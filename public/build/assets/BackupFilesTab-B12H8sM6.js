import{r as n,b as p,j as e}from"./currencyStore-Dk9RVyyc.js";import{c as w}from"./createLucideIcon-BMpC51dL.js";import{L as l}from"./loader-circle-CKPSEXHp.js";import{R as v}from"./refresh-cw-CqkNz5ow.js";import{D}from"./download-CxbKlL8J.js";import{T as R}from"./trash-2-CD_MqfHw.js";const L=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],f=w("archive",L);const U=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],B=w("cloud-upload",U);function $(){const[o,x]=n.useState([]),[c,u]=n.useState(!0),[h,r]=n.useState(null),[d,g]=n.useState(null),[i,b]=n.useState(!1);n.useEffect(()=>{m()},[]);const m=async()=>{u(!0),r(null);try{const a=await p.get("/api/backups");x(a.data.files||[])}catch(a){r("Failed to load backup files. Please try again."),console.error("Backup listing error:",a)}finally{u(!1)}},y=async a=>{if(!d&&confirm(`Delete backup ${a.name}? This cannot be undone.`)){g(a.name),r(null);try{await p.delete(`/api/backups/${encodeURIComponent(a.name)}`),x(s=>s.filter(t=>t.name!==a.name))}catch(s){const t=s.response?.data?.message||"Failed to delete backup file.";r(t),console.error("Delete backup error:",s)}finally{g(null)}}},j=a=>{const s=a.download_url||`/download-backup/${encodeURIComponent(a.name)}`;window.location.href=s},k=async()=>{if(!i){b(!0),r(null);try{const a=await p.get("/backup-now",{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([a.data])),t=document.createElement("a");t.href=s,t.download=`infoshop-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.zip`,t.click(),window.URL.revokeObjectURL(s),await m()}catch(a){const s=a.response?.data?.message||a.message||"Failed to generate backup.";r(s),console.error("Backup now error:",a)}finally{b(!1)}}},N=a=>{if(!a)return"Unknown";try{return new Date(a).toLocaleString()}catch{return a}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-teal-50 border border-teal-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(f,{className:"w-5 h-5 text-teal-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-teal-900",children:"Backup Files"}),e.jsx("p",{className:"text-xs text-teal-700 mt-1",children:"Review previously generated backups, download copies, or delete old archives to reclaim disk space."})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:k,disabled:i,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2.5 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[i?e.jsx(l,{className:"w-4 h-4 animate-spin"}):e.jsx(B,{className:"w-4 h-4"}),"Backup Now"]}),e.jsxs("button",{onClick:m,disabled:c,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2.5 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[c?e.jsx(l,{className:"w-4 h-4 animate-spin"}):e.jsx(v,{className:"w-4 h-4"}),"Refresh List"]}),e.jsxs("div",{className:"text-sm text-gray-600 px-3 py-2 bg-gray-100 rounded-lg border border-gray-200",children:[o.length," backup",o.length===1?"":"s"," available"]})]}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700",children:h}),c?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(l,{className:"w-8 h-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading backups..."})]}):o.length===0?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(f,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No backups found"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Use automation or manual backup tools to create one."})]}):e.jsx("div",{className:"space-y-3",children:o.map(a=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 break-words",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[a.size_human," â€¢ Updated ",N(a.last_modified)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>j(a),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Download"]}),e.jsxs("button",{onClick:()=>y(a),disabled:d===a.name,className:"bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg text-sm font-semibold flex items-center gap-2",children:[d===a.name?e.jsx(l,{className:"w-4 h-4 animate-spin"}):e.jsx(R,{className:"w-4 h-4"}),"Delete"]})]})]},a.name))})]})}export{$ as default};

import{g as at,r as l,f as st,R as lt,j as e}from"./currencyStore-Dk9RVyyc.js";import{P as ct}from"./Payments-DSgOMdsa.js";import{C as mt}from"./Close-B9rgBTOR.js";import{P as ut}from"./PrintReceiptModal-Csw0Y3uy.js";import{P as dt}from"./Percent-BCjtx-gP.js";import{S as k}from"./sweetalert2.esm.all-q958Q1qq.js";import{useAppConfig as pt}from"./AppConfigContext-XFUA3Mas.js";import{u as ft}from"./SalesContext-CG9t8_rq.js";import{u as ht,t as c}from"./currencyFormatter-Be2b0Ktm.js";import{useFirebase as _t}from"./FirebaseContext-4dvVdyML.js";import{G as p}from"./Grid-6qcTmjc4.js";import{B as O}from"./Button-aMjmD1gp.js";import{D as gt,a as xt}from"./DialogContent-Cz4a0t2H.js";import{D as Ct}from"./DialogTitle-osZsMdGC.js";import{I as T}from"./IconButton-PbvyX_sG.js";import{T as f}from"./TextField-DpXyhoD7.js";import{I as h}from"./InputAdornment-DZOHCUsF.js";import{F as bt}from"./FormControlLabel-eGygXIaI.js";import{C as vt}from"./Checkbox-DmEdO0Ay.js";import{D as yt}from"./DialogActions-BraO_KzF.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./Print-5v-Lf9Qb.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./Box-j1BTqM2v.js";import"./extendSxProp-Co6nc6xJ.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./download-CxbKlL8J.js";import"./createLucideIcon-BMpC51dL.js";import"./Card-C4NAxgST.js";import"./CardMedia-lO_mnymB.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./CircularProgress-B97ut0O7.js";import"./numeral-NHlY-3dw.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./useSlot-PFdYD2CN.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./SwitchBase-DLVdjlNh.js";function Le({disabled:E}){const _=ht(),g=at(o=>o.settings.currency_symbol),{return_sale:S,edit_sale:B,sale_id:D,settings:A}=pt(),N=D,M=D,{cartState:$,cartTotal:r,totalProfit:L,emptyCart:G,charges:P,totalChargeAmount:Y,finalTotal:jt,discount:n,setDiscount:d,calculateChargesWithDiscount:x}=ft(),{selectedCustomer:q,saleDate:U,saleTime:V}=l.useContext(st),{createSale:H,isInitialized:J}=_t(),[C,F]=l.useState(!1),[K,z]=l.useState(!1),[Q,R]=l.useState(null),X=A?.auto_open_print_dialog??"1",[w,Z]=l.useState(X==="1"),[m,b]=l.useState(0),[a,v]=l.useState(Y),tt=window.innerWidth<768,y=r-n+a;l.useEffect(()=>{v(x(n))},[P,r,n]);const et=o=>{const s=o.target.value,t=s!==""?parseFloat(s):0;d(t);const u=x(t);v(u)},[ot,j]=lt.useState(!1),rt=()=>{d(0),j(!0)},I=()=>{b(0),d(0),j(!1)},nt=async o=>{if(o.preventDefault(),C)return;F(!0);const s=new FormData(o.currentTarget),t=Object.fromEntries(s.entries());t.amount_received=c(t.amount_received),t.discount=c(t.discount),t.net_total=c(r-n+a),t.change_amount=c(m-(r-n+a)),t.cartItems=$.map(i=>({...i,price:c(i.price),quantity:c(i.quantity),discount:c(i.discount||0)})),t.charges=P.map(i=>({...i,rate_value:c(i.rate_value)})),t.profit_amount=L-n,t.sale_date=U,t.sale_time=V,t.payment_method="Cash",t.contact_id=q.id,t.return_sale=S,t.return_sale_id=N,t.edit_sale_id=M,t.edit_sale=B;const u=`INV-${Date.now()}`;t.invoice_number=u;const W={invoice_number:u,store_id:A?.store_id||1,contact_id:t.contact_id||null,sale_date:t.sale_date,sale_time:t.sale_time,discount:t.discount,total_charge_amount:a,amount_received:t.amount_received,net_total:t.net_total,change_amount:t.change_amount,profit_amount:t.profit_amount,payment_method:t.payment_method,payment_status:"paid",status:"completed",note:t.note||"",return_sale:t.return_sale||!1,return_sale_id:t.return_sale_id||null,edit_sale:t.edit_sale||!1,edit_sale_id:t.edit_sale_id||null,items:t.cartItems,charges:t.charges,created_by:"pos-offline",syncedFrom:"offline"};try{J?(console.log("ðŸ’¾ Saving sale to Firebase:",u),await H(W),console.log("âœ… Sale saved to Firebase successfully")):console.warn("âš ï¸ Firebase not initialized, sale not saved"),k.fire({title:"Success!",text:`Sale ${u} completed successfully!`,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),G(),b(0),d(0),j(!1),w&&(R(W),z(!0))}catch(i){console.error("âŒ Error saving sale:",i),k.fire({title:"Error!",text:`Failed to save sale: ${i.message}`,icon:"error",confirmButtonText:"OK"})}finally{F(!1)}},it=()=>{if(n<0||n>100){alert("Discount must be between 0 and 100");return}const o=r*n/100;d(o);const s=x(o);v(s)};return e.jsxs(p,{size:12,children:[e.jsx(O,{variant:"contained",color:"success",sx:{paddingY:"15px",flexGrow:"1"},size:"large",endIcon:e.jsx(ct,{}),onClick:rt,disabled:E,fullWidth:!0,children:y<0?`REFUND ${_(Math.abs(y))}`:`CASH ${_(y)}`}),e.jsxs(gt,{fullWidth:!0,maxWidth:"sm",open:ot,onClose:I,"aria-labelledby":"alert-dialog-title",PaperProps:{component:"form",onSubmit:nt},fullScreen:tt,children:[e.jsx(Ct,{id:"alert-dialog-title",children:"Cash Checkout"}),e.jsx(T,{"aria-label":"close",onClick:I,sx:o=>({position:"absolute",right:8,top:8,color:o.palette.grey[500]}),children:e.jsx(mt,{})}),e.jsxs(xt,{children:[e.jsx(f,{id:"txtAmount",fullWidth:!0,autoFocus:!0,variant:"outlined",label:r<0?"Refund":"Amount Received",type:"number",name:"amount_received",onFocus:o=>{o.target.select()},onChange:o=>{const s=o.target.value,t=parseFloat(s);b(S&&t>0?-t:t)},sx:{input:{textAlign:"center",fontSize:"2rem"}},value:m,slotProps:{input:{style:{textAlign:"center"},placeholder:r<0?"Refund Amount":"Amount Received",startAdornment:e.jsx(h,{position:"start",children:g})}}}),e.jsx(f,{fullWidth:!0,id:"txtDiscount",type:"number",name:"discount",label:"Discount",variant:"outlined",value:n,sx:{mt:"1.5rem",input:{textAlign:"center",fontSize:"2rem"}},onChange:et,onFocus:o=>{o.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:e.jsx(h,{position:"start",children:g}),endAdornment:e.jsx(h,{position:"start",children:e.jsx(T,{color:"primary",onClick:it,children:e.jsx(dt,{fontSize:"large"})})})}}}),e.jsxs(p,{container:!0,spacing:{xs:2,md:1},mt:3,children:[e.jsx(p,{size:{xs:12,sm:6},children:e.jsx(f,{fullWidth:!0,label:"Payable Amount",variant:"outlined",name:"net_total",value:_(r-n+a,!1),sx:{input:{textAlign:"center",fontSize:"2rem"}},slotProps:{input:{readOnly:!0,style:{textAlign:"center"},startAdornment:e.jsx(h,{position:"start",children:g})}}})}),e.jsx(p,{size:{xs:12,sm:6},children:e.jsx(f,{id:"txtChange",fullWidth:!0,label:"Change",variant:"outlined",name:"change_amount",sx:{input:{textAlign:"center",fontSize:"2rem"}},value:_(m-(r-n+a),!1),slotProps:{input:{readOnly:!0,startAdornment:e.jsx(h,{position:"start",children:g})}}})})]}),e.jsx(f,{fullWidth:!0,variant:"outlined",label:"Note",name:"note",multiline:!0,sx:{mt:"2rem"}}),e.jsx(p,{container:!0,size:12,sx:{mt:"2rem",mb:"1rem"},children:e.jsx(bt,{control:e.jsx(vt,{checked:w,onChange:o=>Z(o.target.checked),name:"open_print_dialog"}),label:"Open Print Dialog"})})]}),e.jsx(yt,{children:e.jsx(O,{variant:"contained",fullWidth:!0,sx:{paddingY:"15px",fontSize:"1.5rem"},type:"submit",disabled:!m||r<0&&m===0||r<0&&m!=r-n+a||r>=0&&m-(r-n+a)<0||C,children:C?"Loading...":r<0?"REFUND":"PAY"})})]}),e.jsx(ut,{open:K,onClose:()=>{z(!1),R(null)},receiptData:Q})]})}export{Le as default};

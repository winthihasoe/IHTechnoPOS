import{r as l,b as g,j as e}from"./currencyStore-Dk9RVyyc.js";import{D as y,C as A}from"./database-oSbIu4Kg.js";import{C as P}from"./circle-check-CQOmOVkC.js";import{L as h}from"./loader-circle-CKPSEXHp.js";import{c as C}from"./createLucideIcon-BMpC51dL.js";import{D as B}from"./download-CxbKlL8J.js";import{R as j}from"./refresh-cw-CqkNz5ow.js";import{C as O}from"./chevron-down-C5MZ1frv.js";import{C as $}from"./chevron-right-BAlzn6w9.js";const z=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],U=C("chart-column",z);const _=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],k=C("play",_);function Q(){const[u,M]=l.useState([]),[n,S]=l.useState([]),[d,f]=l.useState(!0),[b,c]=l.useState(!1),[x,o]=l.useState(null),[N,m]=l.useState(null),[w,r]=l.useState(null),[v,D]=l.useState({});l.useEffect(()=>{p()},[]);const E=s=>{D(a=>({...a,[s]:!a[s]}))},p=async()=>{f(!0),r(null);try{const[s,a]=await Promise.all([g.get("/api/maintenance/database/tables").catch(t=>(console.error("Tables error:",t),{data:{tables:[]}})),g.get("/api/maintenance/database/migrations").catch(t=>(console.error("Migrations error:",t),{data:{migrations:[]}}))]);M(s.data.tables||[]),S(a.data.migrations||[]),(!s.data.tables||s.data.tables.length===0)&&(!a.data.migrations||a.data.migrations.length===0)&&r("No database information available. Database might not be initialized yet.")}catch(s){r("Failed to load database information. Please check database connection and try again."),console.error("Database info error:",s)}finally{f(!1)}},R=async()=>{c(!0),o("migrate"),m(null),r(null);try{const s=await g.post("/api/maintenance/database/migrate");m(s.data.message||"Migrations executed successfully"),await p()}catch(s){const a=s.response?.data?.message||s.response?.data?.error||"Failed to run migrations";r(`Migration Error: ${a}. Check your hosting provider's database access settings if this persists.`),console.error("Migration error:",s)}finally{c(!1),o(null)}},F=async()=>{c(!0),o("seed"),m(null),r(null);try{const s=await g.post("/api/maintenance/database/seed");m(s.data.message||"Seeders executed successfully"),await p()}catch(s){const a=s.response?.data?.message||s.response?.data?.error||"Failed to run seeders";r(`Seeder Error: ${a}. Ensure seeders are available in your database/seeders directory.`),console.error("Seeder error:",s)}finally{c(!1),o(null)}},T=async()=>{c(!0),o("backup"),m(null),r(null);try{const s=await g.get("/api/maintenance/database/backup",{responseType:"blob"});if(s.data.type==="application/json"){const i=new FileReader;i.onload=()=>{const L=JSON.parse(i.result);throw new Error(L.error||"Failed to backup database")},i.readAsText(s.data);return}const a=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=a,t.setAttribute("download",`database-backup-${new Date().toISOString().split("T")[0]}.sql`),document.body.appendChild(t),t.click(),t.parentNode.removeChild(t),window.URL.revokeObjectURL(a),m("Database backup downloaded successfully")}catch(s){const a=s.response?.data?.message||s.response?.data?.error||s.message||"Failed to backup database";r(`Backup Error: ${a}. Ensure mysqldump is available on your hosting server.`),console.error("Backup error:",s)}finally{c(!1),o(null)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900",children:"Database Management"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Manage your database tables, run migrations, seed data, and create backups. All operations require proper database permissions."})]})]}),N&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-900",children:"Success"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:N})]})]}),w&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Error Loading Database"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:w})]})]}),e.jsx("button",{onClick:p,disabled:d,className:"text-red-700 hover:text-red-900 font-semibold text-xs whitespace-nowrap",children:"Retry"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("button",{onClick:R,disabled:b||d,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[x==="migrate"&&e.jsx(h,{className:"w-4 h-4 animate-spin"}),x!=="migrate"&&e.jsx(k,{className:"w-4 h-4"}),"Run Migrations"]}),e.jsxs("button",{onClick:F,disabled:b||d,className:"bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[x==="seed"&&e.jsx(h,{className:"w-4 h-4 animate-spin"}),x!=="seed"&&e.jsx(k,{className:"w-4 h-4"}),"Run Seeders"]}),e.jsxs("button",{onClick:T,disabled:b||d,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[x==="backup"&&e.jsx(h,{className:"w-4 h-4 animate-spin"}),x!=="backup"&&e.jsx(B,{className:"w-4 h-4"}),"Backup Database"]}),e.jsxs("button",{onClick:p,disabled:d||b,className:"bg-gray-600 hover:bg-gray-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg font-semibold text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx(j,{className:`w-4 h-4 ${d?"animate-spin":""}`}),"Refresh"]})]}),d?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(h,{className:"w-8 h-8 text-blue-600 animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading database information..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-purple-600"}),"Database Tables (",u.length,")"]}),u.length===0?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(y,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No tables found in database"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Run migrations to create tables"})]}):e.jsx("div",{className:"space-y-2",children:u.map((s,a)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>E(s.name),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[v[s.name]?e.jsx(O,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}):e.jsx($,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.columns," columns • ",s.engine]})]})]}),e.jsx("div",{className:"flex items-center gap-3 flex-shrink-0 sm:ml-4",children:e.jsxs("div",{className:"flex items-center gap-1 bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-semibold",children:[e.jsx(U,{className:"w-3 h-3"}),s.rows," rows"]})})]}),v[s.name]&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2 uppercase tracking-wide",children:["Collation: ",s.collation]})}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-xs font-semibold text-gray-700 mb-2",children:["Columns (",s.columnDetails?.length||0,")"]})}),s.columnDetails&&s.columnDetails.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-white",children:[e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Column"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Type"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Null"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Key"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Default"}),e.jsx("th",{className:"px-2 py-2 text-left text-gray-700 font-semibold",children:"Extra"})]})}),e.jsx("tbody",{children:s.columnDetails.map((t,i)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-white",children:[e.jsx("td",{className:"px-2 py-2 text-gray-900 font-mono",children:t.name}),e.jsx("td",{className:"px-2 py-2 text-gray-600 font-mono text-xs",children:t.type}),e.jsx("td",{className:"px-2 py-2",children:t.null?e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-1 rounded text-xs",children:"YES"}):e.jsx("span",{className:"bg-red-100 text-red-700 px-2 py-1 rounded text-xs",children:"NO"})}),e.jsx("td",{className:"px-2 py-2 text-gray-600",children:t.key||"-"}),e.jsx("td",{className:"px-2 py-2 text-gray-600 font-mono text-xs",children:t.default!==null?t.default:"-"}),e.jsx("td",{className:"px-2 py-2 text-gray-600 text-xs",children:t.extra||"-"})]},i))})]})}),e.jsx("div",{className:"md:hidden space-y-2",children:s.columnDetails.map((t,i)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 text-xs",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("p",{className:"font-semibold text-gray-900 break-words",children:t.name}),e.jsx("p",{className:"text-gray-600 font-mono text-xs mt-1",children:t.type})]}),e.jsxs("div",{className:"space-y-1 border-t border-gray-200 pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Null:"}),t.null?e.jsx("span",{className:"bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs",children:"YES"}):e.jsx("span",{className:"bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs",children:"NO"})]}),t.key&&e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Key:"}),e.jsx("span",{className:"text-gray-700",children:t.key})]}),t.default!==null&&e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Default:"}),e.jsx("span",{className:"text-gray-700 font-mono text-xs",children:t.default})]}),t.extra&&e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Extra:"}),e.jsx("span",{className:"text-gray-700 text-xs",children:t.extra})]})]})]},i))})]}):e.jsx("p",{className:"text-gray-500 text-xs",children:"No column details available"})]})]},a))})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600"}),"Migrations"]}),n.length===0?e.jsxs("div",{className:"bg-gray-50 border border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(j,{className:"w-10 h-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No migrations found"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:'Click "Run Migrations" to initialize the database'})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("p",{className:"text-xs text-blue-700 font-semibold",children:"Total"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.filter(s=>s.status==="executed").length}),e.jsx("p",{className:"text-xs text-green-700 font-semibold",children:"Executed"})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:n.filter(s=>s.status==="pending").length}),e.jsx("p",{className:"text-xs text-yellow-700 font-semibold",children:"Pending"})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.filter(s=>!s.inFileSystem).length}),e.jsx("p",{className:"text-xs text-red-700 font-semibold",children:"Missing Files"})]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-4 py-2 text-left text-gray-700 font-semibold",children:"Migration Name"}),e.jsx("th",{className:"px-4 py-2 text-center text-gray-700 font-semibold",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-center text-gray-700 font-semibold",children:"Batch"}),e.jsx("th",{className:"px-4 py-2 text-center text-gray-700 font-semibold",children:"File"})]})}),e.jsx("tbody",{children:n.map((s,a)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900 font-mono text-xs break-all",children:s.name}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.status==="executed"?e.jsx("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-semibold",children:"✓ Executed"}):e.jsx("span",{className:"inline-flex items-center gap-1 bg-yellow-100 text-yellow-700 px-2 py-1 rounded text-xs font-semibold",children:"◐ Pending"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.batch?e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-semibold",children:["#",s.batch]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.inFileSystem?e.jsx("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-1 rounded text-xs font-semibold",children:"✓ Present"}):e.jsx("span",{className:"inline-flex items-center gap-1 bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-semibold",children:"✗ Missing"})})]},a))})]})}),e.jsx("div",{className:"md:hidden space-y-2",children:n.map((s,a)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsx("div",{className:"mb-2",children:e.jsx("p",{className:"font-semibold text-gray-900 text-xs break-all",children:s.name})}),e.jsxs("div",{className:"space-y-2 border-t border-gray-200 pt-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Status:"}),s.status==="executed"?e.jsx("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-semibold",children:"✓ Executed"}):e.jsx("span",{className:"inline-flex items-center gap-1 bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs font-semibold",children:"◐ Pending"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"Batch:"}),s.batch?e.jsxs("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs font-semibold",children:["#",s.batch]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"-"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 font-semibold",children:"File:"}),s.inFileSystem?e.jsx("span",{className:"inline-flex items-center gap-1 bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-semibold",children:"✓ Present"}):e.jsx("span",{className:"inline-flex items-center gap-1 bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs font-semibold",children:"✗ Missing"})]})]})]},a))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 mb-2 font-semibold",children:"Legend:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-600",children:[e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-3 h-3 bg-green-500 rounded-full mr-2"}),"Executed: Already run in database"]}),e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-3 h-3 bg-yellow-500 rounded-full mr-2"}),"Pending: Waiting to be executed"]}),e.jsxs("p",{children:[e.jsx("span",{className:"inline-block w-3 h-3 bg-red-500 rounded-full mr-2"}),"Missing: File not found in database/migrations"]})]})]})]})]})]})]})}export{Q as default};

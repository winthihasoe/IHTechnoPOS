import{j as e,r as u,d as w,R as M}from"./currencyStore-Dk9RVyyc.js";import{P as W}from"./Print-5v-Lf9Qb.js";import{c as B}from"./createSvgIcon-B7q9zImx.js";import{l as P,s as N}from"./snapdom-dxSfVsGw.js";import $ from"./Barcode-DaGb-pRP.js";import{u as Y}from"./currencyFormatter-Be2b0Ktm.js";import{s as C}from"./memoTheme-BxRvtGIq.js";import{P as v}from"./Paper-Df0ljdBt.js";import{B as x}from"./Box-j1BTqM2v.js";import{T as o}from"./Typography-DOI0NvTt.js";import{B as L}from"./Button-aMjmD1gp.js";import{I as F}from"./IconButton-PbvyX_sG.js";import{D as E}from"./download-CxbKlL8J.js";import{C as U}from"./Card-C4NAxgST.js";import{C as O}from"./CardMedia-lO_mnymB.js";import{D as y}from"./Divider-D4ysiqwk.js";import{T as Q}from"./TableContainer-Bx1in-E2.js";import{T as G,a as J,b as c,c as K}from"./TableRow-BMfflATG.js";import{T as s}from"./TableCell-DMEjcBPA.js";import"./clsx-B-dksMZM.js";import"./JsBarcode-DwekVVut.js";import"./numeral-NHlY-3dw.js";import"./index-Rj29YxKv.js";import"./useTheme-CvovRv7W.js";import"./extendSxProp-Co6nc6xJ.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./CircularProgress-B97ut0O7.js";import"./createLucideIcon-BMpC51dL.js";import"./dividerClasses-BJEnnqiu.js";const V=B(e.jsx("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"})),X=B(e.jsx("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"}));function De({sale:i,salesItems:T,settings:n,user_name:A,credit_sale:j=!1,autoTriggerPrint:S=!1,hideActionButtons:I=!1}){const h=u.useRef(null),b=P.useReactToPrint({contentRef:h}),[z,Z]=u.useState(i?" "+i.sale_prefix+"/"+i.invoice_number:""),l=Y();u.useEffect(()=>{if(S&&h.current){const t=setTimeout(()=>{b()},300);return()=>clearTimeout(t)}},[S,b]);const H=()=>{const t=window.location.href,a=`Your purchase at ${n.shop_name} receipt: 
${t}`,m=encodeURIComponent(a);let d=i.whatsapp;if(!d&&(d=prompt("Please enter the WhatsApp number (including country code):","94"),!d)){alert("WhatsApp number is required to share the message.");return}const q=`https://wa.me/${d}?text=${m}`;window.open(q,"_blank")},_=async(t=!1,a="png")=>{if(!h.current)return;const m=h.current.cloneNode(!0);Object.assign(m.style,{width:"500px",position:"absolute",left:"-9999px",top:"-9999px",overflow:"hidden",fontSize:"14px",padding:t?"20px":"0"}),m.querySelectorAll("table").forEach(d=>{d.style.width="450px",d.style.minWidth="0",d.style.tableLayout="auto",d.style.overflow="hidden"}),document.body.appendChild(m);try{await N.download(m,{filename:`receipt-${i.id}.${a}`,format:a,scale:2,quality:1,dpr:2}),console.log("Image downloaded successfully!")}catch(d){console.error("Failed to capture and download:",d)}finally{document.body.removeChild(m)}};u.useEffect(()=>{window.handleImageDownload=_,window.snapdom=N},[]);const R=C(v)(({theme:t})=>({width:"500px",padding:t.spacing(3),textAlign:"center","@media print":{boxShadow:"none",color:"black"}})),D=C(v)(({theme:t})=>({width:"100%",fontFamily:n.sale_print_font,textAlign:"center",boxShadow:"none","@media print":{boxShadow:"none",color:"black"}})),p={fontFamily:n.sale_print_font},r={printArea:{...p,fontSize:"16px",paddingRight:parseFloat(n.sale_print_padding_right),paddingLeft:parseFloat(n.sale_print_padding_left),color:"black !important"},receiptTopText:{...p,fontSize:"0.8em",fontWeight:"bold"},receiptSummaryText:{...p,fontSize:"0.8em",fontWeight:"bold",padding:0,borderBottom:"none",color:"black"},receiptSummaryTyp:{...p,fontSize:"1em",fontWeight:"bold",color:"black"},itemsHeader:{...p,fontSize:"0.8em",fontWeight:"bold",padding:"0.25rem 0"},itemsHeaderTyp:{...p,fontSize:"1em",fontWeight:"bold"},itemsCells:{...p,fontSize:"0.9em",fontWeight:"bold",padding:"0.25rem 0",verticalAlign:"middle"},itemsCellsTyp:{...p,fontSize:"0.9em",fontWeight:"bold"}};if(!i||Object.keys(i).length===0)return e.jsx(x,{className:"flex justify-center mt-10 p-0",children:e.jsx(o,{variant:"h6",color:"error",children:"No pending sales available."})});const g=T.filter(t=>!t.charge_id),f=T.filter(t=>t.charge_id);g.reduce((t,a)=>t+a.discount*a.quantity,0);const k=g.reduce((t,a)=>{const m=Number(a.quantity)*(a.unit_price-a.discount)-Number(a.flat_discount);return t+m},0);return e.jsx(x,{className:"flex justify-center mt-10 p-0 text-black",children:e.jsxs(R,{square:!1,className:"receipt-container",children:[!I&&e.jsxs(x,{className:"flex justify-between items-center mb-3 print:hidden text-black",children:[e.jsx(L,{onClick:()=>window.history.back(),variant:"outlined",startIcon:e.jsx(V,{}),children:"Back"}),e.jsxs(x,{className:"flex gap-2",children:[e.jsx(F,{onClick:H,color:"success",children:e.jsx(X,{fontSize:"medium"})}),e.jsx(F,{onClick:()=>_(!0,"jpg"),children:e.jsx(E,{})}),e.jsxs("button",{onClick:b,style:{padding:"8px 16px",backgroundColor:"#1976d2",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"14px"},children:[e.jsx(W,{fontSize:"small",style:{width:"20px",height:"20px"}}),"Print"]})]})]}),e.jsx("div",{id:"print-area",ref:h,className:"p-0 bg-white",style:r.printArea,children:e.jsxs(D,{square:!1,children:[e.jsxs(x,{className:"flex justify-center items-center mt-0 flex-col",children:[e.jsx(U,{sx:{width:160,boxShadow:0},children:e.jsx(O,{component:"img",image:window.location.origin+"/"+n.shop_logo})}),n.show_receipt_shop_name==1&&e.jsx(o,{variant:"h5",sx:{fontSize:"20px",fontFamily:n.sale_print_font,fontWeight:"bold"},color:"black",className:"receipt-shop-name",children:n.shop_name}),e.jsxs(o,{variant:"h6",sx:{fontSize:"15px",fontFamily:n.sale_print_font},color:"black",className:"receipt-address",children:[i.address,e.jsx("br",{}),i.contact_number]})]}),e.jsx(y,{sx:{borderBottom:"1px dashed",borderColor:"black",my:"1rem"},className:"receipt-divider-after-address"}),e.jsxs(x,{className:"flex items-start flex-col justify-start receipt-meta text-black",children:[!j&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{sx:r.receiptTopText,color:"black",children:["Receipt No:",z]}),e.jsxs(o,{sx:r.receiptTopText,color:"black",textAlign:"start",children:["Date:",w(i.created_at).format("DD-MMM-YYYY, h:mm A")+" ","By: ",A]})]}),j&&e.jsx(e.Fragment,{children:e.jsxs(o,{sx:r.receiptTopText,color:"black",textAlign:"start",children:["Print date:",w(i.created_at).format("DD-MMM-YYYY, h:mm A")+" "]})}),e.jsxs(o,{sx:r.receiptTopText,color:"black",children:["Customer: ",i.name]})]}),e.jsx(y,{sx:{borderBottom:"1px dashed",borderColor:"black",my:"1rem"},className:"receipt-divider-after-details"}),e.jsx(Q,{sx:{height:"100%",overflow:"hidden"},children:e.jsxs(G,{sx:{padding:"0",height:"100%"},id:"receipt-items-table",children:[e.jsx(J,{children:e.jsxs(c,{className:"receipt-items-header",children:[e.jsx(s,{sx:r.itemsHeader,children:e.jsx(o,{sx:r.itemsHeaderTyp,color:"black",children:"Item"})}),e.jsx(s,{sx:r.itemsHeader,align:"right",children:e.jsx(o,{sx:r.itemsHeaderTyp,color:"black",children:"Qty."})}),e.jsx(s,{sx:r.itemsHeader,align:"right",children:e.jsx(o,{sx:r.itemsHeaderTyp,color:"black",children:"U.Price"})}),e.jsx(s,{sx:r.itemsHeader,align:"right",children:e.jsx(o,{sx:r.itemsHeaderTyp,color:"black",children:"Disc."})}),e.jsx(s,{sx:r.itemsHeader,align:"right",children:e.jsx(o,{sx:r.itemsHeaderTyp,color:"black",children:"Total"})})]})}),e.jsxs(K,{children:[g.map((t,a)=>e.jsxs(M.Fragment,{children:[e.jsx(c,{className:"receipt-product-row",children:e.jsx(s,{colSpan:5,sx:{...r.itemsCells,borderBottom:"none",paddingBottom:0},children:e.jsx(o,{sx:r.itemsCellsTyp,color:"black",children:e.jsxs("strong",{children:[" ",a+1,".",t.name," ",t.account_number?"| "+t.account_number:""]})})})},`name-row-${a}`),e.jsxs(c,{className:"receipt-details-row",children:[e.jsx(s,{sx:r.itemsCells,align:"right",colSpan:2,children:e.jsxs(o,{sx:r.itemsCellsTyp,color:"black",children:[e.jsx("strong",{children:t.quantity}),Number(t.free_quantity)!==0&&e.jsxs("strong",{children:[" + [Free: ",t.free_quantity,"]"]})]})}),e.jsx(s,{sx:r.itemsCells,align:"right",children:e.jsx(o,{sx:r.itemsCellsTyp,color:"black",children:l(t.unit_price,!1)})}),e.jsx(s,{sx:r.itemsCells,align:"right",children:e.jsx(o,{sx:r.itemsCellsTyp,color:"black",children:l(Number(t.discount*t.quantity)+Number(t.flat_discount),!1)})}),e.jsx(s,{sx:r.itemsCells,align:"right",children:e.jsx(o,{sx:r.itemsCellsTyp,color:"black",children:e.jsx("strong",{children:Number(t.quantity)*(t.unit_price-t.discount)===0?"Free":l(Number(t.quantity)*(t.unit_price-t.discount)-Number(t.flat_discount),!1)})})})]},`details-row-${a}`)]},`item-${a}`)),e.jsx(c,{children:e.jsx(s,{colSpan:5,sx:{padding:"7px 0",borderBottom:"none"}})}),e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:{...r.receiptSummaryText,paddingTop:2},colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Total:"})}),e.jsx(s,{sx:{...r.receiptSummaryText,paddingTop:2},align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(k)})})]}),parseFloat(i.discount)!==0&&e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:r.receiptSummaryText,colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Discount:"})}),e.jsx(s,{sx:r.receiptSummaryText,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(i.discount)})})]}),e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:{...r.receiptSummaryText,paddingBottom:2},colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Subtotal:"})}),e.jsx(s,{sx:{...r.receiptSummaryText,paddingBottom:2},align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(k-parseFloat(i.discount))})})]}),f.length>0&&e.jsx(e.Fragment,{children:f.map((t,a)=>e.jsxs(c,{sx:{border:"none"},className:"receipt-charge-row",children:[e.jsx(s,{sx:r.itemsCells,colSpan:3,children:e.jsxs(o,{sx:r.itemsCellsTyp,color:"black",children:[t.description," ",t.rate_type==="percentage"?`(${t.rate_value}%)`:"(Fixed)"]})}),e.jsx(s,{sx:r.itemsCells,align:"right",colSpan:2,children:e.jsx(o,{sx:r.itemsCellsTyp,color:"black",children:l(t.unit_price)})})]},`charge-${a}`))}),f.length>0&&e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:{...r.receiptSummaryText,paddingTop:2,paddingBottom:2},colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Payable Amount:"})}),e.jsx(s,{sx:{...r.receiptSummaryText,paddingTop:2,paddingBottom:2},align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(i.total_amount)})})]}),e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:r.receiptSummaryText,colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Paid:"})}),e.jsx(s,{sx:r.receiptSummaryText,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(i.amount_received)})})]}),e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:r.receiptSummaryText,colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Balance:"})}),e.jsx(s,{sx:r.receiptSummaryText,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(parseFloat(i.amount_received)-parseFloat(i.total_amount))})})]}),j&&parseFloat(i.amount_received)-parseFloat(i.total_amount)!==parseFloat(i.balance)&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:r.receiptSummaryText,colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Old Balance:"})}),e.jsx(s,{sx:r.receiptSummaryText,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(parseFloat(i.balance)-(parseFloat(i.amount_received)-parseFloat(i.total_amount)))})})]}),e.jsxs(c,{sx:{border:"none"},className:"receipt-summary-row",children:[e.jsx(s,{sx:r.receiptSummaryText,colSpan:4,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:"Total Balance:"})}),e.jsx(s,{sx:r.receiptSummaryText,align:"right",children:e.jsx(o,{sx:r.receiptSummaryTyp,color:"black",children:l(i.balance)})})]})]})]})]})}),e.jsx(y,{sx:{borderBottom:"1px dashed",borderColor:"black",my:"1rem"},className:"receipt-divider-before-footer"}),e.jsx("div",{className:"receipt-barcode flex justify-center",children:e.jsx($,{value:i.invoice_number})}),e.jsx(y,{sx:{borderBottom:"1px dashed",borderColor:"black",my:"1rem"},className:"receipt-divider-before-footer"}),e.jsx("div",{className:"receipt-footer",style:r.receiptSummaryText,dangerouslySetInnerHTML:{__html:n.sale_receipt_note}}),e.jsx("div",{className:"receipt-second-note",style:r.receiptSummaryText,dangerouslySetInnerHTML:{__html:n.sale_receipt_second_note}})]})})]})})}export{De as ReceiptDisplay};

import{r as s,j as e,c as u,H as b}from"./currencyStore-Dk9RVyyc.js";import{J as w}from"./JsBarcode-DwekVVut.js";import{C as j}from"./Card-C4NAxgST.js";import{C}from"./CardContent-CCQfyhgH.js";import{B as a}from"./Box-j1BTqM2v.js";import{C as y}from"./CircularProgress-B97ut0O7.js";import{B as _}from"./Button-aMjmD1gp.js";import{P as E}from"./printer-BGHrbooI.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./createLucideIcon-BMpC51dL.js";const P=({template:r,barcodeSettings:n,templateData:i,maxHeight:f="600px",maxWidth:l="320px",isPrint:x=!1})=>{const[c,d]=s.useState(""),[p,m]=s.useState(null);return s.useEffect(()=>{(async()=>{if(!r){d("");return}try{let t=r;i&&Object.entries(i).forEach(([o,h])=>{t=t.replace(new RegExp(`\\{\\{${o}\\}\\}`,"g"),h?String(h).replace(/</g,"&lt;").replace(/>/g,"&gt;"):"")}),t=t.replace(/\{\{(\w+)\}\}/g,""),d(t),m(null),setTimeout(()=>{try{const o=document.getElementById("barcode-svg");o&&i?.barcode_code&&w(o,i.barcode_code,{format:n?.format||"CODE128",width:n?.width||2,height:n?.height||35,fontSize:n?.fontSize||14})}catch(o){console.error("Error generating barcode:",o)}},100)}catch(t){console.error("Error rendering template:",t),m("Failed to render template"),d("")}})()},[r,n,i]),e.jsx(j,{sx:{backgroundColor:"#fafafa",display:"flex",flexDirection:"column",maxHeight:f,"@media print":{backgroundColor:"white",boxShadow:"none",border:"none"}},children:e.jsx(C,{sx:{overflowY:"auto",p:2,display:"flex",alignItems:"center",justifyContent:"center",width:"100%","@media print":{p:0,backgroundColor:"white"}},children:p?e.jsx(a,{sx:{color:"error.main",textAlign:"center"},children:p}):c?e.jsx(a,{sx:{p:2,backgroundColor:"white",border:"1px solid #e0e0e0",borderRadius:"4px",width:"100%",maxWidth:l,"@media print":{p:0,backgroundColor:"white",border:"none",borderRadius:0}},dangerouslySetInnerHTML:{__html:c}}):e.jsx(a,{sx:{p:2,backgroundColor:"white",border:"1px dashed #cccccc",borderRadius:"4px",width:"100%",maxWidth:l,color:"#999",textAlign:"center"},children:"No preview available"})})})};function K({product:r}){const[n,i]=s.useState({format:"CODE128",width:2,height:35,fontSize:14}),[f,l]=s.useState(""),[x,c]=s.useState(!0),d=u().props.settings.shop_name;s.useEffect(()=>{(async()=>{try{c(!0);const o=await(await fetch("/api/barcode-template")).json();l(o.template||""),o.barcode_settings&&i(o.barcode_settings)}catch(t){console.error("Error fetching barcode template:",t)}finally{c(!1)}})()},[]);const p={product_name:r.name||"",price:r.selling_price?`${r.selling_price}`:"",barcode_code:r.barcode||r.batch_number||"",store_name:d||"",date:new Date().toLocaleDateString()},m=()=>{window.print()};return x?e.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:e.jsx(y,{})}):e.jsxs(e.Fragment,{children:[e.jsx(b,{title:`Barcode - ${r.name}`}),e.jsxs(a,{sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",gap:3,"@media print":{p:0,gap:0}},children:[e.jsx(_,{variant:"contained",color:"primary",startIcon:e.jsx(E,{size:20}),onClick:m,sx:{mb:2,"@media print":{display:"none"}},children:"Print Barcode"}),e.jsx(a,{sx:{display:"flex",justifyContent:"center","@media print":{p:0,m:0,background:"white"}},children:e.jsx(P,{template:f,barcodeSettings:n,templateData:p,maxHeight:"none",maxWidth:"400px",isPrint:!0})})]})]})}export{K as default};

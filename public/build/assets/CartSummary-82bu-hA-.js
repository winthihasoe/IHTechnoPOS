import{g as _,r as s,j as r}from"./currencyStore-Dk9RVyyc.js";import{u as $}from"./SalesContext-CG9t8_rq.js";import{A as E}from"./Add-5ZpxTNJx.js";import{D as w}from"./Delete-DDMcR4JX.js";import{u as O}from"./currencyFormatter-Be2b0Ktm.js";import{a as M}from"./chargesService-CCVnmmfA.js";import{L as N}from"./List-OrinuOpJ.js";import{D as p}from"./Divider-D4ysiqwk.js";import{L as x}from"./ListItem-BK8RisGy.js";import{L as h}from"./ListItemText--0XI93dL.js";import{T as t}from"./Typography-DOI0NvTt.js";import{B as i}from"./Box-j1BTqM2v.js";import{I as P}from"./IconButton-PbvyX_sG.js";import{B as f}from"./Button-aMjmD1gp.js";import{D as Q,a as R}from"./DialogContent-Cz4a0t2H.js";import{D as q}from"./DialogTitle-osZsMdGC.js";import{T as G}from"./TextField-DpXyhoD7.js";import{M as H}from"./MenuItem-CEIQJ6q4.js";import{D as J}from"./DialogActions-BraO_KzF.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./numeral-NHlY-3dw.js";import"./database-DEIbwPOq.js";import"./import-wrapper-prod-jq4Om1Jp.js";import"./ListContext-CTnR0k9S.js";import"./dividerClasses-BJEnnqiu.js";import"./isMuiElement-HmfyYHhb.js";import"./useForkRef-DgOCCfFR.js";import"./useSlot-PFdYD2CN.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./listItemTextClasses-DNpdtY9T.js";import"./index-CsFzvdgQ.js";import"./useTheme-CvovRv7W.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./CircularProgress-B97ut0O7.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./useControlled-DRAJCB75.js";import"./listItemIconClasses-vD-ryqxg.js";function Zr(){const{cartState:v,cartTotal:u,totalQuantity:A,charges:a,totalChargeAmount:K,finalTotal:U,discount:T,calculateChargeAmountWithDiscount:y,addCharge:S,removeCharge:D}=$(),{settings:I}=_(),[g,j]=s.useState([]),[z,n]=s.useState(!1),[l,C]=s.useState(""),m=O(),b=a.reduce((e,o)=>e+y(o),0),B=u-T+b,c=s.useCallback(async()=>{try{const e=await M();j(e),console.log(`✅ Loaded ${e.length} active charges for cart`)}catch(e){console.error("❌ Error loading charges:",e),j([])}},[]);s.useEffect(()=>{c()},[c]);const L=s.useCallback(()=>{c(),n(!0)},[c]),W=()=>{const e=a.map(o=>o.id);return g.filter(o=>!e.includes(o.id))},k=()=>{if(l){const e=g.find(o=>o.id===parseInt(l));e&&(S(e),C(""),n(!1))}},F=e=>{D(e)},d=W();return r.jsxs(N,{sx:{width:"100%",bgcolor:"background.paper",pb:3},children:[r.jsx(p,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(x,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsxs("strong",{children:[v.length," | Qty. ",A]})}),children:r.jsx(h,{primary:"Total Items"})}),r.jsx(x,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:m(u)})}),children:r.jsx(h,{primary:"Subtotal"})}),r.jsx(p,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}}),a.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(i,{sx:{px:2,py:1},children:[r.jsx(t,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Charges & Taxes"}),a.map(e=>r.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,py:.5},children:[r.jsxs(i,{sx:{flex:1},children:[r.jsx(t,{variant:"body2",sx:{fontSize:"0.85rem"},children:e.name}),r.jsx(t,{variant:"caption",sx:{color:"grey.600"},children:e.rate_type==="percentage"?`${e.rate_value}%`:"Fixed"})]}),r.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(t,{variant:"body2",sx:{fontWeight:500,minWidth:"70px",textAlign:"right"},children:m(y(e))}),r.jsx(P,{size:"small",onClick:()=>F(e.id),color:"error",children:r.jsx(w,{sx:{fontSize:"1rem"}})})]})]},e.id))]}),r.jsx(p,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}})]}),r.jsx(i,{sx:{px:2,py:1,mb:1},children:r.jsx(f,{variant:"outlined",size:"small",startIcon:r.jsx(E,{}),onClick:L,fullWidth:!0,children:"Add Charge"})}),a.length>0&&r.jsx(x,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:m(b)})}),children:r.jsx(h,{primary:"Total Charges"})}),r.jsx(p,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(x,{secondaryAction:r.jsx(t,{variant:"h5",sx:{fontSize:{sm:"1.1rem",xs:"1.3rem"},fontWeight:700,color:"primary.main"},children:m(B)}),children:r.jsx(h,{primary:"FINAL TOTAL",primaryTypographyProps:{sx:{fontWeight:700,fontSize:"1.1rem"}}})}),r.jsxs(Q,{open:z,onClose:()=>n(!1),children:[r.jsx(q,{children:"Add Charge/Tax"}),r.jsx(R,{sx:{minWidth:300,pt:2},children:d.length>0?r.jsx(G,{select:!0,fullWidth:!0,label:"Select Charge",value:l,onChange:e=>C(e.target.value),size:"small",children:d.map(e=>r.jsxs(H,{value:e.id,children:[e.name," (",e.rate_type==="percentage"?`${e.rate_value}%`:`${I.currency_symbol}${e.rate_value}`,")"]},e.id))}):r.jsx(i,{sx:{py:2,textAlign:"center"},children:r.jsx(t,{variant:"body2",color:"text.secondary",children:g.length===0?"No charges available. Please sync data first.":"All available charges have been added."})})}),r.jsxs(J,{children:[r.jsx(f,{onClick:()=>n(!1),children:d.length>0?"Cancel":"Close"}),d.length>0&&r.jsx(f,{onClick:k,variant:"contained",disabled:!l,children:"Add"})]})]})]})}export{Zr as default};

import{j as t,g as xt,c as f,r,R as gt,b as q,a as Y}from"./currencyStore-Dk9RVyyc.js";import{P as jt}from"./PrintReceiptModal-Csw0Y3uy.js";import{P as Ct}from"./Percent-BCjtx-gP.js";import{P as G}from"./Payments-DSgOMdsa.js";import{C as J}from"./CreditCard-Dwl4hWaF.js";import{c as bt}from"./createSvgIcon-B7q9zImx.js";import{H as yt}from"./HighlightOff-Bl6nUsD3.js";import{F as _t}from"./index-RHigu7j0.js";import{f as Pt}from"./index-NgBaJJmW.js";import{S as V}from"./sweetalert2.esm.all-q958Q1qq.js";import{u as Dt,t as d}from"./currencyFormatter-Be2b0Ktm.js";import{D as St,a as vt}from"./DialogContent-Cz4a0t2H.js";import{D as At}from"./DialogTitle-osZsMdGC.js";import{I as F}from"./IconButton-PbvyX_sG.js";import{X as It}from"./x-DFsc1drM.js";import{G as i}from"./Grid-6qcTmjc4.js";import{T as y}from"./TextField-DpXyhoD7.js";import{I as _}from"./InputAdornment-DZOHCUsF.js";import{B as x}from"./Button-aMjmD1gp.js";import{D as zt}from"./Divider-D4ysiqwk.js";import{T as Ft,c as kt,b as wt}from"./TableRow-BMfflATG.js";import{T as k}from"./TableCell-DMEjcBPA.js";import{F as Tt}from"./FormControlLabel-eGygXIaI.js";import{C as Wt}from"./Checkbox-DmEdO0Ay.js";import{D as Et}from"./DialogActions-BraO_KzF.js";const Q=bt(t.jsx("path",{d:"M9 16h2V8H9zm3-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m1-4h2V8h-2z"}));function le({useCart:U,open:P,setOpen:w,selectedContact:T,formData:X,is_sale:W=!1}){const E=Dt(),D=xt(e=>e.settings.currency_symbol),{cartState:K,cartTotal:l,emptyCart:Z,totalProfit:$,charges:R,totalChargeAmount:tt,finalTotal:et,discount:a,setDiscount:m,calculateChargesWithDiscount:S}=U(),nt=f().props.return_sale,st=f().props.sale_id,ot=f().props.edit_sale,at=f().props.sale_id,[v,O]=r.useState(!1),[rt,B]=r.useState(!1),[it,M]=r.useState(null),lt=f().props.settings?.auto_open_print_dialog??"1",[N,ct]=r.useState(lt==="1"),[g,j]=r.useState(et-a),[u,C]=r.useState([]),[A,I]=r.useState(0),[p,z]=r.useState(tt),L=l-a+p;r.useEffect(()=>{const e=S(a);z(e),j(l-a+e)},[R,l,a]);const[Rt,ut]=gt.useState(null),dt=()=>{ut(null)},mt=e=>{const o=e.target.value,n=o!==""?parseFloat(o):0;m(n);const c=S(n);z(c)},H=()=>{C([]),I(0),m(0),w(!1)};r.useEffect(()=>{P&&m(0)},[P]),r.useEffect(()=>{const e=l-a+p;j(e),I(u.reduce((o,n)=>o+n.amount,0))},[]),r.useEffect(()=>{I(u.reduce((e,o)=>e+o.amount,0))},[u]);const pt=e=>{if(e.preventDefault(),v)return;O(!0);const o=new FormData(e.currentTarget);let n=Object.fromEntries(o.entries());n.discount=d(n.discount),n.net_total=d(L),n.cartItems=K.map(s=>({...s,price:d(s.price),quantity:d(s.quantity),discount:d(s.discount||0)})),n.charges=R.map(s=>({...s,rate_value:d(s.rate_value)})),n.contact_id=T.id,n.payments=u.map(s=>({...s,amount:d(s.amount)})),n={...n,...X},n.profit_amount=$-a,n.return_sale=nt,n.return_sale_id=st,n.edit_sale_id=at,n.edit_sale=ot;let c="/pos/checkout";W||(c="/purchase/store"),q.post(c,n).then(s=>{V.fire({title:"Success!",text:s.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),Z(),m(0),C([]),W?(N&&s.data.receipt?(M(s.data.receipt),B(!0)):Y.visit("/receipt/"+s.data.sale_id),q.get("/sale-notification/"+s.data.sale_id).then(h=>{console.log("Notification sent successfully:",h.data.success)}).catch(h=>{console.error("Failed to send notification:",h.response.data.error)})):Y.visit("/purchases"),w(!1)}).catch(s=>{const h=JSON.stringify(s.response,Object.getOwnPropertyNames(s));V.fire({title:"Failed!",text:h,icon:"error",showConfirmButton:!0}),console.log(s)}).finally(()=>{O(!1)})},b=e=>{const o=l-a+p,n=A+parseFloat(g);if(o<n)alert("Payment cannot be exceeded the total amount");else if(g){const c={payment_method:e,amount:parseFloat(g)};C([...u,c]);const s=o-n;j(s>0?s:0)}dt()},ht=e=>{const o=u.filter((n,c)=>c!==e);C(o)},ft=()=>{if(a<0||a>100){alert("Discount must be between 0 and 100");return}const e=l*a/100;m(e);const o=S(e);z(o)};return t.jsxs(t.Fragment,{children:[t.jsxs(St,{fullWidth:!0,fullScreen:window.innerWidth<768,maxWidth:"sm",open:P,onClose:H,"aria-labelledby":"alert-dialog-title",PaperProps:{component:"form",onSubmit:pt},children:[t.jsx(At,{id:"alert-dialog-title",children:"ADD PAYMENTS"}),t.jsx(F,{"aria-label":"close",onClick:H,sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[600]}),children:t.jsx(It,{size:26})}),t.jsxs(vt,{children:[t.jsxs(i,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(i,{size:{xs:12,sm:6},children:t.jsx(y,{fullWidth:!0,type:"number",name:"discount",label:"Discount",variant:"outlined",value:a,onChange:mt,onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D}),endAdornment:t.jsx(_,{position:"start",children:t.jsx(F,{color:"primary",onClick:ft,children:t.jsx(Ct,{fontSize:"small"})})})}}})}),t.jsx(i,{size:{xs:12,sm:6},children:t.jsx(y,{size:"large",fullWidth:!0,name:"net_total",label:"Total",variant:"outlined",sx:{input:{fontWeight:"bold"},"& .MuiOutlinedInput-root":{backgroundColor:"rgba(25, 118, 210, 0.08)"}},value:String(E(L,!1))||"0",onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D}),readOnly:!0}}})}),t.jsxs(i,{container:!0,size:12,flexDirection:"column",alignItems:"center",justifyContent:"center",children:[t.jsx(i,{size:12,sx:{mt:"1rem"},children:t.jsx(y,{autoFocus:!0,fullWidth:!0,type:"number",name:"amount",label:"Amount",variant:"outlined",value:g,onChange:e=>j(e.target.value),onFocus:e=>{e.target.select()},sx:{input:{fontSize:"1.4rem"}},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(_,{position:"start",children:D})}}})}),t.jsxs(i,{size:12,spacing:1,container:!0,justifyContent:"center",children:[t.jsx(i,{size:{xs:6,sm:4},children:t.jsx(x,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(G,{}),onClick:()=>b("Cash"),color:"success",children:"CASH"})}),T?.id!==1&&t.jsx(i,{size:{xs:6,sm:4},children:t.jsx(x,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(Q,{}),onClick:()=>b("Credit"),color:"error",children:"CREDIT"})}),t.jsx(i,{size:{xs:6,sm:4},children:t.jsx(x,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(J,{}),onClick:()=>b("Cheque"),children:"CHEQUE"})}),t.jsx(i,{size:{xs:6,sm:4},children:t.jsx(x,{fullWidth:!0,component:"label",role:void 0,variant:"contained",startIcon:t.jsx(_t,{icon:Pt,size:"2xl"}),onClick:()=>b("Card"),children:"CARD"})})]})]})]}),t.jsx(zt,{sx:{py:"0.5rem"}}),t.jsx(Ft,{sx:{width:"100%",bgcolor:"background.paper"},children:t.jsx(kt,{children:u.map((e,o)=>t.jsxs(wt,{children:[t.jsxs(k,{sx:{padding:"5px 16px"},children:[e.payment_method==="Cash"&&t.jsx(G,{}),e.payment_method==="Cheque"&&t.jsx(J,{}),e.payment_method==="Credit"&&t.jsx(Q,{}),t.jsx("span",{className:"ml-2",children:t.jsx("strong",{children:e.payment_method})})]}),t.jsx(k,{align:"right",children:t.jsx("strong",{children:E(e.amount)})}),t.jsx(k,{align:"center",children:t.jsx(F,{edge:"end",color:"error",onClick:()=>ht(o),children:t.jsx(yt,{})})})]},o))})}),t.jsx(i,{container:!0,size:12,sx:{mt:"1rem",mb:"1rem"},children:t.jsx(Tt,{control:t.jsx(Wt,{checked:N,onChange:e=>ct(e.target.checked),name:"open_print_dialog"}),label:"Open Print Dialog"})}),t.jsx(y,{fullWidth:!0,variant:"outlined",label:"Note",name:"note",multiline:!0,sx:{mt:"1rem"},size:"large"})]}),t.jsx(Et,{children:t.jsx(x,{variant:"contained",fullWidth:!0,sx:{paddingY:"15px",fontSize:"1.5rem"},type:"submit",disabled:A-(l-a+p)<0||v||A>l-a+p,children:v?"Loading...":"PAY"})})]}),t.jsx(jt,{open:rt,onClose:()=>{B(!1),M(null)},receiptData:it})]})}export{le as P};

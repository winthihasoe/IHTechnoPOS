import{r as c,j as e,d as w,b as g}from"./currencyStore-Dk9RVyyc.js";import{S as u}from"./sweetalert2.esm.all-q958Q1qq.js";import C from"./BatchModal-COABRYv3.js";import{T as D}from"./trash-2-CD_MqfHw.js";import"./Close-B9rgBTOR.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./react-select.esm-Cy0FGMM3.js";import"./Select-ef7c0426.esm-CXaJakO2.js";import"./toPropertyKey-C9c9JG92.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useForkRef-DgOCCfFR.js";import"./index-DJHI8khq.js";import"./floating-ui.dom-CpMS8hwT.js";import"./DialogContent-Cz4a0t2H.js";import"./useTheme-CvovRv7W.js";import"./useSlot-PFdYD2CN.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./useId-9XzpHYrc.js";import"./DialogTitle-osZsMdGC.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./Button-aMjmD1gp.js";import"./CircularProgress-B97ut0O7.js";import"./IconButton-PbvyX_sG.js";import"./Grid-6qcTmjc4.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./TextField-DpXyhoD7.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./FormControlLabel-eGygXIaI.js";import"./Switch-DzXzblLj.js";import"./SwitchBase-DLVdjlNh.js";import"./DialogActions-BraO_KzF.js";import"./createLucideIcon-BMpC51dL.js";function _t({product:x,batches:d=[],onBatchesChange:S,contacts:h=[]}){const[s,a]=c.useState(d),[j,l]=c.useState(!1),[f,m]=c.useState(null);c.useEffect(()=>{a(d)},[d]);const y=async t=>{try{const r=await g.get(`/api/products/${x.id}/batches`);r.data.batches&&a(r.data.batches)}catch(r){console.error("Failed to reload batches:",r);const o=t.batch||t;o&&o.id&&a(p=>p.map(n=>n.id===o.id||n.batch_id===o.id?{...n,...o,batch_id:o.id}:n))}l(!1),m(null)},b=t=>{m(t),l(!0)},v=(t,r)=>{t.stopPropagation(),u.fire({title:"Delete Batch?",text:"Are you sure you want to delete this batch?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d32f2f",cancelButtonColor:"#757575",confirmButtonText:"Delete"}).then(o=>{o.isConfirmed&&N(r)})},N=async t=>{try{const r=await g.delete(`/productbatch/${t}`);a(o=>o.filter(p=>p.id!==t)),u.fire({icon:"success",title:"Deleted",text:"Batch deleted successfully",position:"bottom",toast:!0,timer:1500,showConfirmButton:!1})}catch(r){u.fire({icon:"error",title:"Error",text:r.response?.data?.message||"Failed to delete batch",position:"bottom",toast:!0,timer:1500,showConfirmButton:!1})}},B=t=>{if(!t.contact_id)return"No Supplier";if(t.contact)return t.contact.name;const r=h.find(o=>o.id===t.contact_id);return r?r.name:"Unknown Supplier"},i=({label:t,value:r})=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide block mb-1",children:t}),e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:r||"-"})]});return e.jsxs(e.Fragment,{children:[e.jsx("div",{"data-batch-modal-trigger":!0,onClick:()=>{m(null),l(!0)},className:"hidden"}),e.jsx("div",{className:"space-y-3",children:s&&s.length>0?s.map(t=>e.jsxs("div",{onClick:()=>b(t),className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md hover:border-blue-300 transition-all duration-200 cursor-pointer",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-gray-900",children:t.batch_number}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:B(t)})]}),s.length>1&&e.jsx("button",{type:"button",onClick:r=>v(r,t.id),className:"p-1.5 bg-red-500 text-white rounded-lg hover:bg-red-600 hover:cursor-pointer transition-colors",children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(i,{label:"Cost",value:t.cost}),e.jsx(i,{label:"Price",value:t.price}),e.jsx(i,{label:"Discount %",value:`${t.discount_percentage||0}%`}),e.jsx(i,{label:"Flat Discount",value:t.discount||0}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{label:"Expiry Date",value:t.expiry_date?w(t.expiry_date).format("DD/MM/YYYY"):"No expiry"})})]})})]},t.id)):e.jsxs("div",{className:"bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 p-6 text-center",children:[e.jsx("p",{className:"text-gray-600 font-medium",children:"No batches found"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Create batches to track inventory"})]})}),e.jsx(C,{batchModalOpen:j,setBatchModalOpen:l,selectedBatch:f,selectedProduct:x,contacts:h,refreshProducts:y,initialIsNew:!f})]})}export{_t as default};

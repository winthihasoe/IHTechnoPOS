import{r as i,j as e,H as B,b as z}from"./currencyStore-Dk9RVyyc.js";import{A as D}from"./AuthenticatedLayout-CblcNqH9.js";import{u as E}from"./index-DbXUpaKY.js";import{F as P,S as $,Z as L,a as A}from"./zap-VK6j0iuH.js";import{D as I,C as R}from"./database-oSbIu4Kg.js";import{U}from"./upload-cVSUPpRP.js";import{L as V}from"./loader-circle-CKPSEXHp.js";import{X as Z}from"./x-DFsc1drM.js";import{C as _}from"./circle-check-CQOmOVkC.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./Payments-DSgOMdsa.js";import"./Receipt-DnWIM4Bg.js";import"./index-RHigu7j0.js";import"./index-NgBaJJmW.js";import"./infoshop-hkdJrh2a.js";import"./Toolbar-f3-_dlD0.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./ListItemButton-DDnSs3En.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./listItemIconClasses-vD-ryqxg.js";import"./ListItemText--0XI93dL.js";import"./listItemTextClasses-DNpdtY9T.js";import"./useSlot-PFdYD2CN.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./useTheme-CvovRv7W.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./Collapse-CHgnjEwQ.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./Box-j1BTqM2v.js";import"./CssBaseline-DBisayGl.js";import"./AppBar-CxLpgr4B.js";import"./Paper-Df0ljdBt.js";import"./IconButton-PbvyX_sG.js";import"./useId-9XzpHYrc.js";import"./CircularProgress-B97ut0O7.js";import"./Grid-6qcTmjc4.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./Tooltip-DjVJzg5-.js";import"./index-DM5RHFVd.js";import"./useControlled-DRAJCB75.js";import"./Grow-D31e1sMI.js";import"./Popper-pZx5Iht2.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-DuznN7Ax.js";import"./Drawer-Dk2A_cxp.js";import"./mergeSlotProps-D_PRovB-.js";import"./debounce-Be36O1Ab.js";import"./ownerWindow-HkKU3E4x.js";import"./Modal-D1QunwiJ.js";import"./ListItem-BK8RisGy.js";import"./index-P4sNTowN.js";import"./tslib.es6-BUas5LQb.js";import"./createLucideIcon-BMpC51dL.js";function as(){const[o,f]=i.useState(null),[c,b]=i.useState(!1),[j,g]=i.useState(0),[d,n]=i.useState("idle"),[u,p]=i.useState([]),[y,m]=i.useState(null),N=i.useRef(null),t=(s,r="info")=>{const a=new Date().toLocaleTimeString();p(l=>[...l,{message:s,type:r,timestamp:a}])},M=()=>{N.current?.scrollIntoView({behavior:"smooth"})};i.useEffect(()=>{M()},[u]);const v=50*1024*1024,k=i.useCallback(s=>{if(s[0]?.name.endsWith(".zip")){if(s[0].size>v){m(`File too large. Maximum size is 50MB. Your file is ${(s[0].size/1024/1024).toFixed(2)}MB`),t(`Error: File exceeds 50MB limit (${(s[0].size/1024/1024).toFixed(2)}MB)`,"error");return}f(s[0]),m(null),p([]),n("idle"),t(`File selected: ${s[0].name} (${(s[0].size/1024/1024).toFixed(2)}MB)`,"success")}else m("Only ZIP files are allowed"),t("Error: Only ZIP files are allowed","error")},[]),{getRootProps:C,getInputProps:S,isDragActive:w}=E({onDrop:k,accept:{"application/zip":[".zip"]},maxSize:v,multiple:!1,disabled:c,onDropRejected:s=>{const r=s[0];r.errors[0]?.code==="file-too-large"&&(m(`File too large. Maximum size is 50MB. Your file is ${(r.file.size/1024/1024).toFixed(2)}MB`),t(`Error: File rejected - exceeds 50MB limit (${(r.file.size/1024/1024).toFixed(2)}MB)`,"error"))}}),F=async s=>{if(s.preventDefault(),!o||c)return;b(!0),n("validating"),m(null),g(0),p([]),t("Preparing update package...","info"),t("ðŸ“‹ Validating folder structure...","info"),t("Required folders: app, routes, resources, config, database, lang","info"),t("Optional folders: vendor, public (build folder will be replaced)","info");const r=new FormData;r.append("zip_file",o);try{n("uploading"),t("Uploading to server...","info");const a=await z.post("/upload-v2",r,{headers:{"Content-Type":"multipart/form-data"},timeout:9e5,onUploadProgress:l=>{const x=Math.round(l.loaded*100/l.total);g(x),x===100&&(n("processing"),t("Upload complete. Processing update...","success"))}});n("success"),t("âœ“ Update completed successfully!","success"),a.data.migrations_output&&(t("Migration Output:","info"),a.data.migrations_output.split(`
`).forEach(x=>{x.trim()&&t(x.trim(),"info")}))}catch(a){n("error");const l=a.response?.data?.error||a.message||"Update failed";m(l),t(`âœ— Error: ${l}`,"error"),a.response?.data?.details&&(t("Error Details:","error"),t(a.response.data.details,"error"))}finally{b(!1)}},h=()=>{f(null),n("idle"),p([]),m(null),g(0)};return e.jsxs(D,{header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"System Update V2"}),children:[e.jsx(B,{title:"Update V2"}),e.jsxs("div",{className:"py-6 px-4 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3 mb-6",children:[e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Migration Based"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Auto Updates"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:e.jsx($,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Auto Backup"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Safe Updates"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:e.jsx(I,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Smart Rollback"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Fail-Safe"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pre-flight Checks"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Validated"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Update Package"}),e.jsxs("div",{...C(),className:`
                            border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all
                            ${w?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
                            ${c?"opacity-50 cursor-not-allowed":""}
                            ${o?"bg-gray-50":"bg-white"}
                        `,children:[e.jsx("input",{...S()}),e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-blue-100 p-4 rounded-full",children:e.jsx(A,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(o.size/1024/1024).toFixed(2)," MB"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full",children:e.jsx(U,{className:"w-8 h-8 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:w?"Drop the file here":"Drag & drop your update package"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"or click to browse (ZIP files only, max 50MB)"})]})]})})]}),y&&e.jsxs("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Update Failed"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:y})]})]}),c&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[d==="validating"&&"Validating...",d==="uploading"&&`Uploading... ${j}%`,d==="processing"&&"Processing update..."]}),d==="processing"&&e.jsx(V,{className:"w-4 h-4 text-blue-600 animate-spin"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${d==="processing"?100:j}%`}})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[o&&!c&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:F,className:"flex-1 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Start Update"]}),e.jsxs("button",{onClick:h,className:"px-4 py-2.5 border border-gray-300 text-gray-700 rounded-lg font-semibold text-sm hover:bg-gray-50 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Cancel"]})]}),d==="success"&&e.jsxs("button",{onClick:h,className:"flex-1 bg-green-600 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Upload Another Update"]}),d==="error"&&e.jsx("button",{onClick:h,className:"flex-1 bg-gray-600 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:"Try Again"})]})]}),u.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Update Logs"}),e.jsx("button",{onClick:()=>p([]),className:"text-xs text-gray-500 hover:text-gray-700 font-semibold",children:"Clear Logs"})]}),e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4 max-h-96 overflow-y-auto font-mono text-xs",children:[u.map((s,r)=>e.jsxs("div",{className:`py-1 flex gap-3 ${s.type==="error"?"text-red-400":s.type==="success"?"text-green-400":s.type==="warning"?"text-yellow-400":"text-gray-300"}`,children:[e.jsxs("span",{className:"text-gray-500",children:["[",s.timestamp,"]"]}),e.jsx("span",{className:"flex-1",children:s.message})]},r)),e.jsx("div",{ref:N})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Before You Update"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1",children:[e.jsx("li",{children:"â€¢ Ensure you have at least 100MB of free disk space"}),e.jsx("li",{children:"â€¢ The system will automatically create a backup before updating"}),e.jsx("li",{children:"â€¢ Maintenance mode will be enabled during the update process"}),e.jsx("li",{children:"â€¢ If the update fails, the system will automatically rollback"}),e.jsx("li",{children:"â€¢ Check the logs below for detailed progress information"})]})]})]})]})}export{as as default};

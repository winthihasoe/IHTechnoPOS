import{g as F,r as m,b as _,j as r}from"./currencyStore-Dk9RVyyc.js";import{u as k}from"./SalesContext-CG9t8_rq.js";import{A as $}from"./Add-5ZpxTNJx.js";import{D as E}from"./Delete-DDMcR4JX.js";import{u as w}from"./currencyFormatter-Be2b0Ktm.js";import{L as M}from"./List-OrinuOpJ.js";import{D as c}from"./Divider-D4ysiqwk.js";import{L as d}from"./ListItem-BK8RisGy.js";import{L as p}from"./ListItemText--0XI93dL.js";import{T as t}from"./Typography-DOI0NvTt.js";import{B as s}from"./Box-j1BTqM2v.js";import{I as O}from"./IconButton-PbvyX_sG.js";import{B as x}from"./Button-aMjmD1gp.js";import{D as Q,a as R}from"./DialogContent-Cz4a0t2H.js";import{D as N}from"./DialogTitle-osZsMdGC.js";import{T as P}from"./TextField-DpXyhoD7.js";import{M as q}from"./MenuItem-CEIQJ6q4.js";import{D as G}from"./DialogActions-BraO_KzF.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./numeral-NHlY-3dw.js";import"./ListContext-CTnR0k9S.js";import"./dividerClasses-BJEnnqiu.js";import"./isMuiElement-HmfyYHhb.js";import"./useForkRef-DgOCCfFR.js";import"./useSlot-PFdYD2CN.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./listItemTextClasses-DNpdtY9T.js";import"./index-CsFzvdgQ.js";import"./useTheme-CvovRv7W.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./CircularProgress-B97ut0O7.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./useControlled-DRAJCB75.js";import"./listItemIconClasses-vD-ryqxg.js";function Kr(){const{cartState:C,cartTotal:h,totalQuantity:b,charges:i,totalChargeAmount:H,finalTotal:J,discount:v,calculateChargeAmountWithDiscount:g,addCharge:A,removeCharge:T}=k(),{settings:S}=F(),[f,D]=m.useState([]),[I,a]=m.useState(!1),[n,u]=m.useState(""),l=w(),j=i.reduce((e,o)=>e+g(o),0),z=h-v+j;m.useEffect(()=>{_.get("/api/charges/active").then(e=>{D(e.data)}).catch(e=>{console.error("Failed to fetch charges:",e)})},[]);const B=()=>{const e=i.map(o=>o.id);return f.filter(o=>!e.includes(o.id))},W=()=>{if(n){const e=f.find(o=>o.id===parseInt(n));e&&(A(e),u(""),a(!1))}},L=e=>{T(e)},y=B();return r.jsxs(M,{sx:{width:"100%",bgcolor:"background.paper",pb:3},children:[r.jsx(c,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsxs("strong",{children:[C.length," | Qty. ",b]})}),children:r.jsx(p,{primary:"Total Items"})}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:l(h)})}),children:r.jsx(p,{primary:"Subtotal"})}),r.jsx(c,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}}),i.length>0&&r.jsxs(r.Fragment,{children:[r.jsxs(s,{sx:{px:2,py:1},children:[r.jsx(t,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Charges & Taxes"}),i.map(e=>r.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1,py:.5},children:[r.jsxs(s,{sx:{flex:1},children:[r.jsx(t,{variant:"body2",sx:{fontSize:"0.85rem"},children:e.name}),r.jsx(t,{variant:"caption",sx:{color:"grey.600"},children:e.rate_type==="percentage"?`${e.rate_value}%`:"Fixed"})]}),r.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(t,{variant:"body2",sx:{fontWeight:500,minWidth:"70px",textAlign:"right"},children:l(g(e))}),r.jsx(O,{size:"small",onClick:()=>L(e.id),color:"error",children:r.jsx(E,{sx:{fontSize:"1rem"}})})]})]},e.id))]}),r.jsx(c,{sx:{borderBottom:"1px dashed",borderColor:"grey.400",my:1}})]}),y.length>0&&r.jsx(s,{sx:{px:2,py:1,mb:1},children:r.jsx(x,{variant:"outlined",size:"small",startIcon:r.jsx($,{}),onClick:()=>a(!0),fullWidth:!0,children:"Add Charge"})}),i.length>0&&r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",color:"initial",sx:{fontSize:{sm:"1rem",xs:"1.2rem"}},children:r.jsx("strong",{children:l(j)})}),children:r.jsx(p,{primary:"Total Charges"})}),r.jsx(c,{sx:{borderBottom:"2px dashed",borderColor:"grey.500",my:1}}),r.jsx(d,{secondaryAction:r.jsx(t,{variant:"h5",sx:{fontSize:{sm:"1.1rem",xs:"1.3rem"},fontWeight:700,color:"primary.main"},children:l(z)}),children:r.jsx(p,{primary:"FINAL TOTAL",primaryTypographyProps:{sx:{fontWeight:700,fontSize:"1.1rem"}}})}),r.jsxs(Q,{open:I,onClose:()=>a(!1),children:[r.jsx(N,{children:"Add Charge/Tax"}),r.jsx(R,{sx:{minWidth:300,pt:2},children:r.jsx(P,{select:!0,fullWidth:!0,label:"Select Charge",value:n,onChange:e=>u(e.target.value),size:"small",children:y.map(e=>r.jsxs(q,{value:e.id,children:[e.name," (",e.rate_type==="percentage"?`${e.rate_value}%`:`${S.currency_symbol}${e.rate_value}`,")"]},e.id))})}),r.jsxs(G,{children:[r.jsx(x,{onClick:()=>a(!1),children:"Cancel"}),r.jsx(x,{onClick:W,variant:"contained",disabled:!n,children:"Add"})]})]})]})}export{Kr as default};

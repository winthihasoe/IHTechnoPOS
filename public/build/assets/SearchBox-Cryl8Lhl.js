import{c as j,r as o,f as v,j as s,b as B}from"./currencyStore-Dk9RVyyc.js";import{S as k}from"./Search-BJKzt9AK.js";import{_ as f}from"./lodash-CwOxCT-R.js";import{u as E}from"./SalesContext-CG9t8_rq.js";import{B as w}from"./Box-j1BTqM2v.js";import{A}from"./Autocomplete-DfOnEm4b.js";import{T as O}from"./TextField-DpXyhoD7.js";import{D as R}from"./Divider-D4ysiqwk.js";import{I as $}from"./IconButton-PbvyX_sG.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./useTheme-CvovRv7W.js";import"./extendSxProp-Co6nc6xJ.js";import"./Close-kFSrCAJM.js";import"./useSlot-PFdYD2CN.js";import"./useForkRef-DgOCCfFR.js";import"./useId-9XzpHYrc.js";import"./useControlled-DRAJCB75.js";import"./usePreviousProps-Dg0VAGfT.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./Paper-Df0ljdBt.js";import"./Popper-pZx5Iht2.js";import"./index-DM5RHFVd.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-DuznN7Ax.js";import"./Chip-DT462TV2.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useFormControl-Cowmrh0y.js";import"./index-CsFzvdgQ.js";import"./ownerWindow-HkKU3E4x.js";import"./debounce-Be36O1Ab.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-D1QunwiJ.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./isMuiElement-HmfyYHhb.js";import"./dividerClasses-BJEnnqiu.js";import"./CircularProgress-B97ut0O7.js";function Et(){const h=j().props.return_sale,{setCartItemModalOpen:d,setSelectedCartItem:p}=o.useContext(v),{addToCart:m,cartState:i}=E(),[q,a]=o.useState(!1),[D,x]=o.useState(""),[g,b]=o.useState([]),[y,I]=o.useState(""),c=o.useRef(null),_=t=>{t.length>2&&(a(!0),B.get("/products/search",{params:{search_query:t}}).then(e=>{if(b(e.data.products),a(!1),e.data.products.length===1){const r=e.data.products;if(r[0].discount_percentage&&Number(r[0].discount_percentage)!==0){const n=r[0].price*r[0].discount_percentage/100;r[0].discount=n}const l=f.findIndex(i,n=>n.id===r.id&&n.batch_number===r.batch_number&&!["custom","reload"].includes(n.product_type));if(l!==-1?r[0].quantity=i[l].quantity:(r[0].quantity=1,m(r[0])),r[0].product_type==="reload"){const n=i.length>0?i.length:0;r[0].cart_index=n}p(r[0]),d(!0)}}).catch(e=>{console.error(e),a(!1)}))},u=o.useCallback(f.debounce(t=>{_(t)},300),[]);o.useEffect(()=>(c.current&&c.current.focus(),()=>{u.cancel()}),[u]);const S=t=>{const e=t.target.value;x(e),u(e)};o.useEffect(()=>{document.addEventListener("keydown",C,!0)},[]);const C=t=>{if(t.key==="ArrowUp"){t.preventDefault();const e=document.getElementById("searchBox");e&&(e.focus(),e.select())}};return s.jsx(s.Fragment,{children:s.jsxs(w,{elevation:0,sx:{p:"2px 2px",ml:{sm:"2rem",xs:"0.5rem"},display:"flex",alignItems:"center",width:"100%",height:"55px",backgroundColor:"white",borderRadius:"5px"},children:[s.jsx(A,{id:"searchBox",disabled:h,fullWidth:!0,disableCloseOnSelect:!0,freeSolo:!0,options:g,inputValue:y,handleHomeEndKeys:!0,onInputChange:(t,e)=>{I(e)},getOptionLabel:t=>typeof t=="string"?t:`${t.name} | ${t.barcode} ${t.sku?`| ${t.sku}`:""} | ${t.batch_number} | Rs.${t.price}`,getOptionKey:t=>t.id+t.batch_id,onChange:(t,e)=>{if(e&&typeof e=="object"&&e.id){if(m(e),e.quantity=1,e.product_type==="reload"){const r=i.length>0?i.length:0;e.cart_index=r}p(e),d(!0)}},renderInput:t=>s.jsx(O,{...t,inputRef:c,fullWidth:!0,placeholder:"Search product... Use Arrow up key to focus ⬆️",id:"searchBox",onChange:S,onFocus:e=>{e.target.select()},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}}}})}),s.jsx(R,{sx:{height:28,m:.5},orientation:"vertical"}),s.jsx($,{type:"button",sx:{p:"10px"},"aria-label":"search",children:s.jsx(k,{})})]})})}export{Et as default};

import{r as m,j as t,R as B,b as I}from"./currencyStore-Dk9RVyyc.js";import{C as q}from"./Close-B9rgBTOR.js";import{S as T}from"./react-select.esm-Cy0FGMM3.js";import{S as z}from"./sweetalert2.esm.all-q958Q1qq.js";import{D as L,a as N}from"./DialogContent-Cz4a0t2H.js";import{D as R}from"./DialogTitle-osZsMdGC.js";import{B as F}from"./Button-aMjmD1gp.js";import{I as H}from"./IconButton-PbvyX_sG.js";import{G as a}from"./Grid-6qcTmjc4.js";import{T as s}from"./TextField-DpXyhoD7.js";import{F as w}from"./FormControlLabel-eGygXIaI.js";import{S as D}from"./Switch-DzXzblLj.js";import{D as G}from"./DialogActions-BraO_KzF.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./Select-ef7c0426.esm-CXaJakO2.js";import"./toPropertyKey-C9c9JG92.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useForkRef-DgOCCfFR.js";import"./index-DJHI8khq.js";import"./floating-ui.dom-CpMS8hwT.js";import"./useTheme-CvovRv7W.js";import"./useSlot-PFdYD2CN.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./useId-9XzpHYrc.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./CircularProgress-B97ut0O7.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./SwitchBase-DLVdjlNh.js";function He({batchModalOpen:f,setBatchModalOpen:W,selectedBatch:l,refreshProducts:j,selectedProduct:k,contacts:y,initialIsNew:x=!1}){const h={batch_id:"",quantity:"",cost:"",price:"",batch_number:"",expiry_date:"",is_active:!0,contact_id:"",discount:0,discount_percentage:0},[g,p]=m.useState(x),[i,c]=m.useState(h),[C,v]=m.useState(!1),_=()=>{p(!1),l&&S(l),W(!1)},E=async e=>{if(e&&(e.preventDefault(),e.stopPropagation()),C)return;v(!0);const r=new FormData;r.append("batch_number",i.batch_number),r.append("quantity",i.quantity),r.append("cost",i.cost),r.append("price",i.price),r.append("expiry_date",(i.expiry_date==="N/A"?"":i.expiry_date)||""),r.append("is_active",i.is_active?1:0),r.append("is_featured",i.is_featured?1:0),i.contact_id&&r.append("contact_id",i.contact_id),r.append("discount",i.discount),r.append("discount_percentage",i.discount_percentage),r.append("new_batch",i.batch_number),r.append("id",k.id);let d="/storebatch";g||(d="/productbatch/"+i.batch_id),I.post(d,Object.fromEntries(r)).then(n=>{z.fire({title:"Success!",text:n.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),j&&j(n.data.batch),_()}).catch(n=>{const b=Object.values(n.response.data.errors).flat().join(" | ");z.fire({title:"Failed!",text:b,icon:"error",showConfirmButton:!0}),console.log(n)}).finally(()=>{v(!1)})},S=e=>{c(r=>({...r,batch_id:e.batch_id||e.id,cost:e.cost,price:e.price,batch_number:e.batch_number,expiry_date:e.expiry_date==="N/A"?"":e.expiry_date,is_active:e.is_active===1,is_featured:e.is_featured===1,contact_id:e.contact_id,discount:e.discount||0,discount_percentage:e.discount_percentage||0}))};m.useEffect(()=>{f&&(l?(S(l),p(!1)):x&&(p(!0),c(h)))},[f,l,x]);const o=e=>{const{name:r,value:d,type:n,checked:b}=e.target;c(A=>{const u={...A};return r==="is_active"||r==="is_featured"?u[r]=b:u[r]=d,r==="discount_percentage"?u.discount=0:r==="discount"&&(u.discount_percentage=0),u})},P=e=>{c({...i,contact_id:e?e.id:null})};return t.jsx(B.Fragment,{children:t.jsxs(L,{fullWidth:!0,fullScreen:window.innerWidth<768,maxWidth:"sm",open:f,onClose:_,"aria-labelledby":"alert-dialog-title",children:[t.jsx(R,{id:"alert-dialog-title",sx:{alignItems:"center",display:"flex"},children:t.jsx("div",{className:"flex sm:flex-row flex-col items-start sm:items-center",children:!g&&t.jsx(F,{fullWidth:!0,variant:"contained",color:"success",onClick:()=>{p(!0),c(h)},children:"CREATE NEW BATCH"})})}),t.jsx(H,{"aria-label":"close",onClick:_,sx:e=>({position:"absolute",right:8,top:8,color:e.palette.grey[500]}),children:t.jsx(q,{})}),t.jsx(N,{sx:{padding:2},children:t.jsxs(a,{container:!0,spacing:2,sx:{justifyContent:"center"},direction:"row",children:[t.jsx(a,{size:{xs:12,sm:4},children:t.jsx(s,{fullWidth:!0,size:"large",name:"batch_number",label:"Batch Number",variant:"outlined",autoFocus:!0,value:i.batch_number,onChange:o,required:!0,onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{}}})}),t.jsx(a,{size:{xs:6,sm:4},children:t.jsx(s,{fullWidth:!0,type:"number",name:"price",size:"large",label:"Price",variant:"outlined",required:!0,value:i.price,onChange:o,onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{step:.5}}})}),t.jsx(a,{size:{xs:6,sm:4},children:t.jsx(s,{fullWidth:!0,type:"number",name:"cost",label:"Cost",variant:"outlined",required:!0,value:i.cost,onChange:o,size:"large",onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0},input:{step:.5}}})}),t.jsx(a,{size:{xs:6,sm:4},children:t.jsx(s,{fullWidth:!0,type:"number",name:"discount_percentage",label:"Discount (%)",variant:"outlined",required:!0,value:i.discount_percentage,onChange:o,size:"large",onFocus:e=>{e.target.select()}})}),t.jsx(a,{size:{xs:6,sm:4},children:t.jsx(s,{fullWidth:!0,type:"number",name:"discount",label:"Flat Discount",variant:"outlined",required:!0,value:i.discount,onChange:o,size:"large",onFocus:e=>{e.target.select()}})}),t.jsx(a,{size:{xs:12,sm:4},children:t.jsx(s,{fullWidth:!0,type:"date",name:"expiry_date",label:"Expiry Date",variant:"outlined",value:i.expiry_date,onChange:o,size:"large",onFocus:e=>{e.target.select()},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(a,{size:{xs:12,sm:12},sx:{zIndex:100},children:t.jsx(T,{className:"w-full",placeholder:"Select a supplier...",name:"contact_id",styles:{control:(e,r)=>({...e,height:"45px",zIndex:100}),menuPortal:e=>({...e,zIndex:9999})},value:y.find(e=>e.id===i.contact_id)||null,onChange:e=>P(e),options:y,isClearable:!0,getOptionLabel:e=>e.name,getOptionValue:e=>e.id})}),t.jsx(a,{size:6,sx:{justifyContent:"center",mt:"1rem"},container:!0,direction:"row",children:t.jsx(w,{value:"1",control:t.jsx(D,{color:"primary",name:"is_active",onChange:o,checked:i.is_active}),label:"Is batch active? ",labelPlacement:"top"})}),t.jsx(a,{size:6,sx:{justifyContent:"center",mt:"1rem"},container:!0,direction:"row",children:t.jsx(w,{value:"1",control:t.jsx(D,{color:"primary",name:"is_featured",onChange:o,checked:i.is_featured}),label:"Is featured? ",labelPlacement:"top"})})]})}),t.jsx(G,{children:t.jsx(F,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:"1.2rem"},type:"button",onClick:E,disabled:C,children:g?"SAVE BATCH":"UPDATE BATCH"})})]})})}export{He as default};

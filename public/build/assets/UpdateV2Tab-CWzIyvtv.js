import{r as l,j as e,b as z}from"./currencyStore-Dk9RVyyc.js";import{u as C}from"./index-DbXUpaKY.js";import{F as B,S as D,Z as P,a as E}from"./zap-VK6j0iuH.js";import{D as L,C as A}from"./database-oSbIu4Kg.js";import{U as w}from"./upload-cVSUPpRP.js";import{L as I}from"./loader-circle-CKPSEXHp.js";import{C as R}from"./circle-check-CQOmOVkC.js";import{X as Z}from"./x-DFsc1drM.js";import"./index-P4sNTowN.js";import"./tslib.es6-BUas5LQb.js";import"./createLucideIcon-BMpC51dL.js";function K(){const[o,g]=l.useState(null),[x,f]=l.useState(!1),[b,u]=l.useState(0),[d,n]=l.useState("idle"),[h,p]=l.useState([]),[j,c]=l.useState(null),N=l.useRef(null),r=(s,t="info")=>{const a=new Date().toLocaleTimeString();p(i=>[...i,{message:s,type:t,timestamp:a}])},U=()=>{N.current?.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{U()},[h]);const y=50*1024*1024,M=l.useCallback(s=>{if(s[0]?.name.endsWith(".zip")){if(s[0].size>y){c(`File too large. Maximum size is 50MB. Your file is ${(s[0].size/1024/1024).toFixed(2)}MB`),r(`Error: File exceeds 50MB limit (${(s[0].size/1024/1024).toFixed(2)}MB)`,"error");return}g(s[0]),c(null),p([]),n("idle"),r(`File selected: ${s[0].name} (${(s[0].size/1024/1024).toFixed(2)}MB)`,"success")}else c("Only ZIP files are allowed"),r("Error: Only ZIP files are allowed","error")},[]),{getRootProps:F,getInputProps:S,isDragActive:v}=C({onDrop:M,accept:{"application/zip":[".zip"]},maxSize:y,multiple:!1,disabled:x,onDropRejected:s=>{const t=s[0];t.errors[0]?.code==="file-too-large"&&(c(`File too large. Maximum size is 50MB. Your file is ${(t.file.size/1024/1024).toFixed(2)}MB`),r(`Error: File rejected - exceeds 50MB limit (${(t.file.size/1024/1024).toFixed(2)}MB)`,"error"))}}),$=async s=>{if(s.preventDefault(),!o||x)return;f(!0),n("validating"),c(null),u(0),p([]),r("Preparing update package...","info"),r("ðŸ“‹ Validating folder structure...","info"),r("Required folders: app, routes, resources, config, database, lang","info"),r("Optional folders: vendor, public (build folder will be replaced)","info");const t=new FormData;t.append("zip_file",o);try{n("uploading"),r("Uploading to server...","info");const a=await z.post("/upload-v2",t,{headers:{"Content-Type":"multipart/form-data"},timeout:9e5,onUploadProgress:i=>{const m=Math.round(i.loaded*100/i.total);u(m),m===100&&(n("processing"),r("Upload complete. Processing update...","success"))}});n("success"),r("âœ“ Update completed successfully!","success"),a.data.migrations_output&&(r("Migration Output:","info"),a.data.migrations_output.split(`
`).forEach(m=>{m.trim()&&r(m.trim(),"info")}))}catch(a){n("error");const i=a.response?.data?.error||a.message||"Update failed";c(i),r(`âœ— Error: ${i}`,"error"),a.response?.data?.details&&(r("Error Details:","error"),r(a.response.data.details,"error"))}finally{f(!1)}},k=()=>{g(null),n("idle"),p([]),c(null),u(0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(B,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Migration Based"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Auto Updates"})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-green-100 p-2 rounded-lg",children:e.jsx(D,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Auto Backup"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Safe Updates"})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-purple-100 p-2 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Smart Rollback"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Fail-Safe"})]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pre-flight Checks"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Validated"})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Update Package"}),e.jsxs("div",{...F(),className:`
                        border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all
                        ${v?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
                        ${x?"opacity-50 cursor-not-allowed":""}
                        bg-white
                    `,children:[e.jsx("input",{...S()}),e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-blue-100 p-4 rounded-full",children:e.jsx(E,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:o.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(o.size/1024/1024).toFixed(2)," MB"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-100 p-4 rounded-full",children:e.jsx(w,{className:"w-8 h-8 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:v?"Drop the file here":"Drag & drop your update package"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"or click to browse (ZIP files only, max 50MB)"})]})]})})]}),j&&e.jsxs("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-3 flex items-start gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Update Failed"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:j})]})]}),x&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[d==="validating"&&"Validating...",d==="uploading"&&`Uploading... ${b}%`,d==="processing"&&"Processing update..."]}),d==="processing"&&e.jsx(I,{className:"w-4 h-4 text-blue-600 animate-spin"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${d==="processing"?100:b}%`}})})]}),d==="success"&&e.jsxs("div",{className:"mt-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-green-900",children:"Update Completed"}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:"Your system has been updated successfully."})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[o&&!x&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:$,className:"flex-1 bg-blue-600 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Start Update"]}),e.jsxs("button",{onClick:()=>g(null),className:"bg-gray-300 text-gray-900 px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-gray-400 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Clear"]})]}),d==="success"&&e.jsx("button",{onClick:k,className:"w-full bg-blue-600 text-white px-4 py-2.5 rounded-lg font-semibold text-sm hover:bg-blue-700 transition-colors",children:"Upload Another"})]})]}),h.length>0&&e.jsxs("div",{className:"bg-gray-900 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-3",children:"Update Logs"}),e.jsxs("div",{className:"bg-black rounded p-3 h-64 overflow-y-auto font-mono text-xs space-y-1",children:[h.map((s,t)=>e.jsxs("div",{className:`
                                    ${s.type==="success"?"text-green-400":""}
                                    ${s.type==="error"?"text-red-400":""}
                                    ${s.type==="info"?"text-blue-400":""}
                                    ${s.type==="warning"?"text-yellow-400":""}
                                `,children:[e.jsxs("span",{className:"text-gray-600",children:["[",s.timestamp,"]"]})," ",s.message]},t)),e.jsx("div",{ref:N})]})]})]})}export{K as default};

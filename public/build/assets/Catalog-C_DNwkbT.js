import{r as m,j as t,d as N}from"./currencyStore-Dk9RVyyc.js";import{d as F}from"./index-C7dwhapP.js";import{u as D}from"./SalesContext-CG9t8_rq.js";import{n as p}from"./numeral-NHlY-3dw.js";import{P as I}from"./PaymentsCheckoutDialog-0sdlSFZF.js";import{D as M,a as Y}from"./DialogContent-Cz4a0t2H.js";import{D as z}from"./DialogTitle-osZsMdGC.js";import{T as A,a as q}from"./Tabs-D51qE-ff.js";import{B as H}from"./Badge-DrYGhX8S.js";import{c as B}from"./createLucideIcon-BMpC51dL.js";import{T as S}from"./TextField-DpXyhoD7.js";import{C as L}from"./circle-check-CQOmOVkC.js";import{D as R}from"./DialogActions-BraO_KzF.js";import{B as T}from"./Button-aMjmD1gp.js";import{L as W,A as E}from"./useMobilePicker-BIozrTWd.js";import{M as O}from"./MobileTimePicker-CFR5bNoc.js";import{B as $}from"./banknote-DLATD7uw.js";import"./import-wrapper-prod-jq4Om1Jp.js";import"./PrintReceiptModal-Csw0Y3uy.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./Print-5v-Lf9Qb.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./currencyFormatter-Be2b0Ktm.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./Box-j1BTqM2v.js";import"./extendSxProp-Co6nc6xJ.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./IconButton-PbvyX_sG.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./CircularProgress-B97ut0O7.js";import"./download-CxbKlL8J.js";import"./Card-C4NAxgST.js";import"./CardMedia-lO_mnymB.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./Percent-BCjtx-gP.js";import"./Payments-DSgOMdsa.js";import"./CreditCard-Dwl4hWaF.js";import"./HighlightOff-Bl6nUsD3.js";import"./index-RHigu7j0.js";import"./index-NgBaJJmW.js";import"./sweetalert2.esm.all-q958Q1qq.js";import"./x-DFsc1drM.js";import"./Grid-6qcTmjc4.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./InputAdornment-DZOHCUsF.js";import"./useFormControl-Cowmrh0y.js";import"./FormControlLabel-eGygXIaI.js";import"./useSlot-PFdYD2CN.js";import"./Checkbox-DmEdO0Ay.js";import"./SwitchBase-DLVdjlNh.js";import"./useControlled-DRAJCB75.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./index-DM5RHFVd.js";import"./debounce-Be36O1Ab.js";import"./useSlotProps-DuznN7Ax.js";import"./KeyboardArrowRight-C0as7Qna.js";import"./usePreviousProps-Dg0VAGfT.js";import"./Grow-D31e1sMI.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./index-P4sNTowN.js";import"./index-JJ5bZ37u.js";import"./ListItem-BK8RisGy.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./Chip-DT462TV2.js";const Q=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],U=B("shopping-cart",Q);async function G(){return await F.pos_products.toArray()}const Fe=({open:n,id:g,onClose:c})=>{const[u,x]=m.useState(""),[f,y]=m.useState([]),[i,v]=m.useState("products"),{cartState:l,addToCart:r,removeFromCart:o,updateCartItem:h}=D(),P=(e,a)=>v(a);m.useEffect(()=>{(async()=>{const e=await G();y(e)})()},[]);const C=e=>{const a=l.findIndex(s=>s.id===e.id&&s.batch_id===e.batch_id);return a===-1?{item:null,index:-1}:{item:l[a],index:a}},b=(e,a,s)=>{const{item:d,index:k}=C(e),j=parseInt(a==="quantity"?s:d?.quantity||0,10),_=parseInt(a==="free_quantity"?s:d?.free_quantity||0,10),w=parseFloat(a==="flat_discount"?s:d?.flat_discount||0);console.log("quantity",j),!j&&!_?o(k):d?h({...d,quantity:j,free_quantity:_,flat_discount:w}):r({...e,free_quantity:_||e.free_quantity||0,flat_discount:w||e.flat_discount||0},j)};return t.jsxs(M,{open:n,onClose:c,fullScreen:!0,children:[t.jsx(z,{children:t.jsxs(A,{value:i,onChange:P,variant:"fullWidth",children:[t.jsx(q,{value:"products",label:"PRODUCTS",wrapped:!0}),t.jsx(q,{value:"cart",label:t.jsx(H,{badgeContent:l.length,color:"error",children:t.jsx(U,{size:20})})})]})}),t.jsxs(Y,{children:[i==="products"&&t.jsxs(t.Fragment,{children:[t.jsx(S,{label:"Search",size:"small",fullWidth:!0,value:u,onChange:e=>x(e.target.value),sx:{mt:1}}),t.jsx("ul",{className:"faded-bottom no-scrollbar grid gap-2 overflow-auto pt-1 pb-1 w-full",children:f.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())).map(e=>{const{item:a}=C(e);return t.jsxs("li",{className:"p-2 w-full shadow-sm",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"uppercase tracking-wide text-sm text-blue-900 font-semibold",children:[e.name," Rs. ",e.price]}),t.jsx("div",{className:"flex ml-2",children:p(e.stock_quantity).format("0,0")})]}),t.jsxs("div",{className:"mt-2 grid grid-cols-[30px_1fr_1fr_1fr] gap-4 items-center",children:[t.jsx("div",{children:t.jsx(L,{size:30,color:a?"green":"gray"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Qty"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.quantity||"",onFocus:s=>s.target.select(),onChange:s=>b(e,"quantity",s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Free Qty"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.free_quantity||"",onFocus:s=>s.target.select(),onChange:s=>b(e,"free_quantity",s.target.value)})]}),t.jsxs("div",{children:[t.jsx("div",{className:"text-gray-500 text-xs",children:"Disc"}),t.jsx("input",{type:"number",min:"0",className:"border border-gray-300 rounded-md py-1 px-2 w-15",value:a?.flat_discount||"",disabled:!a,onFocus:s=>s.target.select(),onChange:s=>b(e,"flat_discount",s.target.value)})]})]})]},e.id+e.batch_number)})})]}),i==="cart"&&t.jsx(J,{cartState:l,contact_id:g,useCart:D})]}),t.jsx(R,{children:t.jsx(T,{fullWidth:!0,onClick:c,children:"Close"})})]})},J=({cartState:n,contact_id:g,useCart:c})=>{const[u,x]=m.useState(!1),[f,y]=m.useState(N().format("YYYY-MM-DD")),[i,v]=m.useState(N().format("HH:mm"));if(!n.length)return t.jsx("div",{className:"p-4",children:"Your cart is empty"});const{cartTotal:l}=c();return t.jsxs(t.Fragment,{children:[t.jsxs("ul",{className:"overflow-auto p-0 space-y-2",children:[n.map((r,o)=>{const h=parseFloat(r.price)*r.quantity-r.flat_discount;return t.jsxs("li",{className:"p-3 border rounded-md shadow-sm bg-white",children:[t.jsxs("div",{className:"grid grid-cols-[2fr_1fr] items-center mb-2",children:[t.jsxs("div",{className:"font-semibold text-sm",children:["#",o+1," | ",r.name]}),t.jsxs("div",{className:"text-sm font-bold text-right",children:["Rs. ",p(h).format("0,0.00")]})]}),t.jsxs("div",{className:"grid grid-cols-[1fr_2fr] gap-2 items-center",children:[t.jsx("div",{children:t.jsx("div",{className:"text-gray-500 text-xs",children:"Details"})}),t.jsx("div",{children:t.jsxs("div",{className:"text-gray-500 text-xs text-right",children:["(",r.price," x ",r.quantity,") - ",r.flat_discount," = Rs. ",p(h).format("0,0.00")]})})]})]},`${r.id}-${r.batch_id}`)}),t.jsxs("li",{className:"p-3 border rounded-md shadow-sm bg-white",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Item Discount"}),t.jsx("div",{className:"text-sm font-bold",children:p(n.reduce((r,o)=>r+(o.discount*o.quantity+o.flat_discount),0)).format("0,0.00")})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"font-semibold text-sm",children:"Total"}),t.jsxs("div",{className:"text-sm font-bold",children:["Rs. ",p(l).format("0,0.00")]})]})]})]}),t.jsx(W,{dateAdapter:E,children:t.jsxs("div",{className:"flex justify-center mt-5 flex-col gap-2",children:[t.jsx(S,{type:"date",label:"Date",variant:"outlined",size:"small",value:f,onChange:r=>y(r.target.value),fullWidth:!0,sx:{mt:2}}),t.jsx(O,{label:"Time",value:i?N(`2000-01-01 ${i}`,"YYYY-MM-DD HH:mm"):null,onChange:r=>{r&&v(r.format("HH:mm"))},format:"hh:mm A",views:["hours","minutes"],slotProps:{textField:{fullWidth:!0,size:"small"},popper:{placement:"bottom-start"}},ampm:!0}),t.jsx(T,{variant:"contained",color:"primary",size:"large",fullWidth:!0,endIcon:t.jsx($,{}),onClick:()=>x(!0),children:"PAYMENTS"})]})}),t.jsx(I,{useCart:c,open:u,setOpen:x,selectedContact:{id:g},is_sale:!0,formData:{sale_date:f,sale_time:i}})]})};export{Fe as default};

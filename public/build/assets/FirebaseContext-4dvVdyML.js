import{b as jf,r as lt,j as zf}from"./currencyStore-Dk9RVyyc.js";const Gf=()=>{};var zc={};const Sl=function(r){const t=[];let e=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},$f=function(r){const t=[];let e=0,n=0;for(;e<r.length;){const s=r[e++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[e++];t[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[e++],a=r[e++],c=r[e++],l=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;t[n++]=String.fromCharCode(55296+(l>>10)),t[n++]=String.fromCharCode(56320+(l&1023))}else{const i=r[e++],a=r[e++];t[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return t.join("")},Pl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],a=s+1<r.length,c=a?r[s+1]:0,l=s+2<r.length,d=l?r[s+2]:0,f=i>>2,g=(i&3)<<4|c>>4;let E=(c&15)<<2|d>>6,R=d&63;l||(R=64,a||(E=64)),n.push(e[f],e[g],e[E],e[R])}return n.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Sl(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):$f(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=e[r.charAt(s++)],c=s<r.length?e[r.charAt(s)]:0;++s;const d=s<r.length?e[r.charAt(s)]:64;++s;const g=s<r.length?e[r.charAt(s)]:64;if(++s,i==null||c==null||d==null||g==null)throw new Kf;const E=i<<2|c>>4;if(n.push(E),d!==64){const R=c<<4&240|d>>2;if(n.push(R),g!==64){const x=d<<6&192|g;n.push(x)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Kf extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Hf=function(r){const t=Sl(r);return Pl.encodeByteArray(t,!0)},Us=function(r){return Hf(r).replace(/\./g,"")},Qf=function(r){try{return Pl.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Vl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Wf=()=>Vl().__FIREBASE_DEFAULTS__,Xf=()=>{if(typeof process>"u"||typeof zc>"u")return;const r=zc.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},Yf=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&Qf(r[1]);return t&&JSON.parse(t)},Ko=()=>{try{return Gf()||Wf()||Xf()||Yf()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Jf=r=>Ko()?.emulatorHosts?.[r],Zf=r=>{const t=Jf(r);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),n]:[t.substring(0,e),n]},Cl=()=>Ko()?.config;class tm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,n))}}}function ai(r){try{return(r.startsWith("http://")||r.startsWith("https://")?new URL(r).hostname:r).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Dl(r){return(await fetch(r,{credentials:"include"})).ok}function em(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},n=t||"demo-project",s=r.iat||0,i=r.sub||r.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...r};return[Us(JSON.stringify(e)),Us(JSON.stringify(a)),""].join(".")}const _r={};function nm(){const r={prod:[],emulator:[]};for(const t of Object.keys(_r))_r[t]?r.emulator.push(t):r.prod.push(t);return r}function rm(r){let t=document.getElementById(r),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",r),e=!0),{created:e,element:t}}let Gc=!1;function sm(r,t){if(typeof window>"u"||typeof document>"u"||!ai(window.location.host)||_r[r]===t||_r[r]||Gc)return;_r[r]=t;function e(E){return`__firebase__banner__${E}`}const n="__firebase__banner",i=nm().prod.length>0;function a(){const E=document.getElementById(n);E&&E.remove()}function c(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function l(E,R){E.setAttribute("width","24"),E.setAttribute("id",R),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function d(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{Gc=!0,a()},E}function f(E,R){E.setAttribute("id",R),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function g(){const E=rm(n),R=e("text"),x=document.getElementById(R)||document.createElement("span"),k=e("learnmore"),D=document.getElementById(k)||document.createElement("a"),z=e("preprendIcon"),U=document.getElementById(z)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const L=E.element;c(L),f(D,k);const Z=d();l(U,z),L.append(U,x,D,Z),document.body.appendChild(L)}i?(x.innerText="Preview backend disconnected.",U.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(U.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,x.innerText="Preview backend running in this workspace."),x.setAttribute("id",R)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function qs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xl(){const r=Ko()?.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Nl(){return!xl()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kl(){return!xl()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Fl(){try{return typeof indexedDB=="object"}catch{return!1}}function im(){return new Promise((r,t)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const om="FirebaseError";class Ln extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=om,Object.setPrototypeOf(this,Ln.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ml.prototype.create)}}class Ml{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,i=this.errors[t],a=i?am(i,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new Ln(s,c,n)}}function am(r,t){return r.replace(cm,(e,n)=>{const s=t[n];return s!=null?String(s):`<${n}?>`})}const cm=/\{\$([^}]+)}/g;function Rr(r,t){if(r===t)return!0;const e=Object.keys(r),n=Object.keys(t);for(const s of e){if(!n.includes(s))return!1;const i=r[s],a=t[s];if($c(i)&&$c(a)){if(!Rr(i,a))return!1}else if(i!==a)return!1}for(const s of n)if(!e.includes(s))return!1;return!0}function $c(r){return r!==null&&typeof r=="object"}function qt(r){return r&&r._delegate?r._delegate:r}class Sr{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Oe="[DEFAULT]";class um{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const n=new tm;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),n=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(n)return null;throw s}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(hm(t))try{this.getOrInitializeService({instanceIdentifier:Oe})}catch{}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(t=Oe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Oe){return this.instances.has(t)}getOptions(t=Oe){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&a.resolve(s)}return s}onInit(t,e){const n=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(n)??new Set;s.add(t),this.onInitCallbacks.set(n,s);const i=this.instances.get(n);return i&&t(i,n),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:lm(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch{}return n||null}normalizeInstanceIdentifier(t=Oe){return this.component?this.component.multipleInstances?t:Oe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lm(r){return r===Oe?void 0:r}function hm(r){return r.instantiationMode==="EAGER"}class dm{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new um(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var W;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(W||(W={}));const fm={debug:W.DEBUG,verbose:W.VERBOSE,info:W.INFO,warn:W.WARN,error:W.ERROR,silent:W.SILENT},mm=W.INFO,gm={[W.DEBUG]:"log",[W.VERBOSE]:"log",[W.INFO]:"info",[W.WARN]:"warn",[W.ERROR]:"error"},pm=(r,t,...e)=>{if(t<r.logLevel)return;const n=new Date().toISOString(),s=gm[t];if(s)console[s](`[${n}]  ${r.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Ol{constructor(t){this.name=t,this._logLevel=mm,this._logHandler=pm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in W))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?fm[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,W.DEBUG,...t),this._logHandler(this,W.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,W.VERBOSE,...t),this._logHandler(this,W.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,W.INFO,...t),this._logHandler(this,W.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,W.WARN,...t),this._logHandler(this,W.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,W.ERROR,...t),this._logHandler(this,W.ERROR,...t)}}const _m=(r,t)=>t.some(e=>r instanceof e);let Kc,Hc;function ym(){return Kc||(Kc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Im(){return Hc||(Hc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Ll=new WeakMap,go=new WeakMap,Bl=new WeakMap,eo=new WeakMap,Ho=new WeakMap;function Em(r){const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{e(ye(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Ll.set(e,r)}).catch(()=>{}),Ho.set(t,r),t}function Tm(r){if(go.has(r))return;const t=new Promise((e,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{e(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});go.set(r,t)}let po={get(r,t,e){if(r instanceof IDBTransaction){if(t==="done")return go.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Bl.get(r);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ye(r[t])},set(r,t,e){return r[t]=e,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function wm(r){po=r(po)}function Am(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const n=r.call(no(this),t,...e);return Bl.set(n,t.sort?t.sort():[t]),ye(n)}:Im().includes(r)?function(...t){return r.apply(no(this),t),ye(Ll.get(this))}:function(...t){return ye(r.apply(no(this),t))}}function vm(r){return typeof r=="function"?Am(r):(r instanceof IDBTransaction&&Tm(r),_m(r,ym())?new Proxy(r,po):r)}function ye(r){if(r instanceof IDBRequest)return Em(r);if(eo.has(r))return eo.get(r);const t=vm(r);return t!==r&&(eo.set(r,t),Ho.set(t,r)),t}const no=r=>Ho.get(r);function bm(r,t,{blocked:e,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(r,t),c=ye(a);return n&&a.addEventListener("upgradeneeded",l=>{n(ye(a.result),l.oldVersion,l.newVersion,ye(a.transaction),l)}),e&&a.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const Rm=["get","getKey","getAll","getAllKeys","count"],Sm=["put","add","delete","clear"],ro=new Map;function Qc(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(ro.get(t))return ro.get(t);const e=t.replace(/FromIndex$/,""),n=t!==e,s=Sm.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(s||Rm.includes(e)))return;const i=async function(a,...c){const l=this.transaction(a,s?"readwrite":"readonly");let d=l.store;return n&&(d=d.index(c.shift())),(await Promise.all([d[e](...c),s&&l.done]))[0]};return ro.set(t,i),i}wm(r=>({...r,get:(t,e,n)=>Qc(t,e)||r.get(t,e,n),has:(t,e)=>!!Qc(t,e)||r.has(t,e)}));class Pm{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Vm(e)){const n=e.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(e=>e).join(" ")}}function Vm(r){return r.getComponent()?.type==="VERSION"}const _o="@firebase/app",Wc="0.14.6";const te=new Ol("@firebase/app"),Cm="@firebase/app-compat",Dm="@firebase/analytics-compat",xm="@firebase/analytics",Nm="@firebase/app-check-compat",km="@firebase/app-check",Fm="@firebase/auth",Mm="@firebase/auth-compat",Om="@firebase/database",Lm="@firebase/data-connect",Bm="@firebase/database-compat",Um="@firebase/functions",qm="@firebase/functions-compat",jm="@firebase/installations",zm="@firebase/installations-compat",Gm="@firebase/messaging",$m="@firebase/messaging-compat",Km="@firebase/performance",Hm="@firebase/performance-compat",Qm="@firebase/remote-config",Wm="@firebase/remote-config-compat",Xm="@firebase/storage",Ym="@firebase/storage-compat",Jm="@firebase/firestore",Zm="@firebase/ai",tg="@firebase/firestore-compat",eg="firebase",ng="12.6.0";const yo="[DEFAULT]",rg={[_o]:"fire-core",[Cm]:"fire-core-compat",[xm]:"fire-analytics",[Dm]:"fire-analytics-compat",[km]:"fire-app-check",[Nm]:"fire-app-check-compat",[Fm]:"fire-auth",[Mm]:"fire-auth-compat",[Om]:"fire-rtdb",[Lm]:"fire-data-connect",[Bm]:"fire-rtdb-compat",[Um]:"fire-fn",[qm]:"fire-fn-compat",[jm]:"fire-iid",[zm]:"fire-iid-compat",[Gm]:"fire-fcm",[$m]:"fire-fcm-compat",[Km]:"fire-perf",[Hm]:"fire-perf-compat",[Qm]:"fire-rc",[Wm]:"fire-rc-compat",[Xm]:"fire-gcs",[Ym]:"fire-gcs-compat",[Jm]:"fire-fst",[tg]:"fire-fst-compat",[Zm]:"fire-vertex","fire-js":"fire-js",[eg]:"fire-js-all"};const js=new Map,sg=new Map,Io=new Map;function Xc(r,t){try{r.container.addComponent(t)}catch(e){te.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,e)}}function zs(r){const t=r.name;if(Io.has(t))return te.debug(`There were multiple attempts to register component ${t}.`),!1;Io.set(t,r);for(const e of js.values())Xc(e,r);for(const e of sg.values())Xc(e,r);return!0}function Ul(r,t){const e=r.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),r.container.getProvider(t)}function ig(r){return r==null?!1:r.settings!==void 0}const og={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ie=new Ml("app","Firebase",og);class ag{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Sr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ie.create("app-deleted",{appName:this._name})}}const cg=ng;function ql(r,t={}){let e=r;typeof t!="object"&&(t={name:t});const n={name:yo,automaticDataCollectionEnabled:!0,...t},s=n.name;if(typeof s!="string"||!s)throw Ie.create("bad-app-name",{appName:String(s)});if(e||(e=Cl()),!e)throw Ie.create("no-options");const i=js.get(s);if(i){if(Rr(e,i.options)&&Rr(n,i.config))return i;throw Ie.create("duplicate-app",{appName:s})}const a=new dm(s);for(const l of Io.values())a.addComponent(l);const c=new ag(e,n,a);return js.set(s,c),c}function ug(r=yo){const t=js.get(r);if(!t&&r===yo&&Cl())return ql();if(!t)throw Ie.create("no-app",{appName:r});return t}function wn(r,t,e){let n=rg[r]??r;e&&(n+=`-${e}`);const s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){const a=[`Unable to register library "${n}" with version "${t}":`];s&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),te.warn(a.join(" "));return}zs(new Sr(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const lg="firebase-heartbeat-database",hg=1,Pr="firebase-heartbeat-store";let so=null;function jl(){return so||(so=bm(lg,hg,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(Pr)}catch(e){console.warn(e)}}}}).catch(r=>{throw Ie.create("idb-open",{originalErrorMessage:r.message})})),so}async function dg(r){try{const e=(await jl()).transaction(Pr),n=await e.objectStore(Pr).get(zl(r));return await e.done,n}catch(t){if(t instanceof Ln)te.warn(t.message);else{const e=Ie.create("idb-get",{originalErrorMessage:t?.message});te.warn(e.message)}}}async function Yc(r,t){try{const n=(await jl()).transaction(Pr,"readwrite");await n.objectStore(Pr).put(t,zl(r)),await n.done}catch(e){if(e instanceof Ln)te.warn(e.message);else{const n=Ie.create("idb-set",{originalErrorMessage:e?.message});te.warn(n.message)}}}function zl(r){return`${r.name}!${r.options.appId}`}const fg=1024,mg=30;class gg{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new _g(e),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Jc();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(s=>s.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:e}),this._heartbeatsCache.heartbeats.length>mg){const s=yg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){te.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Jc(),{heartbeatsToSend:e,unsentEntries:n}=pg(this._heartbeatsCache.heartbeats),s=Us(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return te.warn(t),""}}}function Jc(){return new Date().toISOString().substring(0,10)}function pg(r,t=fg){const e=[];let n=r.slice();for(const s of r){const i=e.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),Zc(e)>t){i.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Zc(e)>t){e.pop();break}n=n.slice(1)}return{heartbeatsToSend:e,unsentEntries:n}}class _g{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Fl()?im().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await dg(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Yc(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const n=await this.read();return Yc(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}else return}}function Zc(r){return Us(JSON.stringify({version:2,heartbeats:r})).length}function yg(r){if(r.length===0)return-1;let t=0,e=r[0].date;for(let n=1;n<r.length;n++)r[n].date<e&&(e=r[n].date,t=n);return t}function Ig(r){zs(new Sr("platform-logger",t=>new Pm(t),"PRIVATE")),zs(new Sr("heartbeat",t=>new gg(t),"PRIVATE")),wn(_o,Wc,r),wn(_o,Wc,"esm2020"),wn("fire-js","")}Ig("");var Eg="firebase",Tg="12.7.0";wn(Eg,Tg,"app");var tu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ee,Gl;(function(){var r;function t(w,p){function I(){}I.prototype=p.prototype,w.F=p.prototype,w.prototype=new I,w.prototype.constructor=w,w.D=function(T,_,v){for(var y=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)y[Ct-2]=arguments[Ct];return p.prototype[_].apply(T,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(n,e),n.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,p,I){I||(I=0);const T=Array(16);if(typeof p=="string")for(var _=0;_<16;++_)T[_]=p.charCodeAt(I++)|p.charCodeAt(I++)<<8|p.charCodeAt(I++)<<16|p.charCodeAt(I++)<<24;else for(_=0;_<16;++_)T[_]=p[I++]|p[I++]<<8|p[I++]<<16|p[I++]<<24;p=w.g[0],I=w.g[1],_=w.g[2];let v=w.g[3],y;y=p+(v^I&(_^v))+T[0]+3614090360&4294967295,p=I+(y<<7&4294967295|y>>>25),y=v+(_^p&(I^_))+T[1]+3905402710&4294967295,v=p+(y<<12&4294967295|y>>>20),y=_+(I^v&(p^I))+T[2]+606105819&4294967295,_=v+(y<<17&4294967295|y>>>15),y=I+(p^_&(v^p))+T[3]+3250441966&4294967295,I=_+(y<<22&4294967295|y>>>10),y=p+(v^I&(_^v))+T[4]+4118548399&4294967295,p=I+(y<<7&4294967295|y>>>25),y=v+(_^p&(I^_))+T[5]+1200080426&4294967295,v=p+(y<<12&4294967295|y>>>20),y=_+(I^v&(p^I))+T[6]+2821735955&4294967295,_=v+(y<<17&4294967295|y>>>15),y=I+(p^_&(v^p))+T[7]+4249261313&4294967295,I=_+(y<<22&4294967295|y>>>10),y=p+(v^I&(_^v))+T[8]+1770035416&4294967295,p=I+(y<<7&4294967295|y>>>25),y=v+(_^p&(I^_))+T[9]+2336552879&4294967295,v=p+(y<<12&4294967295|y>>>20),y=_+(I^v&(p^I))+T[10]+4294925233&4294967295,_=v+(y<<17&4294967295|y>>>15),y=I+(p^_&(v^p))+T[11]+2304563134&4294967295,I=_+(y<<22&4294967295|y>>>10),y=p+(v^I&(_^v))+T[12]+1804603682&4294967295,p=I+(y<<7&4294967295|y>>>25),y=v+(_^p&(I^_))+T[13]+4254626195&4294967295,v=p+(y<<12&4294967295|y>>>20),y=_+(I^v&(p^I))+T[14]+2792965006&4294967295,_=v+(y<<17&4294967295|y>>>15),y=I+(p^_&(v^p))+T[15]+1236535329&4294967295,I=_+(y<<22&4294967295|y>>>10),y=p+(_^v&(I^_))+T[1]+4129170786&4294967295,p=I+(y<<5&4294967295|y>>>27),y=v+(I^_&(p^I))+T[6]+3225465664&4294967295,v=p+(y<<9&4294967295|y>>>23),y=_+(p^I&(v^p))+T[11]+643717713&4294967295,_=v+(y<<14&4294967295|y>>>18),y=I+(v^p&(_^v))+T[0]+3921069994&4294967295,I=_+(y<<20&4294967295|y>>>12),y=p+(_^v&(I^_))+T[5]+3593408605&4294967295,p=I+(y<<5&4294967295|y>>>27),y=v+(I^_&(p^I))+T[10]+38016083&4294967295,v=p+(y<<9&4294967295|y>>>23),y=_+(p^I&(v^p))+T[15]+3634488961&4294967295,_=v+(y<<14&4294967295|y>>>18),y=I+(v^p&(_^v))+T[4]+3889429448&4294967295,I=_+(y<<20&4294967295|y>>>12),y=p+(_^v&(I^_))+T[9]+568446438&4294967295,p=I+(y<<5&4294967295|y>>>27),y=v+(I^_&(p^I))+T[14]+3275163606&4294967295,v=p+(y<<9&4294967295|y>>>23),y=_+(p^I&(v^p))+T[3]+4107603335&4294967295,_=v+(y<<14&4294967295|y>>>18),y=I+(v^p&(_^v))+T[8]+1163531501&4294967295,I=_+(y<<20&4294967295|y>>>12),y=p+(_^v&(I^_))+T[13]+2850285829&4294967295,p=I+(y<<5&4294967295|y>>>27),y=v+(I^_&(p^I))+T[2]+4243563512&4294967295,v=p+(y<<9&4294967295|y>>>23),y=_+(p^I&(v^p))+T[7]+1735328473&4294967295,_=v+(y<<14&4294967295|y>>>18),y=I+(v^p&(_^v))+T[12]+2368359562&4294967295,I=_+(y<<20&4294967295|y>>>12),y=p+(I^_^v)+T[5]+4294588738&4294967295,p=I+(y<<4&4294967295|y>>>28),y=v+(p^I^_)+T[8]+2272392833&4294967295,v=p+(y<<11&4294967295|y>>>21),y=_+(v^p^I)+T[11]+1839030562&4294967295,_=v+(y<<16&4294967295|y>>>16),y=I+(_^v^p)+T[14]+4259657740&4294967295,I=_+(y<<23&4294967295|y>>>9),y=p+(I^_^v)+T[1]+2763975236&4294967295,p=I+(y<<4&4294967295|y>>>28),y=v+(p^I^_)+T[4]+1272893353&4294967295,v=p+(y<<11&4294967295|y>>>21),y=_+(v^p^I)+T[7]+4139469664&4294967295,_=v+(y<<16&4294967295|y>>>16),y=I+(_^v^p)+T[10]+3200236656&4294967295,I=_+(y<<23&4294967295|y>>>9),y=p+(I^_^v)+T[13]+681279174&4294967295,p=I+(y<<4&4294967295|y>>>28),y=v+(p^I^_)+T[0]+3936430074&4294967295,v=p+(y<<11&4294967295|y>>>21),y=_+(v^p^I)+T[3]+3572445317&4294967295,_=v+(y<<16&4294967295|y>>>16),y=I+(_^v^p)+T[6]+76029189&4294967295,I=_+(y<<23&4294967295|y>>>9),y=p+(I^_^v)+T[9]+3654602809&4294967295,p=I+(y<<4&4294967295|y>>>28),y=v+(p^I^_)+T[12]+3873151461&4294967295,v=p+(y<<11&4294967295|y>>>21),y=_+(v^p^I)+T[15]+530742520&4294967295,_=v+(y<<16&4294967295|y>>>16),y=I+(_^v^p)+T[2]+3299628645&4294967295,I=_+(y<<23&4294967295|y>>>9),y=p+(_^(I|~v))+T[0]+4096336452&4294967295,p=I+(y<<6&4294967295|y>>>26),y=v+(I^(p|~_))+T[7]+1126891415&4294967295,v=p+(y<<10&4294967295|y>>>22),y=_+(p^(v|~I))+T[14]+2878612391&4294967295,_=v+(y<<15&4294967295|y>>>17),y=I+(v^(_|~p))+T[5]+4237533241&4294967295,I=_+(y<<21&4294967295|y>>>11),y=p+(_^(I|~v))+T[12]+1700485571&4294967295,p=I+(y<<6&4294967295|y>>>26),y=v+(I^(p|~_))+T[3]+2399980690&4294967295,v=p+(y<<10&4294967295|y>>>22),y=_+(p^(v|~I))+T[10]+4293915773&4294967295,_=v+(y<<15&4294967295|y>>>17),y=I+(v^(_|~p))+T[1]+2240044497&4294967295,I=_+(y<<21&4294967295|y>>>11),y=p+(_^(I|~v))+T[8]+1873313359&4294967295,p=I+(y<<6&4294967295|y>>>26),y=v+(I^(p|~_))+T[15]+4264355552&4294967295,v=p+(y<<10&4294967295|y>>>22),y=_+(p^(v|~I))+T[6]+2734768916&4294967295,_=v+(y<<15&4294967295|y>>>17),y=I+(v^(_|~p))+T[13]+1309151649&4294967295,I=_+(y<<21&4294967295|y>>>11),y=p+(_^(I|~v))+T[4]+4149444226&4294967295,p=I+(y<<6&4294967295|y>>>26),y=v+(I^(p|~_))+T[11]+3174756917&4294967295,v=p+(y<<10&4294967295|y>>>22),y=_+(p^(v|~I))+T[2]+718787259&4294967295,_=v+(y<<15&4294967295|y>>>17),y=I+(v^(_|~p))+T[9]+3951481745&4294967295,w.g[0]=w.g[0]+p&4294967295,w.g[1]=w.g[1]+(_+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+_&4294967295,w.g[3]=w.g[3]+v&4294967295}n.prototype.v=function(w,p){p===void 0&&(p=w.length);const I=p-this.blockSize,T=this.C;let _=this.h,v=0;for(;v<p;){if(_==0)for(;v<=I;)s(this,w,v),v+=this.blockSize;if(typeof w=="string"){for(;v<p;)if(T[_++]=w.charCodeAt(v++),_==this.blockSize){s(this,T),_=0;break}}else for(;v<p;)if(T[_++]=w[v++],_==this.blockSize){s(this,T),_=0;break}}this.h=_,this.o+=p},n.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var p=1;p<w.length-8;++p)w[p]=0;p=this.o*8;for(var I=w.length-8;I<w.length;++I)w[I]=p&255,p/=256;for(this.v(w),w=Array(16),p=0,I=0;I<4;++I)for(let T=0;T<32;T+=8)w[p++]=this.g[I]>>>T&255;return w};function i(w,p){var I=c;return Object.prototype.hasOwnProperty.call(I,w)?I[w]:I[w]=p(w)}function a(w,p){this.h=p;const I=[];let T=!0;for(let _=w.length-1;_>=0;_--){const v=w[_]|0;T&&v==p||(I[_]=v,T=!1)}this.g=I}var c={};function l(w){return-128<=w&&w<128?i(w,function(p){return new a([p|0],p<0?-1:0)}):new a([w|0],w<0?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return g;if(w<0)return D(d(-w));const p=[];let I=1;for(let T=0;w>=I;T++)p[T]=w/I|0,I*=4294967296;return new a(p,0)}function f(w,p){if(w.length==0)throw Error("number format error: empty string");if(p=p||10,p<2||36<p)throw Error("radix out of range: "+p);if(w.charAt(0)=="-")return D(f(w.substring(1),p));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const I=d(Math.pow(p,8));let T=g;for(let v=0;v<w.length;v+=8){var _=Math.min(8,w.length-v);const y=parseInt(w.substring(v,v+_),p);_<8?(_=d(Math.pow(p,_)),T=T.j(_).add(d(y))):(T=T.j(I),T=T.add(d(y)))}return T}var g=l(0),E=l(1),R=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-D(this).m();let w=0,p=1;for(let I=0;I<this.g.length;I++){const T=this.i(I);w+=(T>=0?T:4294967296+T)*p,p*=4294967296}return w},r.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(x(this))return"0";if(k(this))return"-"+D(this).toString(w);const p=d(Math.pow(w,6));var I=this;let T="";for(;;){const _=Z(I,p).g;I=z(I,_.j(p));let v=((I.g.length>0?I.g[0]:I.h)>>>0).toString(w);if(I=_,x(I))return v+T;for(;v.length<6;)v="0"+v;T=v+T}},r.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function x(w){if(w.h!=0)return!1;for(let p=0;p<w.g.length;p++)if(w.g[p]!=0)return!1;return!0}function k(w){return w.h==-1}r.l=function(w){return w=z(this,w),k(w)?-1:x(w)?0:1};function D(w){const p=w.g.length,I=[];for(let T=0;T<p;T++)I[T]=~w.g[T];return new a(I,~w.h).add(E)}r.abs=function(){return k(this)?D(this):this},r.add=function(w){const p=Math.max(this.g.length,w.g.length),I=[];let T=0;for(let _=0;_<=p;_++){let v=T+(this.i(_)&65535)+(w.i(_)&65535),y=(v>>>16)+(this.i(_)>>>16)+(w.i(_)>>>16);T=y>>>16,v&=65535,y&=65535,I[_]=y<<16|v}return new a(I,I[I.length-1]&-2147483648?-1:0)};function z(w,p){return w.add(D(p))}r.j=function(w){if(x(this)||x(w))return g;if(k(this))return k(w)?D(this).j(D(w)):D(D(this).j(w));if(k(w))return D(this.j(D(w)));if(this.l(R)<0&&w.l(R)<0)return d(this.m()*w.m());const p=this.g.length+w.g.length,I=[];for(var T=0;T<2*p;T++)I[T]=0;for(T=0;T<this.g.length;T++)for(let _=0;_<w.g.length;_++){const v=this.i(T)>>>16,y=this.i(T)&65535,Ct=w.i(_)>>>16,Ve=w.i(_)&65535;I[2*T+2*_]+=y*Ve,U(I,2*T+2*_),I[2*T+2*_+1]+=v*Ve,U(I,2*T+2*_+1),I[2*T+2*_+1]+=y*Ct,U(I,2*T+2*_+1),I[2*T+2*_+2]+=v*Ct,U(I,2*T+2*_+2)}for(w=0;w<p;w++)I[w]=I[2*w+1]<<16|I[2*w];for(w=p;w<2*p;w++)I[w]=0;return new a(I,0)};function U(w,p){for(;(w[p]&65535)!=w[p];)w[p+1]+=w[p]>>>16,w[p]&=65535,p++}function L(w,p){this.g=w,this.h=p}function Z(w,p){if(x(p))throw Error("division by zero");if(x(w))return new L(g,g);if(k(w))return p=Z(D(w),p),new L(D(p.g),D(p.h));if(k(p))return p=Z(w,D(p)),new L(D(p.g),p.h);if(w.g.length>30){if(k(w)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var I=E,T=p;T.l(w)<=0;)I=Y(I),T=Y(T);var _=K(I,1),v=K(T,1);for(T=K(T,2),I=K(I,2);!x(T);){var y=v.add(T);y.l(w)<=0&&(_=_.add(I),v=y),T=K(T,1),I=K(I,1)}return p=z(w,_.j(p)),new L(_,p)}for(_=g;w.l(p)>=0;){for(I=Math.max(1,Math.floor(w.m()/p.m())),T=Math.ceil(Math.log(I)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),v=d(I),y=v.j(p);k(y)||y.l(w)>0;)I-=T,v=d(I),y=v.j(p);x(v)&&(v=E),_=_.add(v),w=z(w,y)}return new L(_,w)}r.B=function(w){return Z(this,w).h},r.and=function(w){const p=Math.max(this.g.length,w.g.length),I=[];for(let T=0;T<p;T++)I[T]=this.i(T)&w.i(T);return new a(I,this.h&w.h)},r.or=function(w){const p=Math.max(this.g.length,w.g.length),I=[];for(let T=0;T<p;T++)I[T]=this.i(T)|w.i(T);return new a(I,this.h|w.h)},r.xor=function(w){const p=Math.max(this.g.length,w.g.length),I=[];for(let T=0;T<p;T++)I[T]=this.i(T)^w.i(T);return new a(I,this.h^w.h)};function Y(w){const p=w.g.length+1,I=[];for(let T=0;T<p;T++)I[T]=w.i(T)<<1|w.i(T-1)>>>31;return new a(I,w.h)}function K(w,p){const I=p>>5;p%=32;const T=w.g.length-I,_=[];for(let v=0;v<T;v++)_[v]=p>0?w.i(v+I)>>>p|w.i(v+I+1)<<32-p:w.i(v+I);return new a(_,w.h)}n.prototype.digest=n.prototype.A,n.prototype.reset=n.prototype.u,n.prototype.update=n.prototype.v,Gl=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Ee=a}).apply(typeof tu<"u"?tu:typeof self<"u"?self:typeof window<"u"?window:{});var ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var $l,dr,Kl,Ps,Eo,Hl,Ql,Wl;(function(){var r,t=Object.defineProperty;function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof ys=="object"&&ys];for(var u=0;u<o.length;++u){var h=o[u];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function s(o,u){if(u)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var b=o[m];if(!(b in h))break t;h=h[b]}o=o[o.length-1],m=h[o],u=u(m),u!=m&&u!=null&&t(h,o,{configurable:!0,writable:!0,value:u})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(u){var h=[],m;for(m in u)Object.prototype.hasOwnProperty.call(u,m)&&h.push([m,u[m]]);return h}});var i=i||{},a=this||self;function c(o){var u=typeof o;return u=="object"&&o!=null||u=="function"}function l(o,u,h){return o.call.apply(o.bind,arguments)}function d(o,u,h){return d=l,d.apply(null,arguments)}function f(o,u){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function g(o,u){function h(){}h.prototype=u.prototype,o.Z=u.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(m,b,S){for(var N=Array(arguments.length-2),G=2;G<arguments.length;G++)N[G-2]=arguments[G];return u.prototype[b].apply(m,N)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function R(o){const u=o.length;if(u>0){const h=Array(u);for(let m=0;m<u;m++)h[m]=o[m];return h}return[]}function x(o,u){for(let m=1;m<arguments.length;m++){const b=arguments[m];var h=typeof b;if(h=h!="object"?h:b?Array.isArray(b)?"array":h:"null",h=="array"||h=="object"&&typeof b.length=="number"){h=o.length||0;const S=b.length||0;o.length=h+S;for(let N=0;N<S;N++)o[h+N]=b[N]}else o.push(b)}}class k{constructor(u,h){this.i=u,this.j=h,this.h=0,this.g=null}get(){let u;return this.h>0?(this.h--,u=this.g,this.g=u.next,u.next=null):u=this.i(),u}}function D(o){a.setTimeout(()=>{throw o},0)}function z(){var o=w;let u=null;return o.g&&(u=o.g,o.g=o.g.next,o.g||(o.h=null),u.next=null),u}class U{constructor(){this.h=this.g=null}add(u,h){const m=L.get();m.set(u,h),this.h?this.h.next=m:this.g=m,this.h=m}}var L=new k(()=>new Z,o=>o.reset());class Z{constructor(){this.next=this.g=this.h=null}set(u,h){this.h=u,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,K=!1,w=new U,p=()=>{const o=Promise.resolve(void 0);Y=()=>{o.then(I)}};function I(){for(var o;o=z();){try{o.h.call(o.g)}catch(h){D(h)}var u=L;u.j(o),u.h<100&&(u.h++,o.next=u.g,u.g=o)}K=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function _(o,u){this.type=o,this.g=this.target=u,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var v=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,u=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,u),a.removeEventListener("test",h,u)}catch{}return o})();function y(o){return/^[\s\xa0]*$/.test(o)}function Ct(o,u){_.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,u)}g(Ct,_),Ct.prototype.init=function(o,u){const h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=u,u=o.relatedTarget,u||(h=="mouseover"?u=o.fromElement:h=="mouseout"&&(u=o.toElement)),this.relatedTarget=u,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ct.Z.h.call(this)},Ct.prototype.h=function(){Ct.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ve="closure_listenable_"+(Math.random()*1e6|0),lf=0;function hf(o,u,h,m,b){this.listener=o,this.proxy=null,this.src=u,this.type=h,this.capture=!!m,this.ha=b,this.key=++lf,this.da=this.fa=!1}function rs(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function ss(o,u,h){for(const m in o)u.call(h,o[m],m,o)}function df(o,u){for(const h in o)u.call(void 0,o[h],h,o)}function ja(o){const u={};for(const h in o)u[h]=o[h];return u}const za="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ga(o,u){let h,m;for(let b=1;b<arguments.length;b++){m=arguments[b];for(h in m)o[h]=m[h];for(let S=0;S<za.length;S++)h=za[S],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function is(o){this.src=o,this.g={},this.h=0}is.prototype.add=function(o,u,h,m,b){const S=o.toString();o=this.g[S],o||(o=this.g[S]=[],this.h++);const N=xi(o,u,m,b);return N>-1?(u=o[N],h||(u.fa=!1)):(u=new hf(u,this.src,S,!!m,b),u.fa=h,o.push(u)),u};function Di(o,u){const h=u.type;if(h in o.g){var m=o.g[h],b=Array.prototype.indexOf.call(m,u,void 0),S;(S=b>=0)&&Array.prototype.splice.call(m,b,1),S&&(rs(u),o.g[h].length==0&&(delete o.g[h],o.h--))}}function xi(o,u,h,m){for(let b=0;b<o.length;++b){const S=o[b];if(!S.da&&S.listener==u&&S.capture==!!h&&S.ha==m)return b}return-1}var Ni="closure_lm_"+(Math.random()*1e6|0),ki={};function $a(o,u,h,m,b){if(Array.isArray(u)){for(let S=0;S<u.length;S++)$a(o,u[S],h,m,b);return null}return h=Qa(h),o&&o[Ve]?o.J(u,h,c(m)?!!m.capture:!1,b):ff(o,u,h,!1,m,b)}function ff(o,u,h,m,b,S){if(!u)throw Error("Invalid event type");const N=c(b)?!!b.capture:!!b;let G=Mi(o);if(G||(o[Ni]=G=new is(o)),h=G.add(u,h,m,N,S),h.proxy)return h;if(m=mf(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)v||(b=N),b===void 0&&(b=!1),o.addEventListener(u.toString(),m,b);else if(o.attachEvent)o.attachEvent(Ha(u.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function mf(){function o(h){return u.call(o.src,o.listener,h)}const u=gf;return o}function Ka(o,u,h,m,b){if(Array.isArray(u))for(var S=0;S<u.length;S++)Ka(o,u[S],h,m,b);else m=c(m)?!!m.capture:!!m,h=Qa(h),o&&o[Ve]?(o=o.i,S=String(u).toString(),S in o.g&&(u=o.g[S],h=xi(u,h,m,b),h>-1&&(rs(u[h]),Array.prototype.splice.call(u,h,1),u.length==0&&(delete o.g[S],o.h--)))):o&&(o=Mi(o))&&(u=o.g[u.toString()],o=-1,u&&(o=xi(u,h,m,b)),(h=o>-1?u[o]:null)&&Fi(h))}function Fi(o){if(typeof o!="number"&&o&&!o.da){var u=o.src;if(u&&u[Ve])Di(u.i,o);else{var h=o.type,m=o.proxy;u.removeEventListener?u.removeEventListener(h,m,o.capture):u.detachEvent?u.detachEvent(Ha(h),m):u.addListener&&u.removeListener&&u.removeListener(m),(h=Mi(u))?(Di(h,o),h.h==0&&(h.src=null,u[Ni]=null)):rs(o)}}}function Ha(o){return o in ki?ki[o]:ki[o]="on"+o}function gf(o,u){if(o.da)o=!0;else{u=new Ct(u,this);const h=o.listener,m=o.ha||o.src;o.fa&&Fi(o),o=h.call(m,u)}return o}function Mi(o){return o=o[Ni],o instanceof is?o:null}var Oi="__closure_events_fn_"+(Math.random()*1e9>>>0);function Qa(o){return typeof o=="function"?o:(o[Oi]||(o[Oi]=function(u){return o.handleEvent(u)}),o[Oi])}function Tt(){T.call(this),this.i=new is(this),this.M=this,this.G=null}g(Tt,T),Tt.prototype[Ve]=!0,Tt.prototype.removeEventListener=function(o,u,h,m){Ka(this,o,u,h,m)};function Rt(o,u){var h,m=o.G;if(m)for(h=[];m;m=m.G)h.push(m);if(o=o.M,m=u.type||u,typeof u=="string")u=new _(u,o);else if(u instanceof _)u.target=u.target||o;else{var b=u;u=new _(m,o),Ga(u,b)}b=!0;let S,N;if(h)for(N=h.length-1;N>=0;N--)S=u.g=h[N],b=os(S,m,!0,u)&&b;if(S=u.g=o,b=os(S,m,!0,u)&&b,b=os(S,m,!1,u)&&b,h)for(N=0;N<h.length;N++)S=u.g=h[N],b=os(S,m,!1,u)&&b}Tt.prototype.N=function(){if(Tt.Z.N.call(this),this.i){var o=this.i;for(const u in o.g){const h=o.g[u];for(let m=0;m<h.length;m++)rs(h[m]);delete o.g[u],o.h--}}this.G=null},Tt.prototype.J=function(o,u,h,m){return this.i.add(String(o),u,!1,h,m)},Tt.prototype.K=function(o,u,h,m){return this.i.add(String(o),u,!0,h,m)};function os(o,u,h,m){if(u=o.i.g[String(u)],!u)return!0;u=u.concat();let b=!0;for(let S=0;S<u.length;++S){const N=u[S];if(N&&!N.da&&N.capture==h){const G=N.listener,mt=N.ha||N.src;N.fa&&Di(o.i,N),b=G.call(mt,m)!==!1&&b}}return b&&!m.defaultPrevented}function pf(o,u){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(u)>2147483647?-1:a.setTimeout(o,u||0)}function Wa(o){o.g=pf(()=>{o.g=null,o.i&&(o.i=!1,Wa(o))},o.l);const u=o.h;o.h=null,o.m.apply(null,u)}class _f extends T{constructor(u,h){super(),this.m=u,this.l=h,this.h=null,this.i=!1,this.g=null}j(u){this.h=arguments,this.g?this.i=!0:Wa(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zn(o){T.call(this),this.h=o,this.g={}}g(zn,T);var Xa=[];function Ya(o){ss(o.g,function(u,h){this.g.hasOwnProperty(h)&&Fi(u)},o),o.g={}}zn.prototype.N=function(){zn.Z.N.call(this),Ya(this)},zn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Li=a.JSON.stringify,yf=a.JSON.parse,If=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function Ja(){}function Za(){}var Gn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Bi(){_.call(this,"d")}g(Bi,_);function Ui(){_.call(this,"c")}g(Ui,_);var Ce={},tc=null;function as(){return tc=tc||new Tt}Ce.Ia="serverreachability";function ec(o){_.call(this,Ce.Ia,o)}g(ec,_);function $n(o){const u=as();Rt(u,new ec(u))}Ce.STAT_EVENT="statevent";function nc(o,u){_.call(this,Ce.STAT_EVENT,o),this.stat=u}g(nc,_);function St(o){const u=as();Rt(u,new nc(u,o))}Ce.Ja="timingevent";function rc(o,u){_.call(this,Ce.Ja,o),this.size=u}g(rc,_);function Kn(o,u){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},u)}function Hn(){this.g=!0}Hn.prototype.ua=function(){this.g=!1};function Ef(o,u,h,m,b,S){o.info(function(){if(o.g)if(S){var N="",G=S.split("&");for(let nt=0;nt<G.length;nt++){var mt=G[nt].split("=");if(mt.length>1){const pt=mt[0];mt=mt[1];const Gt=pt.split("_");N=Gt.length>=2&&Gt[1]=="type"?N+(pt+"="+mt+"&"):N+(pt+"=redacted&")}}}else N=null;else N=S;return"XMLHTTP REQ ("+m+") [attempt "+b+"]: "+u+`
`+h+`
`+N})}function Tf(o,u,h,m,b,S,N){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+b+"]: "+u+`
`+h+`
`+S+" "+N})}function on(o,u,h,m){o.info(function(){return"XMLHTTP TEXT ("+u+"): "+Af(o,h)+(m?" "+m:"")})}function wf(o,u){o.info(function(){return"TIMEOUT: "+u})}Hn.prototype.info=function(){};function Af(o,u){if(!o.g)return u;if(!u)return null;try{const S=JSON.parse(u);if(S){for(o=0;o<S.length;o++)if(Array.isArray(S[o])){var h=S[o];if(!(h.length<2)){var m=h[1];if(Array.isArray(m)&&!(m.length<1)){var b=m[0];if(b!="noop"&&b!="stop"&&b!="close")for(let N=1;N<m.length;N++)m[N]=""}}}}return Li(S)}catch{return u}}var cs={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},sc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ic;function qi(){}g(qi,Ja),qi.prototype.g=function(){return new XMLHttpRequest},ic=new qi;function Qn(o){return encodeURIComponent(String(o))}function vf(o){var u=1;o=o.split(":");const h=[];for(;u>0&&o.length;)h.push(o.shift()),u--;return o.length&&h.push(o.join(":")),h}function ae(o,u,h,m){this.j=o,this.i=u,this.l=h,this.S=m||1,this.V=new zn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new oc}function oc(){this.i=null,this.g="",this.h=!1}var ac={},ji={};function zi(o,u,h){o.M=1,o.A=ls(zt(u)),o.u=h,o.R=!0,cc(o,null)}function cc(o,u){o.F=Date.now(),us(o),o.B=zt(o.A);var h=o.B,m=o.S;Array.isArray(m)||(m=[String(m)]),Tc(h.i,"t",m),o.C=0,h=o.j.L,o.h=new oc,o.g=Bc(o.j,h?u:null,!o.u),o.P>0&&(o.O=new _f(d(o.Y,o,o.g),o.P)),u=o.V,h=o.g,m=o.ba;var b="readystatechange";Array.isArray(b)||(b&&(Xa[0]=b.toString()),b=Xa);for(let S=0;S<b.length;S++){const N=$a(h,b[S],m||u.handleEvent,!1,u.h||u);if(!N)break;u.g[N.key]=N}u=o.J?ja(o.J):{},o.u?(o.v||(o.v="POST"),u["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,u)):(o.v="GET",o.g.ea(o.B,o.v,null,u)),$n(),Ef(o.i,o.v,o.B,o.l,o.S,o.u)}ae.prototype.ba=function(o){o=o.target;const u=this.O;u&&le(o)==3?u.j():this.Y(o)},ae.prototype.Y=function(o){try{if(o==this.g)t:{const G=le(this.g),mt=this.g.ya(),nt=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||Pc(this.g)))){this.K||G!=4||mt==7||(mt==8||nt<=0?$n(3):$n(2)),Gi(this);var u=this.g.ca();this.X=u;var h=bf(this);if(this.o=u==200,Tf(this.i,this.v,this.B,this.l,this.S,G,u),this.o){if(this.U&&!this.L){e:{if(this.g){var m,b=this.g;if((m=b.g?b.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!y(m)){var S=m;break e}}S=null}if(o=S)on(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,$i(this,o);else{this.o=!1,this.m=3,St(12),De(this),Wn(this);break t}}if(this.R){o=!0;let pt;for(;!this.K&&this.C<h.length;)if(pt=Rf(this,h),pt==ji){G==4&&(this.m=4,St(14),o=!1),on(this.i,this.l,null,"[Incomplete Response]");break}else if(pt==ac){this.m=4,St(15),on(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else on(this.i,this.l,pt,null),$i(this,pt);if(uc(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||h.length!=0||this.h.h||(this.m=1,St(16),o=!1),this.o=this.o&&o,!o)on(this.i,this.l,h,"[Invalid Chunked Response]"),De(this),Wn(this);else if(h.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),Zi(N),N.P=!0,St(11))}}else on(this.i,this.l,h,null),$i(this,h);G==4&&De(this),this.o&&!this.K&&(G==4?Fc(this.j,this):(this.o=!1,us(this)))}else Uf(this.g),u==400&&h.indexOf("Unknown SID")>0?(this.m=3,St(12)):(this.m=0,St(13)),De(this),Wn(this)}}}catch{}};function bf(o){if(!uc(o))return o.g.la();const u=Pc(o.g);if(u==="")return"";let h="";const m=u.length,b=le(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return De(o),Wn(o),"";o.h.i=new a.TextDecoder}for(let S=0;S<m;S++)o.h.h=!0,h+=o.h.i.decode(u[S],{stream:!(b&&S==m-1)});return u.length=0,o.h.g+=h,o.C=0,o.h.g}function uc(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function Rf(o,u){var h=o.C,m=u.indexOf(`
`,h);return m==-1?ji:(h=Number(u.substring(h,m)),isNaN(h)?ac:(m+=1,m+h>u.length?ji:(u=u.slice(m,m+h),o.C=m+h,u)))}ae.prototype.cancel=function(){this.K=!0,De(this)};function us(o){o.T=Date.now()+o.H,lc(o,o.H)}function lc(o,u){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Kn(d(o.aa,o),u)}function Gi(o){o.D&&(a.clearTimeout(o.D),o.D=null)}ae.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(wf(this.i,this.B),this.M!=2&&($n(),St(17)),De(this),this.m=2,Wn(this)):lc(this,this.T-o)};function Wn(o){o.j.I==0||o.K||Fc(o.j,o)}function De(o){Gi(o);var u=o.O;u&&typeof u.dispose=="function"&&u.dispose(),o.O=null,Ya(o.V),o.g&&(u=o.g,o.g=null,u.abort(),u.dispose())}function $i(o,u){try{var h=o.j;if(h.I!=0&&(h.g==o||Ki(h.h,o))){if(!o.L&&Ki(h.h,o)&&h.I==3){try{var m=h.Ba.g.parse(u)}catch{m=null}if(Array.isArray(m)&&m.length==3){var b=m;if(b[0]==0){t:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)gs(h),fs(h);else break t;Ji(h),St(18)}}else h.xa=b[1],0<h.xa-h.K&&b[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Kn(d(h.Va,h),6e3));fc(h.h)<=1&&h.ta&&(h.ta=void 0)}else Ne(h,11)}else if((o.L||h.g==o)&&gs(h),!y(u))for(b=h.Ba.g.parse(u),u=0;u<b.length;u++){let nt=b[u];const pt=nt[0];if(!(pt<=h.K))if(h.K=pt,nt=nt[1],h.I==2)if(nt[0]=="c"){h.M=nt[1],h.ba=nt[2];const Gt=nt[3];Gt!=null&&(h.ka=Gt,h.j.info("VER="+h.ka));const ke=nt[4];ke!=null&&(h.za=ke,h.j.info("SVER="+h.za));const he=nt[5];he!=null&&typeof he=="number"&&he>0&&(m=1.5*he,h.O=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;const de=o.g;if(de){const _s=de.g?de.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_s){var S=m.h;S.g||_s.indexOf("spdy")==-1&&_s.indexOf("quic")==-1&&_s.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Hi(S,S.h),S.h=null))}if(m.G){const to=de.g?de.g.getResponseHeader("X-HTTP-Session-Id"):null;to&&(m.wa=to,rt(m.J,m.G,to))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),m=h;var N=o;if(m.na=Lc(m,m.L?m.ba:null,m.W),N.L){mc(m.h,N);var G=N,mt=m.O;mt&&(G.H=mt),G.D&&(Gi(G),us(G)),m.g=N}else Nc(m);h.i.length>0&&ms(h)}else nt[0]!="stop"&&nt[0]!="close"||Ne(h,7);else h.I==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Ne(h,7):Yi(h):nt[0]!="noop"&&h.l&&h.l.qa(nt),h.A=0)}}$n(4)}catch{}}var Sf=class{constructor(o,u){this.g=o,this.map=u}};function hc(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function dc(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function fc(o){return o.h?1:o.g?o.g.size:0}function Ki(o,u){return o.h?o.h==u:o.g?o.g.has(u):!1}function Hi(o,u){o.g?o.g.add(u):o.h=u}function mc(o,u){o.h&&o.h==u?o.h=null:o.g&&o.g.has(u)&&o.g.delete(u)}hc.prototype.cancel=function(){if(this.i=gc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function gc(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let u=o.i;for(const h of o.g.values())u=u.concat(h.G);return u}return R(o.i)}var pc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Pf(o,u){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const m=o[h].indexOf("=");let b,S=null;m>=0?(b=o[h].substring(0,m),S=o[h].substring(m+1)):b=o[h],u(b,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function ce(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let u;o instanceof ce?(this.l=o.l,Xn(this,o.j),this.o=o.o,this.g=o.g,Yn(this,o.u),this.h=o.h,Qi(this,wc(o.i)),this.m=o.m):o&&(u=String(o).match(pc))?(this.l=!1,Xn(this,u[1]||"",!0),this.o=Jn(u[2]||""),this.g=Jn(u[3]||"",!0),Yn(this,u[4]),this.h=Jn(u[5]||"",!0),Qi(this,u[6]||"",!0),this.m=Jn(u[7]||"")):(this.l=!1,this.i=new tr(null,this.l))}ce.prototype.toString=function(){const o=[];var u=this.j;u&&o.push(Zn(u,_c,!0),":");var h=this.g;return(h||u=="file")&&(o.push("//"),(u=this.o)&&o.push(Zn(u,_c,!0),"@"),o.push(Qn(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Zn(h,h.charAt(0)=="/"?Df:Cf,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Zn(h,Nf)),o.join("")},ce.prototype.resolve=function(o){const u=zt(this);let h=!!o.j;h?Xn(u,o.j):h=!!o.o,h?u.o=o.o:h=!!o.g,h?u.g=o.g:h=o.u!=null;var m=o.h;if(h)Yn(u,o.u);else if(h=!!o.h){if(m.charAt(0)!="/")if(this.g&&!this.h)m="/"+m;else{var b=u.h.lastIndexOf("/");b!=-1&&(m=u.h.slice(0,b+1)+m)}if(b=m,b==".."||b==".")m="";else if(b.indexOf("./")!=-1||b.indexOf("/.")!=-1){m=b.lastIndexOf("/",0)==0,b=b.split("/");const S=[];for(let N=0;N<b.length;){const G=b[N++];G=="."?m&&N==b.length&&S.push(""):G==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),m&&N==b.length&&S.push("")):(S.push(G),m=!0)}m=S.join("/")}else m=b}return h?u.h=m:h=o.i.toString()!=="",h?Qi(u,wc(o.i)):h=!!o.m,h&&(u.m=o.m),u};function zt(o){return new ce(o)}function Xn(o,u,h){o.j=h?Jn(u,!0):u,o.j&&(o.j=o.j.replace(/:$/,""))}function Yn(o,u){if(u){if(u=Number(u),isNaN(u)||u<0)throw Error("Bad port number "+u);o.u=u}else o.u=null}function Qi(o,u,h){u instanceof tr?(o.i=u,kf(o.i,o.l)):(h||(u=Zn(u,xf)),o.i=new tr(u,o.l))}function rt(o,u,h){o.i.set(u,h)}function ls(o){return rt(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Jn(o,u){return o?u?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Zn(o,u,h){return typeof o=="string"?(o=encodeURI(o).replace(u,Vf),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Vf(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var _c=/[#\/\?@]/g,Cf=/[#\?:]/g,Df=/[#\?]/g,xf=/[#\?@]/g,Nf=/#/g;function tr(o,u){this.h=this.g=null,this.i=o||null,this.j=!!u}function xe(o){o.g||(o.g=new Map,o.h=0,o.i&&Pf(o.i,function(u,h){o.add(decodeURIComponent(u.replace(/\+/g," ")),h)}))}r=tr.prototype,r.add=function(o,u){xe(this),this.i=null,o=an(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(u),this.h+=1,this};function yc(o,u){xe(o),u=an(o,u),o.g.has(u)&&(o.i=null,o.h-=o.g.get(u).length,o.g.delete(u))}function Ic(o,u){return xe(o),u=an(o,u),o.g.has(u)}r.forEach=function(o,u){xe(this),this.g.forEach(function(h,m){h.forEach(function(b){o.call(u,b,m,this)},this)},this)};function Ec(o,u){xe(o);let h=[];if(typeof u=="string")Ic(o,u)&&(h=h.concat(o.g.get(an(o,u))));else for(o=Array.from(o.g.values()),u=0;u<o.length;u++)h=h.concat(o[u]);return h}r.set=function(o,u){return xe(this),this.i=null,o=an(this,o),Ic(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[u]),this.h+=1,this},r.get=function(o,u){return o?(o=Ec(this,o),o.length>0?String(o[0]):u):u};function Tc(o,u,h){yc(o,u),h.length>0&&(o.i=null,o.g.set(an(o,u),R(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],u=Array.from(this.g.keys());for(let m=0;m<u.length;m++){var h=u[m];const b=Qn(h);h=Ec(this,h);for(let S=0;S<h.length;S++){let N=b;h[S]!==""&&(N+="="+Qn(h[S])),o.push(N)}}return this.i=o.join("&")};function wc(o){const u=new tr;return u.i=o.i,o.g&&(u.g=new Map(o.g),u.h=o.h),u}function an(o,u){return u=String(u),o.j&&(u=u.toLowerCase()),u}function kf(o,u){u&&!o.j&&(xe(o),o.i=null,o.g.forEach(function(h,m){const b=m.toLowerCase();m!=b&&(yc(this,m),Tc(this,b,h))},o)),o.j=u}function Ff(o,u){const h=new Hn;if(a.Image){const m=new Image;m.onload=f(ue,h,"TestLoadImage: loaded",!0,u,m),m.onerror=f(ue,h,"TestLoadImage: error",!1,u,m),m.onabort=f(ue,h,"TestLoadImage: abort",!1,u,m),m.ontimeout=f(ue,h,"TestLoadImage: timeout",!1,u,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else u(!1)}function Mf(o,u){const h=new Hn,m=new AbortController,b=setTimeout(()=>{m.abort(),ue(h,"TestPingServer: timeout",!1,u)},1e4);fetch(o,{signal:m.signal}).then(S=>{clearTimeout(b),S.ok?ue(h,"TestPingServer: ok",!0,u):ue(h,"TestPingServer: server error",!1,u)}).catch(()=>{clearTimeout(b),ue(h,"TestPingServer: error",!1,u)})}function ue(o,u,h,m,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),m(h)}catch{}}function Of(){this.g=new If}function Wi(o){this.i=o.Sb||null,this.h=o.ab||!1}g(Wi,Ja),Wi.prototype.g=function(){return new hs(this.i,this.h)};function hs(o,u){Tt.call(this),this.H=o,this.o=u,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(hs,Tt),r=hs.prototype,r.open=function(o,u){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=u,this.readyState=1,nr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const u={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(u.body=o),(this.H||a).fetch(new Request(this.D,u)).then(this.Pa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,er(this)),this.readyState=0},r.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,nr(this)),this.g&&(this.readyState=3,nr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ac(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ac(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}r.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var u=o.value?o.value:new Uint8Array(0);(u=this.B.decode(u,{stream:!o.done}))&&(this.response=this.responseText+=u)}o.done?er(this):nr(this),this.readyState==3&&Ac(this)}},r.Oa=function(o){this.g&&(this.response=this.responseText=o,er(this))},r.Na=function(o){this.g&&(this.response=o,er(this))},r.ga=function(){this.g&&er(this)};function er(o){o.readyState=4,o.l=null,o.j=null,o.B=null,nr(o)}r.setRequestHeader=function(o,u){this.A.append(o,u)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],u=this.h.entries();for(var h=u.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=u.next();return o.join(`\r
`)};function nr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(hs.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function vc(o){let u="";return ss(o,function(h,m){u+=m,u+=":",u+=h,u+=`\r
`}),u}function Xi(o,u,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=vc(h),typeof o=="string"?h!=null&&Qn(h):rt(o,u,h))}function at(o){Tt.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(at,Tt);var Lf=/^https?$/i,Bf=["POST","PUT"];r=at.prototype,r.Fa=function(o){this.H=o},r.ea=function(o,u,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);u=u?u.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ic.g(),this.g.onreadystatechange=E(d(this.Ca,this));try{this.B=!0,this.g.open(u,String(o),!0),this.B=!1}catch(S){bc(this,S);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var b in m)h.set(b,m[b]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const S of m.keys())h.set(S,m.get(S));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(S=>S.toLowerCase()=="content-type"),b=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(Bf,u,void 0)>=0)||m||b||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,N]of h)this.g.setRequestHeader(S,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(S){bc(this,S)}};function bc(o,u){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=u,o.o=5,Rc(o),ds(o)}function Rc(o){o.A||(o.A=!0,Rt(o,"complete"),Rt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,Rt(this,"complete"),Rt(this,"abort"),ds(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ds(this,!0)),at.Z.N.call(this)},r.Ca=function(){this.u||(this.B||this.v||this.j?Sc(this):this.Xa())},r.Xa=function(){Sc(this)};function Sc(o){if(o.h&&typeof i<"u"){if(o.v&&le(o)==4)setTimeout(o.Ca.bind(o),0);else if(Rt(o,"readystatechange"),le(o)==4){o.h=!1;try{const S=o.ca();t:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var u=!0;break t;default:u=!1}var h;if(!(h=u)){var m;if(m=S===0){let N=String(o.D).match(pc)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),m=!Lf.test(N?N.toLowerCase():"")}h=m}if(h)Rt(o,"complete"),Rt(o,"success");else{o.o=6;try{var b=le(o)>2?o.g.statusText:""}catch{b=""}o.l=b+" ["+o.ca()+"]",Rc(o)}}finally{ds(o)}}}}function ds(o,u){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,u||Rt(o,"ready");try{h.onreadystatechange=null}catch{}}}r.isActive=function(){return!!this.g};function le(o){return o.g?o.g.readyState:0}r.ca=function(){try{return le(this)>2?this.g.status:-1}catch{return-1}},r.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.La=function(o){if(this.g){var u=this.g.responseText;return o&&u.indexOf(o)==0&&(u=u.substring(o.length)),yf(u)}};function Pc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Uf(o){const u={};o=(o.g&&le(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(y(o[m]))continue;var h=vf(o[m]);const b=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const S=u[b]||[];u[b]=S,S.push(h)}df(u,function(m){return m.join(", ")})}r.ya=function(){return this.o},r.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function rr(o,u,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||u}function Vc(o){this.za=0,this.i=[],this.j=new Hn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=rr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=rr("baseRetryDelayMs",5e3,o),this.Za=rr("retryDelaySeedMs",1e4,o),this.Ta=rr("forwardChannelMaxRetries",2,o),this.va=rr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new hc(o&&o.concurrentRequestLimit),this.Ba=new Of,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}r=Vc.prototype,r.ka=8,r.I=1,r.connect=function(o,u,h,m){St(0),this.W=o,this.H=u||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.J=Lc(this,null,this.W),ms(this)};function Yi(o){if(Cc(o),o.I==3){var u=o.V++,h=zt(o.J);if(rt(h,"SID",o.M),rt(h,"RID",u),rt(h,"TYPE","terminate"),sr(o,h),u=new ae(o,o.j,u),u.M=2,u.A=ls(zt(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(u.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=u.A,h=!0),h||(u.g=Bc(u.j,null),u.g.ea(u.A)),u.F=Date.now(),us(u)}Oc(o)}function fs(o){o.g&&(Zi(o),o.g.cancel(),o.g=null)}function Cc(o){fs(o),o.v&&(a.clearTimeout(o.v),o.v=null),gs(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function ms(o){if(!dc(o.h)&&!o.m){o.m=!0;var u=o.Ea;Y||p(),K||(Y(),K=!0),w.add(u,o),o.D=0}}function qf(o,u){return fc(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=u.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Kn(d(o.Ea,o,u),Mc(o,o.D)),o.D++,!0)}r.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const b=new ae(this,this.j,o);let S=this.o;if(this.U&&(S?(S=ja(S),Ga(S,this.U)):S=this.U),this.u!==null||this.R||(b.J=S,S=null),this.S)t:{for(var u=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(u+=m,u>4096){u=h;break t}if(u===4096||h===this.i.length-1){u=h+1;break t}}u=1e3}else u=1e3;u=xc(this,b,u),h=zt(this.J),rt(h,"RID",o),rt(h,"CVER",22),this.G&&rt(h,"X-HTTP-Session-Id",this.G),sr(this,h),S&&(this.R?u="headers="+Qn(vc(S))+"&"+u:this.u&&Xi(h,this.u,S)),Hi(this.h,b),this.Ra&&rt(h,"TYPE","init"),this.S?(rt(h,"$req",u),rt(h,"SID","null"),b.U=!0,zi(b,h,null)):zi(b,h,u),this.I=2}}else this.I==3&&(o?Dc(this,o):this.i.length==0||dc(this.h)||Dc(this))};function Dc(o,u){var h;u?h=u.l:h=o.V++;const m=zt(o.J);rt(m,"SID",o.M),rt(m,"RID",h),rt(m,"AID",o.K),sr(o,m),o.u&&o.o&&Xi(m,o.u,o.o),h=new ae(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),u&&(o.i=u.G.concat(o.i)),u=xc(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),Hi(o.h,h),zi(h,m,u)}function sr(o,u){o.H&&ss(o.H,function(h,m){rt(u,m,h)}),o.l&&ss({},function(h,m){rt(u,m,h)})}function xc(o,u,h){h=Math.min(o.i.length,h);const m=o.l?d(o.l.Ka,o.l,o):null;t:{var b=o.i;let G=-1;for(;;){const mt=["count="+h];G==-1?h>0?(G=b[0].g,mt.push("ofs="+G)):G=0:mt.push("ofs="+G);let nt=!0;for(let pt=0;pt<h;pt++){var S=b[pt].g;const Gt=b[pt].map;if(S-=G,S<0)G=Math.max(0,b[pt].g-100),nt=!1;else try{S="req"+S+"_"||"";try{var N=Gt instanceof Map?Gt:Object.entries(Gt);for(const[ke,he]of N){let de=he;c(he)&&(de=Li(he)),mt.push(S+ke+"="+encodeURIComponent(de))}}catch(ke){throw mt.push(S+"type="+encodeURIComponent("_badmap")),ke}}catch{m&&m(Gt)}}if(nt){N=mt.join("&");break t}}N=void 0}return o=o.i.splice(0,h),u.G=o,N}function Nc(o){if(!o.g&&!o.v){o.Y=1;var u=o.Da;Y||p(),K||(Y(),K=!0),w.add(u,o),o.A=0}}function Ji(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Kn(d(o.Da,o),Mc(o,o.A)),o.A++,!0)}r.Da=function(){if(this.v=null,kc(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Kn(d(this.Wa,this),o)}},r.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,St(10),fs(this),kc(this))};function Zi(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function kc(o){o.g=new ae(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var u=zt(o.na);rt(u,"RID","rpc"),rt(u,"SID",o.M),rt(u,"AID",o.K),rt(u,"CI",o.F?"0":"1"),!o.F&&o.ia&&rt(u,"TO",o.ia),rt(u,"TYPE","xmlhttp"),sr(o,u),o.u&&o.o&&Xi(u,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=ls(zt(u)),h.u=null,h.R=!0,cc(h,o)}r.Va=function(){this.C!=null&&(this.C=null,fs(this),Ji(this),St(19))};function gs(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function Fc(o,u){var h=null;if(o.g==u){gs(o),Zi(o),o.g=null;var m=2}else if(Ki(o.h,u))h=u.G,mc(o.h,u),m=1;else return;if(o.I!=0){if(u.o)if(m==1){h=u.u?u.u.length:0,u=Date.now()-u.F;var b=o.D;m=as(),Rt(m,new rc(m,h)),ms(o)}else Nc(o);else if(b=u.m,b==3||b==0&&u.X>0||!(m==1&&qf(o,u)||m==2&&Ji(o)))switch(h&&h.length>0&&(u=o.h,u.i=u.i.concat(h)),b){case 1:Ne(o,5);break;case 4:Ne(o,10);break;case 3:Ne(o,6);break;default:Ne(o,2)}}}function Mc(o,u){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*u}function Ne(o,u){if(o.j.info("Error code "+u),u==2){var h=d(o.bb,o),m=o.Ua;const b=!m;m=new ce(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Xn(m,"https"),ls(m),b?Ff(m.toString(),h):Mf(m.toString(),h)}else St(2);o.I=0,o.l&&o.l.pa(u),Oc(o),Cc(o)}r.bb=function(o){o?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))};function Oc(o){if(o.I=0,o.ja=[],o.l){const u=gc(o.h);(u.length!=0||o.i.length!=0)&&(x(o.ja,u),x(o.ja,o.i),o.h.i.length=0,R(o.i),o.i.length=0),o.l.oa()}}function Lc(o,u,h){var m=h instanceof ce?zt(h):new ce(h);if(m.g!="")u&&(m.g=u+"."+m.g),Yn(m,m.u);else{var b=a.location;m=b.protocol,u=u?u+"."+b.hostname:b.hostname,b=+b.port;const S=new ce(null);m&&Xn(S,m),u&&(S.g=u),b&&Yn(S,b),h&&(S.h=h),m=S}return h=o.G,u=o.wa,h&&u&&rt(m,h,u),rt(m,"VER",o.ka),sr(o,m),m}function Bc(o,u,h){if(u&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return u=o.Aa&&!o.ma?new at(new Wi({ab:h})):new at(o.ma),u.Fa(o.L),u}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Uc(){}r=Uc.prototype,r.ra=function(){},r.qa=function(){},r.pa=function(){},r.oa=function(){},r.isActive=function(){return!0},r.Ka=function(){};function ps(){}ps.prototype.g=function(o,u){return new Nt(o,u)};function Nt(o,u){Tt.call(this),this.g=new Vc(u),this.l=o,this.h=u&&u.messageUrlParams||null,o=u&&u.messageHeaders||null,u&&u.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=u&&u.initMessageHeaders||null,u&&u.messageContentType&&(o?o["X-WebChannel-Content-Type"]=u.messageContentType:o={"X-WebChannel-Content-Type":u.messageContentType}),u&&u.sa&&(o?o["X-WebChannel-Client-Profile"]=u.sa:o={"X-WebChannel-Client-Profile":u.sa}),this.g.U=o,(o=u&&u.Qb)&&!y(o)&&(this.g.u=o),this.A=u&&u.supportsCrossDomainXhr||!1,this.v=u&&u.sendRawJson||!1,(u=u&&u.httpSessionIdParam)&&!y(u)&&(this.g.G=u,o=this.h,o!==null&&u in o&&(o=this.h,u in o&&delete o[u])),this.j=new cn(this)}g(Nt,Tt),Nt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Nt.prototype.close=function(){Yi(this.g)},Nt.prototype.o=function(o){var u=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=Li(o),o=h);u.i.push(new Sf(u.Ya++,o)),u.I==3&&ms(u)},Nt.prototype.N=function(){this.g.l=null,delete this.j,Yi(this.g),delete this.g,Nt.Z.N.call(this)};function qc(o){Bi.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var u=o.__sm__;if(u){t:{for(const h in u){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,u=u!==null&&o in u?u[o]:void 0),this.data=u}else this.data=o}g(qc,Bi);function jc(){Ui.call(this),this.status=1}g(jc,Ui);function cn(o){this.g=o}g(cn,Uc),cn.prototype.ra=function(){Rt(this.g,"a")},cn.prototype.qa=function(o){Rt(this.g,new qc(o))},cn.prototype.pa=function(o){Rt(this.g,new jc)},cn.prototype.oa=function(){Rt(this.g,"b")},ps.prototype.createWebChannel=ps.prototype.g,Nt.prototype.send=Nt.prototype.o,Nt.prototype.open=Nt.prototype.m,Nt.prototype.close=Nt.prototype.close,Wl=function(){return new ps},Ql=function(){return as()},Hl=Ce,Eo={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},cs.NO_ERROR=0,cs.TIMEOUT=8,cs.HTTP_ERROR=6,Ps=cs,sc.COMPLETE="complete",Kl=sc,Za.EventType=Gn,Gn.OPEN="a",Gn.CLOSE="b",Gn.ERROR="c",Gn.MESSAGE="d",Tt.prototype.listen=Tt.prototype.J,dr=Za,at.prototype.listenOnce=at.prototype.K,at.prototype.getLastError=at.prototype.Ha,at.prototype.getLastErrorCode=at.prototype.ya,at.prototype.getStatus=at.prototype.ca,at.prototype.getResponseJson=at.prototype.La,at.prototype.getResponseText=at.prototype.la,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Fa,$l=at}).apply(typeof ys<"u"?ys:typeof self<"u"?self:typeof window<"u"?window:{});const eu="@firebase/firestore",nu="4.9.3";class It{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}It.UNAUTHENTICATED=new It(null),It.GOOGLE_CREDENTIALS=new It("google-credentials-uid"),It.FIRST_PARTY=new It("first-party-uid"),It.MOCK_USER=new It("mock-user");let Bn="12.7.0";const Xe=new Ol("@firebase/firestore");function _n(){return Xe.logLevel}function V(r,...t){if(Xe.logLevel<=W.DEBUG){const e=t.map(Qo);Xe.debug(`Firestore (${Bn}): ${r}`,...e)}}function Pt(r,...t){if(Xe.logLevel<=W.ERROR){const e=t.map(Qo);Xe.error(`Firestore (${Bn}): ${r}`,...e)}}function vn(r,...t){if(Xe.logLevel<=W.WARN){const e=t.map(Qo);Xe.warn(`Firestore (${Bn}): ${r}`,...e)}}function Qo(r){if(typeof r=="string")return r;try{return(function(e){return JSON.stringify(e)})(r)}catch{return r}}function M(r,t,e){let n="Unexpected state";typeof t=="string"?n=t:e=t,Xl(r,n,e)}function Xl(r,t,e){let n=`FIRESTORE (${Bn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${r.toString(16)})`;if(e!==void 0)try{n+=" CONTEXT: "+JSON.stringify(e)}catch{n+=" CONTEXT: "+e}throw Pt(n),new Error(n)}function O(r,t,e,n){let s="Unexpected state";typeof e=="string"?s=e:n=e,r||Xl(t,s,n)}function j(r,t){return r}const P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends Ln{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Wt{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Yl{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class wg{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(It.UNAUTHENTICATED)))}shutdown(){}}class Ag{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class vg{constructor(t){this.t=t,this.currentUser=It.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){O(this.o===void 0,42304);let n=this.i;const s=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve();let i=new Wt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Wt,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const l=i;t.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},c=l=>{V("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((l=>c(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?c(l):(V("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Wt)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((n=>this.i!==t?(V("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(O(typeof n.accessToken=="string",31837,{l:n}),new Yl(n.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return O(t===null||typeof t=="string",2055,{h:t}),new It(t)}}class bg{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=It.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Rg{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new bg(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(It.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ru{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Sg{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ig(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){O(this.o===void 0,3512);const n=i=>{i.error!=null&&V("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,V("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(i.token):Promise.resolve()};this.o=i=>{t.enqueueRetryable((()=>n(i)))};const s=i=>{V("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):V("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new ru(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(O(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new ru(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Pg(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}class Wo{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let n="";for(;n.length<20;){const s=Pg(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function q(r,t){return r<t?-1:r>t?1:0}function To(r,t){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++){const s=r.charAt(n),i=t.charAt(n);if(s!==i)return io(s)===io(i)?q(s,i):io(s)?1:-1}return q(r.length,t.length)}const Vg=55296,Cg=57343;function io(r){const t=r.charCodeAt(0);return t>=Vg&&t<=Cg}function bn(r,t,e){return r.length===t.length&&r.every(((n,s)=>e(n,t[s])))}function Jl(r){return r+"\0"}const su="__name__";class $t{constructor(t,e,n){e===void 0?e=0:e>t.length&&M(637,{offset:e,range:t.length}),n===void 0?n=t.length-e:n>t.length-e&&M(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return $t.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof $t?t.forEach((n=>{e.push(n)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const i=$t.compareSegments(t.get(s),e.get(s));if(i!==0)return i}return q(t.length,e.length)}static compareSegments(t,e){const n=$t.isNumericId(t),s=$t.isNumericId(e);return n&&!s?-1:!n&&s?1:n&&s?$t.extractNumericId(t).compare($t.extractNumericId(e)):To(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ee.fromString(t.substring(4,t.length-2))}}class J extends $t{construct(t,e,n){return new J(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new C(P.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((s=>s.length>0)))}return new J(e)}static emptyPath(){return new J([])}}const Dg=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ot extends $t{construct(t,e,n){return new ot(t,e,n)}static isValidIdentifier(t){return Dg.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ot.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===su}static keyField(){return new ot([su])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(n.length===0)throw new C(P.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let a=!1;for(;s<t.length;){const c=t[s];if(c==="\\"){if(s+1===t.length)throw new C(P.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new C(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(i(),s++)}if(i(),a)throw new C(P.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ot(e)}static emptyPath(){return new ot([])}}class F{constructor(t){this.path=t}static fromPath(t){return new F(J.fromString(t))}static fromName(t){return new F(J.fromString(t).popFirst(5))}static empty(){return new F(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new F(new J(t.slice()))}}function Zl(r,t,e){if(!e)throw new C(P.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function xg(r,t,e,n){if(t===!0&&n===!0)throw new C(P.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function iu(r){if(!F.isDocumentKey(r))throw new C(P.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ou(r){if(F.isDocumentKey(r))throw new C(P.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function th(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function ci(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=(function(n){return n.constructor?n.constructor.name:null})(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":M(12329,{type:typeof r})}function xt(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new C(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=ci(r);throw new C(P.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function Ng(r,t){if(t<=0)throw new C(P.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}function dt(r,t){const e={typeString:r};return t&&(e.value=t),e}function Gr(r,t){if(!th(r))throw new C(P.INVALID_ARGUMENT,"JSON must be an object");let e;for(const n in t)if(t[n]){const s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in r)){e=`JSON missing required field: '${n}'`;break}const a=r[n];if(s&&typeof a!==s){e=`JSON field '${n}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){e=`Expected '${n}' field to equal '${i.value}'`;break}}if(e)throw new C(P.INVALID_ARGUMENT,e);return!0}const au=-62135596800,cu=1e6;class X{static now(){return X.fromMillis(Date.now())}static fromDate(t){return X.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*cu);return new X(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new C(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new C(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<au)throw new C(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new C(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/cu}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:X._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Gr(t,X._jsonSchema))return new X(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-au;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}X._jsonSchemaVersion="firestore/timestamp/1.0",X._jsonSchema={type:dt("string",X._jsonSchemaVersion),seconds:dt("number"),nanoseconds:dt("number")};class B{static fromTimestamp(t){return new B(t)}static min(){return new B(new X(0,0))}static max(){return new B(new X(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Vr=-1;class Gs{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}function wo(r){return r.fields.find((t=>t.kind===2))}function Le(r){return r.fields.filter((t=>t.kind!==2))}Gs.UNKNOWN_ID=-1;class Vs{constructor(t,e){this.fieldPath=t,this.kind=e}}class Cr{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Cr(0,Ot.min())}}function kg(r,t){const e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=B.fromTimestamp(n===1e9?new X(e+1,0):new X(e,n));return new Ot(s,F.empty(),t)}function eh(r){return new Ot(r.readTime,r.key,Vr)}class Ot{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Ot(B.min(),F.empty(),Vr)}static max(){return new Ot(B.max(),F.empty(),Vr)}}function Xo(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=F.comparator(r.documentKey,t.documentKey),e!==0?e:q(r.largestBatchId,t.largestBatchId))}const nh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function rn(r){if(r.code!==P.FAILED_PRECONDITION||r.message!==nh)throw r;V("LocalStore","Unexpectedly lost primary lease")}class A{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&M(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new A(((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(t,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(e,i).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof A?e:A.resolve(e)}catch(e){return A.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):A.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):A.reject(e)}static resolve(t){return new A(((e,n)=>{e(t)}))}static reject(t){return new A(((e,n)=>{n(t)}))}static waitFor(t){return new A(((e,n)=>{let s=0,i=0,a=!1;t.forEach((c=>{++s,c.next((()=>{++i,a&&i===s&&e()}),(l=>n(l)))})),a=!0,i===s&&e()}))}static or(t){let e=A.resolve(!1);for(const n of t)e=e.next((s=>s?A.resolve(s):n()));return e}static forEach(t,e){const n=[];return t.forEach(((s,i)=>{n.push(e.call(this,s,i))})),this.waitFor(n)}static mapArray(t,e){return new A(((n,s)=>{const i=t.length,a=new Array(i);let c=0;for(let l=0;l<i;l++){const d=l;e(t[d]).next((f=>{a[d]=f,++c,c===i&&n(a)}),(f=>s(f)))}}))}static doWhile(t,e){return new A(((n,s)=>{const i=()=>{t()===!0?e().next((()=>{i()}),s):n()};i()}))}}const Ft="SimpleDb";class ui{static open(t,e,n,s){try{return new ui(e,t.transaction(s,n))}catch(i){throw new yr(e,i)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Wt,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new yr(t,e.error)):this.S.resolve()},this.transaction.onerror=n=>{const s=Yo(n.target.error);this.S.reject(new yr(t,s))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(V(Ft,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Mg(e)}}class Te{static delete(t){return V(Ft,"Removing database:",t),Ue(Vl().indexedDB.deleteDatabase(t)).toPromise()}static v(){if(!Fl())return!1;if(Te.F())return!0;const t=qs(),e=Te.M(t),n=0<e&&e<10,s=sh(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static F(){return typeof process<"u"&&process.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE==="YES"}static O(t,e){return t.store(e)}static M(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(t,e,n){this.name=t,this.version=e,this.N=n,this.B=null,Te.M(qs())===12.2&&Pt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(t){return this.db||(V(Ft,"Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;e(a)},s.onblocked=()=>{n(new yr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?n(new C(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new C(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new yr(t,a))},s.onupgradeneeded=i=>{V(Ft,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.N.k(a,s.transaction,i.oldVersion,this.version).next((()=>{V(Ft,"Database upgrade to version "+this.version+" complete")}))}}))),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(t){this.q=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i=e==="readonly";let a=0;for(;;){++a;try{this.db=await this.L(t);const c=ui.open(this.db,t,i?"readonly":"readwrite",n),l=s(c).next((d=>(c.C(),d))).catch((d=>(c.abort(d),A.reject(d)))).toPromise();return l.catch((()=>{})),await c.D,l}catch(c){const l=c,d=l.name!=="FirebaseError"&&a<3;if(V(Ft,"Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function sh(r){const t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}class Fg{constructor(t){this.U=t,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(t){this.U=t}done(){this.K=!0}j(t){this.W=t}delete(){return Ue(this.U.delete())}}class yr extends C{constructor(t,e){super(P.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Se(r){return r.name==="IndexedDbTransactionError"}class Mg{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(V(Ft,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(V(Ft,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ue(n)}add(t){return V(Ft,"ADD",this.store.name,t,t),Ue(this.store.add(t))}get(t){return Ue(this.store.get(t)).next((e=>(e===void 0&&(e=null),V(Ft,"GET",this.store.name,t,e),e)))}delete(t){return V(Ft,"DELETE",this.store.name,t),Ue(this.store.delete(t))}count(){return V(Ft,"COUNT",this.store.name),Ue(this.store.count())}J(t,e){const n=this.options(t,e),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new A(((a,c)=>{i.onerror=l=>{c(l.target.error)},i.onsuccess=l=>{a(l.target.result)}}))}{const i=this.cursor(n),a=[];return this.H(i,((c,l)=>{a.push(l)})).next((()=>a))}}Y(t,e){const n=this.store.getAll(t,e===null?void 0:e);return new A(((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}}))}Z(t,e){V(Ft,"DELETE ALL",this.store.name);const n=this.options(t,e);n.X=!1;const s=this.cursor(n);return this.H(s,((i,a,c)=>c.delete()))}ee(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.H(s,e)}te(t){const e=this.cursor({});return new A(((n,s)=>{e.onerror=i=>{const a=Yo(i.target.error);s(a)},e.onsuccess=i=>{const a=i.target.result;a?t(a.primaryKey,a.value).next((c=>{c?a.continue():n()})):n()}}))}H(t,e){const n=[];return new A(((s,i)=>{t.onerror=a=>{i(a.target.error)},t.onsuccess=a=>{const c=a.target.result;if(!c)return void s();const l=new Fg(c),d=e(c.primaryKey,c.value,l);if(d instanceof A){const f=d.catch((g=>(l.done(),A.reject(g))));n.push(f)}l.isDone?s():l.G===null?c.continue():c.continue(l.G)}})).next((()=>A.waitFor(n)))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.X?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ue(r){return new A(((t,e)=>{r.onsuccess=n=>{const s=n.target.result;t(s)},r.onerror=n=>{const s=Yo(n.target.error);e(s)}}))}let uu=!1;function Yo(r){const t=Te.M(qs());if(t>=12.2&&t<13){const e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){const n=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uu||(uu=!0,setTimeout((()=>{throw n}),0)),n}}return r}const Ir="IndexBackfiller";class Og{constructor(t,e){this.asyncQueue=t,this.ne=e,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(t){V(Ir,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,(async()=>{this.task=null;try{const e=await this.ne.ie();V(Ir,`Documents written: ${e}`)}catch(e){Se(e)?V(Ir,"Ignoring IndexedDB error during index backfill: ",e):await rn(e)}await this.re(6e4)}))}}class Lg{constructor(t,e){this.localStore=t,this.persistence=e}async ie(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(e=>this.se(e,t)))}se(t,e){const n=new Set;let s=e,i=!0;return A.doWhile((()=>i===!0&&s>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next((a=>{if(a!==null&&!n.has(a))return V(Ir,`Processing collection: ${a}`),this.oe(t,a,s).next((c=>{s-=c,n.add(a)}));i=!1})))).next((()=>e-s))}oe(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next((s=>this.localStore.localDocuments.getNextDocuments(t,e,s,n).next((i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next((()=>this._e(s,i))).next((c=>(V(Ir,`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(t,e,c)))).next((()=>a.size))}))))}_e(t,e){let n=t;return e.changes.forEach(((s,i)=>{const a=eh(i);Xo(a,n)>0&&(n=a)})),new Ot(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}}class Bt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=n=>this.ae(n),this.ue=n=>e.writeSequenceNumber(n))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Bt.ce=-1;const $e=-1;function li(r){return r==null}function Dr(r){return r===0&&1/r==-1/0}function Bg(r){return typeof r=="number"&&Number.isInteger(r)&&!Dr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}const $s="";function bt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=lu(t)),t=Ug(r.get(e),t);return lu(t)}function Ug(r,t){let e=t;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":e+="";break;case $s:e+="";break;default:e+=i}}return e}function lu(r){return r+$s+""}function Ht(r){const t=r.length;if(O(t>=2,64408,{path:r}),t===2)return O(r.charAt(0)===$s&&r.charAt(1)==="",56145,{path:r}),J.emptyPath();const e=t-2,n=[];let s="";for(let i=0;i<t;){const a=r.indexOf($s,i);switch((a<0||a>e)&&M(50515,{path:r}),r.charAt(a+1)){case"":const c=r.substring(i,a);let l;s.length===0?l=c:(s+=c,l=s,s=""),n.push(l);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:M(61167,{path:r})}i=a+2}return new J(n)}const Be="remoteDocuments",$r="owner",un="owner",xr="mutationQueues",qg="userId",jt="mutations",hu="batchId",Ge="userMutationsIndex",du=["userId","batchId"];function Cs(r,t){return[r,bt(t)]}function ih(r,t,e){return[r,bt(t),e]}const jg={},Rn="documentMutations",Ks="remoteDocumentsV14",zg=["prefixPath","collectionGroup","readTime","documentId"],Ds="documentKeyIndex",Gg=["prefixPath","collectionGroup","documentId"],oh="collectionGroupIndex",$g=["collectionGroup","readTime","prefixPath","documentId"],Nr="remoteDocumentGlobal",Ao="remoteDocumentGlobalKey",Sn="targets",ah="queryTargetsIndex",Kg=["canonicalId","targetId"],Pn="targetDocuments",Hg=["targetId","path"],Jo="documentTargetsIndex",Qg=["path","targetId"],Hs="targetGlobalKey",Ke="targetGlobal",kr="collectionParents",Wg=["collectionId","parent"],Vn="clientMetadata",Xg="clientId",hi="bundles",Yg="bundleId",di="namedQueries",Jg="name",Zo="indexConfiguration",Zg="indexId",vo="collectionGroupIndex",tp="collectionGroup",Er="indexState",ep=["indexId","uid"],ch="sequenceNumberIndex",np=["uid","sequenceNumber"],Tr="indexEntries",rp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],uh="documentKeyIndex",sp=["indexId","uid","orderedDocumentKey"],fi="documentOverlays",ip=["userId","collectionPath","documentId"],bo="collectionPathOverlayIndex",op=["userId","collectionPath","largestBatchId"],lh="collectionGroupOverlayIndex",ap=["userId","collectionGroup","largestBatchId"],ta="globals",cp="name",hh=[xr,jt,Rn,Be,Sn,$r,Ke,Pn,Vn,Nr,kr,hi,di],up=[...hh,fi],dh=[xr,jt,Rn,Ks,Sn,$r,Ke,Pn,Vn,Nr,kr,hi,di,fi],fh=dh,ea=[...fh,Zo,Er,Tr],lp=ea,mh=[...ea,ta],hp=mh;class Ro extends rh{constructor(t,e){super(),this.le=t,this.currentSequenceNumber=e}}function gt(r,t){const e=j(r);return Te.O(e.le,t)}function fu(r){let t=0;for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function Pe(r,t){for(const e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function gh(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}class it{constructor(t,e){this.comparator=t,this.root=e||Et.EMPTY}insert(t,e){return new it(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Et.BLACK,null,null))}remove(t){return new it(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Et.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(s===0)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Is(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Is(this.root,t,this.comparator,!1)}getReverseIterator(){return new Is(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Is(this.root,t,this.comparator,!0)}}class Is{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(i===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Et{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=n??Et.RED,this.left=s??Et.EMPTY,this.right=i??Et.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Et(t??this.key,e??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):i===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Et.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return Et.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Et.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Et.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw M(43730,{key:this.key,value:this.value});if(this.right.isRed())throw M(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw M(27949);return t+(this.isRed()?0:1)}}Et.EMPTY=null,Et.RED=!0,Et.BLACK=!1;Et.EMPTY=new class{constructor(){this.size=0}get key(){throw M(57766)}get value(){throw M(16141)}get color(){throw M(16727)}get left(){throw M(29726)}get right(){throw M(36894)}copy(t,e,n,s,i){return this}insert(t,e,n){return new Et(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class et{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new mu(this.data.getIterator())}getIteratorFrom(t){return new mu(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((n=>{e=e.add(n)})),e}isEqual(t){if(!(t instanceof et)||this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new et(this.comparator);return e.data=t,e}}class mu{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ln(r){return r.hasNext()?r.getNext():void 0}class Dt{constructor(t){this.fields=t,t.sort(ot.comparator)}static empty(){return new Dt([])}unionWith(t){let e=new et(ot.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new Dt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return bn(this.fields,t.fields,((e,n)=>e.isEqual(n)))}}class ph extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ft{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ph("Invalid base64 string: "+i):i}})(t);return new ft(e)}static fromUint8Array(t){const e=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(t);return new ft(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ft.EMPTY_BYTE_STRING=new ft("");const dp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ee(r){if(O(!!r,39018),typeof r=="string"){let t=0;const e=dp.exec(r);if(O(!!e,46558,{timestamp:r}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function ne(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}const _h="server_timestamp",yh="__type__",Ih="__previous_value__",Eh="__local_write_time__";function na(r){return(r?.mapValue?.fields||{})[yh]?.stringValue===_h}function mi(r){const t=r.mapValue.fields[Ih];return na(t)?mi(t):t}function Fr(r){const t=ee(r.mapValue.fields[Eh].timestampValue);return new X(t.seconds,t.nanos)}class fp{constructor(t,e,n,s,i,a,c,l,d,f){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=l,this.useFetchStreams=d,this.isUsingEmulator=f}}const Mr="(default)";class Ye{constructor(t,e){this.projectId=t,this.database=e||Mr}static empty(){return new Ye("","")}get isDefaultDatabase(){return this.database===Mr}isEqual(t){return t instanceof Ye&&t.projectId===this.projectId&&t.database===this.database}}const ra="__type__",Th="__max__",_e={mapValue:{fields:{__type__:{stringValue:Th}}}},sa="__vector__",Cn="value",xs={nullValue:"NULL_VALUE"};function Ae(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?na(r)?4:wh(r)?9007199254740991:gi(r)?10:11:M(28295,{value:r})}function Jt(r,t){if(r===t)return!0;const e=Ae(r);if(e!==Ae(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Fr(r).isEqual(Fr(t));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=ee(s.timestampValue),c=ee(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos})(r,t);case 5:return r.stringValue===t.stringValue;case 6:return(function(s,i){return ne(s.bytesValue).isEqual(ne(i.bytesValue))})(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return(function(s,i){return st(s.geoPointValue.latitude)===st(i.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(i.geoPointValue.longitude)})(r,t);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return st(s.integerValue)===st(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=st(s.doubleValue),c=st(i.doubleValue);return a===c?Dr(a)===Dr(c):isNaN(a)&&isNaN(c)}return!1})(r,t);case 9:return bn(r.arrayValue.values||[],t.arrayValue.values||[],Jt);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(fu(a)!==fu(c))return!1;for(const l in a)if(a.hasOwnProperty(l)&&(c[l]===void 0||!Jt(a[l],c[l])))return!1;return!0})(r,t);default:return M(52216,{left:r})}}function Or(r,t){return(r.values||[]).find((e=>Jt(e,t)))!==void 0}function ve(r,t){if(r===t)return 0;const e=Ae(r),n=Ae(t);if(e!==n)return q(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(r.booleanValue,t.booleanValue);case 2:return(function(i,a){const c=st(i.integerValue||i.doubleValue),l=st(a.integerValue||a.doubleValue);return c<l?-1:c>l?1:c===l?0:isNaN(c)?isNaN(l)?0:-1:1})(r,t);case 3:return gu(r.timestampValue,t.timestampValue);case 4:return gu(Fr(r),Fr(t));case 5:return To(r.stringValue,t.stringValue);case 6:return(function(i,a){const c=ne(i),l=ne(a);return c.compareTo(l)})(r.bytesValue,t.bytesValue);case 7:return(function(i,a){const c=i.split("/"),l=a.split("/");for(let d=0;d<c.length&&d<l.length;d++){const f=q(c[d],l[d]);if(f!==0)return f}return q(c.length,l.length)})(r.referenceValue,t.referenceValue);case 8:return(function(i,a){const c=q(st(i.latitude),st(a.latitude));return c!==0?c:q(st(i.longitude),st(a.longitude))})(r.geoPointValue,t.geoPointValue);case 9:return pu(r.arrayValue,t.arrayValue);case 10:return(function(i,a){const c=i.fields||{},l=a.fields||{},d=c[Cn]?.arrayValue,f=l[Cn]?.arrayValue,g=q(d?.values?.length||0,f?.values?.length||0);return g!==0?g:pu(d,f)})(r.mapValue,t.mapValue);case 11:return(function(i,a){if(i===_e.mapValue&&a===_e.mapValue)return 0;if(i===_e.mapValue)return 1;if(a===_e.mapValue)return-1;const c=i.fields||{},l=Object.keys(c),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){const E=To(l[g],f[g]);if(E!==0)return E;const R=ve(c[l[g]],d[f[g]]);if(R!==0)return R}return q(l.length,f.length)})(r.mapValue,t.mapValue);default:throw M(23264,{he:e})}}function gu(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return q(r,t);const e=ee(r),n=ee(t),s=q(e.seconds,n.seconds);return s!==0?s:q(e.nanos,n.nanos)}function pu(r,t){const e=r.values||[],n=t.values||[];for(let s=0;s<e.length&&s<n.length;++s){const i=ve(e[s],n[s]);if(i)return i}return q(e.length,n.length)}function Dn(r){return So(r)}function So(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?(function(e){const n=ee(e);return`time(${n.seconds},${n.nanos})`})(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?(function(e){return ne(e).toBase64()})(r.bytesValue):"referenceValue"in r?(function(e){return F.fromName(e).toString()})(r.referenceValue):"geoPointValue"in r?(function(e){return`geo(${e.latitude},${e.longitude})`})(r.geoPointValue):"arrayValue"in r?(function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=So(i);return n+"]"})(r.arrayValue):"mapValue"in r?(function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const a of n)i?i=!1:s+=",",s+=`${a}:${So(e.fields[a])}`;return s+"}"})(r.mapValue):M(61005,{value:r})}function Ns(r){switch(Ae(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=mi(r);return t?16+Ns(t):16;case 5:return 2*r.stringValue.length;case 6:return ne(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return(function(n){return(n.values||[]).reduce(((s,i)=>s+Ns(i)),0)})(r.arrayValue);case 10:case 11:return(function(n){let s=0;return Pe(n.fields,((i,a)=>{s+=i.length+Ns(a)})),s})(r.mapValue);default:throw M(13486,{value:r})}}function Lr(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Po(r){return!!r&&"integerValue"in r}function Br(r){return!!r&&"arrayValue"in r}function _u(r){return!!r&&"nullValue"in r}function yu(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ks(r){return!!r&&"mapValue"in r}function gi(r){return(r?.mapValue?.fields||{})[ra]?.stringValue===sa}function wr(r){if(r.geoPointValue)return{geoPointValue:{...r.geoPointValue}};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:{...r.timestampValue}};if(r.mapValue){const t={mapValue:{fields:{}}};return Pe(r.mapValue.fields,((e,n)=>t.mapValue.fields[e]=wr(n))),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=wr(r.arrayValue.values[e]);return t}return{...r}}function wh(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===Th}const Ah={mapValue:{fields:{[ra]:{stringValue:sa},[Cn]:{arrayValue:{}}}}};function mp(r){return"nullValue"in r?xs:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Lr(Ye.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?gi(r)?Ah:{mapValue:{}}:M(35942,{value:r})}function gp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Lr(Ye.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Ah:"mapValue"in r?gi(r)?{mapValue:{}}:_e:M(61959,{value:r})}function Iu(r,t){const e=ve(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Eu(r,t){const e=ve(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}class vt{constructor(t){this.value=t}static empty(){return new vt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ks(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=wr(e)}setAll(t){let e=ot.emptyPath(),n={},s=[];t.forEach(((a,c)=>{if(!e.isImmediateParentOf(c)){const l=this.getFieldsMap(e);this.applyChanges(l,n,s),n={},s=[],e=c.popLast()}a?n[c.lastSegment()]=wr(a):s.push(c.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());ks(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Jt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];ks(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Pe(e,((s,i)=>t[s]=i));for(const s of n)delete t[s]}clone(){return new vt(wr(this.value))}}function vh(r){const t=[];return Pe(r.fields,((e,n)=>{const s=new ot([e]);if(ks(n)){const i=vh(n.mapValue).fields;if(i.length===0)t.push(s);else for(const a of i)t.push(s.child(a))}else t.push(s)})),new Dt(t)}class ct{constructor(t,e,n,s,i,a,c){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(t){return new ct(t,0,B.min(),B.min(),B.min(),vt.empty(),0)}static newFoundDocument(t,e,n,s){return new ct(t,1,e,B.min(),n,s,0)}static newNoDocument(t,e){return new ct(t,2,e,B.min(),B.min(),vt.empty(),0)}static newUnknownDocument(t,e){return new ct(t,3,e,B.min(),B.min(),vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ct&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xn{constructor(t,e){this.position=t,this.inclusive=e}}function Tu(r,t,e){let n=0;for(let s=0;s<r.position.length;s++){const i=t[s],a=r.position[s];if(i.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),e.key):n=ve(a,e.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function wu(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Jt(r.position[e],t.position[e]))return!1;return!0}class Ur{constructor(t,e="asc"){this.field=t,this.dir=e}}function pp(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}class bh{}class H extends bh{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new _p(t,e,n):e==="array-contains"?new Ep(t,n):e==="in"?new Dh(t,n):e==="not-in"?new Tp(t,n):e==="array-contains-any"?new wp(t,n):new H(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new yp(t,n):new Ip(t,n)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(ve(e,this.value)):e!==null&&Ae(this.value)===Ae(e)&&this.matchesComparison(ve(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return M(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class tt extends bh{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new tt(t,e)}matches(t){return Nn(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Nn(r){return r.op==="and"}function Vo(r){return r.op==="or"}function ia(r){return Rh(r)&&Nn(r)}function Rh(r){for(const t of r.filters)if(t instanceof tt)return!1;return!0}function Co(r){if(r instanceof H)return r.field.canonicalString()+r.op.toString()+Dn(r.value);if(ia(r))return r.filters.map((t=>Co(t))).join(",");{const t=r.filters.map((e=>Co(e))).join(",");return`${r.op}(${t})`}}function Sh(r,t){return r instanceof H?(function(n,s){return s instanceof H&&n.op===s.op&&n.field.isEqual(s.field)&&Jt(n.value,s.value)})(r,t):r instanceof tt?(function(n,s){return s instanceof tt&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce(((i,a,c)=>i&&Sh(a,s.filters[c])),!0):!1})(r,t):void M(19439)}function Ph(r,t){const e=r.filters.concat(t);return tt.create(e,r.op)}function Vh(r){return r instanceof H?(function(e){return`${e.field.canonicalString()} ${e.op} ${Dn(e.value)}`})(r):r instanceof tt?(function(e){return e.op.toString()+" {"+e.getFilters().map(Vh).join(" ,")+"}"})(r):"Filter"}class _p extends H{constructor(t,e,n){super(t,e,n),this.key=F.fromName(n.referenceValue)}matches(t){const e=F.comparator(t.key,this.key);return this.matchesComparison(e)}}class yp extends H{constructor(t,e){super(t,"in",e),this.keys=Ch("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ip extends H{constructor(t,e){super(t,"not-in",e),this.keys=Ch("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ch(r,t){return(t.arrayValue?.values||[]).map((e=>F.fromName(e.referenceValue)))}class Ep extends H{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Br(e)&&Or(e.arrayValue,this.value)}}class Dh extends H{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Or(this.value.arrayValue,e)}}class Tp extends H{constructor(t,e){super(t,"not-in",e)}matches(t){if(Or(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Or(this.value.arrayValue,e)}}class wp extends H{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Br(e)||!e.arrayValue.values)&&e.arrayValue.values.some((n=>Or(this.value.arrayValue,n)))}}class Ap{constructor(t,e=null,n=[],s=[],i=null,a=null,c=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.Te=null}}function Do(r,t=null,e=[],n=[],s=null,i=null,a=null){return new Ap(r,t,e,n,s,i,a)}function Je(r){const t=j(r);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((n=>Co(n))).join(","),e+="|ob:",e+=t.orderBy.map((n=>(function(i){return i.field.canonicalString()+i.dir})(n))).join(","),li(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((n=>Dn(n))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((n=>Dn(n))).join(",")),t.Te=e}return t.Te}function Kr(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!pp(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Sh(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!wu(r.startAt,t.startAt)&&wu(r.endAt,t.endAt)}function Qs(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function Ws(r,t){return r.filters.filter((e=>e instanceof H&&e.field.isEqual(t)))}function Au(r,t,e){let n=xs,s=!0;for(const i of Ws(r,t)){let a=xs,c=!0;switch(i.op){case"<":case"<=":a=mp(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=xs}Iu({value:n,inclusive:s},{value:a,inclusive:c})<0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Iu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})<0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}function vu(r,t,e){let n=_e,s=!0;for(const i of Ws(r,t)){let a=_e,c=!0;switch(i.op){case">=":case">":a=gp(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=_e}Eu({value:n,inclusive:s},{value:a,inclusive:c})>0&&(n=a,s=c)}if(e!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(t)){const a=e.position[i];Eu({value:n,inclusive:s},{value:a,inclusive:e.inclusive})>0&&(n=a,s=e.inclusive);break}}return{value:n,inclusive:s}}class Un{constructor(t,e=null,n=[],s=[],i=null,a="F",c=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function vp(r,t,e,n,s,i,a,c){return new Un(r,t,e,n,s,i,a,c)}function Hr(r){return new Un(r)}function bu(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function xh(r){return r.collectionGroup!==null}function Ar(r){const t=j(r);if(t.Ie===null){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new et(ot.comparator);return a.filters.forEach((l=>{l.getFlattenedFilters().forEach((d=>{d.isInequality()&&(c=c.add(d.field))}))})),c})(t).forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Ie.push(new Ur(i,n))})),e.has(ot.keyField().canonicalString())||t.Ie.push(new Ur(ot.keyField(),n))}return t.Ie}function Ut(r){const t=j(r);return t.Ee||(t.Ee=bp(t,Ar(r))),t.Ee}function bp(r,t){if(r.limitType==="F")return Do(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Ur(s.field,i)}));const e=r.endAt?new xn(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new xn(r.startAt.position,r.startAt.inclusive):null;return Do(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function xo(r,t){const e=r.filters.concat([t]);return new Un(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function Xs(r,t,e){return new Un(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function pi(r,t){return Kr(Ut(r),Ut(t))&&r.limitType===t.limitType}function Nh(r){return`${Je(Ut(r))}|lt:${r.limitType}`}function yn(r){return`Query(target=${(function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map((s=>Vh(s))).join(", ")}]`),li(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((s=>Dn(s))).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((s=>Dn(s))).join(",")),`Target(${n})`})(Ut(r))}; limitType=${r.limitType})`}function Qr(r,t){return t.isFoundDocument()&&(function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):F.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(r,t)&&(function(n,s){for(const i of Ar(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(r,t)&&(function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0})(r,t)&&(function(n,s){return!(n.startAt&&!(function(a,c,l){const d=Tu(a,c,l);return a.inclusive?d<=0:d<0})(n.startAt,Ar(n),s)||n.endAt&&!(function(a,c,l){const d=Tu(a,c,l);return a.inclusive?d>=0:d>0})(n.endAt,Ar(n),s))})(r,t)}function Rp(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function kh(r){return(t,e)=>{let n=!1;for(const s of Ar(r)){const i=Sp(s,t,e);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function Sp(r,t,e){const n=r.field.isKeyField()?F.comparator(t.key,e.key):(function(i,a,c){const l=a.data.field(i),d=c.data.field(i);return l!==null&&d!==null?ve(l,d):M(42886)})(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return M(19790,{direction:r.dir})}}class se{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,t))return i}}has(t){return this.get(t)!==void 0}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(s===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],t))return void(s[i]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return n.length===1?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Pe(this.inner,((e,n)=>{for(const[s,i]of n)t(s,i)}))}isEmpty(){return gh(this.inner)}size(){return this.innerSize}}const Pp=new it(F.comparator);function Mt(){return Pp}const Fh=new it(F.comparator);function fr(...r){let t=Fh;for(const e of r)t=t.insert(e.key,e);return t}function Mh(r){let t=Fh;return r.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Qt(){return vr()}function Oh(){return vr()}function vr(){return new se((r=>r.toString()),((r,t)=>r.isEqual(t)))}const Vp=new it(F.comparator),Cp=new et(F.comparator);function $(...r){let t=Cp;for(const e of r)t=t.add(e);return t}const Dp=new et(q);function xp(){return Dp}function oa(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dr(t)?"-0":t}}function Lh(r){return{integerValue:""+r}}function Np(r,t){return Bg(t)?Lh(t):oa(r,t)}class _i{constructor(){this._=void 0}}function kp(r,t,e){return r instanceof qr?(function(s,i){const a={fields:{[yh]:{stringValue:_h},[Eh]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&na(i)&&(i=mi(i)),i&&(a.fields[Ih]=i),{mapValue:a}})(e,t):r instanceof kn?Uh(r,t):r instanceof Fn?qh(r,t):(function(s,i){const a=Bh(s,i),c=Ru(a)+Ru(s.Ae);return Po(a)&&Po(s.Ae)?Lh(c):oa(s.serializer,c)})(r,t)}function Fp(r,t,e){return r instanceof kn?Uh(r,t):r instanceof Fn?qh(r,t):e}function Bh(r,t){return r instanceof jr?(function(n){return Po(n)||(function(i){return!!i&&"doubleValue"in i})(n)})(t)?t:{integerValue:0}:null}class qr extends _i{}class kn extends _i{constructor(t){super(),this.elements=t}}function Uh(r,t){const e=jh(t);for(const n of r.elements)e.some((s=>Jt(s,n)))||e.push(n);return{arrayValue:{values:e}}}class Fn extends _i{constructor(t){super(),this.elements=t}}function qh(r,t){let e=jh(t);for(const n of r.elements)e=e.filter((s=>!Jt(s,n)));return{arrayValue:{values:e}}}class jr extends _i{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Ru(r){return st(r.integerValue||r.doubleValue)}function jh(r){return Br(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class Mp{constructor(t,e){this.field=t,this.transform=e}}function Op(r,t){return r.field.isEqual(t.field)&&(function(n,s){return n instanceof kn&&s instanceof kn||n instanceof Fn&&s instanceof Fn?bn(n.elements,s.elements,Jt):n instanceof jr&&s instanceof jr?Jt(n.Ae,s.Ae):n instanceof qr&&s instanceof qr})(r.transform,t.transform)}class Lp{constructor(t,e){this.version=t,this.transformResults=e}}class yt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new yt}static exists(t){return new yt(void 0,t)}static updateTime(t){return new yt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Fs(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class yi{}function zh(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new Wr(r.key,yt.none()):new qn(r.key,r.data,yt.none());{const e=r.data,n=vt.empty();let s=new et(ot.comparator);for(let i of t.fields)if(!s.has(i)){let a=e.field(i);a===null&&i.length>1&&(i=i.popLast(),a=e.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new ie(r.key,n,new Dt(s.toArray()),yt.none())}}function Bp(r,t,e){r instanceof qn?(function(s,i,a){const c=s.value.clone(),l=Pu(s.fieldTransforms,i,a.transformResults);c.setAll(l),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()})(r,t,e):r instanceof ie?(function(s,i,a){if(!Fs(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Pu(s.fieldTransforms,i,a.transformResults),l=i.data;l.setAll(Gh(s)),l.setAll(c),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(r,t,e):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function br(r,t,e,n){return r instanceof qn?(function(i,a,c,l){if(!Fs(i.precondition,a))return c;const d=i.value.clone(),f=Vu(i.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(r,t,e,n):r instanceof ie?(function(i,a,c,l){if(!Fs(i.precondition,a))return c;const d=Vu(i.fieldTransforms,l,a),f=a.data;return f.setAll(Gh(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((g=>g.field)))})(r,t,e,n):(function(i,a,c){return Fs(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c})(r,t,e)}function Up(r,t){let e=null;for(const n of r.fieldTransforms){const s=t.data.field(n.field),i=Bh(n.transform,s||null);i!=null&&(e===null&&(e=vt.empty()),e.set(n.field,i))}return e||null}function Su(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!(function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&bn(n,s,((i,a)=>Op(i,a)))})(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class qn extends yi{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ie extends yi{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Gh(r){const t=new Map;return r.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const n=r.data.field(e);t.set(e,n)}})),t}function Pu(r,t,e){const n=new Map;O(r.length===e.length,32656,{Re:e.length,Ve:r.length});for(let s=0;s<e.length;s++){const i=r[s],a=i.transform,c=t.data.field(i.field);n.set(i.field,Fp(a,c,e[s]))}return n}function Vu(r,t,e){const n=new Map;for(const s of r){const i=s.transform,a=e.data.field(s.field);n.set(s.field,kp(i,a,t))}return n}class Wr extends yi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class $h extends yi{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class aa{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(t.key)&&Bp(i,t,n[s])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=br(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=br(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=Oh();return this.mutations.forEach((s=>{const i=t.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=e.has(s.key)?null:c;const l=zh(a,c);l!==null&&n.set(s.key,l),a.isValidDocument()||a.convertToNoDocument(B.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&bn(this.mutations,t.mutations,((e,n)=>Su(e,n)))&&bn(this.baseMutations,t.baseMutations,((e,n)=>Su(e,n)))}}class ca{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){O(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let s=(function(){return Vp})();const i=t.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new ca(t,e,n,s)}}class ua{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class qp{constructor(t,e){this.count=t,this.unchangedNames=e}}var ht,Q;function jp(r){switch(r){case P.OK:return M(64938);case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0;default:return M(15467,{code:r})}}function Kh(r){if(r===void 0)return Pt("GRPC error has no .code"),P.UNKNOWN;switch(r){case ht.OK:return P.OK;case ht.CANCELLED:return P.CANCELLED;case ht.UNKNOWN:return P.UNKNOWN;case ht.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case ht.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case ht.INTERNAL:return P.INTERNAL;case ht.UNAVAILABLE:return P.UNAVAILABLE;case ht.UNAUTHENTICATED:return P.UNAUTHENTICATED;case ht.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case ht.NOT_FOUND:return P.NOT_FOUND;case ht.ALREADY_EXISTS:return P.ALREADY_EXISTS;case ht.PERMISSION_DENIED:return P.PERMISSION_DENIED;case ht.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case ht.ABORTED:return P.ABORTED;case ht.OUT_OF_RANGE:return P.OUT_OF_RANGE;case ht.UNIMPLEMENTED:return P.UNIMPLEMENTED;case ht.DATA_LOSS:return P.DATA_LOSS;default:return M(39323,{code:r})}}(Q=ht||(ht={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";function zp(){return new TextEncoder}const Gp=new Ee([4294967295,4294967295],0);function Cu(r){const t=zp().encode(r),e=new Gl;return e.update(t),new Uint8Array(e.digest())}function Du(r){const t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Ee([e,n],0),new Ee([s,i],0)]}class la{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new mr(`Invalid padding: ${e}`);if(n<0)throw new mr(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new mr(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new mr(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=Ee.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(Ee.fromNumber(n)));return s.compare(Gp)===1&&(s=new Ee([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=Cu(t),[n,s]=Du(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);if(!this.we(a))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),a=new la(i,s,e);return n.forEach((c=>a.insert(c))),a}insert(t){if(this.ge===0)return;const e=Cu(t),[n,s]=Du(e);for(let i=0;i<this.hashCount;i++){const a=this.ye(n,s,i);this.Se(a)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class mr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ii{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Xr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Ii(B.min(),s,new it(q),Mt(),$())}}class Xr{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Xr(n,e,$(),$(),$())}}class Ms{constructor(t,e,n,s){this.be=t,this.removedTargetIds=e,this.key=n,this.De=s}}class Hh{constructor(t,e){this.targetId=t,this.Ce=e}}class Qh{constructor(t,e,n=ft.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class xu{constructor(){this.ve=0,this.Fe=Nu(),this.Me=ft.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),n=$();return this.Fe.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:M(38017,{changeType:i})}})),new Xr(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=Nu()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,O(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class $p{constructor(t){this.Ge=t,this.ze=new Map,this.je=Mt(),this.Je=Es(),this.He=Es(),this.Ye=new it(q)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:M(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((n,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,n=t.Ce.count,s=this.ot(e);if(s){const i=s.target;if(Qs(i))if(n===0){const a=new F(i.path);this.et(e,a,ct.newNoDocument(a,B.min()))}else O(n===1,20013,{expectedCount:n});else{const a=this._t(e);if(a!==n){const c=this.ut(t),l=c?this.ct(c,t,a):1;if(l!==0){this.it(e);const d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=e;let a,c;try{a=ne(n).toUint8Array()}catch(l){if(l instanceof ph)return vn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{c=new la(a,s,i)}catch(l){return vn(l instanceof mr?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return c.ge===0?null:c}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let s=0;return n.forEach((i=>{const a=this.Ge.ht(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;t.mightContain(c)||(this.et(e,i,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((i,a)=>{const c=this.ot(a);if(c){if(i.current&&Qs(c.target)){const l=new F(c.target.path);this.It(l).has(a)||this.Et(a,l)||this.et(a,l,ct.newNoDocument(l,t))}i.Be&&(e.set(a,i.ke()),i.qe())}}));let n=$();this.He.forEach(((i,a)=>{let c=!0;a.forEachWhile((l=>{const d=this.ot(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)})),c&&(n=n.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(t)));const s=new Ii(t,e,this.Ye,this.je,n);return this.je=Mt(),this.Je=Es(),this.He=Es(),this.Ye=new it(q),s}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new xu,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new et(q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new et(q),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||V("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new xu),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Es(){return new it(F.comparator)}function Nu(){return new it(F.comparator)}const Kp={asc:"ASCENDING",desc:"DESCENDING"},Hp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qp={and:"AND",or:"OR"};class Wp{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function No(r,t){return r.useProto3Json||li(t)?t:{value:t}}function Mn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Wh(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Xp(r,t){return Mn(r,t.toTimestamp())}function Vt(r){return O(!!r,49232),B.fromTimestamp((function(e){const n=ee(e);return new X(n.seconds,n.nanos)})(r))}function ha(r,t){return ko(r,t).canonicalString()}function ko(r,t){const e=(function(s){return new J(["projects",s.projectId,"databases",s.database])})(r).child("documents");return t===void 0?e:e.child(t)}function Xh(r){const t=J.fromString(r);return O(id(t),10190,{key:t.toString()}),t}function Ys(r,t){return ha(r.databaseId,t.path)}function He(r,t){const e=Xh(t);if(e.get(1)!==r.databaseId.projectId)throw new C(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new C(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new F(Zh(e))}function Yh(r,t){return ha(r.databaseId,t)}function Jh(r){const t=Xh(r);return t.length===4?J.emptyPath():Zh(t)}function Fo(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Zh(r){return O(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function ku(r,t,e){return{name:Ys(r,t),fields:e.value.mapValue.fields}}function Yp(r,t,e){const n=He(r,t.name),s=Vt(t.updateTime),i=t.createTime?Vt(t.createTime):B.min(),a=new vt({mapValue:{fields:t.fields}}),c=ct.newFoundDocument(n,s,i,a);return e&&c.setHasCommittedMutations(),e?c.setHasCommittedMutations():c}function Jp(r,t){let e;if("targetChange"in t){t.targetChange;const n=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:M(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(O(f===void 0||typeof f=="string",58123),ft.fromBase64String(f||"")):(O(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),ft.fromUint8Array(f||new Uint8Array))})(r,t.targetChange.resumeToken),a=t.targetChange.cause,c=a&&(function(d){const f=d.code===void 0?P.UNKNOWN:Kh(d.code);return new C(f,d.message||"")})(a);e=new Qh(n,s,i,c||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const s=He(r,n.document.name),i=Vt(n.document.updateTime),a=n.document.createTime?Vt(n.document.createTime):B.min(),c=new vt({mapValue:{fields:n.document.fields}}),l=ct.newFoundDocument(s,i,a,c),d=n.targetIds||[],f=n.removedTargetIds||[];e=new Ms(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const s=He(r,n.document),i=n.readTime?Vt(n.readTime):B.min(),a=ct.newNoDocument(s,i),c=n.removedTargetIds||[];e=new Ms([],c,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const s=He(r,n.document),i=n.removedTargetIds||[];e=new Ms([],i,s,null)}else{if(!("filter"in t))return M(11601,{Rt:t});{t.filter;const n=t.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,a=new qp(s,i),c=n.targetId;e=new Hh(c,a)}}return e}function Js(r,t){let e;if(t instanceof qn)e={update:ku(r,t.key,t.value)};else if(t instanceof Wr)e={delete:Ys(r,t.key)};else if(t instanceof ie)e={update:ku(r,t.key,t.data),updateMask:s_(t.fieldMask)};else{if(!(t instanceof $h))return M(16599,{Vt:t.type});e={verify:Ys(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((n=>(function(i,a){const c=a.transform;if(c instanceof qr)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof kn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Fn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof jr)return{fieldPath:a.field.canonicalString(),increment:c.Ae};throw M(20930,{transform:a.transform})})(0,n)))),t.precondition.isNone||(e.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:Xp(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:M(27497)})(r,t.precondition)),e}function Mo(r,t){const e=t.currentDocument?(function(i){return i.updateTime!==void 0?yt.updateTime(Vt(i.updateTime)):i.exists!==void 0?yt.exists(i.exists):yt.none()})(t.currentDocument):yt.none(),n=t.updateTransforms?t.updateTransforms.map((s=>(function(a,c){let l=null;if("setToServerValue"in c)O(c.setToServerValue==="REQUEST_TIME",16630,{proto:c}),l=new qr;else if("appendMissingElements"in c){const f=c.appendMissingElements.values||[];l=new kn(f)}else if("removeAllFromArray"in c){const f=c.removeAllFromArray.values||[];l=new Fn(f)}else"increment"in c?l=new jr(a,c.increment):M(16584,{proto:c});const d=ot.fromServerFormat(c.fieldPath);return new Mp(d,l)})(r,s))):[];if(t.update){t.update.name;const s=He(r,t.update.name),i=new vt({mapValue:{fields:t.update.fields}});if(t.updateMask){const a=(function(l){const d=l.fieldPaths||[];return new Dt(d.map((f=>ot.fromServerFormat(f))))})(t.updateMask);return new ie(s,i,a,e,n)}return new qn(s,i,e,n)}if(t.delete){const s=He(r,t.delete);return new Wr(s,e)}if(t.verify){const s=He(r,t.verify);return new $h(s,e)}return M(1463,{proto:t})}function Zp(r,t){return r&&r.length>0?(O(t!==void 0,14353),r.map((e=>(function(s,i){let a=s.updateTime?Vt(s.updateTime):Vt(i);return a.isEqual(B.min())&&(a=Vt(i)),new Lp(a,s.transformResults||[])})(e,t)))):[]}function td(r,t){return{documents:[Yh(r,t.path)]}}function ed(r,t){const e={structuredQuery:{}},n=t.path;let s;t.collectionGroup!==null?(s=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Yh(r,s);const i=(function(d){if(d.length!==0)return sd(tt.create(d,"and"))})(t.filters);i&&(e.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(E){return{field:In(E.field),direction:e_(E.dir)}})(f)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const c=No(r,t.limit);return c!==null&&(e.structuredQuery.limit=c),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function nd(r){let t=Jh(r.parent);const e=r.structuredQuery,n=e.from?e.from.length:0;let s=null;if(n>0){O(n===1,65062);const f=e.from[0];f.allDescendants?s=f.collectionId:t=t.child(f.collectionId)}let i=[];e.where&&(i=(function(g){const E=rd(g);return E instanceof tt&&ia(E)?E.getFilters():[E]})(e.where));let a=[];e.orderBy&&(a=(function(g){return g.map((E=>(function(x){return new Ur(En(x.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(x.direction))})(E)))})(e.orderBy));let c=null;e.limit&&(c=(function(g){let E;return E=typeof g=="object"?g.value:g,li(E)?null:E})(e.limit));let l=null;e.startAt&&(l=(function(g){const E=!!g.before,R=g.values||[];return new xn(R,E)})(e.startAt));let d=null;return e.endAt&&(d=(function(g){const E=!g.before,R=g.values||[];return new xn(R,E)})(e.endAt)),vp(t,s,a,i,c,"F",l,d)}function t_(r,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return M(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function rd(r){return r.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const n=En(e.unaryFilter.field);return H.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=En(e.unaryFilter.field);return H.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=En(e.unaryFilter.field);return H.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=En(e.unaryFilter.field);return H.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return M(61313);default:return M(60726)}})(r):r.fieldFilter!==void 0?(function(e){return H.create(En(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return M(58110);default:return M(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(r):r.compositeFilter!==void 0?(function(e){return tt.create(e.compositeFilter.filters.map((n=>rd(n))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return M(1026)}})(e.compositeFilter.op))})(r):M(30097,{filter:r})}function e_(r){return Kp[r]}function n_(r){return Hp[r]}function r_(r){return Qp[r]}function In(r){return{fieldPath:r.canonicalString()}}function En(r){return ot.fromServerFormat(r.fieldPath)}function sd(r){return r instanceof H?(function(e){if(e.op==="=="){if(yu(e.value))return{unaryFilter:{field:In(e.field),op:"IS_NAN"}};if(_u(e.value))return{unaryFilter:{field:In(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(yu(e.value))return{unaryFilter:{field:In(e.field),op:"IS_NOT_NAN"}};if(_u(e.value))return{unaryFilter:{field:In(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:In(e.field),op:n_(e.op),value:e.value}}})(r):r instanceof tt?(function(e){const n=e.getFilters().map((s=>sd(s)));return n.length===1?n[0]:{compositeFilter:{op:r_(e.op),filters:n}}})(r):M(54877,{filter:r})}function s_(r){const t=[];return r.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function id(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}class Zt{constructor(t,e,n,s,i=B.min(),a=B.min(),c=ft.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=l}withSequenceNumber(t){return new Zt(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Zt(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Zt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Zt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class od{constructor(t){this.yt=t}}function i_(r,t){let e;if(t.document)e=Yp(r.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const n=F.fromSegments(t.noDocument.path),s=tn(t.noDocument.readTime);e=ct.newNoDocument(n,s),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return M(56709);{const n=F.fromSegments(t.unknownDocument.path),s=tn(t.unknownDocument.version);e=ct.newUnknownDocument(n,s)}}return t.readTime&&e.setReadTime((function(s){const i=new X(s[0],s[1]);return B.fromTimestamp(i)})(t.readTime)),e}function Fu(r,t){const e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Zs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=(function(i,a){return{name:Ys(i,a.key),fields:a.data.value.mapValue.fields,updateTime:Mn(i,a.version.toTimestamp()),createTime:Mn(i,a.createTime.toTimestamp())}})(r.yt,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:Ze(t.version)};else{if(!t.isUnknownDocument())return M(57904,{document:t});n.unknownDocument={path:e.path.toArray(),version:Ze(t.version)}}return n}function Zs(r){const t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function Ze(r){const t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function tn(r){const t=new X(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function qe(r,t){const e=(t.baseMutations||[]).map((i=>Mo(r.yt,i)));for(let i=0;i<t.mutations.length-1;++i){const a=t.mutations[i];if(i+1<t.mutations.length&&t.mutations[i+1].transform!==void 0){const c=t.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const n=t.mutations.map((i=>Mo(r.yt,i))),s=X.fromMillis(t.localWriteTimeMs);return new aa(t.batchId,s,e,n)}function gr(r){const t=tn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?tn(r.lastLimboFreeSnapshotVersion):B.min();let n;return n=(function(i){return i.documents!==void 0})(r.query)?(function(i){const a=i.documents.length;return O(a===1,1966,{count:a}),Ut(Hr(Jh(i.documents[0])))})(r.query):(function(i){return Ut(nd(i))})(r.query),new Zt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function ad(r,t){const e=Ze(t.snapshotVersion),n=Ze(t.lastLimboFreeSnapshotVersion);let s;s=Qs(t.target)?td(r.yt,t.target):ed(r.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Je(t.target),readTime:e,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function cd(r){const t=nd({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?Xs(t,t.limit,"L"):t}function oo(r,t){return new ua(t.largestBatchId,Mo(r.yt,t.overlayMutation))}function Mu(r,t){const e=t.path.lastSegment();return[r,bt(t.path.popLast()),e]}function Ou(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:Ze(n.readTime),documentKey:bt(n.documentKey.path),largestBatchId:n.largestBatchId}}class o_{getBundleMetadata(t,e){return Lu(t).get(e).next((n=>{if(n)return(function(i){return{id:i.bundleId,createTime:tn(i.createTime),version:i.version}})(n)}))}saveBundleMetadata(t,e){return Lu(t).put((function(s){return{bundleId:s.id,createTime:Ze(Vt(s.createTime)),version:s.version}})(e))}getNamedQuery(t,e){return Bu(t).get(e).next((n=>{if(n)return(function(i){return{name:i.name,query:cd(i.bundledQuery),readTime:tn(i.readTime)}})(n)}))}saveNamedQuery(t,e){return Bu(t).put((function(s){return{name:s.name,readTime:Ze(Vt(s.readTime)),bundledQuery:s.bundledQuery}})(e))}}function Lu(r){return gt(r,hi)}function Bu(r){return gt(r,di)}class Ei{constructor(t,e){this.serializer=t,this.userId=e}static wt(t,e){const n=e.uid||"";return new Ei(t,n)}getOverlay(t,e){return ir(t).get(Mu(this.userId,e)).next((n=>n?oo(this.serializer,n):null))}getOverlays(t,e){const n=Qt();return A.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){const s=[];return n.forEach(((i,a)=>{const c=new ua(e,a);s.push(this.St(t,c))})),A.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((a=>s.add(bt(a.getCollectionPath()))));const i=[];return s.forEach((a=>{const c=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(ir(t).Z(bo,c))})),A.waitFor(i)}getOverlaysForCollection(t,e,n){const s=Qt(),i=bt(e),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ir(t).J(bo,a).next((c=>{for(const l of c){const d=oo(this.serializer,l);s.set(d.getKey(),d)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const i=Qt();let a;const c=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return ir(t).ee({index:lh,range:c},((l,d,f)=>{const g=oo(this.serializer,d);i.size()<s||g.largestBatchId===a?(i.set(g.getKey(),g),a=g.largestBatchId):f.done()})).next((()=>i))}St(t,e){return ir(t).put((function(s,i,a){const[c,l,d]=Mu(i,a.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Js(s.yt,a.mutation)}})(this.serializer,this.userId,e))}}function ir(r){return gt(r,fi)}class a_{bt(t){return gt(t,ta)}getSessionToken(t){return this.bt(t).get("sessionToken").next((e=>{const n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING}))}setSessionToken(t,e){return this.bt(t).put({name:"sessionToken",value:e.toUint8Array()})}}class je{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(st(t.integerValue));else if("doubleValue"in t){const n=st(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Dr(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),typeof n=="string"&&(n=ee(n)),e.xt(`${n.seconds||""}`),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(ne(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?wh(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):gi(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):M(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const s of Object.keys(n))this.Ot(s,e),this.Ct(n[s],e)}kt(t,e){const n=t.fields||{};this.Ft(e,53);const s=Cn,i=n[s].arrayValue?.values?.length||0;this.Ft(e,15),e.Mt(st(i)),this.Ot(s,e),this.Ct(n[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const s of n)this.Ct(s,e)}Lt(t,e){this.Ft(e,37),F.fromName(t).path.forEach((n=>{this.Ft(e,60),this.Ut(n,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}je.Kt=new je;const hn=255;function c_(r){if(r===0)return 8;let t=0;return r>>4||(t+=4,r<<=4),r>>6||(t+=2,r<<=2),r>>7||(t+=1),t}function Uu(r){const t=64-(function(n){let s=0;for(let i=0;i<8;++i){const a=c_(255&n[i]);if(s+=a,a!==8)break}return s})(r);return Math.ceil(t/8)}class u_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Gt(n.value),n=e.next();this.zt()}jt(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.Jt(n.value),n=e.next();this.Ht()}Yt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Gt(n);else if(n<2048)this.Gt(960|n>>>6),this.Gt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Gt(480|n>>>12),this.Gt(128|63&n>>>6),this.Gt(128|63&n);else{const s=e.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(t){for(const e of t){const n=e.charCodeAt(0);if(n<128)this.Jt(n);else if(n<2048)this.Jt(960|n>>>6),this.Jt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Jt(480|n>>>12),this.Jt(128|63&n>>>6),this.Jt(128|63&n);else{const s=e.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(t){const e=this.en(t),n=Uu(e);this.tn(1+n),this.buffer[this.position++]=255&n;for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=255&e[s]}nn(t){const e=this.en(t),n=Uu(e);this.tn(1+n),this.buffer[this.position++]=~(255&n);for(let s=e.length-n;s<e.length;++s)this.buffer[this.position++]=~(255&e[s])}rn(){this.sn(hn),this.sn(255)}_n(){this.an(hn),this.an(255)}reset(){this.position=0}seed(t){this.tn(t.length),this.buffer.set(t,this.position),this.position+=t.length}un(){return this.buffer.slice(0,this.position)}en(t){const e=(function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)})(t),n=!!(128&e[0]);e[0]^=n?255:128;for(let s=1;s<e.length;++s)e[s]^=n?255:0;return e}Gt(t){const e=255&t;e===0?(this.sn(0),this.sn(255)):e===hn?(this.sn(hn),this.sn(0)):this.sn(e)}Jt(t){const e=255&t;e===0?(this.an(0),this.an(255)):e===hn?(this.an(hn),this.an(0)):this.an(t)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(t){this.tn(1),this.buffer[this.position++]=t}an(t){this.tn(1),this.buffer[this.position++]=~t}tn(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class l_{constructor(t){this.cn=t}Bt(t){this.cn.Wt(t)}xt(t){this.cn.Yt(t)}Mt(t){this.cn.Xt(t)}vt(){this.cn.rn()}}class h_{constructor(t){this.cn=t}Bt(t){this.cn.jt(t)}xt(t){this.cn.Zt(t)}Mt(t){this.cn.nn(t)}vt(){this.cn._n()}}class or{constructor(){this.cn=new u_,this.ln=new l_(this.cn),this.hn=new h_(this.cn)}seed(t){this.cn.seed(t)}Pn(t){return t===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class ze{constructor(t,e,n,s){this.Tn=t,this.In=e,this.En=n,this.dn=s}An(){const t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.dn,0),e!==t?n.set([0],this.dn.length):++n[n.length-1],new ze(this.Tn,this.In,this.En,n)}Rn(t,e,n){return{indexId:this.Tn,uid:t,arrayValue:Os(this.En),directionalValue:Os(this.dn),orderedDocumentKey:Os(e),documentKey:n.path.toArray()}}Vn(t,e,n){const s=this.Rn(t,e,n);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function fe(r,t){let e=r.Tn-t.Tn;return e!==0?e:(e=qu(r.En,t.En),e!==0?e:(e=qu(r.dn,t.dn),e!==0?e:F.comparator(r.In,t.In)))}function qu(r,t){for(let e=0;e<r.length&&e<t.length;++e){const n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}function Os(r){return kl()?(function(e){let n="";for(let s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);return n})(r):r}function ju(r){return typeof r!="string"?r:(function(e){const n=new Uint8Array(e.length);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return n})(r)}class zu{constructor(t){this.mn=new et(((e,n)=>ot.comparator(e.field,n.field))),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.fn=t.orderBy,this.gn=[];for(const e of t.filters){const n=e;n.isInequality()?this.mn=this.mn.add(n):this.gn.push(n)}}get pn(){return this.mn.size>1}yn(t){if(O(t.collectionGroup===this.collectionId,49279),this.pn)return!1;const e=wo(t);if(e!==void 0&&!this.wn(e))return!1;const n=Le(t);let s=new Set,i=0,a=0;for(;i<n.length&&this.wn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.mn.size>0){const c=this.mn.getIterator().getNext();if(!s.has(c.field.canonicalString())){const l=n[i];if(!this.Sn(c,l)||!this.bn(this.fn[a++],l))return!1}++i}for(;i<n.length;++i){const c=n[i];if(a>=this.fn.length||!this.bn(this.fn[a++],c))return!1}return!0}Dn(){if(this.pn)return null;let t=new et(ot.comparator);const e=[];for(const n of this.gn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Vs(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Vs(n.field,0))}for(const n of this.fn)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Vs(n.field,n.dir==="asc"?0:1)));return new Gs(Gs.UNKNOWN_ID,this.collectionId,e,Cr.empty())}wn(t){for(const e of this.gn)if(this.Sn(e,t))return!0;return!1}Sn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;const n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}bn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}}function ud(r){if(O(r instanceof H||r instanceof tt,20012),r instanceof H){if(r instanceof Dh){const e=r.value.arrayValue?.values?.map((n=>H.create(r.field,"==",n)))||[];return tt.create(e,"or")}return r}const t=r.filters.map((e=>ud(e)));return tt.create(t,r.op)}function d_(r){if(r.getFilters().length===0)return[];const t=Bo(ud(r));return O(ld(t),7391),Oo(t)||Lo(t)?[t]:t.getFilters()}function Oo(r){return r instanceof H}function Lo(r){return r instanceof tt&&ia(r)}function ld(r){return Oo(r)||Lo(r)||(function(e){if(e instanceof tt&&Vo(e)){for(const n of e.getFilters())if(!Oo(n)&&!Lo(n))return!1;return!0}return!1})(r)}function Bo(r){if(O(r instanceof H||r instanceof tt,34018),r instanceof H)return r;if(r.filters.length===1)return Bo(r.filters[0]);const t=r.filters.map((n=>Bo(n)));let e=tt.create(t,r.op);return e=ti(e),ld(e)?e:(O(e instanceof tt,64498),O(Nn(e),40251),O(e.filters.length>1,57927),e.filters.reduce(((n,s)=>da(n,s))))}function da(r,t){let e;return O(r instanceof H||r instanceof tt,38388),O(t instanceof H||t instanceof tt,25473),e=r instanceof H?t instanceof H?(function(s,i){return tt.create([s,i],"and")})(r,t):Gu(r,t):t instanceof H?Gu(t,r):(function(s,i){if(O(s.filters.length>0&&i.filters.length>0,48005),Nn(s)&&Nn(i))return Ph(s,i.getFilters());const a=Vo(s)?s:i,c=Vo(s)?i:s,l=a.filters.map((d=>da(d,c)));return tt.create(l,"or")})(r,t),ti(e)}function Gu(r,t){if(Nn(t))return Ph(t,r.getFilters());{const e=t.filters.map((n=>da(r,n)));return tt.create(e,"or")}}function ti(r){if(O(r instanceof H||r instanceof tt,11850),r instanceof H)return r;const t=r.getFilters();if(t.length===1)return ti(t[0]);if(Rh(r))return r;const e=t.map((s=>ti(s))),n=[];return e.forEach((s=>{s instanceof H?n.push(s):s instanceof tt&&(s.op===r.op?n.push(...s.filters):n.push(s))})),n.length===1?n[0]:tt.create(n,r.op)}class f_{constructor(){this.Cn=new fa}addToCollectionParentIndex(t,e){return this.Cn.add(e),A.resolve()}getCollectionParents(t,e){return A.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return A.resolve()}deleteFieldIndex(t,e){return A.resolve()}deleteAllFieldIndexes(t){return A.resolve()}createTargetIndexes(t,e){return A.resolve()}getDocumentsMatchingTarget(t,e){return A.resolve(null)}getIndexType(t,e){return A.resolve(0)}getFieldIndexes(t,e){return A.resolve([])}getNextCollectionGroupToUpdate(t){return A.resolve(null)}getMinOffset(t,e){return A.resolve(Ot.min())}getMinOffsetFromCollectionGroup(t,e){return A.resolve(Ot.min())}updateCollectionGroup(t,e,n){return A.resolve()}updateIndexEntries(t,e){return A.resolve()}}class fa{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new et(J.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new et(J.comparator)).toArray()}}const $u="IndexedDbIndexManager",Ts=new Uint8Array(0);class m_{constructor(t,e){this.databaseId=e,this.vn=new fa,this.Fn=new se((n=>Je(n)),((n,s)=>Kr(n,s))),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.vn.add(e)}));const i={collectionId:n,parent:bt(s)};return Ku(t).put(i)}return A.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Jl(e),""],!1,!0);return Ku(t).J(s).next((i=>{for(const a of i){if(a.collectionId!==e)break;n.push(Ht(a.parent))}return n}))}addFieldIndex(t,e){const n=ar(t),s=(function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map((l=>[l.fieldPath.canonicalString(),l.kind]))}})(e);delete s.indexId;const i=n.add(s);if(e.indexState){const a=fn(t);return i.next((c=>{a.put(Ou(c,this.uid,e.indexState.sequenceNumber,e.indexState.offset))}))}return i.next()}deleteFieldIndex(t,e){const n=ar(t),s=fn(t),i=dn(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}deleteAllFieldIndexes(t){const e=ar(t),n=dn(t),s=fn(t);return e.Z().next((()=>n.Z())).next((()=>s.Z()))}createTargetIndexes(t,e){return A.forEach(this.Mn(e),(n=>this.getIndexType(t,n).next((s=>{if(s===0||s===1){const i=new zu(n).Dn();if(i!=null)return this.addFieldIndex(t,i)}}))))}getDocumentsMatchingTarget(t,e){const n=dn(t);let s=!0;const i=new Map;return A.forEach(this.Mn(e),(a=>this.xn(t,a).next((c=>{s&&(s=!!c),i.set(a,c)})))).next((()=>{if(s){let a=$();const c=[];return A.forEach(i,((l,d)=>{V($u,`Using index ${(function(L){return`id=${L.indexId}|cg=${L.collectionGroup}|f=${L.fields.map((Z=>`${Z.fieldPath}:${Z.kind}`)).join(",")}`})(l)} to execute ${Je(e)}`);const f=(function(L,Z){const Y=wo(Z);if(Y===void 0)return null;for(const K of Ws(L,Y.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null})(d,l),g=(function(L,Z){const Y=new Map;for(const K of Le(Z))for(const w of Ws(L,K.fieldPath))switch(w.op){case"==":case"in":Y.set(K.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Y.set(K.fieldPath.canonicalString(),w.value),Array.from(Y.values())}return null})(d,l),E=(function(L,Z){const Y=[];let K=!0;for(const w of Le(Z)){const p=w.kind===0?Au(L,w.fieldPath,L.startAt):vu(L,w.fieldPath,L.startAt);Y.push(p.value),K&&(K=p.inclusive)}return new xn(Y,K)})(d,l),R=(function(L,Z){const Y=[];let K=!0;for(const w of Le(Z)){const p=w.kind===0?vu(L,w.fieldPath,L.endAt):Au(L,w.fieldPath,L.endAt);Y.push(p.value),K&&(K=p.inclusive)}return new xn(Y,K)})(d,l),x=this.On(l,d,E),k=this.On(l,d,R),D=this.Nn(l,d,g),z=this.Bn(l.indexId,f,x,E.inclusive,k,R.inclusive,D);return A.forEach(z,(U=>n.Y(U,e.limit).next((L=>{L.forEach((Z=>{const Y=F.fromSegments(Z.documentKey);a.has(Y)||(a=a.add(Y),c.push(Y))}))}))))})).next((()=>c))}return A.resolve(null)}))}Mn(t){let e=this.Fn.get(t);return e||(t.filters.length===0?e=[t]:e=d_(tt.create(t.filters,"and")).map((n=>Do(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt))),this.Fn.set(t,e),e)}Bn(t,e,n,s,i,a,c){const l=(e!=null?e.length:1)*Math.max(n.length,i.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){const E=e?this.Ln(e[g/d]):Ts,R=this.kn(t,E,n[g%d],s),x=this.qn(t,E,i[g%d],a),k=c.map((D=>this.kn(t,E,D,!0)));f.push(...this.createRange(R,x,k))}return f}kn(t,e,n,s){const i=new ze(t,F.empty(),e,n);return s?i:i.An()}qn(t,e,n,s){const i=new ze(t,F.empty(),e,n);return s?i.An():i}xn(t,e){const n=new zu(e),s=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,s).next((i=>{let a=null;for(const c of i)n.yn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a}))}getIndexType(t,e){let n=2;const s=this.Mn(e);return A.forEach(s,(i=>this.xn(t,i).next((a=>{a?n!==0&&a.fields.length<(function(l){let d=new et(ot.comparator),f=!1;for(const g of l.filters)for(const E of g.getFlattenedFilters())E.field.isKeyField()||(E.op==="array-contains"||E.op==="array-contains-any"?f=!0:d=d.add(E.field));for(const g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)})(i)&&(n=1):n=0})))).next((()=>(function(a){return a.limit!==null})(e)&&s.length>1&&n===2?1:n))}Qn(t,e){const n=new or;for(const s of Le(t)){const i=e.data.field(s.fieldPath);if(i==null)return null;const a=n.Pn(s.kind);je.Kt.Dt(i,a)}return n.un()}Ln(t){const e=new or;return je.Kt.Dt(t,e.Pn(0)),e.un()}$n(t,e){const n=new or;return je.Kt.Dt(Lr(this.databaseId,e),n.Pn((function(i){const a=Le(i);return a.length===0?0:a[a.length-1].kind})(t))),n.un()}Nn(t,e,n){if(n===null)return[];let s=[];s.push(new or);let i=0;for(const a of Le(t)){const c=n[i++];for(const l of s)if(this.Un(e,a.fieldPath)&&Br(c))s=this.Kn(s,a,c);else{const d=l.Pn(a.kind);je.Kt.Dt(c,d)}}return this.Wn(s)}On(t,e,n){return this.Nn(t,e,n.position)}Wn(t){const e=[];for(let n=0;n<t.length;++n)e[n]=t[n].un();return e}Kn(t,e,n){const s=[...t],i=[];for(const a of n.arrayValue.values||[])for(const c of s){const l=new or;l.seed(c.un()),je.Kt.Dt(a,l.Pn(e.kind)),i.push(l)}return i}Un(t,e){return!!t.filters.find((n=>n instanceof H&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in")))}getFieldIndexes(t,e){const n=ar(t),s=fn(t);return(e?n.J(vo,IDBKeyRange.bound(e,e)):n.J()).next((i=>{const a=[];return A.forEach(i,(c=>s.get([c.indexId,this.uid]).next((l=>{a.push((function(f,g){const E=g?new Cr(g.sequenceNumber,new Ot(tn(g.readTime),new F(Ht(g.documentKey)),g.largestBatchId)):Cr.empty(),R=f.fields.map((([x,k])=>new Vs(ot.fromServerFormat(x),k)));return new Gs(f.indexId,f.collectionGroup,R,E)})(c,l))})))).next((()=>a))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((e=>e.length===0?null:(e.sort(((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:q(n.collectionGroup,s.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=ar(t),i=fn(t);return this.Gn(t).next((a=>s.J(vo,IDBKeyRange.bound(e,e)).next((c=>A.forEach(c,(l=>i.put(Ou(l.indexId,this.uid,a,n))))))))}updateIndexEntries(t,e){const n=new Map;return A.forEach(e,((s,i)=>{const a=n.get(s.collectionGroup);return(a?A.resolve(a):this.getFieldIndexes(t,s.collectionGroup)).next((c=>(n.set(s.collectionGroup,c),A.forEach(c,(l=>this.zn(t,s,l).next((d=>{const f=this.jn(i,l);return d.isEqual(f)?A.resolve():this.Jn(t,i,l,d,f)})))))))}))}Hn(t,e,n,s){return dn(t).put(s.Rn(this.uid,this.$n(n,e.key),e.key))}Yn(t,e,n,s){return dn(t).delete(s.Vn(this.uid,this.$n(n,e.key),e.key))}zn(t,e,n){const s=dn(t);let i=new et(fe);return s.ee({index:uh,range:IDBKeyRange.only([n.indexId,this.uid,Os(this.$n(n,e))])},((a,c)=>{i=i.add(new ze(n.indexId,e,ju(c.arrayValue),ju(c.directionalValue)))})).next((()=>i))}jn(t,e){let n=new et(fe);const s=this.Qn(e,t);if(s==null)return n;const i=wo(e);if(i!=null){const a=t.data.field(i.fieldPath);if(Br(a))for(const c of a.arrayValue.values||[])n=n.add(new ze(e.indexId,t.key,this.Ln(c),s))}else n=n.add(new ze(e.indexId,t.key,Ts,s));return n}Jn(t,e,n,s,i){V($u,"Updating index entries for document '%s'",e.key);const a=[];return(function(l,d,f,g,E){const R=l.getIterator(),x=d.getIterator();let k=ln(R),D=ln(x);for(;k||D;){let z=!1,U=!1;if(k&&D){const L=f(k,D);L<0?U=!0:L>0&&(z=!0)}else k!=null?U=!0:z=!0;z?(g(D),D=ln(x)):U?(E(k),k=ln(R)):(k=ln(R),D=ln(x))}})(s,i,fe,(c=>{a.push(this.Hn(t,e,n,c))}),(c=>{a.push(this.Yn(t,e,n,c))})),A.waitFor(a)}Gn(t){let e=1;return fn(t).ee({index:ch,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((n,s,i)=>{i.done(),e=s.sequenceNumber+1})).next((()=>e))}createRange(t,e,n){n=n.sort(((a,c)=>fe(a,c))).filter(((a,c,l)=>!c||fe(a,l[c-1])!==0));const s=[];s.push(t);for(const a of n){const c=fe(a,t),l=fe(a,e);if(c===0)s[0]=t.An();else if(c>0&&l<0)s.push(a),s.push(a.An());else if(l>0)break}s.push(e);const i=[];for(let a=0;a<s.length;a+=2){if(this.Zn(s[a],s[a+1]))return[];const c=s[a].Vn(this.uid,Ts,F.empty()),l=s[a+1].Vn(this.uid,Ts,F.empty());i.push(IDBKeyRange.bound(c,l))}return i}Zn(t,e){return fe(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Hu)}getMinOffset(t,e){return A.mapArray(this.Mn(e),(n=>this.xn(t,n).next((s=>s||M(44426))))).next(Hu)}}function Ku(r){return gt(r,kr)}function dn(r){return gt(r,Tr)}function ar(r){return gt(r,Zo)}function fn(r){return gt(r,Er)}function Hu(r){O(r.length!==0,28825);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;Xo(s,t)<0&&(t=s),e<s.largestBatchId&&(e=s.largestBatchId)}return new Ot(t.readTime,t.documentKey,e)}const Qu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hd=41943040;class At{static withCacheSize(t){return new At(t,At.DEFAULT_COLLECTION_PERCENTILE,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}function dd(r,t,e){const n=r.store(jt),s=r.store(Rn),i=[],a=IDBKeyRange.only(e.batchId);let c=0;const l=n.ee({range:a},((f,g,E)=>(c++,E.delete())));i.push(l.next((()=>{O(c===1,47070,{batchId:e.batchId})})));const d=[];for(const f of e.mutations){const g=ih(t,f.key.path,e.batchId);i.push(s.delete(g)),d.push(f.key)}return A.waitFor(i).next((()=>d))}function ei(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw M(14731);t=r.noDocument}return JSON.stringify(t).length}At.DEFAULT_COLLECTION_PERCENTILE=10,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,At.DEFAULT=new At(hd,At.DEFAULT_COLLECTION_PERCENTILE,At.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),At.DISABLED=new At(-1,0,0);class Ti{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=s,this.Xn={}}static wt(t,e,n,s){O(t.uid!=="",64387);const i=t.isAuthenticated()?t.uid:"";return new Ti(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return me(t).ee({index:Ge,range:n},((s,i,a)=>{e=!1,a.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=Tn(t),a=me(t);return a.add({}).next((c=>{O(typeof c=="number",49019);const l=new aa(c,e,n,s),d=(function(R,x,k){const D=k.baseMutations.map((U=>Js(R.yt,U))),z=k.mutations.map((U=>Js(R.yt,U)));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:D,mutations:z}})(this.serializer,this.userId,l),f=[];let g=new et(((E,R)=>q(E.canonicalString(),R.canonicalString())));for(const E of s){const R=ih(this.userId,E.key.path,c);g=g.add(E.key.path.popLast()),f.push(a.put(d)),f.push(i.put(R,jg))}return g.forEach((E=>{f.push(this.indexManager.addToCollectionParentIndex(t,E))})),t.addOnCommittedListener((()=>{this.Xn[c]=l.keys()})),A.waitFor(f).next((()=>l))}))}lookupMutationBatch(t,e){return me(t).get(e).next((n=>n?(O(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:e}),qe(this.serializer,n)):null))}er(t,e){return this.Xn[e]?A.resolve(this.Xn[e]):this.lookupMutationBatch(t,e).next((n=>{if(n){const s=n.keys();return this.Xn[e]=s,s}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return me(t).ee({index:Ge,range:s},((a,c,l)=>{c.userId===this.userId&&(O(c.batchId>=n,47524,{tr:n}),i=qe(this.serializer,c)),l.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=$e;return me(t).ee({index:Ge,range:e,reverse:!0},((s,i,a)=>{n=i.batchId,a.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,$e],[this.userId,Number.POSITIVE_INFINITY]);return me(t).J(Ge,e).next((n=>n.map((s=>qe(this.serializer,s)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=Cs(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Tn(t).ee({range:s},((a,c,l)=>{const[d,f,g]=a,E=Ht(f);if(d===this.userId&&e.path.isEqual(E))return me(t).get(g).next((R=>{if(!R)throw M(61480,{nr:a,batchId:g});O(R.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:R.userId,batchId:g}),i.push(qe(this.serializer,R))}));l.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(q);const s=[];return e.forEach((i=>{const a=Cs(this.userId,i.path),c=IDBKeyRange.lowerBound(a),l=Tn(t).ee({range:c},((d,f,g)=>{const[E,R,x]=d,k=Ht(R);E===this.userId&&i.path.isEqual(k)?n=n.add(x):g.done()}));s.push(l)})),A.waitFor(s).next((()=>this.rr(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=Cs(this.userId,n),a=IDBKeyRange.lowerBound(i);let c=new et(q);return Tn(t).ee({range:a},((l,d,f)=>{const[g,E,R]=l,x=Ht(E);g===this.userId&&n.isPrefixOf(x)?x.length===s&&(c=c.add(R)):f.done()})).next((()=>this.rr(t,c)))}rr(t,e){const n=[],s=[];return e.forEach((i=>{s.push(me(t).get(i).next((a=>{if(a===null)throw M(35274,{batchId:i});O(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:i}),n.push(qe(this.serializer,a))})))})),A.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return dd(t.le,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.ir(e.batchId)})),A.forEach(n,(s=>this.referenceDelegate.markPotentiallyOrphaned(t,s))))))}ir(t){delete this.Xn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return A.resolve();const n=IDBKeyRange.lowerBound((function(a){return[a]})(this.userId)),s=[];return Tn(t).ee({range:n},((i,a,c)=>{if(i[0]===this.userId){const l=Ht(i[1]);s.push(l)}else c.done()})).next((()=>{O(s.length===0,56720,{sr:s.map((i=>i.canonicalString()))})}))}))}containsKey(t,e){return fd(t,this.userId,e)}_r(t){return md(t).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:$e,lastStreamToken:""}))}}function fd(r,t,e){const n=Cs(t,e.path),s=n[1],i=IDBKeyRange.lowerBound(n);let a=!1;return Tn(r).ee({range:i,X:!0},((c,l,d)=>{const[f,g,E]=c;f===t&&g===s&&(a=!0),d.done()})).next((()=>a))}function me(r){return gt(r,jt)}function Tn(r){return gt(r,Rn)}function md(r){return gt(r,xr)}class en{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new en(0)}static cr(){return new en(-1)}}class g_{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.lr(t).next((e=>{const n=new en(e.highestTargetId);return e.highestTargetId=n.next(),this.hr(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.lr(t).next((e=>B.fromTimestamp(new X(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.lr(t).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.lr(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.hr(t,s))))}addTargetData(t,e){return this.Pr(t,e).next((()=>this.lr(t).next((n=>(n.targetCount+=1,this.Tr(e,n),this.hr(t,n))))))}updateTargetData(t,e){return this.Pr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>mn(t).delete(e.targetId))).next((()=>this.lr(t))).next((n=>(O(n.targetCount>0,8065),n.targetCount-=1,this.hr(t,n))))}removeTargets(t,e,n){let s=0;const i=[];return mn(t).ee(((a,c)=>{const l=gr(c);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(t,l)))})).next((()=>A.waitFor(i))).next((()=>s))}forEachTarget(t,e){return mn(t).ee(((n,s)=>{const i=gr(s);e(i)}))}lr(t){return Wu(t).get(Hs).next((e=>(O(e!==null,2888),e)))}hr(t,e){return Wu(t).put(Hs,e)}Pr(t,e){return mn(t).put(ad(this.serializer,e))}Tr(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.lr(t).next((e=>e.targetCount))}getTargetData(t,e){const n=Je(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return mn(t).ee({range:s,index:ah},((a,c,l)=>{const d=gr(c);Kr(e,d.target)&&(i=d,l.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=pe(t);return e.forEach((a=>{const c=bt(a.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(t,n,a))})),A.waitFor(s)}removeMatchingKeys(t,e,n){const s=pe(t);return A.forEach(e,(i=>{const a=bt(i.path);return A.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(t,n,i)])}))}removeMatchingKeysForTargetId(t,e){const n=pe(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=pe(t);let i=$();return s.ee({range:n,X:!0},((a,c,l)=>{const d=Ht(a[1]),f=new F(d);i=i.add(f)})).next((()=>i))}containsKey(t,e){const n=bt(e.path),s=IDBKeyRange.bound([n],[Jl(n)],!1,!0);let i=0;return pe(t).ee({index:Jo,X:!0,range:s},(([a,c],l,d)=>{a!==0&&(i++,d.done())})).next((()=>i>0))}At(t,e){return mn(t).get(e).next((n=>n?gr(n):null))}}function mn(r){return gt(r,Sn)}function Wu(r){return gt(r,Ke)}function pe(r){return gt(r,Pn)}const Xu="LruGarbageCollector",gd=1048576;function Yu([r,t],[e,n]){const s=q(r,e);return s===0?q(t,n):s}class p_{constructor(t){this.Ir=t,this.buffer=new et(Yu),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const n=this.buffer.last();Yu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}}class pd{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){V(Xu,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Se(e)?V(Xu,"Ignoring IndexedDB error during garbage collection: ",e):await rn(e)}await this.Vr(3e5)}))}}class __{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((n=>Math.floor(e/100*n)))}nthSequenceNumber(t,e){if(e===0)return A.resolve(Bt.ce);const n=new p_(e);return this.mr.forEachTarget(t,(s=>n.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>n.Ar(s))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(V("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(Qu)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(V("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qu):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,s,i,a,c,l,d;const f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(V("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(t,s)))).next((g=>(n=g,c=Date.now(),this.removeTargets(t,n,e)))).next((g=>(i=g,l=Date.now(),this.removeOrphanedDocuments(t,n)))).next((g=>(d=Date.now(),_n()<=W.DEBUG&&V("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(l-c)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g}))))}}function _d(r,t){return new __(r,t)}class y_{constructor(t,e){this.db=t,this.garbageCollector=_d(this,e)}gr(t){const e=this.wr(t);return this.db.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}pr(t,e){return this.Sr(t,((n,s)=>e(s)))}addReference(t,e,n){return ws(t,n)}removeReference(t,e,n){return ws(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return ws(t,e)}br(t,e){return(function(s,i){let a=!1;return md(s).te((c=>fd(s,c,i).next((l=>(l&&(a=!0),A.resolve(!l)))))).next((()=>a))})(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(t,((a,c)=>{if(c<=e){const l=this.br(t,a).next((d=>{if(!d)return i++,n.getEntry(t,a).next((()=>(n.removeEntry(a,B.min()),pe(t).delete((function(g){return[0,bt(g.path)]})(a)))))}));s.push(l)}})).next((()=>A.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return ws(t,e)}Sr(t,e){const n=pe(t);let s,i=Bt.ce;return n.ee({index:Jo},(([a,c],{path:l,sequenceNumber:d})=>{a===0?(i!==Bt.ce&&e(new F(Ht(s)),i),i=d,s=l):i=Bt.ce})).next((()=>{i!==Bt.ce&&e(new F(Ht(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function ws(r,t){return pe(r).put((function(n,s){return{targetId:0,path:bt(n.path),sequenceNumber:s}})(t,r.currentSequenceNumber))}class yd{constructor(){this.changes=new se((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,ct.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return n!==void 0?A.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class I_{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return Fe(t).put(n)}removeEntry(t,e,n){return Fe(t).delete((function(i,a){const c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],Zs(a),c[c.length-1]]})(e,n))}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Dr(t,n))))}getEntry(t,e){let n=ct.newInvalidDocument(e);return Fe(t).ee({index:Ds,range:IDBKeyRange.only(cr(e))},((s,i)=>{n=this.Cr(e,i)})).next((()=>n))}vr(t,e){let n={size:0,document:ct.newInvalidDocument(e)};return Fe(t).ee({index:Ds,range:IDBKeyRange.only(cr(e))},((s,i)=>{n={document:this.Cr(e,i),size:ei(i)}})).next((()=>n))}getEntries(t,e){let n=Mt();return this.Fr(t,e,((s,i)=>{const a=this.Cr(s,i);n=n.insert(s,a)})).next((()=>n))}Mr(t,e){let n=Mt(),s=new it(F.comparator);return this.Fr(t,e,((i,a)=>{const c=this.Cr(i,a);n=n.insert(i,c),s=s.insert(i,ei(a))})).next((()=>({documents:n,Or:s})))}Fr(t,e,n){if(e.isEmpty())return A.resolve();let s=new et(tl);e.forEach((l=>s=s.add(l)));const i=IDBKeyRange.bound(cr(s.first()),cr(s.last())),a=s.getIterator();let c=a.getNext();return Fe(t).ee({index:Ds,range:i},((l,d,f)=>{const g=F.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&tl(c,g)<0;)n(c,null),c=a.getNext();c&&c.isEqual(g)&&(n(c,d),c=a.hasNext()?a.getNext():null),c?f.j(cr(c)):f.done()})).next((()=>{for(;c;)n(c,null),c=a.hasNext()?a.getNext():null}))}getDocumentsMatchingQuery(t,e,n,s,i){const a=e.path,c=[a.popLast().toArray(),a.lastSegment(),Zs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Fe(t).J(IDBKeyRange.bound(c,l,!0)).next((d=>{i?.incrementDocumentReadCount(d.length);let f=Mt();for(const g of d){const E=this.Cr(F.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);E.isFoundDocument()&&(Qr(e,E)||s.has(E.key))&&(f=f.insert(E.key,E))}return f}))}getAllFromCollectionGroup(t,e,n,s){let i=Mt();const a=Zu(e,n),c=Zu(e,Ot.max());return Fe(t).ee({index:oh,range:IDBKeyRange.bound(a,c,!0)},((l,d,f)=>{const g=this.Cr(F.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(g.key,g),i.size===s&&f.done()})).next((()=>i))}newChangeBuffer(t){return new E_(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((e=>e.byteSize))}getMetadata(t){return Ju(t).get(Ao).next((e=>(O(!!e,20021),e)))}Dr(t,e){return Ju(t).put(Ao,e)}Cr(t,e){if(e){const n=i_(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return ct.newInvalidDocument(t)}}function Id(r){return new I_(r)}class E_ extends yd{constructor(t,e){super(),this.Nr=t,this.trackRemovals=e,this.Br=new se((n=>n.toString()),((n,s)=>n.isEqual(s)))}applyChanges(t){const e=[];let n=0,s=new et(((i,a)=>q(i.canonicalString(),a.canonicalString())));return this.changes.forEach(((i,a)=>{const c=this.Br.get(i);if(e.push(this.Nr.removeEntry(t,i,c.readTime)),a.isValidDocument()){const l=Fu(this.Nr.serializer,a);s=s.add(i.path.popLast());const d=ei(l);n+=d-c.size,e.push(this.Nr.addEntry(t,i,l))}else if(n-=c.size,this.trackRemovals){const l=Fu(this.Nr.serializer,a.convertToNoDocument(B.min()));e.push(this.Nr.addEntry(t,i,l))}})),s.forEach((i=>{e.push(this.Nr.indexManager.addToCollectionParentIndex(t,i))})),e.push(this.Nr.updateMetadata(t,n)),A.waitFor(e)}getFromCache(t,e){return this.Nr.vr(t,e).next((n=>(this.Br.set(e,{size:n.size,readTime:n.document.readTime}),n.document)))}getAllFromCache(t,e){return this.Nr.Mr(t,e).next((({documents:n,Or:s})=>(s.forEach(((i,a)=>{this.Br.set(i,{size:a,readTime:n.get(i).readTime})})),n)))}}function Ju(r){return gt(r,Nr)}function Fe(r){return gt(r,Ks)}function cr(r){const t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Zu(r,t){const e=t.documentKey.path.toArray();return[r,Zs(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function tl(r,t){const e=r.path.toArray(),n=t.path.toArray();let s=0;for(let i=0;i<e.length-2&&i<n.length-2;++i)if(s=q(e[i],n[i]),s)return s;return s=q(e.length,n.length),s||(s=q(e[e.length-2],n[n.length-2]),s||q(e[e.length-1],n[n.length-1]))}class T_{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ed{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(n!==null&&br(n.mutation,s,Dt.empty(),X.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.getLocalViewOfDocuments(t,n,$()).next((()=>n))))}getLocalViewOfDocuments(t,e,n=$()){const s=Qt();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((i=>{let a=fr();return i.forEach(((c,l)=>{a=a.insert(c,l.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const n=Qt();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,$())))}populateOverlays(t,e,n){const s=[];return n.forEach((i=>{e.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(t,s).next((i=>{i.forEach(((a,c)=>{e.set(a,c)}))}))}computeViews(t,e,n,s){let i=Mt();const a=vr(),c=(function(){return vr()})();return e.forEach(((l,d)=>{const f=n.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof ie)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),br(f.mutation,d,f.mutation.getFieldMask(),X.now())):a.set(d.key,Dt.empty())})),this.recalculateAndSaveOverlays(t,i).next((l=>(l.forEach(((d,f)=>a.set(d,f))),e.forEach(((d,f)=>c.set(d,new T_(f,a.get(d)??null)))),c)))}recalculateAndSaveOverlays(t,e){const n=vr();let s=new it(((a,c)=>a-c)),i=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const c of a)c.keys().forEach((l=>{const d=e.get(l);if(d===null)return;let f=n.get(l)||Dt.empty();f=c.applyToLocalView(d,f),n.set(l,f);const g=(s.get(c.batchId)||$()).add(l);s=s.insert(c.batchId,g)}))})).next((()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const l=c.getNext(),d=l.key,f=l.value,g=Oh();f.forEach((E=>{if(!i.has(E)){const R=zh(e.get(E),n.get(E));R!==null&&g.set(E,R),i=i.add(E)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return A.waitFor(a)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((n=>this.recalculateAndSaveOverlays(t,n)))}getDocumentsMatchingQuery(t,e,n,s){return(function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):xh(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,s):this.getDocumentsMatchingCollectionQuery(t,e,n,s)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):A.resolve(Qt());let c=Vr,l=i;return a.next((d=>A.forEach(d,((f,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),i.get(f)?A.resolve():this.remoteDocumentCache.getEntry(t,f).next((E=>{l=l.insert(f,E)}))))).next((()=>this.populateOverlays(t,d,i))).next((()=>this.computeViews(t,l,d,$()))).next((f=>({batchId:c,changes:Mh(f)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new F(e)).next((n=>{let s=fr();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,s){const i=e.collectionGroup;let a=fr();return this.indexManager.getCollectionParents(t,i).next((c=>A.forEach(c,(l=>{const d=(function(g,E){return new Un(E,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(e,l.child(i));return this.getDocumentsMatchingCollectionQuery(t,d,n,s).next((f=>{f.forEach(((g,E)=>{a=a.insert(g,E)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,s)))).next((a=>{i.forEach(((l,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,ct.newInvalidDocument(f)))}));let c=fr();return a.forEach(((l,d)=>{const f=i.get(l);f!==void 0&&br(f.mutation,d,Dt.empty(),X.now()),Qr(e,d)&&(c=c.insert(l,d))})),c}))}}class w_{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return A.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Vt(s.createTime)}})(e)),A.resolve()}getNamedQuery(t,e){return A.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:cd(s.bundledQuery),readTime:Vt(s.readTime)}})(e)),A.resolve()}}class A_{constructor(){this.overlays=new it(F.comparator),this.qr=new Map}getOverlay(t,e){return A.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Qt();return A.forEach(e,(s=>this.getOverlay(t,s).next((i=>{i!==null&&n.set(s,i)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((s,i)=>{this.St(t,e,i)})),A.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.qr.get(n);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(n)),A.resolve()}getOverlaysForCollection(t,e,n){const s=Qt(),i=e.length+1,a=new F(e.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const l=c.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===i&&l.largestBatchId>n&&s.set(l.getKey(),l)}return A.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new it(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=i.get(d.largestBatchId);f===null&&(f=Qt(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const c=Qt(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((d,f)=>c.set(d,f))),!(c.size()>=s)););return A.resolve(c)}St(t,e,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ua(e,n));let i=this.qr.get(e);i===void 0&&(i=$(),this.qr.set(e,i)),this.qr.set(e,i.add(n.key))}}class v_{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return A.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,A.resolve()}}class ma{constructor(){this.Qr=new et(_t.$r),this.Ur=new et(_t.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new _t(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((n=>this.addReference(n,e)))}removeReference(t,e){this.Gr(new _t(t,e))}zr(t,e){t.forEach((n=>this.removeReference(n,e)))}jr(t){const e=new F(new J([])),n=new _t(e,t),s=new _t(e,t+1),i=[];return this.Ur.forEachInRange([n,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new F(new J([])),n=new _t(e,t),s=new _t(e,t+1);let i=$();return this.Ur.forEachInRange([n,s],(a=>{i=i.add(a.key)})),i}containsKey(t){const e=new _t(t,0),n=this.Qr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}}class _t{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return F.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||F.comparator(t.key,e.key)}}class b_{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new et(_t.$r)}checkEmpty(t){return A.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new aa(i,e,n,s);this.mutationQueue.push(a);for(const c of s)this.Zr=this.Zr.add(new _t(c.key,i)),this.indexManager.addToCollectionParentIndex(t,c.key.path.popLast());return A.resolve(a)}lookupMutationBatch(t,e){return A.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.ei(n),i=s<0?0:s;return A.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(this.mutationQueue.length===0?$e:this.tr-1)}getAllMutationBatches(t){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new _t(e,0),s=new _t(e,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([n,s],(a=>{const c=this.Xr(a.Yr);i.push(c)})),A.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new et(q);return e.forEach((s=>{const i=new _t(s,0),a=new _t(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(c=>{n=n.add(c.Yr)}))})),A.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;F.isDocumentKey(i)||(i=i.child(""));const a=new _t(new F(i),0);let c=new et(q);return this.Zr.forEachWhile((l=>{const d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(c=c.add(l.Yr)),!0)}),a),A.resolve(this.ti(c))}ti(t){const e=[];return t.forEach((n=>{const s=this.Xr(n);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){O(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Zr;return A.forEach(e.mutations,(s=>{const i=new _t(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new _t(e,0),s=this.Zr.firstAfterOrEqual(n);return A.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,A.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class R_{constructor(t){this.ri=t,this.docs=(function(){return new it(F.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return A.resolve(n?n.document.mutableCopy():ct.newInvalidDocument(e))}getEntries(t,e){let n=Mt();return e.forEach((s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():ct.newInvalidDocument(s))})),A.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=Mt();const a=e.path,c=new F(a.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(c);for(;l.hasNext();){const{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||Xo(eh(f),n)<=0||(s.has(f.key)||Qr(e,f))&&(i=i.insert(f.key,f.mutableCopy()))}return A.resolve(i)}getAllFromCollectionGroup(t,e,n,s){M(9500)}ii(t,e){return A.forEach(this.docs,(n=>e(n)))}newChangeBuffer(t){return new S_(this)}getSize(t){return A.resolve(this.size)}}class S_ extends yd{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(n)})),A.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class P_{constructor(t){this.persistence=t,this.si=new se((e=>Je(e)),Kr),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new ma,this.targetCount=0,this.ai=en.ur()}forEachTarget(t,e){return this.si.forEach(((n,s)=>e(s))),A.resolve()}getLastRemoteSnapshotVersion(t){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return A.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),A.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new en(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,A.resolve()}updateTargetData(t,e){return this.Pr(e),A.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,A.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.si.forEach(((a,c)=>{c.sequenceNumber<=e&&n.get(c.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(t,c.targetId)),s++)})),A.waitFor(i).next((()=>s))}getTargetCount(t){return A.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return A.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),A.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((a=>{i.push(s.markPotentiallyOrphaned(t,a))})),A.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),A.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return A.resolve(n)}containsKey(t,e){return A.resolve(this._i.containsKey(e))}}class ga{constructor(t,e){this.ui={},this.overlays={},this.ci=new Bt(0),this.li=!1,this.li=!0,this.hi=new v_,this.referenceDelegate=t(this),this.Pi=new P_(this),this.indexManager=new f_,this.remoteDocumentCache=(function(s){return new R_(s)})((n=>this.referenceDelegate.Ti(n))),this.serializer=new od(e),this.Ii=new w_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new A_,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new b_(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){V("MemoryPersistence","Starting transaction:",t);const s=new V_(this.ci.next());return this.referenceDelegate.Ei(),n(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(t,e){return A.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class V_ extends rh{constructor(t){super(),this.currentSequenceNumber=t}}class wi{constructor(t){this.persistence=t,this.Ri=new ma,this.Vi=null}static mi(t){return new wi(t)}get fi(){if(this.Vi)return this.Vi;throw M(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),A.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),A.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),A.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.fi,(n=>{const s=F.fromPath(n);return this.gi(t,s).next((i=>{i||e.removeEntry(s,B.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((n=>{n?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return A.or([()=>A.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class ni{constructor(t,e){this.persistence=t,this.pi=new se((n=>bt(n.path)),((n,s)=>n.isEqual(s))),this.garbageCollector=_d(this,e)}static mi(t,e){return new ni(t,e)}Ei(){}di(t){return A.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((n=>e.next((s=>n+s))))}wr(t){let e=0;return this.pr(t,(n=>{e++})).next((()=>e))}pr(t,e){return A.forEach(this.pi,((n,s)=>this.br(t,n,s).next((i=>i?A.resolve():e(s)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((c=>{c||(n++,i.removeEntry(a,B.min()))})))).next((()=>i.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),A.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),A.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),A.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),A.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ns(t.data.value)),e}br(t,e,n){return A.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return A.resolve(s!==void 0&&s>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class C_{constructor(t){this.serializer=t}k(t,e,n,s){const i=new ui("createOrUpgrade",e);n<1&&s>=1&&((function(l){l.createObjectStore($r)})(t),(function(l){l.createObjectStore(xr,{keyPath:qg}),l.createObjectStore(jt,{keyPath:hu,autoIncrement:!0}).createIndex(Ge,du,{unique:!0}),l.createObjectStore(Rn)})(t),el(t),(function(l){l.createObjectStore(Be)})(t));let a=A.resolve();return n<3&&s>=3&&(n!==0&&((function(l){l.deleteObjectStore(Pn),l.deleteObjectStore(Sn),l.deleteObjectStore(Ke)})(t),el(t)),a=a.next((()=>(function(l){const d=l.store(Ke),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put(Hs,f)})(i)))),n<4&&s>=4&&(n!==0&&(a=a.next((()=>(function(l,d){return d.store(jt).J().next((g=>{l.deleteObjectStore(jt),l.createObjectStore(jt,{keyPath:hu,autoIncrement:!0}).createIndex(Ge,du,{unique:!0});const E=d.store(jt),R=g.map((x=>E.put(x)));return A.waitFor(R)}))})(t,i)))),a=a.next((()=>{(function(l){l.createObjectStore(Vn,{keyPath:Xg})})(t)}))),n<5&&s>=5&&(a=a.next((()=>this.yi(i)))),n<6&&s>=6&&(a=a.next((()=>((function(l){l.createObjectStore(Nr)})(t),this.wi(i))))),n<7&&s>=7&&(a=a.next((()=>this.Si(i)))),n<8&&s>=8&&(a=a.next((()=>this.bi(t,i)))),n<9&&s>=9&&(a=a.next((()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)}))),n<10&&s>=10&&(a=a.next((()=>this.Di(i)))),n<11&&s>=11&&(a=a.next((()=>{(function(l){l.createObjectStore(hi,{keyPath:Yg})})(t),(function(l){l.createObjectStore(di,{keyPath:Jg})})(t)}))),n<12&&s>=12&&(a=a.next((()=>{(function(l){const d=l.createObjectStore(fi,{keyPath:ip});d.createIndex(bo,op,{unique:!1}),d.createIndex(lh,ap,{unique:!1})})(t)}))),n<13&&s>=13&&(a=a.next((()=>(function(l){const d=l.createObjectStore(Ks,{keyPath:zg});d.createIndex(Ds,Gg),d.createIndex(oh,$g)})(t))).next((()=>this.Ci(t,i))).next((()=>t.deleteObjectStore(Be)))),n<14&&s>=14&&(a=a.next((()=>this.Fi(t,i)))),n<15&&s>=15&&(a=a.next((()=>(function(l){l.createObjectStore(Zo,{keyPath:Zg,autoIncrement:!0}).createIndex(vo,tp,{unique:!1}),l.createObjectStore(Er,{keyPath:ep}).createIndex(ch,np,{unique:!1}),l.createObjectStore(Tr,{keyPath:rp}).createIndex(uh,sp,{unique:!1})})(t)))),n<16&&s>=16&&(a=a.next((()=>{e.objectStore(Er).clear()})).next((()=>{e.objectStore(Tr).clear()}))),n<17&&s>=17&&(a=a.next((()=>{(function(l){l.createObjectStore(ta,{keyPath:cp})})(t)}))),n<18&&s>=18&&kl()&&(a=a.next((()=>{e.objectStore(Er).clear()})).next((()=>{e.objectStore(Tr).clear()}))),a}wi(t){let e=0;return t.store(Be).ee(((n,s)=>{e+=ei(s)})).next((()=>{const n={byteSize:e};return t.store(Nr).put(Ao,n)}))}yi(t){const e=t.store(xr),n=t.store(jt);return e.J().next((s=>A.forEach(s,(i=>{const a=IDBKeyRange.bound([i.userId,$e],[i.userId,i.lastAcknowledgedBatchId]);return n.J(Ge,a).next((c=>A.forEach(c,(l=>{O(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const d=qe(this.serializer,l);return dd(t,i.userId,d).next((()=>{}))}))))}))))}Si(t){const e=t.store(Pn),n=t.store(Be);return t.store(Ke).get(Hs).next((s=>{const i=[];return n.ee(((a,c)=>{const l=new J(a),d=(function(g){return[0,bt(g)]})(l);i.push(e.get(d).next((f=>f?A.resolve():(g=>e.put({targetId:0,path:bt(g),sequenceNumber:s.highestListenSequenceNumber}))(l))))})).next((()=>A.waitFor(i)))}))}bi(t,e){t.createObjectStore(kr,{keyPath:Wg});const n=e.store(kr),s=new fa,i=a=>{if(s.add(a)){const c=a.lastSegment(),l=a.popLast();return n.put({collectionId:c,parent:bt(l)})}};return e.store(Be).ee({X:!0},((a,c)=>{const l=new J(a);return i(l.popLast())})).next((()=>e.store(Rn).ee({X:!0},(([a,c,l],d)=>{const f=Ht(c);return i(f.popLast())}))))}Di(t){const e=t.store(Sn);return e.ee(((n,s)=>{const i=gr(s),a=ad(this.serializer,i);return e.put(a)}))}Ci(t,e){const n=e.store(Be),s=[];return n.ee(((i,a)=>{const c=e.store(Ks),l=(function(g){return g.document?new F(J.fromString(g.document.name).popFirst(5)):g.noDocument?F.fromSegments(g.noDocument.path):g.unknownDocument?F.fromSegments(g.unknownDocument.path):M(36783)})(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))})).next((()=>A.waitFor(s)))}Fi(t,e){const n=e.store(jt),s=Id(this.serializer),i=new ga(wi.mi,this.serializer.yt);return n.J().next((a=>{const c=new Map;return a.forEach((l=>{let d=c.get(l.userId)??$();qe(this.serializer,l).keys().forEach((f=>d=d.add(f))),c.set(l.userId,d)})),A.forEach(c,((l,d)=>{const f=new It(d),g=Ei.wt(this.serializer,f),E=i.getIndexManager(f),R=Ti.wt(f,this.serializer,E,i.referenceDelegate);return new Ed(s,R,g,E).recalculateAndSaveOverlaysForDocumentKeys(new Ro(e,Bt.ce),l).next()}))}))}}function el(r){r.createObjectStore(Pn,{keyPath:Hg}).createIndex(Jo,Qg,{unique:!0}),r.createObjectStore(Sn,{keyPath:"targetId"}).createIndex(ah,Kg,{unique:!0}),r.createObjectStore(Ke)}const ge="IndexedDbPersistence",ao=18e5,co=5e3,uo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",D_="main";class pa{constructor(t,e,n,s,i,a,c,l,d,f,g=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Mi=i,this.window=a,this.document=c,this.xi=d,this.Oi=f,this.Ni=g,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=E=>Promise.resolve(),!pa.v())throw new C(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new y_(this,s),this.$i=e+D_,this.serializer=new od(l),this.Ui=new Te(this.$i,this.Ni,new C_(this.serializer)),this.hi=new a_,this.Pi=new g_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Id(this.serializer),this.Ii=new o_,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,f===!1&&Pt(ge,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(P.FAILED_PRECONDITION,uo);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Pi.getHighestSequenceNumber(t)))})).then((t=>{this.ci=new Bt(t,this.xi)})).then((()=>{this.li=!0})).catch((t=>(this.Ui&&this.Ui.close(),Promise.reject(t))))}Ji(t){return this.Qi=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ui.$((async e=>{e.newVersion===null&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Mi.enqueueAndForget((async()=>{this.started&&await this.Wi()})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>As(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Hi(t).next((e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))))}))})).next((()=>this.Yi(t))).next((e=>this.isPrimary&&!e?this.Zi(t).next((()=>!1)):!!e&&this.Xi(t).next((()=>!0)))))).catch((t=>{if(Se(t))return V(ge,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return V(ge,"Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Mi.enqueueRetryable((()=>this.Qi(t))),this.isPrimary=t}))}Hi(t){return ur(t).get(un).next((e=>A.resolve(this.es(e))))}ts(t){return As(t).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,ao)){this.qi=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const n=gt(e,Vn);return n.J().next((s=>{const i=this.ss(s,ao),a=s.filter((c=>i.indexOf(c)===-1));return A.forEach(a,(c=>n.delete(c.clientId))).next((()=>a))}))})).catch((()=>[]));if(this.Ki)for(const e of t)this.Ki.removeItem(this._s(e.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Wi().then((()=>this.ns())).then((()=>this.ji()))))}es(t){return!!t&&t.ownerId===this.clientId}Yi(t){return this.Oi?A.resolve(!0):ur(t).get(un).next((e=>{if(e!==null&&this.rs(e.leaseTimestampMs,co)&&!this.us(e.ownerId)){if(this.es(e)&&this.networkEnabled)return!0;if(!this.es(e)){if(!e.allowTabSynchronization)throw new C(P.FAILED_PRECONDITION,uo);return!1}}return!(!this.networkEnabled||!this.inForeground)||As(t).J().next((n=>this.ss(n,co).find((s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1}))===void 0))})).next((e=>(this.isPrimary!==e&&V(ge,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[$r,Vn],(t=>{const e=new Ro(t,Bt.ce);return this.Zi(e).next((()=>this.ts(e)))})),this.Ui.close(),this.Ps()}ss(t,e){return t.filter((n=>this.rs(n.updateTimeMs,e)&&!this.us(n.clientId)))}Ts(){return this.runTransaction("getActiveClients","readonly",(t=>As(t).J().next((e=>this.ss(e,ao).map((n=>n.clientId))))))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(t,e){return Ti.wt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new m_(t,this.serializer.yt.databaseId)}getDocumentOverlayCache(t){return Ei.wt(this.serializer,t)}getBundleCache(){return this.Ii}runTransaction(t,e,n){V(ge,"Starting transaction:",t);const s=e==="readonly"?"readonly":"readwrite",i=(function(l){return l===18?hp:l===17?mh:l===16?lp:l===15?ea:l===14?fh:l===13?dh:l===12?up:l===11?hh:void M(60245)})(this.Ni);let a;return this.Ui.runTransaction(t,s,i,(c=>(a=new Ro(c,this.ci?this.ci.next():Bt.ce),e==="readwrite-primary"?this.Hi(a).next((l=>!!l||this.Yi(a))).next((l=>{if(!l)throw Pt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable((()=>this.Qi(!1))),new C(P.FAILED_PRECONDITION,nh);return n(a)})).next((l=>this.Xi(a).next((()=>l)))):this.Is(a).next((()=>n(a)))))).then((c=>(a.raiseOnCommittedEvent(),c)))}Is(t){return ur(t).get(un).next((e=>{if(e!==null&&this.rs(e.leaseTimestampMs,co)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new C(P.FAILED_PRECONDITION,uo)}))}Xi(t){const e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ur(t).put(un,e)}static v(){return Te.v()}Zi(t){const e=ur(t);return e.get(un).next((n=>this.es(n)?(V(ge,"Releasing primary lease."),e.delete(un)):A.resolve()))}rs(t,e){const n=Date.now();return!(t<n-e)&&(!(t>n)||(Pt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget((()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi())))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){typeof this.window?.addEventListener=="function"&&(this.Bi=()=>{this.cs();const t=/(?:Version|Mobile)\/1[456]/;Nl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(t){try{const e=this.Ki?.getItem(this._s(t))!==null;return V(ge,`Client '${t}' ${e?"is":"is not"} zombied in LocalStorage`),e}catch(e){return Pt(ge,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(t){Pt("Failed to set zombie client id.",t)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function ur(r){return gt(r,$r)}function As(r){return gt(r,Vn)}function x_(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}class _a{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=s}static As(t,e){let n=$(),s=$();for(const i of e.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new _a(t,e.fromCache,n,s)}}class N_{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Td{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Nl()?8:sh(qs())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,s){const i={result:null};return this.ys(t,e).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(t,e,s,n).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new N_;return this.Ss(t,e,a).next((c=>{if(i.result=c,this.Vs)return this.bs(t,e,a,c.size)}))})).next((()=>i.result))}bs(t,e,n,s){return n.documentReadCount<this.fs?(_n()<=W.DEBUG&&V("QueryEngine","SDK will not create cache indexes for query:",yn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),A.resolve()):(_n()<=W.DEBUG&&V("QueryEngine","Query:",yn(e),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(_n()<=W.DEBUG&&V("QueryEngine","The SDK decides to create cache indexes for query:",yn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ut(e))):A.resolve())}ys(t,e){if(bu(e))return A.resolve(null);let n=Ut(e);return this.indexManager.getIndexType(t,n).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=Xs(e,null,"F"),n=Ut(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const a=$(...i);return this.ps.getDocuments(t,a).next((c=>this.indexManager.getMinOffset(t,n).next((l=>{const d=this.Ds(e,c);return this.Cs(e,d,a,l.readTime)?this.ys(t,Xs(e,null,"F")):this.vs(t,d,e,l)}))))})))))}ws(t,e,n,s){return bu(e)||s.isEqual(B.min())?A.resolve(null):this.ps.getDocuments(t,n).next((i=>{const a=this.Ds(e,i);return this.Cs(e,a,n,s)?A.resolve(null):(_n()<=W.DEBUG&&V("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),yn(e)),this.vs(t,a,e,kg(s,Vr)).next((c=>c)))}))}Ds(t,e){let n=new et(kh(t));return e.forEach(((s,i)=>{Qr(t,i)&&(n=n.add(i))})),n}Cs(t,e,n,s){if(t.limit===null)return!1;if(n.size!==e.size)return!0;const i=t.limitType==="F"?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(t,e,n){return _n()<=W.DEBUG&&V("QueryEngine","Using full collection scan to execute query:",yn(e)),this.ps.getDocumentsMatchingQuery(t,e,Ot.min(),n)}vs(t,e,n,s){return this.ps.getDocumentsMatchingQuery(t,n,s).next((i=>(e.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const ya="LocalStore",k_=3e8;class F_{constructor(t,e,n,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new it(q),this.xs=new se((i=>Je(i)),Kr),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ed(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function wd(r,t,e,n){return new F_(r,t,e,n)}async function Ad(r,t){const e=j(r);return await e.persistence.runTransaction("Handle user change","readonly",(n=>{let s;return e.mutationQueue.getAllMutationBatches(n).next((i=>(s=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n)))).next((i=>{const a=[],c=[];let l=$();for(const d of s){a.push(d.batchId);for(const f of d.mutations)l=l.add(f.key)}for(const d of i){c.push(d.batchId);for(const f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:c})))}))}))}function M_(r,t){const e=j(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(n=>{const s=t.batch.keys(),i=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(c,l,d,f){const g=d.batch,E=g.keys();let R=A.resolve();return E.forEach((x=>{R=R.next((()=>f.getEntry(l,x))).next((k=>{const D=d.docVersions.get(x);O(D!==null,48541),k.version.compareTo(D)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))}))})),R.next((()=>c.mutationQueue.removeMutationBatch(l,g)))})(e,n,t,i).next((()=>i.apply(n))).next((()=>e.mutationQueue.performConsistencyCheck(n))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(n,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,(function(c){let l=$();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(l=l.add(c.batch.mutations[d].key));return l})(t)))).next((()=>e.localDocuments.getDocuments(n,s)))}))}function vd(r){const t=j(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function O_(r,t){const e=j(r),n=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const c=[];t.targetChanges.forEach(((f,g)=>{const E=s.get(g);if(!E)return;c.push(e.Pi.removeMatchingKeys(i,f.removedDocuments,g).next((()=>e.Pi.addMatchingKeys(i,f.addedDocuments,g))));let R=E.withSequenceNumber(i.currentSequenceNumber);t.targetMismatches.get(g)!==null?R=R.withResumeToken(ft.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(R=R.withResumeToken(f.resumeToken,n)),s=s.insert(g,R),(function(k,D,z){return k.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=k_?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0})(E,R,f)&&c.push(e.Pi.updateTargetData(i,R))}));let l=Mt(),d=$();if(t.documentUpdates.forEach((f=>{t.resolvedLimboDocuments.has(f)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,f))})),c.push(L_(i,a,t.documentUpdates).next((f=>{l=f.ks,d=f.qs}))),!n.isEqual(B.min())){const f=e.Pi.getLastRemoteSnapshotVersion(i).next((g=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,n)));c.push(f)}return A.waitFor(c).next((()=>a.apply(i))).next((()=>e.localDocuments.getLocalViewOfDocuments(i,l,d))).next((()=>l))})).then((i=>(e.Ms=s,i)))}function L_(r,t,e){let n=$(),s=$();return e.forEach((i=>n=n.add(i))),t.getEntries(r,n).next((i=>{let a=Mt();return e.forEach(((c,l)=>{const d=i.get(c);l.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),l.isNoDocument()&&l.version.isEqual(B.min())?(t.removeEntry(c,l.readTime),a=a.insert(c,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(c,l)):V(ya,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",l.version)})),{ks:a,qs:s}}))}function B_(r,t){const e=j(r);return e.persistence.runTransaction("Get next mutation batch","readonly",(n=>(t===void 0&&(t=$e),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t))))}function U_(r,t){const e=j(r);return e.persistence.runTransaction("Allocate target","readwrite",(n=>{let s;return e.Pi.getTargetData(n,t).next((i=>i?(s=i,A.resolve(s)):e.Pi.allocateTargetId(n).next((a=>(s=new Zt(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Pi.addTargetData(n,s).next((()=>s)))))))})).then((n=>{const s=e.Ms.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(n.targetId,n),e.xs.set(t,n.targetId)),n}))}async function Uo(r,t,e){const n=j(r),s=n.Ms.get(t),i=e?"readwrite":"readwrite-primary";try{e||await n.persistence.runTransaction("Release target",i,(a=>n.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Se(a))throw a;V(ya,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(s.target)}function nl(r,t,e){const n=j(r);let s=B.min(),i=$();return n.persistence.runTransaction("Execute query","readwrite",(a=>(function(l,d,f){const g=j(l),E=g.xs.get(f);return E!==void 0?A.resolve(g.Ms.get(E)):g.Pi.getTargetData(d,f)})(n,a,Ut(t)).next((c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(a,c.targetId).next((l=>{i=l}))})).next((()=>n.Fs.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?i:$()))).next((c=>(q_(n,Rp(t),c),{documents:c,Qs:i})))))}function q_(r,t,e){let n=r.Os.get(t)||B.min();e.forEach(((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)})),r.Os.set(t,n)}class rl{constructor(){this.activeTargetIds=xp()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class bd{constructor(){this.Mo=new rl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new rl,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class j_{Oo(t){}shutdown(){}}const sl="ConnectivityMonitor";class il{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){V(sl,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){V(sl,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let vs=null;function qo(){return vs===null?vs=(function(){return 268435456+Math.round(2147483648*Math.random())})():vs++,"0x"+vs.toString(16)}const lo="RestConnection",z_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class G_{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Mr?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(t,e,n,s,i){const a=qo(),c=this.zo(t,e.toUriEncodedString());V(lo,`Sending RPC '${t}' ${a}:`,c,n);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:d}=new URL(c),f=ai(d);return this.Jo(t,c,l,n,f).then((g=>(V(lo,`Received RPC '${t}' ${a}: `,g),g)),(g=>{throw vn(lo,`RPC '${t}' ${a} failed with error: `,g,"url: ",c,"request:",n),g}))}Ho(t,e,n,s,i,a){return this.Go(t,e,n,s,i)}jo(t,e,n){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Bn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,i)=>t[i]=s)),n&&n.headers.forEach(((s,i)=>t[i]=s))}zo(t,e){const n=z_[t];return`${this.Uo}/v1/${e}:${n}`}terminate(){}}class $_{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const wt="WebChannelConnection";class K_ extends G_{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,s,i){const a=qo();return new Promise(((c,l)=>{const d=new $l;d.setWithCredentials(!0),d.listenOnce(Kl.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Ps.NO_ERROR:const g=d.getResponseJson();V(wt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(g)),c(g);break;case Ps.TIMEOUT:V(wt,`RPC '${t}' ${a} timed out`),l(new C(P.DEADLINE_EXCEEDED,"Request time out"));break;case Ps.HTTP_ERROR:const E=d.getStatus();if(V(wt,`RPC '${t}' ${a} failed with status:`,E,"response text:",d.getResponseText()),E>0){let R=d.getResponseJson();Array.isArray(R)&&(R=R[0]);const x=R?.error;if(x&&x.status&&x.message){const k=(function(z){const U=z.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(U)>=0?U:P.UNKNOWN})(x.status);l(new C(k,x.message))}else l(new C(P.UNKNOWN,"Server responded with status "+d.getStatus()))}else l(new C(P.UNAVAILABLE,"Connection failed."));break;default:M(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{V(wt,`RPC '${t}' ${a} completed.`)}}));const f=JSON.stringify(s);V(wt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",f,n,15)}))}T_(t,e,n){const s=qo(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Wl(),c=Ql(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;const f=i.join("");V(wt,`Creating RPC '${t}' stream ${s}: ${f}`,l);const g=a.createWebChannel(f,l);this.I_(g);let E=!1,R=!1;const x=new $_({Yo:D=>{R?V(wt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(E||(V(wt,`Opening RPC '${t}' stream ${s} transport.`),g.open(),E=!0),V(wt,`RPC '${t}' stream ${s} sending:`,D),g.send(D))},Zo:()=>g.close()}),k=(D,z,U)=>{D.listen(z,(L=>{try{U(L)}catch(Z){setTimeout((()=>{throw Z}),0)}}))};return k(g,dr.EventType.OPEN,(()=>{R||(V(wt,`RPC '${t}' stream ${s} transport opened.`),x.o_())})),k(g,dr.EventType.CLOSE,(()=>{R||(R=!0,V(wt,`RPC '${t}' stream ${s} transport closed`),x.a_(),this.E_(g))})),k(g,dr.EventType.ERROR,(D=>{R||(R=!0,vn(wt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),x.a_(new C(P.UNAVAILABLE,"The operation could not be completed")))})),k(g,dr.EventType.MESSAGE,(D=>{if(!R){const z=D.data[0];O(!!z,16349);const U=z,L=U?.error||U[0]?.error;if(L){V(wt,`RPC '${t}' stream ${s} received error:`,L);const Z=L.status;let Y=(function(p){const I=ht[p];if(I!==void 0)return Kh(I)})(Z),K=L.message;Y===void 0&&(Y=P.INTERNAL,K="Unknown error status: "+Z+" with message "+L.message),R=!0,x.a_(new C(Y,K)),g.close()}else V(wt,`RPC '${t}' stream ${s} received:`,z),x.u_(z)}})),k(c,Hl.STAT_EVENT,(D=>{D.stat===Eo.PROXY?V(wt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===Eo.NOPROXY&&V(wt,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{x.__()}),0),x}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function H_(){return typeof window<"u"?window:null}function Ls(){return typeof document<"u"?document:null}function Ai(r){return new Wp(r,!0)}class Rd{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Mi=t,this.timerId=e,this.d_=n,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-n);s>0&&V("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const ol="PersistentStream";class Sd{constructor(t,e,n,s,i,a,c,l){this.Mi=t,this.S_=n,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Rd(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===P.RESOURCE_EXHAUSTED?(Pt(e.toString()),Pt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===P.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([n,s])=>{this.D_===e&&this.G_(n,s)}),(n=>{t((()=>{const s=new C(P.UNKNOWN,"Fetching auth token failed: "+n.message);return this.z_(s)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{n((()=>this.z_(s)))})),this.stream.onMessage((s=>{n((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return V(ol,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(V(ol,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Q_ extends Sd{constructor(t,e,n,s,i,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=Jp(this.serializer,t),n=(function(i){if(!("targetChange"in i))return B.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Vt(a.readTime):B.min()})(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=Fo(this.serializer),e.addTarget=(function(i,a){let c;const l=a.target;if(c=Qs(l)?{documents:td(i,l)}:{query:ed(i,l).ft},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=Wh(i,a.resumeToken);const d=No(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){c.readTime=Mn(i,a.snapshotVersion.toTimestamp());const d=No(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c})(this.serializer,t);const n=t_(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=Fo(this.serializer),e.removeTarget=t,this.q_(e)}}class W_ extends Sd{constructor(t,e,n,s,i,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return O(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,O(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){O(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Zp(t.writeResults,t.commitTime),n=Vt(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=Fo(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((n=>Js(this.serializer,n)))};this.q_(e)}}class X_{}class Y_ extends X_{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new C(P.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(t,ko(e,n),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new C(P.UNKNOWN,i.toString())}))}Ho(t,e,n,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,c])=>this.connection.Ho(t,ko(e,n),s,a,c,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===P.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new C(P.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class J_{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Pt(e),this.aa=!1):V("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const nn="RemoteStore";class Z_{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{n.enqueueAndForget((async()=>{sn(this)&&(V(nn,"Restarting streams for network reachability change."),await(async function(l){const d=j(l);d.Ea.add(4),await Yr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await vi(d)})(this))}))})),this.Ra=new J_(n,s)}}async function vi(r){if(sn(r))for(const t of r.da)await t(!0)}async function Yr(r){for(const t of r.da)await t(!1)}function Pd(r,t){const e=j(r);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),wa(e)?Ta(e):jn(e).O_()&&Ea(e,t))}function Ia(r,t){const e=j(r),n=jn(e);e.Ia.delete(t),n.O_()&&Vd(e,t),e.Ia.size===0&&(n.O_()?n.L_():sn(e)&&e.Ra.set("Unknown"))}function Ea(r,t){if(r.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){const e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}jn(r).Y_(t)}function Vd(r,t){r.Va.Ue(t),jn(r).Z_(t)}function Ta(r){r.Va=new $p({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),At:t=>r.Ia.get(t)||null,ht:()=>r.datastore.serializer.databaseId}),jn(r).start(),r.Ra.ua()}function wa(r){return sn(r)&&!jn(r).x_()&&r.Ia.size>0}function sn(r){return j(r).Ea.size===0}function Cd(r){r.Va=void 0}async function ty(r){r.Ra.set("Online")}async function ey(r){r.Ia.forEach(((t,e)=>{Ea(r,t)}))}async function ny(r,t){Cd(r),wa(r)?(r.Ra.ha(t),Ta(r)):r.Ra.set("Unknown")}async function ry(r,t,e){if(r.Ra.set("Online"),t instanceof Qh&&t.state===2&&t.cause)try{await(async function(s,i){const a=i.cause;for(const c of i.targetIds)s.Ia.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.Ia.delete(c),s.Va.removeTarget(c))})(r,t)}catch(n){V(nn,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ri(r,n)}else if(t instanceof Ms?r.Va.Ze(t):t instanceof Hh?r.Va.st(t):r.Va.tt(t),!e.isEqual(B.min()))try{const n=await vd(r.localStore);e.compareTo(n)>=0&&await(function(i,a){const c=i.Va.Tt(a);return c.targetChanges.forEach(((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(l.resumeToken,a))}})),c.targetMismatches.forEach(((l,d)=>{const f=i.Ia.get(l);if(!f)return;i.Ia.set(l,f.withResumeToken(ft.EMPTY_BYTE_STRING,f.snapshotVersion)),Vd(i,l);const g=new Zt(f.target,l,d,f.sequenceNumber);Ea(i,g)})),i.remoteSyncer.applyRemoteEvent(c)})(r,e)}catch(n){V(nn,"Failed to raise snapshot:",n),await ri(r,n)}}async function ri(r,t,e){if(!Se(t))throw t;r.Ea.add(1),await Yr(r),r.Ra.set("Offline"),e||(e=()=>vd(r.localStore)),r.asyncQueue.enqueueRetryable((async()=>{V(nn,"Retrying IndexedDB access"),await e(),r.Ea.delete(1),await vi(r)}))}function Dd(r,t){return t().catch((e=>ri(r,e,t)))}async function Jr(r){const t=j(r),e=be(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:$e;for(;sy(t);)try{const s=await B_(t.localStore,n);if(s===null){t.Ta.length===0&&e.L_();break}n=s.batchId,iy(t,s)}catch(s){await ri(t,s)}xd(t)&&Nd(t)}function sy(r){return sn(r)&&r.Ta.length<10}function iy(r,t){r.Ta.push(t);const e=be(r);e.O_()&&e.X_&&e.ea(t.mutations)}function xd(r){return sn(r)&&!be(r).x_()&&r.Ta.length>0}function Nd(r){be(r).start()}async function oy(r){be(r).ra()}async function ay(r){const t=be(r);for(const e of r.Ta)t.ea(e.mutations)}async function cy(r,t,e){const n=r.Ta.shift(),s=ca.from(n,t,e);await Dd(r,(()=>r.remoteSyncer.applySuccessfulWrite(s))),await Jr(r)}async function uy(r,t){t&&be(r).X_&&await(async function(n,s){if((function(a){return jp(a)&&a!==P.ABORTED})(s.code)){const i=n.Ta.shift();be(n).B_(),await Dd(n,(()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s))),await Jr(n)}})(r,t),xd(r)&&Nd(r)}async function al(r,t){const e=j(r);e.asyncQueue.verifyOperationInProgress(),V(nn,"RemoteStore received new credentials");const n=sn(e);e.Ea.add(3),await Yr(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await vi(e)}async function ly(r,t){const e=j(r);t?(e.Ea.delete(2),await vi(e)):t||(e.Ea.add(2),await Yr(e),e.Ra.set("Unknown"))}function jn(r){return r.ma||(r.ma=(function(e,n,s){const i=j(e);return i.sa(),new Q_(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:ty.bind(null,r),t_:ey.bind(null,r),r_:ny.bind(null,r),H_:ry.bind(null,r)}),r.da.push((async t=>{t?(r.ma.B_(),wa(r)?Ta(r):r.Ra.set("Unknown")):(await r.ma.stop(),Cd(r))}))),r.ma}function be(r){return r.fa||(r.fa=(function(e,n,s){const i=j(e);return i.sa(),new W_(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(r.datastore,r.asyncQueue,{Xo:()=>Promise.resolve(),t_:oy.bind(null,r),r_:uy.bind(null,r),ta:ay.bind(null,r),na:cy.bind(null,r)}),r.da.push((async t=>{t?(r.fa.B_(),await Jr(r)):(await r.fa.stop(),r.Ta.length>0&&(V(nn,`Stopping write stream with ${r.Ta.length} pending writes`),r.Ta=[]))}))),r.fa}class Aa{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Wt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,s,i){const a=Date.now()+n,c=new Aa(t,e,a,s,i);return c.start(n),c}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new C(P.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function va(r,t){if(Pt("AsyncQueue",`${t}: ${r}`),Se(r))return new C(P.UNAVAILABLE,`${t}: ${r}`);throw r}class An{static emptySet(t){return new An(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||F.comparator(e.key,n.key):(e,n)=>F.comparator(e.key,n.key),this.keyedMap=fr(),this.sortedSet=new it(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof An)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const n=new An;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class cl{constructor(){this.ga=new it(F.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?t.type!==0&&n.type===3?this.ga=this.ga.insert(e,t):t.type===3&&n.type!==1?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.ga=this.ga.remove(e):t.type===1&&n.type===2?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):M(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class On{constructor(t,e,n,s,i,a,c,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,s,i){const a=[];return e.forEach((c=>{a.push({type:0,doc:c})})),new On(t,e,An.emptySet(e),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&pi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==n[s].type||!e[s].doc.isEqual(n[s].doc))return!1;return!0}}class hy{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class dy{constructor(){this.queries=ul(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,n){const s=j(e),i=s.queries;s.queries=ul(),i.forEach(((a,c)=>{for(const l of c.Sa)l.onError(n)}))})(this,new C(P.ABORTED,"Firestore shutting down"))}}function ul(){return new se((r=>Nh(r)),pi)}async function ba(r,t){const e=j(r);let n=3;const s=t.query;let i=e.queries.get(s);i?!i.ba()&&t.Da()&&(n=2):(i=new hy,n=t.Da()?0:1);try{switch(n){case 0:i.wa=await e.onListen(s,!0);break;case 1:i.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const c=va(a,`Initialization of query '${yn(t.query)}' failed`);return void t.onError(c)}e.queries.set(s,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&Sa(e)}async function Ra(r,t){const e=j(r),n=t.query;let s=3;const i=e.queries.get(n);if(i){const a=i.Sa.indexOf(t);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=t.Da()?0:1:!i.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function fy(r,t){const e=j(r);let n=!1;for(const s of t){const i=s.query,a=e.queries.get(i);if(a){for(const c of a.Sa)c.Fa(s)&&(n=!0);a.wa=s}}n&&Sa(e)}function my(r,t,e){const n=j(r),s=n.queries.get(t);if(s)for(const i of s.Sa)i.onError(e);n.queries.delete(t)}function Sa(r){r.Ca.forEach((t=>{t.next()}))}var jo,ll;(ll=jo||(jo={})).Ma="default",ll.Cache="cache";class Pa{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const n=[];for(const s of t.docChanges)s.type!==3&&n.push(s);t=new On(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const n=e!=="Offline";return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=On.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==jo.Cache}}class kd{constructor(t){this.key=t}}class Fd{constructor(t){this.key=t}}class gy{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=kh(t),this.tu=new An(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new cl,s=e?e.tu:this.tu;let i=e?e.mutatedKeys:this.mutatedKeys,a=s,c=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((f,g)=>{const E=s.get(f),R=Qr(this.query,g)?g:null,x=!!E&&this.mutatedKeys.has(E.key),k=!!R&&(R.hasLocalMutations||this.mutatedKeys.has(R.key)&&R.hasCommittedMutations);let D=!1;E&&R?E.data.isEqual(R.data)?x!==k&&(n.track({type:3,doc:R}),D=!0):this.su(E,R)||(n.track({type:2,doc:R}),D=!0,(l&&this.eu(R,l)>0||d&&this.eu(R,d)<0)&&(c=!0)):!E&&R?(n.track({type:0,doc:R}),D=!0):E&&!R&&(n.track({type:1,doc:E}),D=!0,(l||d)&&(c=!0)),D&&(R?(a=a.add(R),i=k?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),n.track({type:1,doc:f})}return{tu:a,iu:n,Cs:c,mutatedKeys:i}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,s){const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((f,g)=>(function(R,x){const k=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return M(20277,{Rt:D})}};return k(R)-k(x)})(f.type,g.type)||this.eu(f.doc,g.doc))),this.ou(n),s=s??!1;const c=e&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,d=l!==this.Za;return this.Za=l,a.length!==0||d?{snapshot:new On(this.query,t.tu,i,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:c}:{au:c}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new cl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((n=>{this.uu(n.key)&&(this.Xa=this.Xa.add(n.key))}));const e=[];return t.forEach((n=>{this.Xa.has(n)||e.push(new Fd(n))})),this.Xa.forEach((n=>{t.has(n)||e.push(new kd(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return On.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Va="SyncEngine";class py{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class _y{constructor(t){this.key=t,this.hu=!1}}class yy{constructor(t,e,n,s,i,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new se((c=>Nh(c)),pi),this.Iu=new Map,this.Eu=new Set,this.du=new it(F.comparator),this.Au=new Map,this.Ru=new ma,this.Vu={},this.mu=new Map,this.fu=en.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Iy(r,t,e=!0){const n=qd(r);let s;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await Md(n,t,e,!0),s}async function Ey(r,t){const e=qd(r);await Md(e,t,!0,!1)}async function Md(r,t,e,n){const s=await U_(r.localStore,Ut(t)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,e);let c;return n&&(c=await Ty(r,t,i,a==="current",s.resumeToken)),r.isPrimaryClient&&e&&Pd(r.remoteStore,s),c}async function Ty(r,t,e,n,s){r.pu=(g,E,R)=>(async function(k,D,z,U){let L=D.view.ru(z);L.Cs&&(L=await nl(k.localStore,D.query,!1).then((({documents:w})=>D.view.ru(w,L))));const Z=U&&U.targetChanges.get(D.targetId),Y=U&&U.targetMismatches.get(D.targetId)!=null,K=D.view.applyChanges(L,k.isPrimaryClient,Z,Y);return dl(k,D.targetId,K.au),K.snapshot})(r,g,E,R);const i=await nl(r.localStore,t,!0),a=new gy(t,i.Qs),c=a.ru(i.documents),l=Xr.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",s),d=a.applyChanges(c,r.isPrimaryClient,l);dl(r,e,d.au);const f=new py(t,e,a);return r.Tu.set(t,f),r.Iu.has(e)?r.Iu.get(e).push(t):r.Iu.set(e,[t]),d.snapshot}async function wy(r,t,e){const n=j(r),s=n.Tu.get(t),i=n.Iu.get(s.targetId);if(i.length>1)return n.Iu.set(s.targetId,i.filter((a=>!pi(a,t)))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Uo(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),e&&Ia(n.remoteStore,s.targetId),zo(n,s.targetId)})).catch(rn)):(zo(n,s.targetId),await Uo(n.localStore,s.targetId,!0))}async function Ay(r,t){const e=j(r),n=e.Tu.get(t),s=e.Iu.get(n.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Ia(e.remoteStore,n.targetId))}async function vy(r,t,e){const n=jd(r);try{const s=await(function(a,c){const l=j(a),d=X.now(),f=c.reduce(((R,x)=>R.add(x.key)),$());let g,E;return l.persistence.runTransaction("Locally write mutations","readwrite",(R=>{let x=Mt(),k=$();return l.Ns.getEntries(R,f).next((D=>{x=D,x.forEach(((z,U)=>{U.isValidDocument()||(k=k.add(z))}))})).next((()=>l.localDocuments.getOverlayedDocuments(R,x))).next((D=>{g=D;const z=[];for(const U of c){const L=Up(U,g.get(U.key).overlayedDocument);L!=null&&z.push(new ie(U.key,L,vh(L.value.mapValue),yt.exists(!0)))}return l.mutationQueue.addMutationBatch(R,d,z,c)})).next((D=>{E=D;const z=D.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(R,D.batchId,z)}))})).then((()=>({batchId:E.batchId,changes:Mh(g)})))})(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),(function(a,c,l){let d=a.Vu[a.currentUser.toKey()];d||(d=new it(q)),d=d.insert(c,l),a.Vu[a.currentUser.toKey()]=d})(n,s.batchId,e),await Zr(n,s.changes),await Jr(n.remoteStore)}catch(s){const i=va(s,"Failed to persist write");e.reject(i)}}async function Od(r,t){const e=j(r);try{const n=await O_(e.localStore,t);t.targetChanges.forEach(((s,i)=>{const a=e.Au.get(i);a&&(O(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?O(a.hu,14607):s.removedDocuments.size>0&&(O(a.hu,42227),a.hu=!1))})),await Zr(e,n,t)}catch(n){await rn(n)}}function hl(r,t,e){const n=j(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){const s=[];n.Tu.forEach(((i,a)=>{const c=a.view.va(t);c.snapshot&&s.push(c.snapshot)})),(function(a,c){const l=j(a);l.onlineState=c;let d=!1;l.queries.forEach(((f,g)=>{for(const E of g.Sa)E.va(c)&&(d=!0)})),d&&Sa(l)})(n.eventManager,t),s.length&&n.Pu.H_(s),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function by(r,t,e){const n=j(r);n.sharedClientState.updateQueryState(t,"rejected",e);const s=n.Au.get(t),i=s&&s.key;if(i){let a=new it(F.comparator);a=a.insert(i,ct.newNoDocument(i,B.min()));const c=$().add(i),l=new Ii(B.min(),new Map,new it(q),a,c);await Od(n,l),n.du=n.du.remove(i),n.Au.delete(t),Ca(n)}else await Uo(n.localStore,t,!1).then((()=>zo(n,t,e))).catch(rn)}async function Ry(r,t){const e=j(r),n=t.batch.batchId;try{const s=await M_(e.localStore,t);Bd(e,n,null),Ld(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await Zr(e,s)}catch(s){await rn(s)}}async function Sy(r,t,e){const n=j(r);try{const s=await(function(a,c){const l=j(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return l.mutationQueue.lookupMutationBatch(d,c).next((g=>(O(g!==null,37113),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g)))).next((()=>l.mutationQueue.performConsistencyCheck(d))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,c))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>l.localDocuments.getDocuments(d,f)))}))})(n.localStore,t);Bd(n,t,e),Ld(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),await Zr(n,s)}catch(s){await rn(s)}}function Ld(r,t){(r.mu.get(t)||[]).forEach((e=>{e.resolve()})),r.mu.delete(t)}function Bd(r,t,e){const n=j(r);let s=n.Vu[n.currentUser.toKey()];if(s){const i=s.get(t);i&&(e?i.reject(e):i.resolve(),s=s.remove(t)),n.Vu[n.currentUser.toKey()]=s}}function zo(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(const n of r.Iu.get(t))r.Tu.delete(n),e&&r.Pu.yu(n,e);r.Iu.delete(t),r.isPrimaryClient&&r.Ru.jr(t).forEach((n=>{r.Ru.containsKey(n)||Ud(r,n)}))}function Ud(r,t){r.Eu.delete(t.path.canonicalString());const e=r.du.get(t);e!==null&&(Ia(r.remoteStore,e),r.du=r.du.remove(t),r.Au.delete(e),Ca(r))}function dl(r,t,e){for(const n of e)n instanceof kd?(r.Ru.addReference(n.key,t),Py(r,n)):n instanceof Fd?(V(Va,"Document no longer in limbo: "+n.key),r.Ru.removeReference(n.key,t),r.Ru.containsKey(n.key)||Ud(r,n.key)):M(19791,{wu:n})}function Py(r,t){const e=t.key,n=e.path.canonicalString();r.du.get(e)||r.Eu.has(n)||(V(Va,"New document in limbo: "+e),r.Eu.add(n),Ca(r))}function Ca(r){for(;r.Eu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){const t=r.Eu.values().next().value;r.Eu.delete(t);const e=new F(J.fromString(t)),n=r.fu.next();r.Au.set(n,new _y(e)),r.du=r.du.insert(e,n),Pd(r.remoteStore,new Zt(Ut(Hr(e.path)),n,"TargetPurposeLimboResolution",Bt.ce))}}async function Zr(r,t,e){const n=j(r),s=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach(((c,l)=>{a.push(n.pu(l,t,e).then((d=>{if((d||e)&&n.isPrimaryClient){const f=d?!d.fromCache:e?.targetChanges.get(l.targetId)?.current;n.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(d){s.push(d);const f=_a.As(l.targetId,d);i.push(f)}})))})),await Promise.all(a),n.Pu.H_(s),await(async function(l,d){const f=j(l);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>A.forEach(d,(E=>A.forEach(E.Es,(R=>f.persistence.referenceDelegate.addReference(g,E.targetId,R))).next((()=>A.forEach(E.ds,(R=>f.persistence.referenceDelegate.removeReference(g,E.targetId,R)))))))))}catch(g){if(!Se(g))throw g;V(ya,"Failed to update sequence numbers: "+g)}for(const g of d){const E=g.targetId;if(!g.fromCache){const R=f.Ms.get(E),x=R.snapshotVersion,k=R.withLastLimboFreeSnapshotVersion(x);f.Ms=f.Ms.insert(E,k)}}})(n.localStore,i))}async function Vy(r,t){const e=j(r);if(!e.currentUser.isEqual(t)){V(Va,"User change. New user:",t.toKey());const n=await Ad(e.localStore,t);e.currentUser=t,(function(i,a){i.mu.forEach((c=>{c.forEach((l=>{l.reject(new C(P.CANCELLED,a))}))})),i.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await Zr(e,n.Ls)}}function Cy(r,t){const e=j(r),n=e.Au.get(t);if(n&&n.hu)return $().add(n.key);{let s=$();const i=e.Iu.get(t);if(!i)return s;for(const a of i){const c=e.Tu.get(a);s=s.unionWith(c.view.nu)}return s}}function qd(r){const t=j(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Od.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Cy.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=by.bind(null,t),t.Pu.H_=fy.bind(null,t.eventManager),t.Pu.yu=my.bind(null,t.eventManager),t}function jd(r){const t=j(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ry.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Sy.bind(null,t),t}class zr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ai(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return wd(this.persistence,new Td,t.initialUser,this.serializer)}Cu(t){return new ga(wi.mi,this.serializer)}Du(t){return new bd}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zr.provider={build:()=>new zr};class Dy extends zr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){O(this.persistence.referenceDelegate instanceof ni,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new pd(n,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?At.withCacheSize(this.cacheSizeBytes):At.DEFAULT;return new ga((n=>ni.mi(n,e)),this.serializer)}}class xy extends zr{constructor(t,e,n){super(),this.xu=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await this.xu.initialize(this,t),await jd(this.xu.syncEngine),await Jr(this.xu.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}vu(t){return wd(this.persistence,new Td,t.initialUser,this.serializer)}Fu(t,e){const n=this.persistence.referenceDelegate.garbageCollector;return new pd(n,t.asyncQueue,e)}Mu(t,e){const n=new Lg(e,this.persistence);return new Og(t.asyncQueue,n)}Cu(t){const e=x_(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?At.withCacheSize(this.cacheSizeBytes):At.DEFAULT;return new pa(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,H_(),Ls(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(t){return new bd}}class si{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>hl(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Vy.bind(null,this.syncEngine),await ly(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new dy})()}createDatastore(t){const e=Ai(t.databaseInfo.databaseId),n=(function(i){return new K_(i)})(t.databaseInfo);return(function(i,a,c,l){return new Y_(i,a,c,l)})(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return(function(n,s,i,a,c){return new Z_(n,s,i,a,c)})(this.localStore,this.datastore,t.asyncQueue,(e=>hl(this.syncEngine,e,0)),(function(){return il.v()?new il:new j_})())}createSyncEngine(t,e){return(function(s,i,a,c,l,d,f){const g=new yy(s,i,a,c,l,d);return f&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const n=j(e);V(nn,"RemoteStore shutting down."),n.Ea.add(5),await Yr(n),n.Aa.shutdown(),n.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}si.provider={build:()=>new si};class Da{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Pt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const Re="FirestoreClient";class Ny{constructor(t,e,n,s,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=It.UNAUTHENTICATED,this.clientId=Wo.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async a=>{V(Re,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,(a=>(V(Re,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Wt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=va(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function ho(r,t){r.asyncQueue.verifyOperationInProgress(),V(Re,"Initializing OfflineComponentProvider");const e=r.configuration;await t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener((async s=>{n.isEqual(s)||(await Ad(t.localStore,s),n=s)})),t.persistence.setDatabaseDeletedListener((()=>r.terminate())),r._offlineComponents=t}async function fl(r,t){r.asyncQueue.verifyOperationInProgress();const e=await ky(r);V(Re,"Initializing OnlineComponentProvider"),await t.initialize(e,r.configuration),r.setCredentialChangeListener((n=>al(t.remoteStore,n))),r.setAppCheckTokenChangeListener(((n,s)=>al(t.remoteStore,s))),r._onlineComponents=t}async function ky(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){V(Re,"Using user provided OfflineComponentProvider");try{await ho(r,r._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===P.FAILED_PRECONDITION||s.code===P.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;vn("Error using user provided cache. Falling back to memory cache: "+e),await ho(r,new zr)}}else V(Re,"Using default OfflineComponentProvider"),await ho(r,new Dy(void 0));return r._offlineComponents}async function zd(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(V(Re,"Using user provided OnlineComponentProvider"),await fl(r,r._uninitializedComponentsProvider._online)):(V(Re,"Using default OnlineComponentProvider"),await fl(r,new si))),r._onlineComponents}function Fy(r){return zd(r).then((t=>t.syncEngine))}async function ii(r){const t=await zd(r),e=t.eventManager;return e.onListen=Iy.bind(null,t.syncEngine),e.onUnlisten=wy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Ey.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Ay.bind(null,t.syncEngine),e}function My(r,t,e={}){const n=new Wt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,l,d){const f=new Da({next:E=>{f.Nu(),a.enqueueAndForget((()=>Ra(i,g)));const R=E.docs.has(c);!R&&E.fromCache?d.reject(new C(P.UNAVAILABLE,"Failed to get document because the client is offline.")):R&&E.fromCache&&l&&l.source==="server"?d.reject(new C(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(E)},error:E=>d.reject(E)}),g=new Pa(Hr(c.path),f,{includeMetadataChanges:!0,qa:!0});return ba(i,g)})(await ii(r),r.asyncQueue,t,e,n))),n.promise}function Oy(r,t,e={}){const n=new Wt;return r.asyncQueue.enqueueAndForget((async()=>(function(i,a,c,l,d){const f=new Da({next:E=>{f.Nu(),a.enqueueAndForget((()=>Ra(i,g))),E.fromCache&&l.source==="server"?d.reject(new C(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(E)},error:E=>d.reject(E)}),g=new Pa(c,f,{includeMetadataChanges:!0,qa:!0});return ba(i,g)})(await ii(r),r.asyncQueue,t,e,n))),n.promise}function Gd(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}const ml=new Map;const $d="firestore.googleapis.com",gl=!0;class pl{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new C(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=$d,this.ssl=gl}else this.host=t.host,this.ssl=t.ssl??gl;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=hd;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<gd)throw new C(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}xg("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Gd(t.experimentalLongPollingOptions??{}),(function(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<5)throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is 5)`);if(n.timeoutSeconds>30)throw new C(P.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(n,s){return n.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class bi{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new C(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new C(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pl(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(n){if(!n)return new wg;switch(n.type){case"firstParty":return new Rg(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new C(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const n=ml.get(e);n&&(V("ComponentProvider","Removing Datastore"),ml.delete(e),n.terminate())})(this),Promise.resolve()}}function Ly(r,t,e,n={}){r=xt(r,bi);const s=ai(t),i=r._getSettings(),a={...i,emulatorOptions:r._getEmulatorOptions()},c=`${t}:${e}`;s&&(Dl(`https://${c}`),sm("Firestore",!0)),i.host!==$d&&i.host!==c&&vn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:c,ssl:s,emulatorOptions:n};if(!Rr(l,a)&&(r._setSettings(l),n.mockUserToken)){let d,f;if(typeof n.mockUserToken=="string")d=n.mockUserToken,f=It.MOCK_USER;else{d=em(n.mockUserToken,r._app?.options.projectId);const g=n.mockUserToken.sub||n.mockUserToken.user_id;if(!g)throw new C(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new It(g)}r._authCredentials=new Ag(new Yl(d,f))}}class oe{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new oe(this.firestore,t,this._query)}}class ut{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new we(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ut(this.firestore,t,this._key)}toJSON(){return{type:ut._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(Gr(e,ut._jsonSchema))return new ut(t,n||null,new F(J.fromString(e.referencePath)))}}ut._jsonSchemaVersion="firestore/documentReference/1.0",ut._jsonSchema={type:dt("string",ut._jsonSchemaVersion),referencePath:dt("string")};class we extends oe{constructor(t,e,n){super(t,e,Hr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ut(this.firestore,null,new F(t))}withConverter(t){return new we(this.firestore,t,this._path)}}function Me(r,t,...e){if(r=qt(r),Zl("collection","path",t),r instanceof bi){const n=J.fromString(t,...e);return ou(n),new we(r,null,n)}{if(!(r instanceof ut||r instanceof we))throw new C(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(t,...e));return ou(n),new we(r.firestore,null,n)}}function gn(r,t,...e){if(r=qt(r),arguments.length===1&&(t=Wo.newId()),Zl("doc","path",t),r instanceof bi){const n=J.fromString(t,...e);return iu(n),new ut(r,null,new F(n))}{if(!(r instanceof ut||r instanceof we))throw new C(P.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(J.fromString(t,...e));return iu(n),new ut(r.firestore,r instanceof we?r.converter:null,new F(n))}}const _l="AsyncQueue";class yl{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Rd(this,"async_queue_retry"),this._c=()=>{const n=Ls();n&&V(_l,"Visibility state changed to "+n.visibilityState),this.M_.w_()},this.ac=t;const e=Ls();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Ls();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new Wt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Se(t))throw t;V(_l,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((n=>{throw this.nc=n,this.rc=!1,Pt("INTERNAL UNHANDLED ERROR: ",Il(n)),n})).then((n=>(this.rc=!1,n))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=Aa.createAndSchedule(this,t,e,n,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&M(47125,{Pc:Il(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,n)=>e.targetTimeMs-n.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Il(r){let t=r.message||"";return r.stack&&(t=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),t}function El(r){return(function(e,n){if(typeof e!="object"||e===null)return!1;const s=e;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1})(r,["next","error","complete"])}class re extends bi{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new yl,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new yl(t),this._firestoreClient=void 0,await t}}}function By(r,t,e){e||(e=Mr);const n=Ul(r,"firestore");if(n.isInitialized(e)){const s=n.getImmediate({identifier:e}),i=n.getOptions(e);if(Rr(i,t))return s;throw new C(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new C(P.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<gd)throw new C(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&ai(t.host)&&Dl(t.host),n.initialize({options:t,instanceIdentifier:e})}function Uy(r,t){const e=typeof r=="object"?r:ug(),n=typeof r=="string"?r:Mr,s=Ul(e,"firestore").getImmediate({identifier:n});if(!s._initialized){const i=Zf("firestore");i&&Ly(s,...i)}return s}function ts(r){if(r._terminated)throw new C(P.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||qy(r),r._firestoreClient}function qy(r){const t=r._freezeSettings(),e=(function(s,i,a,c){return new fp(s,i,a,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Gd(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)})(r._databaseId,r._app?.options.appId||"",r._persistenceKey,t);r._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(r._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),r._firestoreClient=new Ny(r._authCredentials,r._appCheckCredentials,r._queue,e,r._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(r._componentsProvider))}class Lt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Lt(ft.fromBase64String(t))}catch(e){throw new C(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Lt(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Lt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Gr(t,Lt._jsonSchema))return Lt.fromBase64String(t.bytes)}}Lt._jsonSchemaVersion="firestore/bytes/1.0",Lt._jsonSchema={type:dt("string",Lt._jsonSchemaVersion),bytes:dt("string")};class es{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new C(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ot(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class xa{constructor(t){this._methodName=t}}class Xt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new C(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new C(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Xt._jsonSchemaVersion}}static fromJSON(t){if(Gr(t,Xt._jsonSchema))return new Xt(t.latitude,t.longitude)}}Xt._jsonSchemaVersion="firestore/geoPoint/1.0",Xt._jsonSchema={type:dt("string",Xt._jsonSchemaVersion),latitude:dt("number"),longitude:dt("number")};class Yt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Yt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Gr(t,Yt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Yt(t.vectorValues);throw new C(P.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Yt._jsonSchemaVersion="firestore/vectorValue/1.0",Yt._jsonSchema={type:dt("string",Yt._jsonSchemaVersion),vectorValues:dt("object")};const jy=/^__.*__$/;class zy{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new ie(t,this.data,this.fieldMask,e,this.fieldTransforms):new qn(t,this.data,e,this.fieldTransforms)}}class Kd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ie(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Hd(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M(40011,{Ac:r})}}class Na{constructor(t,e,n,s,i,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Na({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.gc(t),n}yc(t){const e=this.path?.child(t),n=this.Vc({path:e,fc:!1});return n.Rc(),n}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return oi(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(Hd(this.Ac)&&jy.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class Gy{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ai(t)}Cc(t,e,n,s=!1){return new Na({Ac:t,methodName:e,Dc:n,path:ot.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ri(r){const t=r._freezeSettings(),e=Ai(r._databaseId);return new Gy(r._databaseId,!!t.ignoreUndefinedProperties,e)}function Qd(r,t,e,n,s,i={}){const a=r.Cc(i.merge||i.mergeFields?2:0,t,e,s);ka("Data must be an object, but it was:",a,n);const c=Yd(n,a);let l,d;if(i.merge)l=new Dt(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const g of i.mergeFields){const E=Go(t,g,e);if(!a.contains(E))throw new C(P.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);Zd(f,E)||f.push(E)}l=new Dt(f),d=a.fieldTransforms.filter((g=>l.covers(g.field)))}else l=null,d=a.fieldTransforms;return new zy(new vt(c),l,d)}class Si extends xa{_toFieldTransform(t){if(t.Ac!==2)throw t.Ac===1?t.Sc(`${this._methodName}() can only appear at the top level of your update data`):t.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Si}}function Wd(r,t,e,n){const s=r.Cc(1,t,e);ka("Data must be an object, but it was:",s,n);const i=[],a=vt.empty();Pe(n,((l,d)=>{const f=Fa(t,l,e);d=qt(d);const g=s.yc(f);if(d instanceof Si)i.push(f);else{const E=ns(d,g);E!=null&&(i.push(f),a.set(f,E))}}));const c=new Dt(i);return new Kd(a,c,s.fieldTransforms)}function Xd(r,t,e,n,s,i){const a=r.Cc(1,t,e),c=[Go(t,n,e)],l=[s];if(i.length%2!=0)throw new C(P.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<i.length;E+=2)c.push(Go(t,i[E])),l.push(i[E+1]);const d=[],f=vt.empty();for(let E=c.length-1;E>=0;--E)if(!Zd(d,c[E])){const R=c[E];let x=l[E];x=qt(x);const k=a.yc(R);if(x instanceof Si)d.push(R);else{const D=ns(x,k);D!=null&&(d.push(R),f.set(R,D))}}const g=new Dt(d);return new Kd(f,g,a.fieldTransforms)}function $y(r,t,e,n=!1){return ns(e,r.Cc(n?4:3,t))}function ns(r,t){if(Jd(r=qt(r)))return ka("Unsupported field value:",t,r),Yd(r,t);if(r instanceof xa)return(function(n,s){if(!Hd(s.Ac))throw s.Sc(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(n,s){const i=[];let a=0;for(const c of n){let l=ns(c,s.wc(a));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),a++}return{arrayValue:{values:i}}})(r,t)}return(function(n,s){if((n=qt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Np(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=X.fromDate(n);return{timestampValue:Mn(s.serializer,i)}}if(n instanceof X){const i=new X(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Mn(s.serializer,i)}}if(n instanceof Xt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Lt)return{bytesValue:Wh(s.serializer,n._byteString)};if(n instanceof ut){const i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:ha(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Yt)return(function(a,c){return{mapValue:{fields:{[ra]:{stringValue:sa},[Cn]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw c.Sc("VectorValues must only contain numeric values.");return oa(c.serializer,d)}))}}}}}})(n,s);throw s.Sc(`Unsupported field value: ${ci(n)}`)})(r,t)}function Yd(r,t){const e={};return gh(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pe(r,((n,s)=>{const i=ns(s,t.mc(n));i!=null&&(e[n]=i)})),{mapValue:{fields:e}}}function Jd(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof X||r instanceof Xt||r instanceof Lt||r instanceof ut||r instanceof xa||r instanceof Yt)}function ka(r,t,e){if(!Jd(e)||!th(e)){const n=ci(e);throw n==="an object"?t.Sc(r+" a custom object"):t.Sc(r+" "+n)}}function Go(r,t,e){if((t=qt(t))instanceof es)return t._internalPath;if(typeof t=="string")return Fa(r,t);throw oi("Field path arguments must be of type string or ",r,!1,void 0,e)}const Ky=new RegExp("[~\\*/\\[\\]]");function Fa(r,t,e){if(t.search(Ky)>=0)throw oi(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new es(...t.split("."))._internalPath}catch{throw oi(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function oi(r,t,e,n,s){const i=n&&!n.isEmpty(),a=s!==void 0;let c=`Function ${t}() called with invalid data`;e&&(c+=" (via `toFirestore()`)"),c+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new C(P.INVALID_ARGUMENT,c+r+l)}function Zd(r,t){return r.some((e=>e.isEqual(t)))}class tf{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ut(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Hy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Pi("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class Hy extends tf{data(){return super.data()}}function Pi(r,t){return typeof t=="string"?Fa(r,t):t instanceof es?t._internalPath:t._delegate._internalPath}function ef(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new C(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ma{}class Oa extends Ma{}function pn(r,t,...e){let n=[];t instanceof Ma&&n.push(t),n=n.concat(e),(function(i){const a=i.filter((l=>l instanceof La)).length,c=i.filter((l=>l instanceof Vi)).length;if(a>1||a>0&&c>0)throw new C(P.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(n);for(const s of n)r=s._apply(r);return r}class Vi extends Oa{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new Vi(t,e,n)}_apply(t){const e=this._parse(t);return nf(t._query,e),new oe(t.firestore,t.converter,xo(t._query,e))}_parse(t){const e=Ri(t.firestore);return(function(i,a,c,l,d,f,g){let E;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new C(P.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){wl(g,f);const x=[];for(const k of g)x.push(Tl(l,i,k));E={arrayValue:{values:x}}}else E=Tl(l,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||wl(g,f),E=$y(c,a,g,f==="in"||f==="not-in");return H.create(d,f,E)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}function fo(r,t,e){const n=t,s=Pi("where",r);return Vi._create(s,n,e)}class La extends Ma{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new La(t,e)}_parse(t){const e=this._queryConstraints.map((n=>n._parse(t))).filter((n=>n.getFilters().length>0));return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,i){let a=s;const c=i.getFlattenedFilters();for(const l of c)nf(a,l),a=xo(a,l)})(t._query,e),new oe(t.firestore,t.converter,xo(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ba extends Oa{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new Ba(t,e)}_apply(t){const e=(function(s,i,a){if(s.startAt!==null)throw new C(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new C(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ur(i,a)})(t._query,this._field,this._direction);return new oe(t.firestore,t.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new Un(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(t._query,e))}}function bs(r,t="asc"){const e=t,n=Pi("orderBy",r);return Ba._create(n,e)}class Ua extends Oa{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new Ua(t,e,n)}_apply(t){return new oe(t.firestore,t.converter,Xs(t._query,this._limit,this._limitType))}}function Qy(r){return Ng("limit",r),Ua._create("limit",r,"F")}function Tl(r,t,e){if(typeof(e=qt(e))=="string"){if(e==="")throw new C(P.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!xh(t)&&e.indexOf("/")!==-1)throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const n=t.path.child(J.fromString(e));if(!F.isDocumentKey(n))throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Lr(r,new F(n))}if(e instanceof ut)return Lr(r,e._key);throw new C(P.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ci(e)}.`)}function wl(r,t){if(!Array.isArray(r)||r.length===0)throw new C(P.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function nf(r,t){const e=(function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null})(r.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new C(P.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new C(P.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class Wy{convertValue(t,e="none"){switch(Ae(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ne(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw M(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Pe(t,((s,i)=>{n[s]=this.convertValue(i,e)})),n}convertVectorValue(t){const e=t.fields?.[Cn].arrayValue?.values?.map((n=>st(n.doubleValue)));return new Yt(e)}convertGeoPoint(t){return new Xt(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map((n=>this.convertValue(n,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=mi(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Fr(t));default:return null}}convertTimestamp(t){const e=ee(t);return new X(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=J.fromString(t);O(id(n),9688,{name:t});const s=new Ye(n.get(1),n.get(3)),i=new F(n.popFirst(5));return s.isEqual(e)||Pt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function rf(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}class pr{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Qe extends tf{constructor(t,e,n,s,i,a){super(t,e,n,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Bs(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Pi("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new C(P.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Qe._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Qe._jsonSchemaVersion="firestore/documentSnapshot/1.0",Qe._jsonSchema={type:dt("string",Qe._jsonSchemaVersion),bundleSource:dt("string","DocumentSnapshot"),bundleName:dt("string"),bundle:dt("string")};class Bs extends Qe{data(t={}){return super.data(t)}}class We{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new pr(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Bs(this._firestore,this._userDataWriter,n.key,n,new pr(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new C(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((c=>{const l=new Bs(s._firestore,s._userDataWriter,c.doc.key,c.doc,new pr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((c=>i||c.type!==3)).map((c=>{const l=new Bs(s._firestore,s._userDataWriter,c.doc.key,c.doc,new pr(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:Xy(c.type),doc:l,oldIndex:d,newIndex:f}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new C(P.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=We._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Wo.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(e.push(i._document),n.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Xy(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return M(61501,{type:r})}}function Yy(r){r=xt(r,ut);const t=xt(r.firestore,re);return My(ts(t),r._key).then((e=>sf(t,r,e)))}We._jsonSchemaVersion="firestore/querySnapshot/1.0",We._jsonSchema={type:dt("string",We._jsonSchemaVersion),bundleSource:dt("string","QuerySnapshot"),bundleName:dt("string"),bundle:dt("string")};class qa extends Wy{constructor(t){super(),this.firestore=t}convertBytes(t){return new Lt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ut(this.firestore,null,e)}}function lr(r){r=xt(r,oe);const t=xt(r.firestore,re),e=ts(t),n=new qa(t);return ef(r._query),Oy(e,r._query).then((s=>new We(t,n,r,s)))}function Al(r,t,e){r=xt(r,ut);const n=xt(r.firestore,re),s=rf(r.converter,t,e);return Ci(n,[Qd(Ri(n),"setDoc",r._key,s,r.converter!==null,e).toMutation(r._key,yt.none())])}function Rs(r,t,e,...n){r=xt(r,ut);const s=xt(r.firestore,re),i=Ri(s);let a;return a=typeof(t=qt(t))=="string"||t instanceof es?Xd(i,"updateDoc",r._key,t,e,n):Wd(i,"updateDoc",r._key,t),Ci(s,[a.toMutation(r._key,yt.exists(!0))])}function vl(r){return Ci(xt(r.firestore,re),[new Wr(r._key,yt.none())])}function bl(r,...t){r=qt(r);let e={includeMetadataChanges:!1,source:"default"},n=0;typeof t[n]!="object"||El(t[n])||(e=t[n++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(El(t[n])){const l=t[n];t[n]=l.next?.bind(l),t[n+1]=l.error?.bind(l),t[n+2]=l.complete?.bind(l)}let i,a,c;if(r instanceof ut)a=xt(r.firestore,re),c=Hr(r._key.path),i={next:l=>{t[n]&&t[n](sf(a,r,l))},error:t[n+1],complete:t[n+2]};else{const l=xt(r,oe);a=xt(l.firestore,re),c=l._query;const d=new qa(a);i={next:f=>{t[n]&&t[n](new We(a,d,l,f))},error:t[n+1],complete:t[n+2]},ef(r._query)}return(function(d,f,g,E){const R=new Da(E),x=new Pa(f,R,g);return d.asyncQueue.enqueueAndForget((async()=>ba(await ii(d),x))),()=>{R.Nu(),d.asyncQueue.enqueueAndForget((async()=>Ra(await ii(d),x)))}})(ts(a),c,s,i)}function Ci(r,t){return(function(n,s){const i=new Wt;return n.asyncQueue.enqueueAndForget((async()=>vy(await Fy(n),s,i))),i.promise})(ts(r),t)}function sf(r,t,e){const n=e.docs.get(t._key),s=new qa(r);return new Qe(r,s,t._key,n,new pr(e.hasPendingWrites,e.fromCache),t.converter)}class Jy{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=of(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function Zy(r){return new Jy(r)}class tI{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=si.provider,this._offlineComponentProvider={build:e=>new xy(e,t?.cacheSizeBytes,this.forceOwnership)}}}function of(r){return new tI(r?.forceOwnership)}class eI{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ri(t)}set(t,e,n){this._verifyNotCommitted();const s=mo(t,this._firestore),i=rf(s.converter,e,n),a=Qd(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,yt.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=mo(t,this._firestore);let a;return a=typeof(e=qt(e))=="string"||e instanceof es?Xd(this._dataReader,"WriteBatch.update",i._key,e,n,s):Wd(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(a.toMutation(i._key,yt.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=mo(t,this._firestore);return this._mutations=this._mutations.concat(new Wr(e._key,yt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mo(r,t){if((r=qt(r)).firestore!==t)throw new C(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}function nI(r){return ts(r=xt(r,re)),new eI(r,(t=>Ci(r,t)))}(function(t,e=!0){(function(s){Bn=s})(cg),zs(new Sr("firestore",((n,{instanceIdentifier:s,options:i})=>{const a=n.getProvider("app").getImmediate(),c=new re(new vg(n.getProvider("auth-internal")),new Sg(a,n.getProvider("app-check-internal")),(function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new C(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ye(d.options.projectId,f)})(a,s),a);return i={useFetchStreams:e,...i},c._setSettings(i),c}),"PUBLIC").setMultipleInstances(!0)),wn(eu,nu,t),wn(eu,nu,"esm2020")})();let Kt=null,Ss=null,hr=null;const af="firebase_config_cache";function $o(){try{const r=localStorage.getItem(af);if(r){const t=JSON.parse(r);return console.log("[Firebase] Loaded config from localStorage cache"),t}}catch(r){console.warn("[Firebase] Failed to read cached config:",r.message)}return null}function rI(r){try{localStorage.setItem(af,JSON.stringify(r)),console.log("[Firebase] Config cached to localStorage")}catch(t){console.warn("[Firebase] Failed to cache config to localStorage:",t.message)}}async function sI(){if(Kt)return Kt;const r=$o();return r?(Kt=r,Rl().catch(t=>{console.warn("[Firebase] Background config fetch failed, using cached:",t.message)}),r):Rl()}async function Rl(){if(!navigator.onLine){console.log("[Firebase] Offline detected, checking cache...");const r=$o();if(r)return Kt=r,r;throw new Error("Firebase config not available (offline and no cached config)")}try{console.log("[Firebase] Fetching config from backend...");const r=await jf.get("/api/config/firebase",{timeout:5e3});if(r.data.status==="success"&&r.data.config)return Kt=r.data.config,rI(Kt),console.log("[Firebase] Config fetched and cached:",{projectId:Kt.projectId,authDomain:Kt.authDomain}),Kt;throw new Error(r.data.message||"Invalid Firebase config response")}catch(r){console.error("[Firebase] Failed to fetch config from backend:",r.message);const t=$o();if(t)return Kt=t,console.log("[Firebase] Using cached config as fallback"),t;throw new Error("Firebase config not available (offline and no cached config)")}}async function cf(){if(Ss)return Ss;try{const r=await sI();return console.log("[Firebase] Initializing with cached config"),Ss=ql(r),Ss}catch(r){return console.error("[Firebase] Initialization error:",r),null}}async function iI(){if(hr)return hr;const r=await cf();if(!r)return null;try{console.log("[Firebase] Initializing Firestore with offline persistence..."),hr=By(r,{localCache:Zy({tabManager:of()})}),console.log("[Firebase] Firestore initialized with persistent local cache")}catch(t){t.message?.includes("initializeFirestore() has already been called")?(console.log("[Firebase] Firestore already initialized, getting existing instance"),hr=Uy(r)):console.error("[Firebase] Error initializing Firestore:",t.message)}return hr}const oI={get instance(){return iI()}};class kt{static async getFirestore(){const t=await oI.instance;if(!t)throw new Error("Firestore not initialized. Check if Firebase is configured in Laravel .env");return t}static async createSale(t){const e=t.invoice_number;if(!e)throw new Error("invoice_number is required in sale data");try{console.log("[Firebase] Step 1: Getting Firestore instance...");const n=await this.getFirestore();console.log("[Firebase] Step 2: Firestore instance obtained");const s=gn(n,"sales",e),i=navigator.onLine;console.log("[Firebase] Step 3: Creating sale (online: "+i+"):",e);const a={...t,createdAt:X.now(),updatedAt:X.now(),synced:!1,syncedAt:null};if(i)console.log("[Firebase] Step 4B: Online mode - writing to Firebase Cloud..."),await Al(s,a),console.log("[Firebase] Step 5B: Write completed to cloud");else{console.log("[Firebase] Step 4A: Offline mode - initiating write with timeout...");const c=Al(s,a),l=new Promise(f=>{setTimeout(()=>{console.log("[Firebase] Step 5A: Timeout reached - assuming write queued locally"),f("timeout")},500)}),d=await Promise.race([c,l]);console.log(d==="timeout"?"[Firebase] Step 6A: Write assumed queued to offline cache (will sync when online)":"[Firebase] Step 6A: Write completed to local cache")}return console.log("[Firebase] Step 7: Sale created successfully:",e),e}catch(n){throw console.error("[Firebase] ERROR at some step:",n),new Error(n.message||"Failed to create sale in Firebase")}}static async getAllSales(){try{const t=await this.getFirestore(),e=pn(Me(t,"sales"),bs("createdAt","desc")),s=(await lr(e)).docs.map(i=>({id:i.id,firebaseDocId:i.id,...i.data()}));return console.log(`[Firebase] Retrieved ${s.length} sales`),s}catch(t){return console.error("[Firebase] Error getting sales:",t),[]}}static async getUnsyncedSales(){try{const t=await this.getFirestore(),e=pn(Me(t,"sales"),fo("synced","==",!1)),s=(await lr(e)).docs.map(i=>({id:i.id,firebaseDocId:i.id,...i.data()}));return console.log(`[Firebase] Retrieved ${s.length} unsynced sales`),s}catch(t){return console.error("[Firebase] Error getting unsynced sales:",t),[]}}static async getSaleByInvoiceNumber(t){try{const e=await this.getFirestore(),n=gn(e,"sales",t),s=await Yy(n);return s.exists()?{id:s.id,firebaseDocId:s.id,...s.data()}:null}catch(e){return console.error("[Firebase] Error getting sale by invoice number:",e),null}}static async updateSale(t,e){try{const n=await this.getFirestore(),s=gn(n,"sales",t),i=navigator.onLine,a={...e,updatedAt:X.now(),synced:!1};if(i)await Rs(s,a);else{console.log("[Firebase] Offline - updating sale with timeout:",t);const c=Rs(s,a),l=new Promise(d=>setTimeout(()=>d("timeout"),500));await Promise.race([c,l]),console.log("[Firebase] Update queued locally")}console.log("[Firebase] Sale updated:",t)}catch(n){throw console.error("[Firebase] Error updating sale:",n),new Error(n.message||"Failed to update sale in Firebase")}}static async markSaleAsSynced(t){try{const e=await this.getFirestore(),n=gn(e,"sales",t),s=navigator.onLine,i={synced:!0,syncedAt:X.now()};if(s)await Rs(n,i);else{console.log("[Firebase] Offline - marking synced with timeout:",t);const a=Rs(n,i),c=new Promise(l=>setTimeout(()=>l("timeout"),500));await Promise.race([a,c]),console.log("[Firebase] Sync mark queued locally")}console.log("[Firebase] Sale marked as synced:",t)}catch(e){throw console.error("[Firebase] Error marking sale as synced:",e),new Error(e.message||"Failed to mark sale as synced")}}static async deleteSale(t){try{const e=await this.getFirestore(),n=gn(e,"sales",t);if(navigator.onLine)await vl(n);else{console.log("[Firebase] Offline - deleting sale with timeout:",t);const i=vl(n),a=new Promise(c=>setTimeout(()=>c("timeout"),500));await Promise.race([i,a]),console.log("[Firebase] Delete queued locally")}console.log("[Firebase] Sale deleted:",t)}catch(e){throw console.error("[Firebase] Error deleting sale:",e),new Error(e.message||"Failed to delete sale from Firebase")}}static async batchMarkAsSynced(t){try{const e=await this.getFirestore(),n=nI(e);if(t.forEach(i=>{const a=gn(e,"sales",i);n.update(a,{synced:!0,syncedAt:X.now()})}),navigator.onLine)await n.commit();else{console.log("[Firebase] Offline - batch syncing with timeout");const i=n.commit(),a=new Promise(c=>setTimeout(()=>c("timeout"),500));await Promise.race([i,a]),console.log("[Firebase] Batch commit queued locally")}console.log(`[Firebase] Batch marked ${t.length} sales as synced`)}catch(e){throw console.error("[Firebase] Error batch marking sales as synced:",e),new Error(e.message||"Failed to batch mark sales as synced")}}static async onSalesChange(t){try{const e=await this.getFirestore(),n=pn(Me(e,"sales"),bs("createdAt","desc"));return bl(n,s=>{const i=s.docs.map(a=>({id:a.id,firebaseDocId:a.id,...a.data()}));t(i)})}catch(e){return console.error("[Firebase] Error listening to sales changes:",e),()=>{}}}static async onUnsyncedSalesChange(t){try{const e=await this.getFirestore(),n=pn(Me(e,"sales"),fo("synced","==",!1),bs("createdAt","asc"));return bl(n,s=>{const i=s.docs.map(a=>({id:a.id,firebaseDocId:a.id,...a.data()}));t(i)})}catch(e){return console.error("[Firebase] Error listening to unsynced sales changes:",e),()=>{}}}static async getSalesCount(){try{const t=await this.getFirestore();return(await lr(Me(t,"sales"))).size}catch(t){return console.error("[Firebase] Error getting sales count:",t),0}}static async getUnsyncedSalesCount(){try{const t=await this.getFirestore(),e=pn(Me(t,"sales"),fo("synced","==",!1));return(await lr(e)).size}catch(t){return console.error("[Firebase] Error getting unsynced sales count:",t),0}}static async hasSales(){try{return await this.getSalesCount()>0}catch(t){return console.error("[Firebase] Error checking if has sales:",t),!1}}static async getRecentSales(t=10){try{const e=await this.getFirestore(),n=pn(Me(e,"sales"),bs("createdAt","desc"),Qy(t));return(await lr(n)).docs.map(a=>({id:a.id,firebaseDocId:a.id,...a.data()}))}catch(e){return console.error("[Firebase] Error getting recent sales:",e),[]}}}const uf=lt.createContext(null),uI=()=>{const r=lt.useContext(uf);if(!r)throw new Error("useFirebase must be used within FirebaseProvider");return r},lI=({children:r})=>{const[t,e]=lt.useState(!1),[n,s]=lt.useState(!1),[i,a]=lt.useState(0),[c,l]=lt.useState(0),[d,f]=lt.useState(null),[g,E]=lt.useState(!0);lt.useEffect(()=>{(async()=>{try{console.log("[FirebaseContext] Initializing Firebase..."),await cf()?(e(!0),s(!0),console.log("[FirebaseContext] Firebase initialized successfully"),await R()):(f("Failed to initialize Firebase. Check if it is configured in Laravel .env"),console.error("[FirebaseContext] Firebase initialization failed"))}catch(_){console.error("[FirebaseContext] Error initializing Firebase:",_),f(_.message)}finally{E(!1)}})()},[]);const R=lt.useCallback(async()=>{try{const[T,_]=await Promise.all([kt.getSalesCount(),kt.getUnsyncedSalesCount()]);a(T),l(_),console.log(`[FirebaseContext] Sales: ${T}, Unsynced: ${_}`)}catch(T){console.error("[FirebaseContext] Error loading counts:",T)}},[]),x=lt.useCallback(async T=>{try{console.log("[FirebaseContext] Creating sale:",T.invoice_number);const _=await kt.createSale(T);return R().catch(v=>{console.warn("[FirebaseContext] Background count reload failed:",v)}),_}catch(_){throw console.error("[FirebaseContext] Error creating sale:",_),_}},[R]),k=lt.useCallback(async()=>{try{return await kt.getAllSales()}catch(T){return console.error("[FirebaseContext] Error getting all sales:",T),[]}},[]),D=lt.useCallback(async()=>{try{return await kt.getUnsyncedSales()}catch(T){return console.error("[FirebaseContext] Error getting unsynced sales:",T),[]}},[]),z=lt.useCallback(async T=>{try{return await kt.getSaleByInvoiceNumber(T)}catch(_){return console.error("[FirebaseContext] Error getting sale:",_),null}},[]),U=lt.useCallback(async(T,_)=>{try{await kt.updateSale(T,_),await R()}catch(v){throw console.error("[FirebaseContext] Error updating sale:",v),v}},[R]),L=lt.useCallback(async T=>{try{await kt.deleteSale(T),await R()}catch(_){throw console.error("[FirebaseContext] Error deleting sale:",_),_}},[R]),Z=lt.useCallback(async T=>{try{await kt.markSaleAsSynced(T),await R()}catch(_){throw console.error("[FirebaseContext] Error marking sale as synced:",_),_}},[R]),Y=lt.useCallback(async T=>{try{await kt.batchMarkAsSynced(T),await R()}catch(_){throw console.error("[FirebaseContext] Error batch marking as synced:",_),_}},[R]),K=lt.useCallback(async T=>{try{return await kt.onSalesChange(_=>{a(_.length),T(_)})}catch(_){return console.error("[FirebaseContext] Error subscribing to sales changes:",_),()=>{}}},[]),w=lt.useCallback(async T=>{try{return await kt.onUnsyncedSalesChange(_=>{l(_.length),T(_)})}catch(_){return console.error("[FirebaseContext] Error subscribing to unsynced sales changes:",_),()=>{}}},[]),p=lt.useCallback(async(T=10)=>{try{return await kt.getRecentSales(T)}catch(_){return console.error("[FirebaseContext] Error getting recent sales:",_),[]}},[]),I={isInitialized:t,isConnected:n,isLoading:g,error:d,salesCount:i,unsyncedSalesCount:c,createSale:x,getAllSales:k,getUnsyncedSales:D,getSaleByInvoiceNumber:z,updateSale:U,deleteSale:L,markSaleAsSynced:Z,batchMarkAsSynced:Y,subscribeSalesChanges:K,subscribeUnsyncedSalesChanges:w,getRecentSales:p,loadCounts:R};return zf.jsx(uf.Provider,{value:I,children:r})};export{lI as FirebaseProvider,uf as default,uI as useFirebase};

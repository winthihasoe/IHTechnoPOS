import{r as n,e as F,j as U}from"./currencyStore-Dk9RVyyc.js";const M=n.createContext(),z=({children:l,cartType:u="sales_cart",defaultCharges:o=[]})=>{const{cartState:C,addToCart:P,removeFromCart:D,updateProductQuantity:T,emptyCart:_,updateCartItem:A,holdCart:R,setHeldCartToCart:g,removeHeldItem:E}=F(u),[m,s]=n.useState([]),[b,v]=n.useState(0),f=n.useRef(),y=n.useRef();n.useEffect(()=>{const t=JSON.stringify(f.current)!==JSON.stringify(o),e=y.current!==u;if(!t&&!e)return;f.current=o,y.current=u;const a=u==="sales_return_cart",r=Array.isArray(o)?o:[];if(r.length>0){const d=r.map(i=>({...i,id:i.id||`charge_${Math.random()}`,rate_value:a?-Math.abs(i.rate_value):Number(i.rate_value)}));s(d)}else s([])},[o,u]);const w=t=>{s(e=>[...e,{...t,id:t.id||`charge_${Date.now()}`}])},Q=t=>{s(e=>e.filter(a=>a.id!==t))},j=(t,e)=>{s(a=>a.map(r=>r.id===t?{...r,...e}:r))},{cartTotal:c,totalQuantity:I,totalProfit:O}=n.useMemo(()=>C.reduce((t,e)=>{const a=Number(e.quantity),r=Number(e.cost),d=Number(e.price),i=Number(e.discount||0),S=Number(e.flat_discount||0),x=d-i,W=x*a-S,B=(x-r)*a-S;return t.cartTotal+=W,t.totalQuantity+=a,t.totalProfit+=B,t},{cartTotal:0,totalQuantity:0,totalProfit:0}),[C]),h=t=>t.rate_type==="percentage"?Math.abs(c)*Number(t.rate_value)/100:Number(t.rate_value),N=(t,e=b)=>{const a=Math.abs(c),r=Math.max(a-e,0);return t.rate_type==="percentage"?r*Number(t.rate_value)/100:Number(t.rate_value)},$=t=>m.reduce((e,a)=>e+N(a,t),0),p=n.useMemo(()=>m.reduce((t,e)=>t+h(e),0),[m,c]),q=n.useMemo(()=>c+p,[c,p]),H=()=>{_();const t=u==="sales_return_cart",e=Array.isArray(o)?o:[];if(e.length>0){const a=e.map(r=>({...r,id:r.id||`charge_${Math.random()}`,rate_value:t?-Math.abs(r.rate_value):Number(r.rate_value)}));s(a)}else s([]);v(0)},J=()=>{_()};return U.jsx(M.Provider,{value:{cartState:C,cartTotal:c,totalQuantity:I,totalProfit:O,charges:m,totalChargeAmount:p,finalTotal:q,discount:b,setDiscount:v,calculateChargeAmount:h,calculateChargeAmountWithDiscount:N,calculateChargesWithDiscount:$,addCharge:w,removeCharge:Q,updateCharge:j,addToCart:P,removeFromCart:D,updateProductQuantity:T,emptyCart:H,emptyCartItemsOnly:J,updateCartItem:A,holdCart:R,setHeldCartToCart:g,removeHeldItem:E},children:l})},G=()=>{const l=n.useContext(M);if(!l)throw new Error("useSales must be used within a SalesProvider");return l};export{z as S,G as u};

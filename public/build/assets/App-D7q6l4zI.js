import{j as e,r as i,S as z}from"./currencyStore-Dk9RVyyc.js";import{S as H}from"./SalesContext-CG9t8_rq.js";import{AppConfigProvider as $}from"./AppConfigContext-XFUA3Mas.js";import{S as O,u as U,g as y,a as S}from"./SyncContext-DCoP7Jma.js";import{FirebaseProvider as G}from"./FirebaseContext-4dvVdyML.js";import F from"./POS-DDYi5dRl.js";import{i as V}from"./database-DEIbwPOq.js";import{g as W}from"./productsService-Cx6SDGJw.js";import{g as C}from"./chargesService-CCVnmmfA.js";import{B}from"./Box-j1BTqM2v.js";import{C as J}from"./CircularProgress-B97ut0O7.js";import{T as d}from"./Typography-DOI0NvTt.js";import"./folder-open-CJR3uNFI.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./createLucideIcon-BMpC51dL.js";import"./Home-BKek3M8v.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useForkRef-DgOCCfFR.js";import"./useSlotProps-DuznN7Ax.js";import"./useSlot-PFdYD2CN.js";import"./Receipt-DnWIM4Bg.js";import"./ProductItem-BTSm3Xki.js";import"./product-placeholder-DL4NWfZp.js";import"./currencyFormatter-Be2b0Ktm.js";import"./numeral-NHlY-3dw.js";import"./Card-C4NAxgST.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./CardMedia-lO_mnymB.js";import"./CardContent-CCQfyhgH.js";import"./CartItem-CMrvZo7O.js";import"./Delete-DDMcR4JX.js";import"./QuantityInput-GBNfqYnf.js";import"./Add-5ZpxTNJx.js";import"./Remove-6EDtWCFk.js";import"./IconButton-PbvyX_sG.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-9XzpHYrc.js";import"./CartItemModal-DjcGF4YG.js";import"./Close-B9rgBTOR.js";import"./Visibility-BHSl7kaI.js";import"./VisibilityOff-CyahlUox.js";import"./Commission-BSR3AjUX.js";import"./Grid-6qcTmjc4.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./extendSxProp-Co6nc6xJ.js";import"./isMuiElement-HmfyYHhb.js";import"./TextField-DpXyhoD7.js";import"./useFormControl-Cowmrh0y.js";import"./index-CsFzvdgQ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./Grow-D31e1sMI.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-D1QunwiJ.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./InputAdornment-DZOHCUsF.js";import"./DialogContent-Cz4a0t2H.js";import"./DialogTitle-osZsMdGC.js";import"./Chip-DT462TV2.js";import"./Alert-CsOnCL1T.js";import"./Close-kFSrCAJM.js";import"./DialogActions-BraO_KzF.js";import"./Button-aMjmD1gp.js";import"./ListItem-BK8RisGy.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./ListItemAvatar-DpHqHrXm.js";import"./ListItemText--0XI93dL.js";import"./listItemTextClasses-DNpdtY9T.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./MenuItem-CEIQJ6q4.js";import"./listItemIconClasses-vD-ryqxg.js";import"./CartSummary-82bu-hA-.js";import"./CartFooter-Ch7vuF3l.js";import"./FolderCopy-VbOLkKr2.js";import"./ShoppingCart-C6ZMGsLy.js";import"./CheckoutModal-_8yFlqxe.js";import"./sweetalert2.esm.all-q958Q1qq.js";import"./Percent-BCjtx-gP.js";import"./CreditCard-Dwl4hWaF.js";import"./HeldItemsModal-DSqEecKB.js";import"./ListItemButton-DDnSs3En.js";import"./QuotationDialog-ktNyJ0Gs.js";import"./SaleTemplateDialog-C55ih7j2.js";import"./index-JJ5bZ37u.js";import"./SearchBox-CfXbtKPw.js";import"./Search-BJKzt9AK.js";import"./lodash-CwOxCT-R.js";import"./Autocomplete-DfOnEm4b.js";import"./usePreviousProps-Dg0VAGfT.js";import"./Popper-pZx5Iht2.js";import"./CartIcon-aCGUFWsj.js";import"./Badge-DrYGhX8S.js";import"./UnsyncedSalesDialog-DhKj5tMG.js";import"./Print-5v-Lf9Qb.js";import"./Refresh-Be3nBego.js";import"./PrintReceiptModal-Csw0Y3uy.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./download-CxbKlL8J.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./CartItemsTop-DEWWB6nJ.js";import"./Edit-ByvjS5ky.js";import"./MUITimePicker-BanoNu3u.js";import"./en-gb-BMmXCQZs.js";import"./useMobilePicker-BIozrTWd.js";import"./index-P4sNTowN.js";import"./MobileTimePicker-CFR5bNoc.js";import"./FormDialog-k2NLfBwH.js";import"./MUIDatePicker-uF2qI3Qp.js";import"./DatePicker--Uxs9Qj-.js";import"./Tooltip-DjVJzg5-.js";import"./SaleTemplateItems-DtIG-lUv.js";import"./CollectionItem-D_nsMvwI.js";import"./LocalOffer-RDrMQxbC.js";import"./CssBaseline-DBisayGl.js";import"./AppBar-CxLpgr4B.js";import"./Toolbar-f3-_dlD0.js";import"./Link-2ACJKGF0.js";import"./Drawer-Dk2A_cxp.js";import"./import-wrapper-prod-jq4Om1Jp.js";const X=[{id:1,name:"Walk-in Customer",balance:0},{id:2,name:"John Doe",balance:1000.5},{id:3,name:"Jane Smith",balance:-500.25},{id:4,name:"Bob Wilson",balance:250}],Y=[{id:1,name:"VAT 10%",charge_type:"tax",rate_value:10,rate_type:"percentage",is_active:!0,is_default:!0}],K=[{id:1,name:"Electronics",collection_type:"category"},{id:2,name:"Accessories",collection_type:"category"}],I=[{id:"1",name:"Laptop Dell XPS 15",sku:"DELL-XPS-15",barcode:"1234567890",price:1500,cost:1e3,quantity:10,stock_quantity:10,batch_number:"BATCH001",batch_id:"B1",is_stock_managed:1,product_type:"simple",image_url:null,category_id:1,is_featured:1,discount:0,discount_percentage:0},{id:"2",name:"iPhone 15 Pro",sku:"IPHONE-15-PRO",barcode:"0987654321",price:999,cost:700,quantity:15,stock_quantity:15,batch_number:"BATCH002",batch_id:"B2",is_stock_managed:1,product_type:"simple",image_url:null,category_id:1,is_featured:1,discount:0,discount_percentage:0},{id:"3",name:"Samsung Galaxy S24",sku:"SAMSUNG-S24",barcode:"5678901234",price:850,cost:600,quantity:20,stock_quantity:20,batch_number:"BATCH003",batch_id:"B3",is_stock_managed:1,product_type:"simple",image_url:null,category_id:1,is_featured:0,discount:50,discount_percentage:5.88},{id:"4",name:'MacBook Pro 16"',sku:"MBP-16",barcode:"4567890123",price:2400,cost:1800,quantity:5,stock_quantity:5,batch_number:"BATCH004",batch_id:"B4",is_stock_managed:1,product_type:"simple",image_url:null,category_id:1,is_featured:1,discount:0,discount_percentage:0},{id:"5",name:"Wireless Mouse",sku:"MOUSE-001",barcode:"3456789012",price:25,cost:10,quantity:50,stock_quantity:50,batch_number:"BATCH005",batch_id:"B5",is_stock_managed:1,product_type:"simple",image_url:null,category_id:2,is_featured:0,discount:0,discount_percentage:0}];function Q(){const{syncState:c,startSync:u,loadLastSyncInfo:b}=U(),[w,m]=i.useState([]),[T,l]=i.useState([]),[D,g]=i.useState(X),[R,f]=i.useState(Y),[P,h]=i.useState(K),[q,v]=i.useState(!0),[E,M]=i.useState(null),N=i.useCallback(async p=>{m(p);const a=p.filter(t=>t.is_featured===!0||t.is_featured===1);l(a);try{const[t,o,r]=await Promise.all([C(),y(),S()]);t.length>0&&(f(t),console.log(`âœ… Reloaded ${t.length} charges after sync`)),o.length>0&&(h(o),console.log(`âœ… Reloaded ${o.length} collections after sync`)),r.length>0&&(g(r),console.log(`âœ… Reloaded ${r.length} customers after sync`))}catch(t){console.error("âŒ Error reloading data after sync:",t)}},[]);return i.useEffect(()=>{async function p(){try{if(!await V())throw new Error("Failed to initialize database");const[t,o,r,n]=await Promise.all([W(),C(),y(),S()]);if(t.length>0){m(t);const s=t.filter(_=>_.is_featured===!0||_.is_featured===1);l(s),console.log(`âœ… Loaded ${t.length} products from Dexie (${s.length} featured)`)}else console.log("â„¹ï¸ No cached products found, will sync from server");o.length>0?(f(o),console.log(`âœ… Loaded ${o.length} charges from Dexie`)):console.log("â„¹ï¸ No cached charges found, will sync from server"),r.length>0?(h(r),console.log(`âœ… Loaded ${r.length} collections from Dexie`)):console.log("â„¹ï¸ No cached collections found, will sync from server"),n.length>0?(g(n),console.log(`âœ… Loaded ${n.length} customers from Dexie`)):console.log("â„¹ï¸ No cached customers found, will sync from server"),await b(),(t.length===0||o.length===0||r.length===0||n.length===0)&&(console.log("ðŸ”„ Starting background sync (missing data detected)..."),await u(async s=>{m(s);const _=s.filter(L=>L.is_featured===!0||L.is_featured===1);l(_);const[A,k,j]=await Promise.all([C(),y(),S()]);A.length>0&&f(A),k.length>0&&h(k),j.length>0&&g(j)})),v(!1)}catch(a){console.error("âŒ Initialization error:",a),M(a.message),m(I);const t=I.filter(o=>o.is_featured===1);l(t),v(!1)}}p()},[u,b]),i.useEffect(()=>{const a=setInterval(async()=>{if(navigator.onLine&&c.status!=="syncing"){console.log("ðŸ”„ Periodic background sync triggered...");try{await u(async t=>{m(t);const o=t.filter(s=>s.is_featured===!0||s.is_featured===1);l(o);const[r,n,x]=await Promise.all([C(),y(),S()]);r.length>0&&f(r),n.length>0&&h(n),x.length>0&&g(x),console.log("âœ… Periodic sync completed")})}catch(t){console.error("âŒ Periodic sync error:",t)}}},3e5);return()=>clearInterval(a)},[u]),q?e.jsxs(B,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:2},children:[e.jsx(J,{size:60}),e.jsx(d,{variant:"h6",color:"text.secondary",children:c.status==="syncing"?c.message:"Initializing..."}),c.status==="syncing"&&e.jsxs(d,{variant:"body2",color:"text.secondary",children:[c.progress,"% complete"]})]}):E?e.jsxs(B,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:2,p:3},children:[e.jsx(d,{variant:"h5",color:"error",children:"Initialization Error"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:E}),e.jsx(d,{variant:"body2",color:"text.secondary",children:"Using sample data for testing"})]}):e.jsx($,{children:e.jsx(z,{children:e.jsx(H,{defaultCharges:R,children:e.jsx(F,{products:T,allProducts:w,customers:D,categories:P,all_collections:P,return_sale:!1,edit_sale:!1,sale_id:null,onProductsUpdate:N})})})})}function Io(){return e.jsx(O,{children:e.jsx(G,{children:e.jsx(Q,{})})})}export{Io as default};

import{j as t,c as D,r as i,H as G,L as h,a as K,b as R}from"./currencyStore-Dk9RVyyc.js";import{A as U}from"./AuthenticatedLayout-CblcNqH9.js";import{A as J}from"./Add-5ZpxTNJx.js";import{c as _}from"./createSvgIcon-B7q9zImx.js";import{H as X}from"./History-D6bprVsV.js";import Y from"./BatchModal-COABRYv3.js";import Z from"./QuantityModal-CRhSCbRi.js";import{C as tt}from"./CustomPagination-DIeBJN57.js";import{n as v}from"./numeral-NHlY-3dw.js";import{S as et}from"./react-select.esm-Cy0FGMM3.js";import{S as N}from"./sweetalert2.esm.all-q958Q1qq.js";import{u as rt}from"./index-JJ5bZ37u.js";import{P as ot,B as it}from"./ProductsList-DxMvKADo.js";import{u as at}from"./useTheme-CvovRv7W.js";import{G as s}from"./Grid-6qcTmjc4.js";import{T as j}from"./TextField-DpXyhoD7.js";import{M as c}from"./MenuItem-CEIQJ6q4.js";import{B as S}from"./Button-aMjmD1gp.js";import{B as q}from"./Box-j1BTqM2v.js";import{C as L}from"./Chip-DT462TV2.js";import{I as st}from"./IconButton-PbvyX_sG.js";import{C as lt}from"./CircularProgress-B97ut0O7.js";import{D as nt}from"./DataGrid-CyDBJMLY.js";import"./Payments-DSgOMdsa.js";import"./Receipt-DnWIM4Bg.js";import"./index-RHigu7j0.js";import"./index-NgBaJJmW.js";import"./infoshop-hkdJrh2a.js";import"./Toolbar-f3-_dlD0.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./ListItemButton-DDnSs3En.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./listItemIconClasses-vD-ryqxg.js";import"./ListItemText--0XI93dL.js";import"./listItemTextClasses-DNpdtY9T.js";import"./useSlot-PFdYD2CN.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./Collapse-CHgnjEwQ.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./CssBaseline-DBisayGl.js";import"./AppBar-CxLpgr4B.js";import"./Paper-Df0ljdBt.js";import"./Tooltip-DjVJzg5-.js";import"./index-DM5RHFVd.js";import"./useControlled-DRAJCB75.js";import"./useId-9XzpHYrc.js";import"./Grow-D31e1sMI.js";import"./Popper-pZx5Iht2.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-DuznN7Ax.js";import"./Drawer-Dk2A_cxp.js";import"./mergeSlotProps-D_PRovB-.js";import"./debounce-Be36O1Ab.js";import"./ownerWindow-HkKU3E4x.js";import"./Modal-D1QunwiJ.js";import"./ListItem-BK8RisGy.js";import"./isMuiElement-HmfyYHhb.js";import"./Close-B9rgBTOR.js";import"./DialogContent-Cz4a0t2H.js";import"./DialogTitle-osZsMdGC.js";import"./FormControlLabel-eGygXIaI.js";import"./useFormControl-Cowmrh0y.js";import"./Switch-DzXzblLj.js";import"./SwitchBase-DLVdjlNh.js";import"./DialogActions-BraO_KzF.js";import"./Select-ef7c0426.esm-CXaJakO2.js";import"./toPropertyKey-C9c9JG92.js";import"./floating-ui.dom-CpMS8hwT.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./select-DF-qibkA.js";import"./tslib.es6-BUas5LQb.js";import"./utils-NikRBbYi.js";import"./chevron-down-C5MZ1frv.js";import"./createLucideIcon-BMpC51dL.js";import"./chevron-right-BAlzn6w9.js";import"./currencyFormatter-Be2b0Ktm.js";import"./index-P4sNTowN.js";import"./with-selector-Bw9PUS5X.js";import"./Badge-DrYGhX8S.js";import"./usePreviousProps-Dg0VAGfT.js";import"./Autocomplete-DfOnEm4b.js";import"./Close-kFSrCAJM.js";import"./KeyboardArrowRight-C0as7Qna.js";import"./TableCell-DMEjcBPA.js";import"./Checkbox-DmEdO0Ay.js";import"./InputAdornment-DZOHCUsF.js";const dt=_(t.jsx("path",{d:"M15 21h-2v-2h2zm-2-7h-2v5h2zm8-2h-2v4h2zm-2-2h-2v2h2zM7 12H5v2h2zm-2-2H3v2h2zm7-5h2V3h-2zm-7.5-.5v3h3v-3zM9 9H3V3h6zm-4.5 7.5v3h3v-3zM9 21H3v-6h6zm7.5-16.5v3h3v-3zM21 9h-6V3h6zm-2 10v-3h-4v2h2v3h4v-2zm-2-7h-4v2h4zm-4-2H7v2h2v2h2v-2h2zm1-1V7h-2V5h-2v4zM6.75 5.25h-1.5v1.5h1.5zm0 12h-1.5v1.5h1.5zm12-12h-1.5v1.5h1.5z"})),mt=_(t.jsx("path",{d:"M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"})),ct=_(t.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"})),ut=(f,x,g)=>[{field:"image_url",headerName:"Image",width:100,renderCell:r=>r.value?t.jsx("img",{src:r.value,style:{width:"75px",height:"51px",objectFit:"cover",padding:"5px",paddingBottom:"5px",paddingLeft:"0"},alt:"Product Image",loading:"lazy"}):t.jsx("span",{style:{width:"100%",height:"100%",objectFit:"cover",padding:"5px",paddingBottom:"5px",paddingLeft:"0"},className:"text-center",children:"No Image"})},{field:"name",headerName:"Product Name",width:200,renderCell:r=>t.jsx(h,{underline:"hover",className:"hover:underline",href:"/products/"+r.row.id+"/edit",children:t.jsx("p",{className:"font-bold",children:r.value})})},{field:"contact_name",headerName:"Supplier",width:100},{field:"barcode",headerName:"Barcode",width:170},{field:"batch_number",headerName:"Batch",width:120,renderCell:r=>t.jsx(S,{onClick:()=>f(r.row,"batch"),variant:"text",fullWidth:!0,sx:{textAlign:"left",fontWeight:"bold",justifyContent:"flex-start"},children:r.value})},{field:"cost",headerName:"Cost",width:100,align:"right",headerAlign:"right"},{field:"price",headerName:"Price",width:100,align:"right",headerAlign:"right",renderCell:r=>v(r.value).format("0,0.00")},{field:"valuation",headerName:"Valuation",width:100,align:"right",headerAlign:"right",renderCell:r=>{const l=r.row.cost,y=r.row.quantity;return v(l*y).format("0,0.00")}},{field:"quantity",headerName:"Qty",width:90,align:"right",headerAlign:"right",valueGetter:r=>parseFloat(r),renderCell:r=>t.jsx(S,{variant:"text",color:"default",fullWidth:!0,sx:{textAlign:"right",fontWeight:"bold",justifyContent:"flex-end"},underline:"hover",onClick:()=>f(r.row,"qty"),children:v(r.value).format("0,0.00")})},{field:"action",headerName:"Action",align:"center",headerAlign:"center",width:200,renderCell:r=>t.jsxs(q,{sx:{display:"flex",gap:1,justifyContent:"center",alignItems:"center",flexWrap:"nowrap"},children:[t.jsx(h,{href:`/product/${r.row.batch_id}/barcode`,children:t.jsx(dt,{color:"primary"})}),t.jsx(h,{href:`/product/${r.row.batch_id}/barcode-v2`,children:t.jsx(it,{size:24,stroke:"#1976d2"})}),t.jsx(h,{href:`/quantity/${r.row.stock_id}/log`,children:t.jsx(X,{color:"primary"})})]})},{field:"is_featured",headerName:"Featured",headerAlign:"center",renderCell:r=>{const l=g===r.row.batch_id;return t.jsx(st,{size:"small",disabled:l,onClick:()=>!l&&x(r.row.batch_id,r.value===1),children:l?t.jsx(lt,{size:24}):r.value===1?t.jsx(mt,{color:"primary"}):t.jsx(ct,{color:"primary"})})}}];function mr({products:f,stores:x,contacts:g}){const r=at(),l=rt(r.breakpoints.down("sm"));D().props.auth.user;const[y,P]=i.useState(!1),[k,I]=i.useState(!1),[z,M]=i.useState(null),[F,O]=i.useState(null),[n,b]=i.useState(f),[T,pt]=i.useState(g),[W,V]=i.useState(0),[H,B]=i.useState(null),[ht,ft]=i.useState(!1),[m,w]=i.useState(()=>({store:0,status:new URLSearchParams(window.location.search).get("status")||1,search_query:"",alert_quantity:"",per_page:100,contact_id:""})),A=(e,a)=>{if(a==="batch"){const o=n.data.find(d=>d.id===e.id);M(e),O(o),P(!0)}else a==="qty"&&(M(e),I(!0))},Q=async(e,a)=>{B(e);try{const o=await R.post(`/productbatch/${e}/toggle-featured`);o.data.success&&(b(d=>({...d,data:d.data.map(C=>C.batch_id===e?{...C,is_featured:o.data.is_featured?1:0}:C)})),N.fire({icon:"success",title:o.data.message,position:"bottom",toast:!0,timer:1500,showConfirmButton:!1}))}catch(o){N.fire({icon:"error",title:o.response?.data?.message||"Failed to toggle featured status",position:"bottom",toast:!0,timer:1500,showConfirmButton:!1})}finally{B(null)}},u=(e=window.location.pathname)=>{const a=typeof e=="string"?e:window.location.pathname,o={preserveState:!0,preserveScroll:!0,only:["products"],onSuccess:d=>{b(d.props.products)}};K.get(a,{...m},o)},p=e=>{if(e?.target){const{name:a,value:o}=e.target;w(d=>({...d,[a]:o}))}else w(a=>({...a,contact_id:e?.id}))};i.useEffect(()=>{const e=Object.values(n.data).reduce((a,o)=>a+o.cost*o.quantity,0);V(e)},[n]);const[E,$]=i.useState(!1);return i.useEffect(()=>{if(!E){$(!0);return}u(window.location.pathname)},[m]),t.jsxs(U,{children:[t.jsx(G,{title:"Products"}),t.jsxs(s,{container:!0,spacing:1,alignItems:"center",children:[t.jsxs(s,{size:12,spacing:1,container:!0,alignItems:"center",justifyContent:{xs:"center",sm:"end"},children:[t.jsx(s,{size:{xs:12,sm:3,md:2},children:t.jsxs(j,{value:m.store,label:"Store",onChange:p,required:!0,name:"store",select:!0,fullWidth:!0,margin:"dense",size:"small",children:[t.jsx(c,{value:0,children:"All"}),x.map(e=>t.jsx(c,{value:e.id,children:e.name},e.id))]})}),t.jsx(s,{size:{xs:12,sm:4,md:3},children:t.jsx(et,{fullWidth:!0,placeholder:"Select a supplier...",styles:{control:(e,a)=>({...e,height:"40px"}),menuPortal:e=>({...e,zIndex:9999})},options:g,onChange:e=>p(e),isClearable:!0,getOptionLabel:e=>e.name+" | "+e.balance,getOptionValue:e=>e.id,menuPortalTarget:document.body})}),t.jsx(s,{size:{xs:6,sm:2},children:t.jsxs(j,{value:m.status,label:"Status",size:"small",onChange:p,required:!0,name:"status",fullWidth:!0,select:!0,margin:"dense",children:[t.jsx(c,{value:1,children:"Active"}),t.jsx(c,{value:0,children:"Inactive"}),t.jsx(c,{value:"alert",children:"Alert"}),t.jsx(c,{value:"out_of_stock",children:"Out of Stock"})]})}),t.jsx(s,{size:{xs:6,sm:2,md:2},children:t.jsx(j,{value:m.alert_quantity,label:"Alert Qty",size:"small",onChange:p,placeholder:"Alert Qty",name:"alert_quantity",type:"number",slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(s,{size:{xs:12,sm:3,md:3},children:t.jsx(j,{fullWidth:!0,name:"search_query",label:"Search",size:"small",variant:"outlined",value:m.search_query,onChange:p,placeholder:"Barcode or Name",onFocus:e=>{e.target.select()},onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),u(window.location.pathname))},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(s,{size:{xs:9,sm:3,md:2},children:t.jsx(h,{href:"/products/create",children:t.jsx(S,{size:"small",variant:"contained",color:"success",startIcon:t.jsx(J,{}),fullWidth:!0,sx:{minWidth:{xs:"100px",sm:"100px"}},children:"Add Product"})})})]}),!l&&t.jsx(q,{className:"py-2 w-full",sx:{display:"grid",gridTemplateColumns:"1fr",height:"calc(100vh - 290px)"},children:t.jsx(nt,{rows:n.data,columns:ut(A,Q,H),getRowId:e=>e.id+e.batch_number+e.store_id,slotProps:{toolbar:{showQuickFilter:!0}},initialState:{columns:{columnVisibilityModel:{cost:!1,created_at:!1}}},showToolbar:!0,hideFooter:!0})}),l&&t.jsx(ot,{products:n.data,handleProductEdit:A}),t.jsxs(s,{size:12,spacing:2,container:!0,justifyContent:"end",alignItems:"center",children:[t.jsx(L,{size:"large",label:"Total results : "+n.total,color:"primary"}),t.jsx(L,{size:"large",label:"Total valuation : "+v(W).format("0,00.00"),color:"primary"}),t.jsx(tt,{refreshTable:u,setSearchTerms:w,searchTerms:m,data:n})]})]}),t.jsx(Y,{batchModalOpen:y,setBatchModalOpen:P,selectedBatch:z,selectedProduct:F,contacts:T,refreshProducts:u,initialIsNew:!z}),t.jsx(Z,{modalOpen:k,setModalOpen:I,selectedStock:z,products:n.data,setProducts:b,refreshProducts:u,stores:x})]})}export{mr as default};

import{r as p,g as w,f as M,j as t,R as O}from"./currencyStore-Dk9RVyyc.js";import{C as U}from"./Close-B9rgBTOR.js";import{V}from"./Visibility-BHSl7kaI.js";import{V as N}from"./VisibilityOff-CyahlUox.js";import{useAppConfig as B}from"./AppConfigContext-XFUA3Mas.js";import{u as Y}from"./SalesContext-CG9t8_rq.js";import G from"./Commission-BSR3AjUX.js";import{D as Q,a as $}from"./DialogContent-Cz4a0t2H.js";import{D as H}from"./DialogTitle-osZsMdGC.js";import{C as J}from"./Chip-DT462TV2.js";import{I as z}from"./IconButton-PbvyX_sG.js";import{G as s}from"./Grid-6qcTmjc4.js";import{T as a}from"./TextField-DpXyhoD7.js";import{I as l}from"./InputAdornment-DZOHCUsF.js";import{A as K}from"./Alert-CsOnCL1T.js";import{D as X}from"./DialogActions-BraO_KzF.js";import{B as k}from"./Button-aMjmD1gp.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./useTheme-CvovRv7W.js";import"./useSlot-PFdYD2CN.js";import"./useForkRef-DgOCCfFR.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useId-9XzpHYrc.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./CircularProgress-B97ut0O7.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./Close-kFSrCAJM.js";function Xt(){const{return_sale:C,misc_settings:f}=B(),F=f?.cart_first_focus,[d,v]=p.useState(!1),m=w(i=>i.settings.currency_symbol),A=()=>v(i=>!i),x=p.useRef(null),{updateCartItem:y}=Y(),{cartItemModalOpen:W,setCartItemModalOpen:P,selectedCartItem:b,setSelectedCartItem:I}=p.useContext(M),[e,g]=p.useState([]),h=()=>{I(null),g([]),v(!1),P(!1)},R=async i=>{if(i.preventDefault(),C){const n={...e,quantity:-Math.abs(e.quantity)};y(n)}else y(e);h()};p.useEffect(()=>{b&&g(b)},[b]);const r=i=>{const{name:n,value:u}=i.target;g(T=>{let o={...T};n==="quantity"&&u===""&&(o.quantity=0),n==="fixed_commission"?o.meta_data={...o.meta_data,fixed_commission:u}:o[n]=u;const j=parseFloat(o.price)||0;if(n==="discount"){const c=parseFloat(u)||0;o.discount_percentage=(c/j*100).toFixed(2)}else if(n==="price")o.discount=parseFloat(o.discount)||0,o.discount_percentage=(o.discount/j*100).toFixed(2);else if(n==="discount_percentage"){const c=parseFloat(u)||0;o.discount=(c/100*j).toFixed(2)}if(o.product_type==="commission"){const c=parseFloat(o.meta_data?.fixed_commission)||0,_=parseFloat(o.price)||0;o.cost=_-c}if(o.product_type==="reload"){const c=parseFloat(o.meta_data?.fixed_commission)||0,_=parseFloat(o.price)||0,S=parseFloat(o.additional_commission)||0,q=parseFloat(o.extra_commission)||0,D=(_-S)*c/100,L=S+q+D;if(o.extra_commission=q,o.commission=L,n==="price"||n==="fixed_commission"||n==="extra_commission"||n==="additional_commission"){const E=parseFloat(o.price)-parseFloat(o.commission)||0;o.cost=E}}return o})};return t.jsx(O.Fragment,{children:t.jsxs(Q,{fullWidth:!0,maxWidth:"sm",open:W,disableRestoreFocus:!0,disableEnforceFocus:!0,onClose:h,"aria-labelledby":"alert-dialog-title",component:"form",onSubmit:R,slotProps:{backdrop:{onTransitionEnd:()=>{x.current&&x.current.focus()}}},"aria-describedby":"dialog-description",children:[t.jsx(H,{id:"alert-dialog-title",children:t.jsxs("div",{children:[t.jsx("span",{className:"mr-1.5",children:e.name}),e.stock_quantity&&e.product_type!=="reload"&&e.stock_quantity!==""?t.jsx(J,{inert:!0,disableElevation:!0,color:parseFloat(e.stock_quantity)<=0?"error":parseFloat(e.stock_quantity)<=parseFloat(e.alert_quantity)?"warning":"primary",size:"small",label:`QTY. ${e.stock_quantity}`}):""]})}),t.jsx(z,{"aria-label":"close",onClick:h,sx:i=>({position:"absolute",right:8,top:8,color:i.palette.grey[500]}),children:t.jsx(U,{})}),t.jsxs($,{children:[t.jsxs(s,{container:!0,spacing:2,children:[t.jsx("input",{type:"hidden",name:"batch_number",value:e.batch_number,onChange:r,inert:!0}),t.jsx("input",{type:"hidden",name:"name",value:e.name,onChange:r,inert:!0}),t.jsx("input",{type:"hidden",name:"id",value:e.id,onChange:r,inert:!0}),t.jsx(s,{size:6,children:e.product_type!=="reload"?t.jsx(a,{fullWidth:!0,type:"number",name:"quantity",label:"Quantity",variant:"outlined",value:e.quantity,onChange:i=>{const n=i.target.value,u=parseFloat(n);r({target:{name:"quantity",value:C&&u>0?-u:u}})},inputRef:F==="quantity"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}}):t.jsx(a,{fullWidth:!0,type:"text",name:"account_number",label:"Account Number",variant:"outlined",value:e.account_number,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},autoFocus:!0,required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(s,{size:6,children:t.jsx(a,{fullWidth:!0,type:"number",name:"price",label:"Price",variant:"outlined",required:!0,value:e.price,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="commission"&&t.jsx(G,{handleChange:r,formState:e}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"additional_commission",label:"Customer Commission",variant:"outlined",required:!0,value:e.additional_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"extra_commission",label:"Extra Commission",variant:"outlined",required:!0,value:e.extra_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"fixed_commission",label:"Fixed Commission",variant:"outlined",required:!0,value:e.meta_data.fixed_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})}),e.product_type==="reload"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"reload",label:"Reload amount",variant:"outlined",required:!0,value:e.price-e.additional_commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem",fontWeight:"bold"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})}),t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"commission",label:"Total Commission",variant:"outlined",required:!0,value:e.commission,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})})]}),e.product_type==="simple"&&t.jsxs(t.Fragment,{children:[f.enable_flat_item_discount==="yes"&&t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"flat_discount",label:"Flat Discount",variant:"outlined",required:!0,value:e.flat_discount??0,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),f.enable_unit_discount==="yes"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount",label:"Unit Discount",variant:"outlined",required:!0,value:e.discount,onChange:r,inputRef:F==="discount"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount_percentage",label:"Unit Discount (%)",variant:"outlined",required:!0,value:e.discount_percentage||0,onChange:r,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})})]})]}),t.jsx(s,{size:{sm:12,xs:12,md:4},children:t.jsx(a,{fullWidth:!0,type:d?"number":"text",style:{WebkitTextSecurity:d?"none":"disc",MozTextSecurity:d?"none":"disc",msTextSecurity:d?"none":"disc"},disabled:!d,name:"cost",label:"Cost",variant:"outlined",required:!0,onChange:r,value:e.cost,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{readOnly:e.product_type==="reload",startAdornment:t.jsx(l,{position:"start",children:m}),endAdornment:t.jsx(l,{position:"end",children:t.jsx(z,{"aria-label":"toggle cost visibility",onClick:A,edge:"end",children:d?t.jsx(N,{}):t.jsx(V,{})})})}}})})]}),e.price-e.discount<e.cost&&t.jsxs(K,{severity:"error",sx:{mt:2},children:["Selling at a ",t.jsx("b",{children:"lower price"}),". Please be cautious."]})]}),t.jsx(X,{children:t.jsxs(s,{container:!0,spacing:1,size:12,justifyContent:"center",width:"100%",children:[e.quantity>0&&t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"button",color:"error",onClick:i=>{const n={...e,quantity:-Math.abs(e.quantity)};y(n),h()},children:"RETURN"})}),t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"submit",color:e.quantity<0?"error":"primary",children:e.quantity<0?"RETURN":"UPDATE"})})]})})]})})}export{Xt as default};

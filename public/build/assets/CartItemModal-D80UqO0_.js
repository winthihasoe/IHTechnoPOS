import{c as w,r as p,g as M,f as O,j as t,R as U}from"./currencyStore-Dk9RVyyc.js";import{C as V}from"./Close-B9rgBTOR.js";import{V as N}from"./Visibility-BHSl7kaI.js";import{V as B}from"./VisibilityOff-CyahlUox.js";import{u as Y}from"./SalesContext-CG9t8_rq.js";import G from"./Commission-TQHH1o-V.js";import{D as Q,a as $}from"./DialogContent-Cz4a0t2H.js";import{D as H}from"./DialogTitle-osZsMdGC.js";import{C as J}from"./Chip-DT462TV2.js";import{I as z}from"./IconButton-PbvyX_sG.js";import{G as s}from"./Grid-6qcTmjc4.js";import{T as a}from"./TextField-DpXyhoD7.js";import{I as l}from"./InputAdornment-DZOHCUsF.js";import{A as K}from"./Alert-CsOnCL1T.js";import{D as X}from"./DialogActions-BraO_KzF.js";import{B as k}from"./Button-aMjmD1gp.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./useTheme-CvovRv7W.js";import"./useSlot-PFdYD2CN.js";import"./useForkRef-DgOCCfFR.js";import"./Paper-Df0ljdBt.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useId-9XzpHYrc.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./CircularProgress-B97ut0O7.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./Close-kFSrCAJM.js";function Kt(){const{return_sale:_,cart_first_focus:C,misc_settings:F}=w().props??{},[d,v]=p.useState(!1),m=M(i=>i.settings.currency_symbol),A=()=>v(i=>!i),x=p.useRef(null),{updateCartItem:f}=Y(),{cartItemModalOpen:W,setCartItemModalOpen:P,selectedCartItem:y,setSelectedCartItem:I}=p.useContext(O),[e,b]=p.useState([]),h=()=>{I(null),b([]),v(!1),P(!1)},R=async i=>{if(i.preventDefault(),_){const n={...e,quantity:-Math.abs(e.quantity)};f(n)}else f(e);h()};p.useEffect(()=>{y&&b(y)},[y]);const o=i=>{const{name:n,value:u}=i.target;b(T=>{let r={...T};n==="quantity"&&u===""&&(r.quantity=0),n==="fixed_commission"?r.meta_data={...r.meta_data,fixed_commission:u}:r[n]=u;const g=parseFloat(r.price)||0;if(n==="discount"){const c=parseFloat(u)||0;r.discount_percentage=(c/g*100).toFixed(2)}else if(n==="price")r.discount=parseFloat(r.discount)||0,r.discount_percentage=(r.discount/g*100).toFixed(2);else if(n==="discount_percentage"){const c=parseFloat(u)||0;r.discount=(c/100*g).toFixed(2)}if(r.product_type==="commission"){const c=parseFloat(r.meta_data?.fixed_commission)||0,j=parseFloat(r.price)||0;r.cost=j-c}if(r.product_type==="reload"){const c=parseFloat(r.meta_data?.fixed_commission)||0,j=parseFloat(r.price)||0,S=parseFloat(r.additional_commission)||0,q=parseFloat(r.extra_commission)||0,D=(j-S)*c/100,L=S+q+D;if(r.extra_commission=q,r.commission=L,n==="price"||n==="fixed_commission"||n==="extra_commission"||n==="additional_commission"){const E=parseFloat(r.price)-parseFloat(r.commission)||0;r.cost=E}}return r})};return t.jsx(U.Fragment,{children:t.jsxs(Q,{fullWidth:!0,maxWidth:"sm",open:W,disableRestoreFocus:!0,disableEnforceFocus:!0,onClose:h,"aria-labelledby":"alert-dialog-title",component:"form",onSubmit:R,slotProps:{backdrop:{onTransitionEnd:()=>{x.current&&x.current.focus()}}},"aria-describedby":"dialog-description",children:[t.jsx(H,{id:"alert-dialog-title",children:t.jsxs("div",{children:[t.jsx("span",{className:"mr-1.5",children:e.name}),e.stock_quantity&&e.product_type!=="reload"&&e.stock_quantity!==""?t.jsx(J,{inert:!0,disableElevation:!0,color:parseFloat(e.stock_quantity)<=0?"error":parseFloat(e.stock_quantity)<=parseFloat(e.alert_quantity)?"warning":"primary",size:"small",label:`QTY. ${e.stock_quantity}`}):""]})}),t.jsx(z,{"aria-label":"close",onClick:h,sx:i=>({position:"absolute",right:8,top:8,color:i.palette.grey[500]}),children:t.jsx(V,{})}),t.jsxs($,{children:[t.jsxs(s,{container:!0,spacing:2,children:[t.jsx("input",{type:"hidden",name:"batch_number",value:e.batch_number,onChange:o,inert:!0}),t.jsx("input",{type:"hidden",name:"name",value:e.name,onChange:o,inert:!0}),t.jsx("input",{type:"hidden",name:"id",value:e.id,onChange:o,inert:!0}),t.jsx(s,{size:6,children:e.product_type!=="reload"?t.jsx(a,{fullWidth:!0,type:"number",name:"quantity",label:"Quantity",variant:"outlined",value:e.quantity,onChange:i=>{const n=i.target.value,u=parseFloat(n);o({target:{name:"quantity",value:_&&u>0?-u:u}})},inputRef:C==="quantity"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}}):t.jsx(a,{fullWidth:!0,type:"text",name:"account_number",label:"Account Number",variant:"outlined",value:e.account_number,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},autoFocus:!0,required:!0,onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0}}})}),t.jsx(s,{size:6,children:t.jsx(a,{fullWidth:!0,type:"number",name:"price",label:"Price",variant:"outlined",required:!0,value:e.price,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="commission"&&t.jsx(G,{handleChange:o,formState:e}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"additional_commission",label:"Customer Commission",variant:"outlined",required:!0,value:e.additional_commission,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"extra_commission",label:"Extra Commission",variant:"outlined",required:!0,value:e.extra_commission,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),e.product_type==="reload"&&t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"fixed_commission",label:"Fixed Commission",variant:"outlined",required:!0,value:e.meta_data.fixed_commission,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})}),e.product_type==="reload"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"reload",label:"Reload amount",variant:"outlined",required:!0,value:e.price-e.additional_commission,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem",fontWeight:"bold"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})}),t.jsx(s,{size:4,children:t.jsx(a,{fullWidth:!0,type:"number",name:"commission",label:"Total Commission",variant:"outlined",required:!0,value:e.commission,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m}),readOnly:!0}}})})]}),e.product_type==="simple"&&t.jsxs(t.Fragment,{children:[F.enable_flat_item_discount==="yes"&&t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"flat_discount",label:"Flat Discount",variant:"outlined",required:!0,value:e.flat_discount??0,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),F.enable_unit_discount==="yes"&&t.jsxs(t.Fragment,{children:[t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount",label:"Unit Discount",variant:"outlined",required:!0,value:e.discount,onChange:o,inputRef:C==="discount"?x:void 0,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(l,{position:"start",children:m})}}})}),t.jsx(s,{size:{sm:6,xs:6,md:4},children:t.jsx(a,{fullWidth:!0,type:"number",name:"discount_percentage",label:"Unit Discount (%)",variant:"outlined",required:!0,value:e.discount_percentage||0,onChange:o,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{endAdornment:t.jsx(l,{position:"start",children:"%"})}}})})]})]}),t.jsx(s,{size:{sm:12,xs:12,md:4},children:t.jsx(a,{fullWidth:!0,type:d?"number":"text",style:{WebkitTextSecurity:d?"none":"disc",MozTextSecurity:d?"none":"disc",msTextSecurity:d?"none":"disc"},disabled:!d,name:"cost",label:"Cost",variant:"outlined",required:!0,onChange:o,value:e.cost,sx:{mt:"0.5rem",input:{fontSize:"1rem"}},onFocus:i=>{i.target.select()},slotProps:{inputLabel:{shrink:!0},input:{readOnly:e.product_type==="reload",startAdornment:t.jsx(l,{position:"start",children:m}),endAdornment:t.jsx(l,{position:"end",children:t.jsx(z,{"aria-label":"toggle cost visibility",onClick:A,edge:"end",children:d?t.jsx(B,{}):t.jsx(N,{})})})}}})})]}),e.price-e.discount<e.cost&&t.jsxs(K,{severity:"error",sx:{mt:2},children:["Selling at a ",t.jsx("b",{children:"lower price"}),". Please be cautious."]})]}),t.jsx(X,{children:t.jsxs(s,{container:!0,spacing:1,size:12,justifyContent:"center",width:"100%",children:[e.quantity>0&&t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"button",color:"error",onClick:i=>{const n={...e,quantity:-Math.abs(e.quantity)};f(n),h()},children:"RETURN"})}),t.jsx(s,{size:{xs:6,sm:6},children:t.jsx(k,{variant:"contained",fullWidth:!0,sx:{paddingY:"10px",fontSize:{xs:"1rem",sm:"1.2rem"}},type:"submit",color:e.quantity<0?"error":"primary",children:e.quantity<0?"RETURN":"UPDATE"})})]})})]})})}export{Kt as default};

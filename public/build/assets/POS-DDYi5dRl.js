import{j as e,r as s}from"./currencyStore-Dk9RVyyc.js";import{F as xe,W as P,C as fe}from"./folder-open-CJR3uNFI.js";import{H as N,B as he}from"./Home-BKek3M8v.js";import{c as X}from"./createSvgIcon-B7q9zImx.js";import{R as ue}from"./Receipt-DnWIM4Bg.js";import{f as ge}from"./productsService-Cx6SDGJw.js";import{u as ye}from"./SyncContext-DCoP7Jma.js";import je from"./ProductItem-BTSm3Xki.js";import Ce from"./CartItem-CMrvZo7O.js";import Se from"./CartSummary-82bu-hA-.js";import be from"./CartFooter-Ch7vuF3l.js";import we from"./SearchBox-CfXbtKPw.js";import ve from"./CartIcon-aCGUFWsj.js";import Ie from"./UnsyncedSalesDialog-DhKj5tMG.js";import{S as ze}from"./SalesContext-CG9t8_rq.js";import H from"./CartItemsTop-DEWWB6nJ.js";import De from"./SaleTemplateItems-DtIG-lUv.js";import V from"./CollectionItem-D_nsMvwI.js";import{S as p}from"./sweetalert2.esm.all-q958Q1qq.js";import{s as Z}from"./memoTheme-BxRvtGIq.js";import{B as n}from"./Box-j1BTqM2v.js";import{C as ke}from"./CssBaseline-DBisayGl.js";import{A as G}from"./AppBar-CxLpgr4B.js";import{T as J}from"./Toolbar-f3-_dlD0.js";import{I as j}from"./IconButton-PbvyX_sG.js";import{T as d}from"./Typography-DOI0NvTt.js";import{T as E}from"./Tooltip-DjVJzg5-.js";import{C as Be}from"./CircularProgress-B97ut0O7.js";import{G as x}from"./Grid-6qcTmjc4.js";import{L as Y}from"./Link-2ACJKGF0.js";import{F as Te}from"./LocalOffer-RDrMQxbC.js";import{D as O}from"./Divider-D4ysiqwk.js";import{A as Ee}from"./Alert-CsOnCL1T.js";import{B as q}from"./Button-aMjmD1gp.js";import{C as Oe}from"./Chip-DT462TV2.js";import{D as K}from"./Drawer-Dk2A_cxp.js";import"./createLucideIcon-BMpC51dL.js";import"./clsx-B-dksMZM.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useForkRef-DgOCCfFR.js";import"./useSlotProps-DuznN7Ax.js";import"./useSlot-PFdYD2CN.js";import"./database-DEIbwPOq.js";import"./import-wrapper-prod-jq4Om1Jp.js";import"./chargesService-CCVnmmfA.js";import"./AppConfigContext-XFUA3Mas.js";import"./product-placeholder-DL4NWfZp.js";import"./currencyFormatter-Be2b0Ktm.js";import"./numeral-NHlY-3dw.js";import"./Card-C4NAxgST.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./CardMedia-lO_mnymB.js";import"./CardContent-CCQfyhgH.js";import"./index-Rj29YxKv.js";import"./index-CsFzvdgQ.js";import"./extendSxProp-Co6nc6xJ.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./Delete-DDMcR4JX.js";import"./QuantityInput-GBNfqYnf.js";import"./Add-5ZpxTNJx.js";import"./Remove-6EDtWCFk.js";import"./useId-9XzpHYrc.js";import"./CartItemModal-DjcGF4YG.js";import"./Close-B9rgBTOR.js";import"./Visibility-BHSl7kaI.js";import"./VisibilityOff-CyahlUox.js";import"./Commission-BSR3AjUX.js";import"./TextField-DpXyhoD7.js";import"./useFormControl-Cowmrh0y.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./Grow-D31e1sMI.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-D1QunwiJ.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./isMuiElement-HmfyYHhb.js";import"./InputAdornment-DZOHCUsF.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./DialogContent-Cz4a0t2H.js";import"./DialogTitle-osZsMdGC.js";import"./DialogActions-BraO_KzF.js";import"./Close-kFSrCAJM.js";import"./ListItem-BK8RisGy.js";import"./listItemButtonClasses-DXPtGUcW.js";import"./ListItemAvatar-DpHqHrXm.js";import"./ListItemText--0XI93dL.js";import"./listItemTextClasses-DNpdtY9T.js";import"./MenuItem-CEIQJ6q4.js";import"./listItemIconClasses-vD-ryqxg.js";import"./dividerClasses-BJEnnqiu.js";import"./FolderCopy-VbOLkKr2.js";import"./ShoppingCart-C6ZMGsLy.js";import"./CheckoutModal-_8yFlqxe.js";import"./FirebaseContext-4dvVdyML.js";import"./Percent-BCjtx-gP.js";import"./CreditCard-Dwl4hWaF.js";import"./HeldItemsModal-DSqEecKB.js";import"./ListItemButton-DDnSs3En.js";import"./QuotationDialog-ktNyJ0Gs.js";import"./SaleTemplateDialog-C55ih7j2.js";import"./index-JJ5bZ37u.js";import"./Search-BJKzt9AK.js";import"./lodash-CwOxCT-R.js";import"./Autocomplete-DfOnEm4b.js";import"./usePreviousProps-Dg0VAGfT.js";import"./Popper-pZx5Iht2.js";import"./Badge-DrYGhX8S.js";import"./Print-5v-Lf9Qb.js";import"./Refresh-Be3nBego.js";import"./PrintReceiptModal-Csw0Y3uy.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./download-CxbKlL8J.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./Edit-ByvjS5ky.js";import"./MUITimePicker-BanoNu3u.js";import"./en-gb-BMmXCQZs.js";import"./useMobilePicker-BIozrTWd.js";import"./index-P4sNTowN.js";import"./MobileTimePicker-CFR5bNoc.js";import"./FormDialog-k2NLfBwH.js";import"./MUIDatePicker-uF2qI3Qp.js";import"./DatePicker--Uxs9Qj-.js";const Q=X(e.jsx("path",{d:"m1 9 2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9m8 8 3 3 3-3c-1.65-1.66-4.34-1.66-6 0m-4-4 2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13"})),U=X(e.jsx("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8m0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4z"}));function Le(){const[l,C]=s.useState(typeof navigator<"u"?navigator.onLine:!0);return s.useEffect(()=>{const g=()=>C(!0),S=()=>C(!1);return window.addEventListener("online",g),window.addEventListener("offline",S),()=>{window.removeEventListener("online",g),window.removeEventListener("offline",S)}},[]),l}const u=530,_e=Z("div")(({theme:l})=>({display:"flex",alignItems:"center",padding:l.spacing(0,1),...l.mixins.toolbar,justifyContent:"flex-end"})),Fe=Z("div")(({theme:l})=>({display:"flex",flexDirection:"column",alignItems:"center",padding:0,zIndex:"999"}));function fo({products:l,allProducts:C,customers:g,return_sale:S,categories:Me,edit_sale:z,sale_data:D,default_charges:ee,all_collections:k,onProductsUpdate:b}){const w=z?"sale_edit_cart":S?"sales_return_cart":"sales_cart",[L,_]=s.useState(!1),[te,F]=s.useState(!1),[re,v]=s.useState(l),[oe,M]=s.useState([]),[W,ie]=s.useState("products"),[f,I]=s.useState(null),[B,y]=s.useState([]),[se,$]=s.useState(!1),a=Le(),{syncState:r,startSync:ne,resetSync:ae}=ye(),R=()=>{F(!0),_(!1)},le=()=>{F(!1)},ce=()=>{te||_(!L)};s.useEffect(()=>{w==="sales_return_cart"&&localStorage.setItem("sales_return_cart",JSON.stringify([])),w==="sale_edit_cart"&&localStorage.setItem("sale_edit_cart",JSON.stringify([]))},[w]),s.useEffect(()=>{z&&D&&!D.cart_snapshot&&p.fire({title:"Only recent sales can be edited",text:"Please select a recent sale to edit",icon:"error",confirmButtonText:"Go to Sales",showCancelButton:!1,showCloseButton:!1,allowOutsideClick:!1}).then(()=>{window.location.href="/sales"})},[z,D]);const me=async()=>{const t=p.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:o=>{o.addEventListener("mouseenter",p.stopTimer),o.addEventListener("mouseleave",p.resumeTimer)}});if(!a){t.fire({icon:"warning",title:"No Internet Connection",text:"Please connect to sync products"});return}try{const o=await ne(async i=>{b&&b(i);const c=i.filter(m=>m.is_featured===!0||m.is_featured===1);v(c),I(null),y([])});if(o.success){const{productCount:i,chargeCount:c,collectionCount:m,contactCount:h}=o;t.fire({icon:"success",title:"Sync Complete!",text:`Synced: ${i} products, ${c} charges, ${m} collections, ${h} contacts`})}else throw new Error(o.error||"Sync failed")}catch(o){console.error("Sync error:",o),t.fire({icon:"error",title:"Sync Failed",text:o.message||"Failed to sync"})}},pe=async()=>{const t=p.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:i=>{i.addEventListener("mouseenter",p.stopTimer),i.addEventListener("mouseleave",p.resumeTimer)}});if(!a){t.fire({icon:"warning",title:"No Internet Connection",text:"Please connect to reset and sync"});return}if((await p.fire({title:"Reset Sync Data?",text:"This will clear all cached products and sync fresh data from the server.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, reset and sync",cancelButtonText:"Cancel"})).isConfirmed)try{t.fire({icon:"info",title:"Resetting...",text:"Clearing cached data"});const i=await ae(async c=>{b&&b(c);const m=c.filter(h=>h.is_featured===!0||h.is_featured===1);v(m),I(null),y([])});if(i.success){const{productCount:c,chargeCount:m,collectionCount:h,contactCount:de}=i;t.fire({icon:"success",title:"Reset Complete!",text:`Synced: ${c} products, ${m} charges, ${h} collections, ${de} contacts`})}else throw new Error(i.error||"Reset failed")}catch(i){console.error("Reset error:",i),t.fire({icon:"error",title:"Reset Failed",text:i.message||"Failed to reset"})}},T=async t=>{try{const o=await ge(t.id);v(o),M([]),I(t),t.children&&t.children.length>0?y(t.children):y([]),ie("products")}catch(o){console.error("Error loading collection products:",o)}},A=e.jsx(e.Fragment,{children:e.jsxs(n,{component:"form",action:"/pos",method:"post",sx:{display:"flex",flexDirection:"column",height:"100%",p:2,pb:0},children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",flex:1,minHeight:0},children:[e.jsx(n,{sx:{display:{xs:"none",sm:"block"}},children:e.jsx(H,{customers:g})}),e.jsx(O,{}),e.jsxs(n,{sx:{flex:1,overflow:"auto",pr:1},children:[e.jsx(Ce,{}),e.jsx(Se,{})]})]}),e.jsx(Fe,{sx:{flexShrink:0,mt:2},children:e.jsx(be,{})})]})});return e.jsxs(ze,{cartType:w,defaultCharges:ee,children:[e.jsxs(n,{sx:{display:"flex"},children:[e.jsx(ke,{}),e.jsx(G,{position:"fixed",sx:{width:{sm:`calc(100% - ${u}px)`},mr:{sm:`${u}px`}},children:e.jsxs(J,{sx:{paddingY:"10px"},children:[e.jsx(j,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:ce,sx:{mr:0,display:{sm:"none"}},children:e.jsx(ve,{})}),e.jsx(n,{sx:{display:{xs:"none",sm:"flex"}},children:e.jsx(d,{variant:"h4",noWrap:!0,component:"div",children:"POS"})}),e.jsx(we,{products:C||l}),e.jsx(E,{title:a?"Sync Products":"No Internet Connection",children:e.jsx("span",{children:e.jsx(j,{color:"inherit",onClick:me,disabled:!a||r.status==="syncing",sx:{ml:1,p:"10px",color:"default","& .MuiSvgIcon-root":{fontSize:30}},type:"button",children:r.status==="syncing"?e.jsx(Be,{size:24,color:"inherit"}):e.jsx(U,{})})})}),e.jsx("a",{href:"/pos",style:{textDecoration:"none",color:"inherit"},children:e.jsx(j,{color:"inherit",sx:{ml:0,p:"10px",color:"default","& .MuiSvgIcon-root":{fontSize:30}},type:"button",title:"Online Mode",children:e.jsx(Q,{})})}),e.jsx("a",{href:"/dashboard",style:{textDecoration:"none",color:"inherit"},children:e.jsx(j,{color:"inherit",sx:{ml:0,p:"10px",color:"default","& .MuiSvgIcon-root":{fontSize:30}},type:"button",children:e.jsx(N,{})})})]})}),e.jsxs(n,{component:"main",sx:{flexGrow:1,p:3,pb:12,width:{sm:`calc(100% - ${u}px)`}},children:[e.jsx(J,{}),e.jsxs(x,{container:!0,spacing:1,sx:{mb:2},children:[e.jsx(De,{templates:oe,setTemplates:M}),W==="products"&&f&&e.jsx(x,{size:12,sx:{mb:2},children:e.jsxs(he,{separator:"/",sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsxs(Y,{component:"button",variant:"body2",onClick:t=>{t.preventDefault(),I(null),y([]),f&&v(l)},sx:{cursor:"pointer",color:"primary.main",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(N,{sx:{fontSize:"18px"}}),"Home"]}),f.parent_id&&e.jsxs(Y,{component:"button",variant:"body2",onClick:t=>{t.preventDefault();const o=k?.find(i=>i.id===f.parent_id);o&&T(o)},sx:{cursor:"pointer",color:"primary.main",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Te,{size:18}),k?.find(t=>t.id===f.parent_id)?.name]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5,color:"text.primary",fontWeight:"bold"},children:[e.jsx(xe,{size:18}),f.name]})]})}),W==="products"&&e.jsxs(e.Fragment,{children:[B&&B.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(x,{size:12,sx:{mb:2},children:e.jsx(d,{variant:"subtitle2",color:"text.secondary",sx:{fontWeight:"bold"},children:"Subcategories"})}),B.map(t=>e.jsx(x,{size:{xs:6,sm:4,md:3,lg:2},sx:{p:1},children:e.jsx(V,{collection:t,onClick:T,hasChildren:t.children&&t.children.length>0})},t.id)),e.jsx(x,{size:12,sx:{my:2},children:e.jsx(O,{})})]}),re?.map(t=>e.jsx(x,{size:{xs:6,sm:6,md:2},sx:{cursor:"pointer"},children:e.jsx(je,{product:t})},`${t.id}-${t.batch_id||t.batch_number}`))]}),!f&&e.jsxs(e.Fragment,{children:[e.jsx(x,{size:12,sx:{mt:4,mb:2},children:e.jsx(O,{textAlign:"left",children:e.jsx(d,{variant:"h6",color:"text.secondary",children:"Collections"})})}),k?.map(t=>e.jsx(x,{size:{xs:6,sm:4,md:3,lg:2},sx:{p:1},children:e.jsx(V,{collection:t,onClick:T,hasChildren:t.children&&t.children.length>0})},t.id))]})]}),e.jsxs(G,{position:"fixed",sx:{top:"auto",bottom:0,left:0,width:{sm:`calc(100% - ${u}px)`},backgroundColor:"#fff3cd",color:"#856404",boxShadow:"0 -1px 3px rgba(0,0,0,0.1)",p:1,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(Ee,{severity:"warning",icon:e.jsx(P,{}),sx:{display:"flex",alignItems:"center",justifyContent:"flex-start",backgroundColor:"transparent",color:"#856404",border:"none",fontWeight:500,m:0,p:0,flex:1,"& .MuiAlert-icon":{mr:1.5,p:0},"& .MuiAlert-message":{p:0,ml:0,textAlign:"left"}},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:.5},children:[e.jsx(d,{variant:"body2",sx:{fontWeight:500},children:"OFFLINE MODE - All data is stored locally on this device"}),r.status==="syncing"&&e.jsxs(d,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.9,fontWeight:600},children:["ðŸ”„ Syncing: ",r.progress,"% - ",r.message]}),r.status==="success"&&e.jsxs(d,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.9,color:"#155724",fontWeight:600},children:["âœ“ ",r.message]}),r.status==="error"&&e.jsxs(d,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.9,color:"#721c24",fontWeight:600},children:["âœ— ",r.message]}),r.status==="idle"&&r.lastSyncedAt&&e.jsxs(d,{variant:"caption",sx:{fontSize:"0.7rem",opacity:.8},children:["Last synced: ",new Date(r.lastSyncedAt).toLocaleString()," â€¢ Local: ",r.localProducts," products, ",r.localCharges," charges, ",r.localCollections," collections, ",r.localContacts," contacts"]})]})}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,ml:2},children:[e.jsx(E,{title:"View unsynced sales pending sync to server",children:e.jsx(q,{variant:"outlined",size:"small",onClick:()=>$(!0),startIcon:e.jsx(ue,{}),sx:{borderColor:"#856404",color:"#856404",fontSize:"0.7rem",py:.5,px:1,minWidth:"auto","&:hover":{borderColor:"#533f03",backgroundColor:"rgba(133, 100, 4, 0.08)"}},children:"View Sales"})}),e.jsx(E,{title:"Clear cached data and sync fresh from server",children:e.jsx("span",{children:e.jsx(q,{variant:"outlined",size:"small",onClick:pe,disabled:!a||r.status==="syncing",startIcon:e.jsx(U,{}),sx:{borderColor:"#856404",color:"#856404",fontSize:"0.7rem",py:.5,px:1,minWidth:"auto","&:hover":{borderColor:"#533f03",backgroundColor:"rgba(133, 100, 4, 0.08)"},"&:disabled":{borderColor:"rgba(133, 100, 4, 0.3)",color:"rgba(133, 100, 4, 0.3)"}},children:"Reset Sync"})})}),e.jsx(Oe,{icon:a?e.jsx(Q,{sx:{fontSize:"16px"}}):e.jsx(P,{sx:{fontSize:"16px"}}),label:a?"Connected":"No Internet",size:"small",sx:{backgroundColor:a?"#d4edda":"#f8d7da",color:a?"#155724":"#721c24",fontWeight:600,fontSize:"0.75rem","& .MuiChip-icon":{color:a?"#155724":"#721c24"}}})]})]})]}),e.jsxs(n,{component:"nav",sx:{width:{sm:u},flexShrink:{sm:0}},children:[e.jsxs(K,{variant:"temporary",open:L,onTransitionEnd:le,onClose:R,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:"100%"}},anchor:"right",children:[e.jsxs(_e,{children:[e.jsx(H,{customers:g}),e.jsx(j,{onClick:R,children:e.jsx(fe,{})})]}),A]}),e.jsx(K,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:u}},open:!0,anchor:"right",children:A})]})]}),e.jsx(Ie,{open:se,onClose:()=>$(!1)})]})}export{fo as default};

import{R as C,r as c,j as e,d as f,b as T}from"./currencyStore-Dk9RVyyc.js";import{C as F}from"./Close-B9rgBTOR.js";import{S as j}from"./sweetalert2.esm.all-q958Q1qq.js";import{I as N}from"./AuthenticatedLayout-CblcNqH9.js";import{P as R}from"./Payments-DSgOMdsa.js";import{H as V}from"./HighlightOff-Bl6nUsD3.js";import{u as $}from"./currencyFormatter-Be2b0Ktm.js";import{D as k,a as H}from"./DialogContent-Cz4a0t2H.js";import{D as O}from"./DialogTitle-osZsMdGC.js";import{I as _}from"./IconButton-PbvyX_sG.js";import{T as u,c as g,b as i,a as y}from"./TableRow-BMfflATG.js";import{T as s}from"./TableCell-DMEjcBPA.js";import{T as q,a as W}from"./Tabs-D51qE-ff.js";import{D as z}from"./DialogActions-BraO_KzF.js";import{B as L}from"./Button-aMjmD1gp.js";import{B as Q}from"./Box-j1BTqM2v.js";function de({open:d,setOpen:w,selectedTransaction:Y=null,type:l="sale"}){const o=$(),[h,S]=C.useState(0),[n,B]=c.useState([]),A=(t,a)=>{S(a)},b=({children:t,value:a,index:r})=>a===r?e.jsx(Q,{sx:{padding:0},children:t}):null,[x,p]=c.useState([]),[D,I]=c.useState([]),m=()=>{w(!1)},P=async t=>{try{const a=t==="sales"?"sale":t,r=await T.post(`/getorderdetails/${a}`,{transaction_id:Y});p(r.data.payments),I(r.data.items),B(r.data.details)}catch(a){console.error("Error fetching payments: ",a)}},E=async t=>{j.fire({title:"Do you want to remove the payment?",showDenyButton:!0,confirmButtonText:"YES",denyButtonText:"NO"}).then(a=>{a.isConfirmed&&T.post(`/delete-payment/${l}`,{transaction_id:t}).then(r=>{const M=x.filter(v=>v.id!==t);p(M),j.fire({title:"Success!",text:r.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0})}).catch(r=>{j.fire({title:r.response.data.error,showConfirmButton:!0,icon:"error"}),console.error("Deletion failed with errors:",r)})})};return c.useEffect(()=>{d&&P(l)},[d]),e.jsx(C.Fragment,{children:e.jsxs(k,{fullWidth:!0,maxWidth:"md",open:d,onClose:m,"aria-labelledby":"alert-dialog-title",children:[e.jsx(O,{id:"alert-dialog-title",children:"VIEW DETAILS"}),e.jsx(_,{"aria-label":"close",onClick:m,sx:t=>({position:"absolute",right:8,top:8,color:t.palette.grey[500]}),children:e.jsx(F,{})}),e.jsxs(H,{sx:{paddingY:"5px"},children:[e.jsx(u,{size:"large",children:e.jsxs(g,{children:[e.jsxs(i,{children:[e.jsx(s,{align:"left",children:"Date"}),e.jsx(s,{sx:{fontWeight:"bold"},align:"right",children:l==="sales"||l==="sale"?f(n.sale_date).format("DD-MM-YYYY"):f(n.purchase_date).format("DD-MM-YYYY")})]}),e.jsxs(i,{children:[e.jsx(s,{align:"left",children:"Contact Name"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:n.contact_name})]}),e.jsxs(i,{children:[e.jsx(s,{align:"left",children:"Total"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:o(n.total_amount,!1)})]}),e.jsxs(i,{children:[e.jsx(s,{align:"left",children:"Discount"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:o(n.discount,!1)})]}),e.jsxs(i,{children:[e.jsx(s,{align:"left",children:"Created At"}),e.jsx(s,{align:"right",sx:{fontWeight:"bold"},children:f(n.created_at).format("DD-MM-YYYY hh:mm A")})]})]})}),e.jsxs(q,{value:h,onChange:A,"aria-label":"icon label tabs example",children:[e.jsx(W,{icon:e.jsx(N,{}),iconPosition:"start",label:"ITEMS"}),e.jsx(W,{icon:e.jsx(R,{}),iconPosition:"start",label:"PAYMENTS"})]}),e.jsx(b,{value:h,index:0,children:e.jsxs(u,{children:[e.jsx(y,{children:e.jsxs(i,{children:[e.jsx(s,{sx:{fontWeight:"bold",whiteSpace:"nowrap"},children:"Name"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Qty"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Price"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Cost"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Discount"})]})}),e.jsx(g,{children:Array.isArray(D)&&D.map((t,a)=>e.jsxs(i,{children:[e.jsxs(s,{className:"whitespace-nowrap",sx:{whiteSpace:"nowrap"},children:[t.name," ",t.batch_number!==null&&` | ${t.batch_number}`]}),e.jsx(s,{children:t.quantity}),e.jsx(s,{children:o(parseFloat(t.unit_price),!1)}),e.jsx(s,{children:o(parseFloat(t.unit_cost),!1)}),e.jsx(s,{children:o(parseFloat(t.discount),!1)})]},a))})]})}),e.jsx(b,{value:h,index:1,children:e.jsxs(u,{children:[e.jsx(y,{children:e.jsxs(i,{children:[e.jsx(s,{sx:{fontWeight:"bold"},children:"Method"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Amount"}),e.jsx(s,{sx:{fontWeight:"bold"},children:"Date"}),e.jsx(s,{sx:{fontWeight:"bold"},children:" Action "})]})}),e.jsx(g,{children:Array.isArray(x)&&x.map((t,a)=>e.jsxs(i,{children:[e.jsx(s,{children:t.amount<0?`${t.payment_method} Refund`:t.payment_method}),e.jsx(s,{children:t.payment_method==="Credit"?`- ${t.amount}`:t.amount}),e.jsx(s,{children:t.transaction_date}),e.jsx(s,{align:"left",children:!t.parent_id&&t.payment_method!=="Credit"&&e.jsx(_,{onClick:()=>E(t.id),edge:"start",color:"error","aria-label":"delete",children:e.jsx(V,{})})})]},a))})]})})]}),e.jsx(z,{children:e.jsx(L,{onClick:m,autoFocus:!0,children:"Close"})})]})})}export{de as V};

import{R as E,r as h,j as r}from"./currencyStore-Dk9RVyyc.js";import{C as F}from"./Close-B9rgBTOR.js";import{P as N}from"./Print-5v-Lf9Qb.js";import{R as U}from"./Refresh-Be3nBego.js";import{R as C}from"./Receipt-DnWIM4Bg.js";import{useFirebase as W}from"./FirebaseContext-4dvVdyML.js";import{P as k}from"./PrintReceiptModal-Csw0Y3uy.js";import{u as $}from"./useTheme-CvovRv7W.js";import{u as q}from"./index-JJ5bZ37u.js";import{D as G,a as Q}from"./DialogContent-Cz4a0t2H.js";import{D as V}from"./DialogTitle-osZsMdGC.js";import{B as a}from"./Box-j1BTqM2v.js";import{T as p}from"./Typography-DOI0NvTt.js";import{C as P}from"./Chip-DT462TV2.js";import{I as D}from"./IconButton-PbvyX_sG.js";import{D as R}from"./Divider-D4ysiqwk.js";import{C as M}from"./CircularProgress-B97ut0O7.js";import{C as J}from"./Card-C4NAxgST.js";import{C as K}from"./CardContent-CCQfyhgH.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./currencyFormatter-Be2b0Ktm.js";import"./numeral-NHlY-3dw.js";import"./Paper-Df0ljdBt.js";import"./Button-aMjmD1gp.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useForkRef-DgOCCfFR.js";import"./download-CxbKlL8J.js";import"./createLucideIcon-BMpC51dL.js";import"./CardMedia-lO_mnymB.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./getThemeProps-DKKyYQML.js";import"./useSlot-PFdYD2CN.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./extendSxProp-Co6nc6xJ.js";import"./index-CsFzvdgQ.js";import"./dividerClasses-BJEnnqiu.js";var _=function(s,i){return _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},_(s,i)};function X(s,i){_(s,i);function t(){this.constructor=s}s.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var g=function(){return g=Object.assign||function(i){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(i[l]=t[l])}return i},g.apply(this,arguments)};function Z(s,i,t,e){var n,l=!1,c=0;function u(){n&&clearTimeout(n)}function x(){u(),l=!0}typeof i!="boolean"&&(e=t,t=i,i=void 0);function d(){var v=this,y=Date.now()-c,S=arguments;if(l)return;function m(){c=Date.now(),t.apply(v,S)}function w(){n=void 0}e&&!n&&m(),u(),e===void 0&&y>s?m():i!==!0&&(n=setTimeout(e?w:m,e===void 0?s-y:s))}return d.cancel=x,d}var f={Pixel:"Pixel",Percent:"Percent"},Y={unit:f.Percent,value:.8};function I(s){return typeof s=="number"?{unit:f.Percent,value:s*100}:typeof s=="string"?s.match(/^(\d*(\.\d+)?)px$/)?{unit:f.Pixel,value:parseFloat(s)}:s.match(/^(\d*(\.\d+)?)%$/)?{unit:f.Percent,value:parseFloat(s)}:(console.warn('scrollThreshold format is invalid. Valid formats: "120px", "50%"...'),Y):(console.warn("scrollThreshold should be string or number"),Y)}var ee=(function(s){X(i,s);function i(t){var e=s.call(this,t)||this;return e.lastScrollTop=0,e.actionTriggered=!1,e.startY=0,e.currentY=0,e.dragging=!1,e.maxPullDownDistance=0,e.getScrollableTarget=function(){return e.props.scrollableTarget instanceof HTMLElement?e.props.scrollableTarget:typeof e.props.scrollableTarget=="string"?document.getElementById(e.props.scrollableTarget):(e.props.scrollableTarget===null&&console.warn(`You are trying to pass scrollableTarget but it is null. This might
        happen because the element may not have been added to DOM yet.
        See https://github.com/ankeetmaini/react-infinite-scroll-component/issues/59 for more info.
      `),null)},e.onStart=function(n){e.lastScrollTop||(e.dragging=!0,n instanceof MouseEvent?e.startY=n.pageY:n instanceof TouchEvent&&(e.startY=n.touches[0].pageY),e.currentY=e.startY,e._infScroll&&(e._infScroll.style.willChange="transform",e._infScroll.style.transition="transform 0.2s cubic-bezier(0,0,0.31,1)"))},e.onMove=function(n){e.dragging&&(n instanceof MouseEvent?e.currentY=n.pageY:n instanceof TouchEvent&&(e.currentY=n.touches[0].pageY),!(e.currentY<e.startY)&&(e.currentY-e.startY>=Number(e.props.pullDownToRefreshThreshold)&&e.setState({pullToRefreshThresholdBreached:!0}),!(e.currentY-e.startY>e.maxPullDownDistance*1.5)&&e._infScroll&&(e._infScroll.style.overflow="visible",e._infScroll.style.transform="translate3d(0px, "+(e.currentY-e.startY)+"px, 0px)")))},e.onEnd=function(){e.startY=0,e.currentY=0,e.dragging=!1,e.state.pullToRefreshThresholdBreached&&(e.props.refreshFunction&&e.props.refreshFunction(),e.setState({pullToRefreshThresholdBreached:!1})),requestAnimationFrame(function(){e._infScroll&&(e._infScroll.style.overflow="auto",e._infScroll.style.transform="none",e._infScroll.style.willChange="unset")})},e.onScrollListener=function(n){typeof e.props.onScroll=="function"&&setTimeout(function(){return e.props.onScroll&&e.props.onScroll(n)},0);var l=e.props.height||e._scrollableNode?n.target:document.documentElement.scrollTop?document.documentElement:document.body;if(!e.actionTriggered){var c=e.props.inverse?e.isElementAtTop(l,e.props.scrollThreshold):e.isElementAtBottom(l,e.props.scrollThreshold);c&&e.props.hasMore&&(e.actionTriggered=!0,e.setState({showLoader:!0}),e.props.next&&e.props.next()),e.lastScrollTop=l.scrollTop}},e.state={showLoader:!1,pullToRefreshThresholdBreached:!1,prevDataLength:t.dataLength},e.throttledOnScrollListener=Z(150,e.onScrollListener).bind(e),e.onStart=e.onStart.bind(e),e.onMove=e.onMove.bind(e),e.onEnd=e.onEnd.bind(e),e}return i.prototype.componentDidMount=function(){if(typeof this.props.dataLength>"u")throw new Error('mandatory prop "dataLength" is missing. The prop is needed when loading more content. Check README.md for usage');if(this._scrollableNode=this.getScrollableTarget(),this.el=this.props.height?this._infScroll:this._scrollableNode||window,this.el&&this.el.addEventListener("scroll",this.throttledOnScrollListener),typeof this.props.initialScrollY=="number"&&this.el&&this.el instanceof HTMLElement&&this.el.scrollHeight>this.props.initialScrollY&&this.el.scrollTo(0,this.props.initialScrollY),this.props.pullDownToRefresh&&this.el&&(this.el.addEventListener("touchstart",this.onStart),this.el.addEventListener("touchmove",this.onMove),this.el.addEventListener("touchend",this.onEnd),this.el.addEventListener("mousedown",this.onStart),this.el.addEventListener("mousemove",this.onMove),this.el.addEventListener("mouseup",this.onEnd),this.maxPullDownDistance=this._pullDown&&this._pullDown.firstChild&&this._pullDown.firstChild.getBoundingClientRect().height||0,this.forceUpdate(),typeof this.props.refreshFunction!="function"))throw new Error(`Mandatory prop "refreshFunction" missing.
          Pull Down To Refresh functionality will not work
          as expected. Check README.md for usage'`)},i.prototype.componentWillUnmount=function(){this.el&&(this.el.removeEventListener("scroll",this.throttledOnScrollListener),this.props.pullDownToRefresh&&(this.el.removeEventListener("touchstart",this.onStart),this.el.removeEventListener("touchmove",this.onMove),this.el.removeEventListener("touchend",this.onEnd),this.el.removeEventListener("mousedown",this.onStart),this.el.removeEventListener("mousemove",this.onMove),this.el.removeEventListener("mouseup",this.onEnd)))},i.prototype.componentDidUpdate=function(t){this.props.dataLength!==t.dataLength&&(this.actionTriggered=!1,this.setState({showLoader:!1}))},i.getDerivedStateFromProps=function(t,e){var n=t.dataLength!==e.prevDataLength;return n?g(g({},e),{prevDataLength:t.dataLength}):null},i.prototype.isElementAtTop=function(t,e){e===void 0&&(e=.8);var n=t===document.body||t===document.documentElement?window.screen.availHeight:t.clientHeight,l=I(e);return l.unit===f.Pixel?t.scrollTop<=l.value+n-t.scrollHeight+1:t.scrollTop<=l.value/100+n-t.scrollHeight+1},i.prototype.isElementAtBottom=function(t,e){e===void 0&&(e=.8);var n=t===document.body||t===document.documentElement?window.screen.availHeight:t.clientHeight,l=I(e);return l.unit===f.Pixel?t.scrollTop+n>=t.scrollHeight-l.value:t.scrollTop+n>=l.value/100*t.scrollHeight},i.prototype.render=function(){var t=this,e=g({height:this.props.height||"auto",overflow:"auto",WebkitOverflowScrolling:"touch"},this.props.style),n=this.props.hasChildren||!!(this.props.children&&this.props.children instanceof Array&&this.props.children.length),l=this.props.pullDownToRefresh&&this.props.height?{overflow:"auto"}:{};return E.createElement("div",{style:l,className:"infinite-scroll-component__outerdiv"},E.createElement("div",{className:"infinite-scroll-component "+(this.props.className||""),ref:function(c){return t._infScroll=c},style:e},this.props.pullDownToRefresh&&E.createElement("div",{style:{position:"relative"},ref:function(c){return t._pullDown=c}},E.createElement("div",{style:{position:"absolute",left:0,right:0,top:-1*this.maxPullDownDistance}},this.state.pullToRefreshThresholdBreached?this.props.releaseToRefreshContent:this.props.pullDownToRefreshContent)),this.props.children,!this.state.showLoader&&!n&&this.props.hasMore&&this.props.loader,this.state.showLoader&&this.props.hasMore&&this.props.loader,!this.props.hasMore&&this.props.endMessage))},i})(h.Component);function tt({open:s,onClose:i}){const t=$(),e=q(t.breakpoints.down("sm")),{getUnsyncedSales:n}=W(),[l,c]=h.useState([]),[u,x]=h.useState([]),[d,v]=h.useState(!1),[y,S]=h.useState(!0),[m,w]=h.useState(!1),[H,b]=h.useState(null),j=10;h.useEffect(()=>{s&&L()},[s]);const L=async()=>{v(!0);try{const o=await n();c(o),x(o.slice(0,j)),S(o.length>j)}catch(o){console.error("[UnsyncedSalesDialog] Error fetching sales:",o)}finally{v(!1)}},A=()=>{const o=u.length,T=l.slice(o,o+j);x([...u,...T]),S(o+T.length<l.length)},z=o=>{b(o),w(!0)},B=o=>o?(o.toDate?o.toDate():new Date(o)).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",O=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o||0);return r.jsxs(r.Fragment,{children:[r.jsxs(G,{open:s,onClose:i,fullScreen:e,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:e?"100vh":"80vh",pb:0}},children:[r.jsx(V,{sx:{pb:1},children:r.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(C,{}),r.jsx(p,{variant:"h6",children:"Unsynced Sales"}),r.jsx(P,{label:`${l.length} pending`,size:"small",color:"warning",sx:{fontWeight:600}})]}),r.jsxs(a,{sx:{display:"flex",gap:1},children:[r.jsx(D,{onClick:L,disabled:d,size:"small",title:"Refresh",children:r.jsx(U,{})}),r.jsx(D,{onClick:i,size:"small",children:r.jsx(F,{})})]})]})}),r.jsx(R,{}),r.jsx(Q,{sx:{p:2},children:d?r.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"300px",gap:2},children:[r.jsx(M,{}),r.jsx(p,{variant:"body2",color:"text.secondary",children:"Loading unsynced sales..."})]}):l.length===0?r.jsxs(a,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"300px",gap:2},children:[r.jsx(C,{sx:{fontSize:64,color:"text.disabled"}}),r.jsx(p,{variant:"h6",color:"text.secondary",children:"All sales synced! ✅"}),r.jsx(p,{variant:"body2",color:"text.secondary",children:"No pending sales to sync to the server"})]}):r.jsx(ee,{dataLength:u.length,next:A,hasMore:y,loader:r.jsx(a,{sx:{textAlign:"center",py:2},children:r.jsx(M,{size:24})}),endMessage:r.jsx(p,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No more sales"}),children:r.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:u.map(o=>r.jsx(J,{variant:"outlined",sx:{"&:hover":{boxShadow:1}},children:r.jsxs(K,{sx:{p:1.5,"&:last-child":{pb:1.5}},children:[r.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[r.jsxs(a,{sx:{flex:1},children:[r.jsx(p,{variant:"body2",sx:{fontWeight:600,fontSize:"0.875rem"},children:o.invoice_number||o.id}),r.jsx(p,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:B(o.createdAt||o.sale_date)})]}),r.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:.5},children:[r.jsx(P,{label:"Pending Sync",size:"small",color:"warning",sx:{fontWeight:500,fontSize:"0.7rem",height:"22px"}}),r.jsx(D,{size:"small",onClick:()=>z(o),sx:{ml:.5},title:"Print Receipt",children:r.jsx(N,{fontSize:"small"})})]})]}),r.jsx(R,{sx:{my:.75}}),r.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap",alignItems:"center"},children:[r.jsxs(p,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.7rem"},children:[o.contact_id?`Customer #${o.contact_id}`:"Walk-in"," • ",o.payment_method||"Cash"," • ",o.items?.length||0," item(s)"]}),r.jsx(p,{variant:"body2",sx:{fontWeight:700,color:"primary.main",fontSize:"0.875rem",ml:"auto"},children:O(o.net_total||o.total_amount||0)})]})]})},o.id))})})})]}),r.jsx(k,{open:m,onClose:()=>{w(!1),b(null)},receiptData:H})]})}export{tt as default};

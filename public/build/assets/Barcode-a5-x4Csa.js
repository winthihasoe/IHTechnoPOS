import{c as h,r as i,j as d,H as f}from"./currencyStore-Dk9RVyyc.js";import{J as u}from"./JsBarcode-DwekVVut.js";const S=(t,o)=>{if(!t)return"";let r=t;return Object.entries(o).forEach(([c,s])=>{const e=`{{${c}}}`;r=r.split(e).join(x(String(s||"")))}),r=r.replace(/\{\{(\w+)\}\}/g,""),r},T=t=>{const{elementId:o="barcode-svg",barcodeCode:r,format:c="CODE128",width:s=1.5,height:e=35,fontSize:a=14}=t;try{const n=document.getElementById(o);if(!n||!r)return;u(n,r,{format:c,width:s,height:e,fontSize:a})}catch(n){console.error("Error generating barcode:",n)}},x=t=>{const o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,r=>o[r])};function j({product:t,barcode_settings:o,template:r}){const c=h().props.settings.shop_name,s=t.selling_price?`${t.selling_price}`:"",e=o.barcode_settings?JSON.parse(o.barcode_settings):{},[a]=i.useState({containerHeight:e.container_height||"28mm",storeFontSize:e.store_font_size||"0.8em",priceFontSize:e.price_font_size||"0.8em",priceMarginTop:e.price_margin_top||"-3px",priceMarginBottom:e.price_margin_bottom||"-5px",barcodeMarginTop:e.barcode_margin_top||"-10px",barcodeHeight:e.barcode_height||35,barcodeFontSize:e.barcode_font_size||14,barcodeWidth:e.barcode_width||1.5,barcodeFormat:e.barcode_format||"CODE128",productNameMarginTop:e.product_name_margin_top||"-4px",productNameFontSize:e.product_name_font_size||"0.7em"}),[n,g]=i.useState("");return i.useEffect(()=>{(async()=>{let m=r;if(!m)try{m=(await(await fetch("/api/barcode-template")).json()).template||""}catch(l){console.error("Error fetching barcode template:",l)}const _={product_name:t.name||"",price:s,barcode_code:t.barcode||"",store_name:c||"",date:new Date().toLocaleDateString()},b=S(m,_);g(b)})()},[t,c,s]),i.useEffect(()=>{const p=setTimeout(()=>{T({elementId:"barcode-svg",barcodeCode:t.barcode,format:a.barcodeFormat,width:parseFloat(a.barcodeWidth),height:parseInt(a.barcodeHeight),fontSize:parseInt(a.barcodeFontSize)})},300);return()=>clearTimeout(p)},[n,a]),d.jsxs(d.Fragment,{children:[d.jsx(f,{title:"Barcode"}),d.jsx("div",{dangerouslySetInnerHTML:{__html:n}})]})}export{j as default};

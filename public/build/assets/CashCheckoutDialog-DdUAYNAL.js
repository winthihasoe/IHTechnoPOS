import{g as rt,c as p,r as s,f as it,R as nt,j as t,b as z,a as at}from"./currencyStore-Dk9RVyyc.js";import{P as st}from"./Payments-DSgOMdsa.js";import{C as lt}from"./Close-B9rgBTOR.js";import{P as ct}from"./PrintReceiptModal-Csw0Y3uy.js";import{P as mt}from"./Percent-BCjtx-gP.js";import{S as W}from"./sweetalert2.esm.all-q958Q1qq.js";import{u as ut}from"./SalesContext-CG9t8_rq.js";import{u as pt,t as l}from"./currencyFormatter-Be2b0Ktm.js";import{G as d}from"./Grid-6qcTmjc4.js";import{B as I}from"./Button-aMjmD1gp.js";import{D as dt,a as ft}from"./DialogContent-Cz4a0t2H.js";import{D as ht}from"./DialogTitle-osZsMdGC.js";import{I as O}from"./IconButton-PbvyX_sG.js";import{T as f}from"./TextField-DpXyhoD7.js";import{I as h}from"./InputAdornment-DZOHCUsF.js";import{F as xt}from"./FormControlLabel-eGygXIaI.js";import{C as gt}from"./Checkbox-DmEdO0Ay.js";import{D as Ct}from"./DialogActions-BraO_KzF.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./ReceiptDisplay-_SLXtf8O.js";import"./Print-5v-Lf9Qb.js";import"./snapdom-dxSfVsGw.js";import"./Barcode-DaGb-pRP.js";import"./JsBarcode-DwekVVut.js";import"./Paper-Df0ljdBt.js";import"./useTheme-CvovRv7W.js";import"./Box-j1BTqM2v.js";import"./extendSxProp-Co6nc6xJ.js";import"./Typography-DOI0NvTt.js";import"./index-CsFzvdgQ.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./download-CxbKlL8J.js";import"./createLucideIcon-BMpC51dL.js";import"./Card-C4NAxgST.js";import"./CardMedia-lO_mnymB.js";import"./Divider-D4ysiqwk.js";import"./dividerClasses-BJEnnqiu.js";import"./TableContainer-Bx1in-E2.js";import"./TableRow-BMfflATG.js";import"./TableCell-DMEjcBPA.js";import"./CircularProgress-B97ut0O7.js";import"./numeral-NHlY-3dw.js";import"./useThemeProps-Cgy5Iu59.js";import"./getThemeProps-DKKyYQML.js";import"./isMuiElement-HmfyYHhb.js";import"./useId-9XzpHYrc.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./useForkRef-DgOCCfFR.js";import"./useSlot-PFdYD2CN.js";import"./Modal-D1QunwiJ.js";import"./ownerWindow-HkKU3E4x.js";import"./ownerDocument-DW-IO8s5.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./useFormControl-Cowmrh0y.js";import"./debounce-Be36O1Ab.js";import"./index-DM5RHFVd.js";import"./useSlotProps-DuznN7Ax.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./useControlled-DRAJCB75.js";import"./SwitchBase-DLVdjlNh.js";function Te({disabled:T}){const x=pt(),g=rt(o=>o.settings.currency_symbol),y=p().props.return_sale,B=p().props.sale_id,E=p().props.edit_sale,M=p().props.sale_id,{cartState:N,cartTotal:i,totalProfit:L,emptyCart:G,charges:A,totalChargeAmount:Y,finalTotal:_t,discount:n,setDiscount:u,calculateChargesWithDiscount:C}=ut(),{selectedCustomer:q,saleDate:U,saleTime:$}=s.useContext(it),[_,P]=s.useState(!1),[H,F]=s.useState(!1),[J,R]=s.useState(null),V=p().props.settings?.auto_open_print_dialog??"1",[k,K]=s.useState(V==="1"),[c,j]=s.useState(0),[m,b]=s.useState(Y),Q=window.innerWidth<768,D=i-n+m;s.useEffect(()=>{b(C(n))},[A,i,n]);const X=o=>{const a=o.target.value,e=a!==""?parseFloat(a):0;u(e);const r=C(e);b(r)},[Z,S]=nt.useState(!1),tt=()=>{u(0),S(!0)},w=()=>{j(0),u(0),S(!1)},et=o=>{if(o.preventDefault(),_)return;P(!0);const a=new FormData(o.currentTarget),e=Object.fromEntries(a.entries());e.amount_received=l(e.amount_received),e.discount=l(e.discount),e.net_total=l(i-n+m),e.change_amount=l(c-(i-n+m)),e.cartItems=N.map(r=>({...r,price:l(r.price),quantity:l(r.quantity),discount:l(r.discount||0)})),e.charges=A.map(r=>({...r,rate_value:l(r.rate_value)})),e.profit_amount=L-n,e.sale_date=U,e.sale_time=$,e.payment_method="Cash",e.contact_id=q.id,e.return_sale=y,e.return_sale_id=B,e.edit_sale_id=M,e.edit_sale=E,z.post("/pos/checkout",e).then(r=>{W.fire({title:"Success!",text:r.data.message,icon:"success",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),G(),j(0),u(0),k&&r.data.receipt?(R(r.data.receipt),F(!0)):at.visit("/receipt/"+r.data.sale_id),z.get("/sale-notification/"+r.data.sale_id).then(v=>{console.log("Notification sent successfully:",v.data.success)}).catch(v=>{console.error("Failed to send notification:",v.response.data.error)}),S(!1)}).catch(r=>{W.fire({title:"Failed!",text:r.response.data.error,icon:"error",showConfirmButton:!0}),console.log(r)}).finally(()=>{P(!1)})},ot=()=>{if(n<0||n>100){alert("Discount must be between 0 and 100");return}const o=i*n/100;u(o);const a=C(o);b(a)};return t.jsxs(d,{size:12,children:[t.jsx(I,{variant:"contained",color:"success",sx:{paddingY:"15px",flexGrow:"1"},size:"large",endIcon:t.jsx(st,{}),onClick:tt,disabled:T,fullWidth:!0,children:D<0?`REFUND ${x(Math.abs(D))}`:`CASH ${x(D)}`}),t.jsxs(dt,{fullWidth:!0,maxWidth:"sm",open:Z,onClose:w,"aria-labelledby":"alert-dialog-title",PaperProps:{component:"form",onSubmit:et},fullScreen:Q,children:[t.jsx(ht,{id:"alert-dialog-title",children:"Cash Checkout"}),t.jsx(O,{"aria-label":"close",onClick:w,sx:o=>({position:"absolute",right:8,top:8,color:o.palette.grey[500]}),children:t.jsx(lt,{})}),t.jsxs(ft,{children:[t.jsx(f,{id:"txtAmount",fullWidth:!0,autoFocus:!0,variant:"outlined",label:i<0?"Refund":"Amount Received",type:"number",name:"amount_received",onFocus:o=>{o.target.select()},onChange:o=>{const a=o.target.value,e=parseFloat(a);j(y&&e>0?-e:e)},sx:{input:{textAlign:"center",fontSize:"2rem"}},value:c,slotProps:{input:{style:{textAlign:"center"},placeholder:i<0?"Refund Amount":"Amount Received",startAdornment:t.jsx(h,{position:"start",children:g})}}}),t.jsx(f,{fullWidth:!0,id:"txtDiscount",type:"number",name:"discount",label:"Discount",variant:"outlined",value:n,sx:{mt:"1.5rem",input:{textAlign:"center",fontSize:"2rem"}},onChange:X,onFocus:o=>{o.target.select()},slotProps:{inputLabel:{shrink:!0},input:{startAdornment:t.jsx(h,{position:"start",children:g}),endAdornment:t.jsx(h,{position:"start",children:t.jsx(O,{color:"primary",onClick:ot,children:t.jsx(mt,{fontSize:"large"})})})}}}),t.jsxs(d,{container:!0,spacing:{xs:2,md:1},mt:3,children:[t.jsx(d,{size:{xs:12,sm:6},children:t.jsx(f,{fullWidth:!0,label:"Payable Amount",variant:"outlined",name:"net_total",value:x(i-n+m,!1),sx:{input:{textAlign:"center",fontSize:"2rem"}},slotProps:{input:{readOnly:!0,style:{textAlign:"center"},startAdornment:t.jsx(h,{position:"start",children:g})}}})}),t.jsx(d,{size:{xs:12,sm:6},children:t.jsx(f,{id:"txtChange",fullWidth:!0,label:"Change",variant:"outlined",name:"change_amount",sx:{input:{textAlign:"center",fontSize:"2rem"}},value:x(c-(i-n+m),!1),slotProps:{input:{readOnly:!0,startAdornment:t.jsx(h,{position:"start",children:g})}}})})]}),t.jsx(f,{fullWidth:!0,variant:"outlined",label:"Note",name:"note",multiline:!0,sx:{mt:"2rem"}}),t.jsx(d,{container:!0,size:12,sx:{mt:"2rem",mb:"1rem"},children:t.jsx(xt,{control:t.jsx(gt,{checked:k,onChange:o=>K(o.target.checked),name:"open_print_dialog"}),label:"Open Print Dialog"})})]}),t.jsx(Ct,{children:t.jsx(I,{variant:"contained",fullWidth:!0,sx:{paddingY:"15px",fontSize:"1.5rem"},type:"submit",disabled:!c||i<0&&c===0||i<0&&c!=i-n+m||i>=0&&c-(i-n+m)<0||_,children:_?"Loading...":i<0?"REFUND":"PAY"})})]}),t.jsx(ct,{open:H,onClose:()=>{F(!1),R(null)},receiptData:J})]})}export{Te as default};

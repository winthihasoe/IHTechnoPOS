import{r as o,f as j,j as n}from"./currencyStore-Dk9RVyyc.js";import{S as k}from"./Search-BJKzt9AK.js";import{_ as b}from"./lodash-CwOxCT-R.js";import{u as B}from"./SalesContext-CG9t8_rq.js";import{useAppConfig as E}from"./AppConfigContext-XFUA3Mas.js";import{s as w}from"./productsService-Cx6SDGJw.js";import{B as $}from"./Box-j1BTqM2v.js";import{A}from"./Autocomplete-DfOnEm4b.js";import{T as O}from"./TextField-DpXyhoD7.js";import{D as R}from"./Divider-D4ysiqwk.js";import{I as D}from"./IconButton-PbvyX_sG.js";import"./createSvgIcon-B7q9zImx.js";import"./clsx-B-dksMZM.js";import"./memoTheme-BxRvtGIq.js";import"./index-Rj29YxKv.js";import"./database-DEIbwPOq.js";import"./import-wrapper-prod-jq4Om1Jp.js";import"./useTheme-CvovRv7W.js";import"./extendSxProp-Co6nc6xJ.js";import"./Close-kFSrCAJM.js";import"./useSlot-PFdYD2CN.js";import"./useForkRef-DgOCCfFR.js";import"./useId-9XzpHYrc.js";import"./useControlled-DRAJCB75.js";import"./usePreviousProps-Dg0VAGfT.js";import"./TransitionGroupContext-yQ7B3b2o.js";import"./Portal-DeuEDNNi.js";import"./index-DJHI8khq.js";import"./Paper-Df0ljdBt.js";import"./Popper-pZx5Iht2.js";import"./index-DM5RHFVd.js";import"./ownerDocument-DW-IO8s5.js";import"./useSlotProps-DuznN7Ax.js";import"./Chip-DT462TV2.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./ButtonBase-CjVOrSoJ.js";import"./useTimeout--F2UA0HV.js";import"./emotion-react.browser.esm-BdOGWTdw.js";import"./useFormControl-Cowmrh0y.js";import"./index-CsFzvdgQ.js";import"./ownerWindow-HkKU3E4x.js";import"./debounce-Be36O1Ab.js";import"./Grow-D31e1sMI.js";import"./mergeSlotProps-D_PRovB-.js";import"./Modal-D1QunwiJ.js";import"./List-OrinuOpJ.js";import"./ListContext-CTnR0k9S.js";import"./isMuiElement-HmfyYHhb.js";import"./dividerClasses-BJEnnqiu.js";import"./CircularProgress-B97ut0O7.js";function Re({products:F=[]}){const{return_sale:y}=E(),{setCartItemModalOpen:u,setSelectedCartItem:p}=o.useContext(j),{addToCart:m,cartState:s}=B(),[I,a]=o.useState(!1),[L,S]=o.useState(""),[C,d]=o.useState([]),[_,f]=o.useState(""),l=o.useRef(null),h=o.useCallback(async e=>{if(e.length>=2){a(!0);try{const t=await w(e);if(d(t),a(!1),t.length===1){const r=[...t];if(r[0].discount_percentage&&Number(r[0].discount_percentage)!==0){const i=r[0].price*r[0].discount_percentage/100;r[0].discount=i}const g=b.findIndex(s,i=>i.id===r.id&&i.batch_number===r.batch_number&&!["custom","reload"].includes(i.product_type));if(g!==-1?r[0].quantity=s[g].quantity:(r[0].quantity=1,m(r[0])),r[0].product_type==="reload"){const i=s.length>0?s.length:0;r[0].cart_index=i}p(r[0]),u(!0)}}catch(t){console.error("Search error:",t),a(!1)}}else e.length===0&&(d([]),a(!1))},[s,m,p,u]),c=o.useCallback(b.debounce(e=>{h(e)},150),[h]);o.useEffect(()=>{l.current&&l.current.focus()},[]),o.useEffect(()=>()=>{c.cancel()},[c]);const v=o.useCallback(e=>{const t=e.target.value;S(t),c(t)},[c]);o.useEffect(()=>(document.addEventListener("keydown",x,!0),()=>{document.removeEventListener("keydown",x,!0)}),[]);const x=e=>{if(e.key==="ArrowUp"){e.preventDefault();const t=document.getElementById("searchBox");t&&(t.focus(),t.select())}};return n.jsx(n.Fragment,{children:n.jsxs($,{elevation:0,sx:{p:"2px 2px",ml:{sm:"2rem",xs:"0.5rem"},display:"flex",alignItems:"center",width:"100%",height:"55px",backgroundColor:"white",borderRadius:"5px"},children:[n.jsx(A,{id:"searchBox",disabled:y,fullWidth:!0,disableCloseOnSelect:!0,freeSolo:!0,options:C,inputValue:_,handleHomeEndKeys:!0,loading:I,onInputChange:(e,t)=>{f(t)},getOptionLabel:e=>typeof e=="string"?e:`${e.name} | ${e.barcode}${e.sku?` | ${e.sku}`:""} | ${e.batch_number} | Rs.${e.price}`,getOptionKey:e=>`${e.id}-${e.batch_id}`,onChange:(e,t)=>{if(t&&typeof t=="object"&&t.id){if(m(t),t.quantity=1,t.product_type==="reload"){const r=s.length>0?s.length:0;t.cart_index=r}p(t),u(!0),f(""),d([])}},renderInput:e=>n.jsx(O,{...e,inputRef:l,fullWidth:!0,placeholder:"Search product... Use Arrow up key to focus ⬆️",id:"searchBox",onChange:v,onFocus:t=>{t.target.select()},sx:{"& .MuiOutlinedInput-root":{"& fieldset":{border:"none"},"&:hover fieldset":{border:"none"},"&.Mui-focused fieldset":{border:"none"}}}})}),n.jsx(R,{sx:{height:28,m:.5},orientation:"vertical"}),n.jsx(D,{type:"button",sx:{p:"10px"},"aria-label":"search",children:n.jsx(k,{})})]})})}export{Re as default};
